import{_ as a,c as n,o as l,b as p}from"./chunks/framework.CMLuPXeo.js";const d=JSON.parse('{"title":"nuxtjs 数据获取","description":"","frontmatter":{},"headers":[{"level":2,"title":"理解数据获取","slug":"理解数据获取","link":"#理解数据获取","children":[]},{"level":2,"title":"数据获取方案概览","slug":"数据获取方案概览","link":"#数据获取方案概览","children":[]},{"level":2,"title":"useAsyncData","slug":"useasyncdata","link":"#useasyncdata","children":[{"level":3,"title":"核心概念","slug":"核心概念","link":"#核心概念","children":[]},{"level":3,"title":"基本用法","slug":"基本用法","link":"#基本用法","children":[]},{"level":3,"title":"高级配置","slug":"高级配置","link":"#高级配置","children":[]}]},{"level":2,"title":"useFetch  composable","slug":"usefetch-composable","link":"#usefetch-composable","children":[{"level":3,"title":"智能获取","slug":"智能获取","link":"#智能获取","children":[]}]},{"level":2,"title":"asyncData 方法","slug":"asyncdata-方法","link":"#asyncdata-方法","children":[{"level":3,"title":"页面级数据获取","slug":"页面级数据获取","link":"#页面级数据获取","children":[]},{"level":3,"title":"执行时机","slug":"执行时机","link":"#执行时机","children":[]},{"level":3,"title":"基本用法","slug":"基本用法-1","link":"#基本用法-1","children":[]},{"level":3,"title":"上下文参数","slug":"上下文参数","link":"#上下文参数","children":[]}]},{"level":2,"title":"fetch 方法","slug":"fetch-方法","link":"#fetch-方法","children":[{"level":3,"title":"组件级数据获取","slug":"组件级数据获取","link":"#组件级数据获取","children":[]},{"level":3,"title":"核心特性","slug":"核心特性","link":"#核心特性","children":[]},{"level":3,"title":"基本用法","slug":"基本用法-2","link":"#基本用法-2","children":[]},{"level":3,"title":"高级配置","slug":"高级配置-1","link":"#高级配置-1","children":[]}]},{"level":2,"title":"数据获取与状态管理","slug":"数据获取与状态管理","link":"#数据获取与状态管理","children":[{"level":3,"title":"与 Vuex 集成","slug":"与-vuex-集成","link":"#与-vuex-集成","children":[]},{"level":3,"title":"服务端初始化","slug":"服务端初始化","link":"#服务端初始化","children":[]}]},{"level":2,"title":"API 调用方式","slug":"api-调用方式","link":"#api-调用方式","children":[{"level":3,"title":"$fetch 使用","slug":"fetch-使用","link":"#fetch-使用","children":[]},{"level":3,"title":"使用 axios","slug":"使用-axios","link":"#使用-axios","children":[]}]},{"level":2,"title":"性能优化策略","slug":"性能优化策略","link":"#性能优化策略","children":[{"level":3,"title":"缓存策略","slug":"缓存策略","link":"#缓存策略","children":[]},{"level":3,"title":"预加载与懒加载","slug":"预加载与懒加载","link":"#预加载与懒加载","children":[]}]},{"level":2,"title":"错误处理与加载状态","slug":"错误处理与加载状态","link":"#错误处理与加载状态","children":[{"level":3,"title":"统一错误处理","slug":"统一错误处理","link":"#统一错误处理","children":[]},{"level":3,"title":"加载状态管理","slug":"加载状态管理","link":"#加载状态管理","children":[]}]},{"level":2,"title":"最佳实践指南","slug":"最佳实践指南","link":"#最佳实践指南","children":[{"level":3,"title":"选择合适的数据获取方法","slug":"选择合适的数据获取方法","link":"#选择合适的数据获取方法","children":[]},{"level":3,"title":"性能优化建议","slug":"性能优化建议","link":"#性能优化建议","children":[]},{"level":3,"title":"开发体验提升","slug":"开发体验提升","link":"#开发体验提升","children":[]}]}],"relativePath":"framework/nuxtjs/data-fetching.md","filePath":"framework/nuxtjs/data-fetching.md"}'),o={name:"framework/nuxtjs/data-fetching.md"};function e(t,s,c,r,E,i){return l(),n("div",null,[...s[0]||(s[0]=[p(`<div style="display:none;" hidden="true" aria-hidden="true">Are you an LLM? You can read better optimized documentation at /framework/nuxtjs/data-fetching.md for this page in Markdown format</div><h1 id="nuxtjs-数据获取" tabindex="-1">nuxtjs 数据获取 <a class="header-anchor" href="#nuxtjs-数据获取" aria-label="Permalink to &quot;nuxtjs 数据获取&quot;">​</a></h1><h2 id="理解数据获取" tabindex="-1">理解数据获取 <a class="header-anchor" href="#理解数据获取" aria-label="Permalink to &quot;理解数据获取&quot;">​</a></h2><p>在现代 Web 开发中，数据获取是连接前端界面与后端服务的桥梁。Nuxt.js 提供了多种数据获取方式，适应不同的渲染模式和应用场景。</p><p>示意图： [浏览器请求] → [Nuxt 应用] → [API 服务器]<br> ↓<br> [数据返回] → [页面渲染]</p><h2 id="数据获取方案概览" tabindex="-1">数据获取方案概览 <a class="header-anchor" href="#数据获取方案概览" aria-label="Permalink to &quot;数据获取方案概览&quot;">​</a></h2><p>Nuxt.js 提供了丰富的数据获取方法，主要分为：</p><ul><li><strong>useAsyncData</strong>：Composition API 风格，适用于 Nuxt 3</li><li><strong>useFetch</strong>：基于 useAsyncData 的快捷方式</li><li><strong>asyncData</strong>：Options API 风格，仅限页面组件</li><li><strong>fetch</strong>：组件级数据获取，支持更多配置选项</li><li><strong>直接调用 API</strong>：使用 $fetch、axios 等 HTTP 客户端</li></ul><h2 id="useasyncdata" tabindex="-1">useAsyncData <a class="header-anchor" href="#useasyncdata" aria-label="Permalink to &quot;useAsyncData&quot;">​</a></h2><h3 id="核心概念" tabindex="-1">核心概念 <a class="header-anchor" href="#核心概念" aria-label="Permalink to &quot;核心概念&quot;">​</a></h3><p><code>useAsyncData</code> 是 Nuxt 3 的 Composition API 函数，用于在组件中加载和管理异步数据。它与 Nuxt 的响应式系统和页面生命周期紧密集成。</p><h3 id="基本用法" tabindex="-1">基本用法 <a class="header-anchor" href="#基本用法" aria-label="Permalink to &quot;基本用法&quot;">​</a></h3><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#E1E4E8;">&lt;</span><span style="color:#85E89D;">template</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">  &lt;</span><span style="color:#85E89D;">div</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;</span><span style="color:#85E89D;">p</span><span style="color:#B392F0;"> v-if</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;pending&quot;</span><span style="color:#E1E4E8;">&gt;正在加载...&lt;/</span><span style="color:#85E89D;">p</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;</span><span style="color:#85E89D;">p</span><span style="color:#B392F0;"> v-if</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;error&quot;</span><span style="color:#E1E4E8;">&gt;加载错误: {{ error.message }}&lt;/</span><span style="color:#85E89D;">p</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;</span><span style="color:#85E89D;">div</span><span style="color:#B392F0;"> v-if</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;data&quot;</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">      &lt;</span><span style="color:#85E89D;">p</span><span style="color:#E1E4E8;">&gt;{{ data }}&lt;/</span><span style="color:#85E89D;">p</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;/</span><span style="color:#85E89D;">div</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">  &lt;/</span><span style="color:#85E89D;">div</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">&lt;/</span><span style="color:#85E89D;">template</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">&lt;</span><span style="color:#85E89D;">script</span><span style="color:#B392F0;"> setup</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">const { data, pending, error } = await useAsyncData(&#39;unique-key&#39;, async () =&gt; {</span></span>
<span class="line"><span style="color:#E1E4E8;">  const response </span><span style="color:#F97583;">=</span><span style="color:#F97583;"> await</span><span style="color:#B392F0;"> fetch</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;https://api.example.com/data&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#B392F0;">  if</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">!</span><span style="color:#E1E4E8;">response.ok) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    throw new </span><span style="color:#B392F0;">Error</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;网络错误&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">  return response.</span><span style="color:#B392F0;">json</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"><span style="color:#E1E4E8;">})</span></span>
<span class="line"><span style="color:#E1E4E8;">&lt;/</span><span style="color:#85E89D;">script</span><span style="color:#E1E4E8;">&gt;</span></span></code></pre></div><h3 id="高级配置" tabindex="-1">高级配置 <a class="header-anchor" href="#高级配置" aria-label="Permalink to &quot;高级配置&quot;">​</a></h3><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> { </span><span style="color:#79B8FF;">data</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">refresh</span><span style="color:#E1E4E8;"> } </span><span style="color:#F97583;">=</span><span style="color:#F97583;"> await</span><span style="color:#B392F0;"> useAsyncData</span><span style="color:#E1E4E8;">(</span></span>
<span class="line"><span style="color:#9ECBFF;">  &#39;posts&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#F97583;">  async</span><span style="color:#E1E4E8;"> () </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#F97583;">    const</span><span style="color:#79B8FF;"> posts</span><span style="color:#F97583;"> =</span><span style="color:#F97583;"> await</span><span style="color:#B392F0;"> $fetch</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;/api/posts&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#F97583;">    return</span><span style="color:#E1E4E8;"> posts</span></span>
<span class="line"><span style="color:#E1E4E8;">  },</span></span>
<span class="line"><span style="color:#E1E4E8;">  {</span></span>
<span class="line"><span style="color:#E1E4E8;">    cache: </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">,        </span><span style="color:#6A737D;">// 启用缓存</span></span>
<span class="line"><span style="color:#E1E4E8;">    retry: </span><span style="color:#79B8FF;">3</span><span style="color:#E1E4E8;">,           </span><span style="color:#6A737D;">// 失败时重试次数</span></span>
<span class="line"><span style="color:#B392F0;">    transform</span><span style="color:#E1E4E8;">: (</span><span style="color:#FFAB70;">data</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#6A737D;">      // 数据转换</span></span>
<span class="line"><span style="color:#F97583;">      return</span><span style="color:#E1E4E8;"> data.</span><span style="color:#B392F0;">map</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">item</span><span style="color:#F97583;"> =&gt;</span><span style="color:#E1E4E8;"> ({ </span><span style="color:#F97583;">...</span><span style="color:#E1E4E8;">item, processed: </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;"> }))</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">)</span></span></code></pre></div><h2 id="usefetch-composable" tabindex="-1">useFetch composable <a class="header-anchor" href="#usefetch-composable" aria-label="Permalink to &quot;useFetch  composable&quot;">​</a></h2><h3 id="智能获取" tabindex="-1">智能获取 <a class="header-anchor" href="#智能获取" aria-label="Permalink to &quot;智能获取&quot;">​</a></h3><p><code>useFetch</code> 是基于 <code>useAsyncData</code> 的封装，能自动根据 URL 生成 key，并内置了请求能力。</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#E1E4E8;">&lt;</span><span style="color:#85E89D;">script</span><span style="color:#B392F0;"> setup</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">const { data: posts, pending, error } = await useFetch(&#39;/api/posts&#39;)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">// 带参数请求</span></span>
<span class="line"><span style="color:#E1E4E8;">const { data: user } = await useFetch(&#39;/api/users&#39;, {</span></span>
<span class="line"><span style="color:#E1E4E8;">  query: { id: </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> },</span></span>
<span class="line"><span style="color:#E1E4E8;">  watch: [userId]  </span><span style="color:#6A737D;">// 监听响应式数据变化</span></span>
<span class="line"><span style="color:#E1E4E8;">})</span></span>
<span class="line"><span style="color:#E1E4E8;">&lt;/</span><span style="color:#85E89D;">script</span><span style="color:#E1E4E8;">&gt;</span></span></code></pre></div><h2 id="asyncdata-方法" tabindex="-1">asyncData 方法 <a class="header-anchor" href="#asyncdata-方法" aria-label="Permalink to &quot;asyncData 方法&quot;">​</a></h2><h3 id="页面级数据获取" tabindex="-1">页面级数据获取 <a class="header-anchor" href="#页面级数据获取" aria-label="Permalink to &quot;页面级数据获取&quot;">​</a></h3><p><code>asyncData</code> 是 Nuxt.js 的传统数据获取方法，专门用于页面组件。它在组件初始化前被调用，因此无法通过 <code>this</code> 访问组件实例。</p><h3 id="执行时机" tabindex="-1">执行时机 <a class="header-anchor" href="#执行时机" aria-label="Permalink to &quot;执行时机&quot;">​</a></h3><p>示意图： [页面请求] → [asyncData 执行] → [组件初始化] → [页面渲染]</p><h3 id="基本用法-1" tabindex="-1">基本用法 <a class="header-anchor" href="#基本用法-1" aria-label="Permalink to &quot;基本用法&quot;">​</a></h3><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#F97583;">export</span><span style="color:#F97583;"> default</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#F97583;">  async</span><span style="color:#B392F0;"> asyncData</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">context</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#F97583;">    const</span><span style="color:#79B8FF;"> post</span><span style="color:#F97583;"> =</span><span style="color:#F97583;"> await</span><span style="color:#E1E4E8;"> context.$http.</span><span style="color:#B392F0;">$get</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">\`/api/posts/\${</span><span style="color:#E1E4E8;">context</span><span style="color:#9ECBFF;">.</span><span style="color:#E1E4E8;">params</span><span style="color:#9ECBFF;">.</span><span style="color:#E1E4E8;">id</span><span style="color:#9ECBFF;">}\`</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#F97583;">    return</span><span style="color:#E1E4E8;"> { post }</span></span>
<span class="line"><span style="color:#E1E4E8;">  },</span></span>
<span class="line"><span style="color:#B392F0;">  data</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#F97583;">    return</span><span style="color:#E1E4E8;"> { localData: </span><span style="color:#9ECBFF;">&#39;default&#39;</span><span style="color:#E1E4E8;"> }</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre></div><h3 id="上下文参数" tabindex="-1">上下文参数 <a class="header-anchor" href="#上下文参数" aria-label="Permalink to &quot;上下文参数&quot;">​</a></h3><p>asyncData 接收上下文对象，包含：</p><ul><li><code>params</code>：路由参数</li><li><code>query</code>：查询字符串</li><li><code>store</code>：Vuex 状态</li><li><code>req</code>/<strong><code>res</code></strong>：HTTP 请求/响应对象 (服务端)</li><li><code>redirect</code>：重定向方法</li><li><code>error</code>：错误处理方法</li></ul><h2 id="fetch-方法" tabindex="-1">fetch 方法 <a class="header-anchor" href="#fetch-方法" aria-label="Permalink to &quot;fetch 方法&quot;">​</a></h2><h3 id="组件级数据获取" tabindex="-1">组件级数据获取 <a class="header-anchor" href="#组件级数据获取" aria-label="Permalink to &quot;组件级数据获取&quot;">​</a></h3><p>Nuxt.js 提供了 <code>fetch</code> 方法，允许在任何组件中获取数据。自 Nuxt.js 2.12 版本开始引入，为数据获取提供了更加灵活和强大的解决方案。</p><h3 id="核心特性" tabindex="-1">核心特性 <a class="header-anchor" href="#核心特性" aria-label="Permalink to &quot;核心特性&quot;">​</a></h3><p><strong>执行时机</strong>：</p><ul><li>服务端渲染时：首次访问或刷新页面</li><li>客户端导航时：前端路由切换页面</li></ul><p><strong>状态管理</strong>：通过 <code>$fetchState</code> 提供：</p><ul><li><code>pending</code>：数据加载状态 (仅客户端有效)</li><li><code>error</code>：错误信息对象</li><li><code>timestamp</code>：最后一次获取数据的时间戳</li></ul><h3 id="基本用法-2" tabindex="-1">基本用法 <a class="header-anchor" href="#基本用法-2" aria-label="Permalink to &quot;基本用法&quot;">​</a></h3><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#F97583;">export</span><span style="color:#F97583;"> default</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#B392F0;">  data</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#F97583;">    return</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">      posts: []</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">  },</span></span>
<span class="line"><span style="color:#F97583;">  async</span><span style="color:#B392F0;"> fetch</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#79B8FF;">    this</span><span style="color:#E1E4E8;">.posts </span><span style="color:#F97583;">=</span><span style="color:#F97583;"> await</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.$http.</span><span style="color:#B392F0;">$get</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;https://api.example.com/posts&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">  },</span></span>
<span class="line"><span style="color:#B392F0;">  mounted</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#6A737D;">    // 手动触发数据刷新</span></span>
<span class="line"><span style="color:#79B8FF;">    this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">$fetch</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre></div><h3 id="高级配置-1" tabindex="-1">高级配置 <a class="header-anchor" href="#高级配置-1" aria-label="Permalink to &quot;高级配置&quot;">​</a></h3><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#F97583;">export</span><span style="color:#F97583;"> default</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  fetchOnServer: </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;">,  </span><span style="color:#6A737D;">// 仅在客户端执行</span></span>
<span class="line"><span style="color:#E1E4E8;">  fetchDelay: </span><span style="color:#79B8FF;">300</span><span style="color:#E1E4E8;">,       </span><span style="color:#6A737D;">// 延迟执行，防止闪烁</span></span>
<span class="line"><span style="color:#E1E4E8;">  fetchKey: </span><span style="color:#9ECBFF;">&#39;unique-key&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#6A737D;">// 缓存标识</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#F97583;">  async</span><span style="color:#B392F0;"> fetch</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#6A737D;">    // 数据获取逻辑</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre></div><h2 id="数据获取与状态管理" tabindex="-1">数据获取与状态管理 <a class="header-anchor" href="#数据获取与状态管理" aria-label="Permalink to &quot;数据获取与状态管理&quot;">​</a></h2><h3 id="与-vuex-集成" tabindex="-1">与 Vuex 集成 <a class="header-anchor" href="#与-vuex-集成" aria-label="Permalink to &quot;与 Vuex 集成&quot;">​</a></h3><p>在 Nuxt.js 中，数据获取常与 Vuex 状态管理结合使用。</p><p><strong>Store 定义</strong>：</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;">// store/posts.js</span></span>
<span class="line"><span style="color:#F97583;">export</span><span style="color:#F97583;"> const</span><span style="color:#B392F0;"> state</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> () </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> ({</span></span>
<span class="line"><span style="color:#E1E4E8;">  list: [],</span></span>
<span class="line"><span style="color:#E1E4E8;">  current: </span><span style="color:#79B8FF;">null</span></span>
<span class="line"><span style="color:#E1E4E8;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">export</span><span style="color:#F97583;"> const</span><span style="color:#79B8FF;"> mutations</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#B392F0;">  SET_POSTS</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">state</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">posts</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    state.list </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> posts</span></span>
<span class="line"><span style="color:#E1E4E8;">  },</span></span>
<span class="line"><span style="color:#B392F0;">  SET_CURRENT_POST</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">state</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">post</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    state.current </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> post</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">export</span><span style="color:#F97583;"> const</span><span style="color:#79B8FF;"> actions</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#F97583;">  async</span><span style="color:#B392F0;"> fetchPosts</span><span style="color:#E1E4E8;">({ </span><span style="color:#FFAB70;">commit</span><span style="color:#E1E4E8;"> }) {</span></span>
<span class="line"><span style="color:#F97583;">    const</span><span style="color:#79B8FF;"> posts</span><span style="color:#F97583;"> =</span><span style="color:#F97583;"> await</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.$axios.</span><span style="color:#B392F0;">$get</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;/api/posts&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#B392F0;">    commit</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;SET_POSTS&#39;</span><span style="color:#E1E4E8;">, posts)</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre></div><p><strong>在组件中使用</strong>：</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#F97583;">export</span><span style="color:#F97583;"> default</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#F97583;">  async</span><span style="color:#B392F0;"> fetch</span><span style="color:#E1E4E8;">({ </span><span style="color:#FFAB70;">store</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">params</span><span style="color:#E1E4E8;"> }) {</span></span>
<span class="line"><span style="color:#F97583;">    await</span><span style="color:#E1E4E8;"> store.</span><span style="color:#B392F0;">dispatch</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;posts/fetchPosts&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">  },</span></span>
<span class="line"><span style="color:#E1E4E8;">  computed: {</span></span>
<span class="line"><span style="color:#B392F0;">    posts</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#F97583;">      return</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.$store.state.posts.list</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre></div><h3 id="服务端初始化" tabindex="-1">服务端初始化 <a class="header-anchor" href="#服务端初始化" aria-label="Permalink to &quot;服务端初始化&quot;">​</a></h3><p>使用 <code>nuxtServerInit</code> 在服务端初始化全局数据：</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;">// store/index.js</span></span>
<span class="line"><span style="color:#F97583;">export</span><span style="color:#F97583;"> const</span><span style="color:#79B8FF;"> actions</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#F97583;">  async</span><span style="color:#B392F0;"> nuxtServerInit</span><span style="color:#E1E4E8;">({ </span><span style="color:#FFAB70;">commit</span><span style="color:#E1E4E8;"> }, { </span><span style="color:#FFAB70;">req</span><span style="color:#E1E4E8;"> }) {</span></span>
<span class="line"><span style="color:#6A737D;">    // 从 cookie 获取 token</span></span>
<span class="line"><span style="color:#F97583;">    const</span><span style="color:#79B8FF;"> token</span><span style="color:#F97583;"> =</span><span style="color:#B392F0;"> getTokenFromCookie</span><span style="color:#E1E4E8;">(req.headers.cookie)</span></span>
<span class="line"><span style="color:#B392F0;">    commit</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;auth/SET_TOKEN&#39;</span><span style="color:#E1E4E8;">, token)</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#6A737D;">    // 获取用户信息</span></span>
<span class="line"><span style="color:#F97583;">    if</span><span style="color:#E1E4E8;"> (token) {</span></span>
<span class="line"><span style="color:#F97583;">      const</span><span style="color:#79B8FF;"> user</span><span style="color:#F97583;"> =</span><span style="color:#F97583;"> await</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.$axios.</span><span style="color:#B392F0;">$get</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;/api/user&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#B392F0;">      commit</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;auth/SET_USER&#39;</span><span style="color:#E1E4E8;">, user)</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre></div><h2 id="api-调用方式" tabindex="-1">API 调用方式 <a class="header-anchor" href="#api-调用方式" aria-label="Permalink to &quot;API 调用方式&quot;">​</a></h2><h3 id="fetch-使用" tabindex="-1">$fetch 使用 <a class="header-anchor" href="#fetch-使用" aria-label="Permalink to &quot;$fetch 使用&quot;">​</a></h3><p>Nuxt 3 提供了全局的 <code>$fetch</code> 方法用于 API 调用：</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#E1E4E8;">&lt;</span><span style="color:#85E89D;">script</span><span style="color:#B392F0;"> setup</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">const data = await $fetch(&#39;/api/endpoint&#39;, {</span></span>
<span class="line"><span style="color:#E1E4E8;">  method: </span><span style="color:#9ECBFF;">&#39;POST&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  body: { key: </span><span style="color:#9ECBFF;">&#39;value&#39;</span><span style="color:#E1E4E8;"> },</span></span>
<span class="line"><span style="color:#E1E4E8;">  baseURL: </span><span style="color:#9ECBFF;">&#39;https://api.example.com&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#B392F0;">  onRequest</span><span style="color:#E1E4E8;">({ request, options }) {</span></span>
<span class="line"><span style="color:#6A737D;">    // 请求拦截</span></span>
<span class="line"><span style="color:#E1E4E8;">  },</span></span>
<span class="line"><span style="color:#B392F0;">  onResponse</span><span style="color:#E1E4E8;">({ response, options }) {</span></span>
<span class="line"><span style="color:#6A737D;">    // 响应处理</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">})</span></span>
<span class="line"><span style="color:#E1E4E8;">&lt;/</span><span style="color:#85E89D;">script</span><span style="color:#E1E4E8;">&gt;</span></span></code></pre></div><h3 id="使用-axios" tabindex="-1">使用 axios <a class="header-anchor" href="#使用-axios" aria-label="Permalink to &quot;使用 axios&quot;">​</a></h3><p>安装并配置 axios 插件：</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;">// plugins/axios.js</span></span>
<span class="line"><span style="color:#F97583;">export</span><span style="color:#F97583;"> default</span><span style="color:#F97583;"> function</span><span style="color:#E1E4E8;">({ </span><span style="color:#FFAB70;">$axios</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">redirect</span><span style="color:#E1E4E8;"> }) {</span></span>
<span class="line"><span style="color:#E1E4E8;">  $axios.</span><span style="color:#B392F0;">onError</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">error</span><span style="color:#F97583;"> =&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#F97583;">    if</span><span style="color:#E1E4E8;"> (error.response.status </span><span style="color:#F97583;">===</span><span style="color:#79B8FF;"> 500</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#B392F0;">      redirect</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;/sorry&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">  })</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 在组件中使用</span></span>
<span class="line"><span style="color:#F97583;">export</span><span style="color:#F97583;"> default</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#F97583;">  async</span><span style="color:#B392F0;"> asyncData</span><span style="color:#E1E4E8;">({ </span><span style="color:#FFAB70;">$axios</span><span style="color:#E1E4E8;"> }) {</span></span>
<span class="line"><span style="color:#F97583;">    const</span><span style="color:#79B8FF;"> posts</span><span style="color:#F97583;"> =</span><span style="color:#F97583;"> await</span><span style="color:#E1E4E8;"> $axios.</span><span style="color:#B392F0;">$get</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;/api/posts&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#F97583;">    return</span><span style="color:#E1E4E8;"> { posts }</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre></div><h2 id="性能优化策略" tabindex="-1">性能优化策略 <a class="header-anchor" href="#性能优化策略" aria-label="Permalink to &quot;性能优化策略&quot;">​</a></h2><h3 id="缓存策略" tabindex="-1">缓存策略 <a class="header-anchor" href="#缓存策略" aria-label="Permalink to &quot;缓存策略&quot;">​</a></h3><p>示意图： [首次请求] → [数据获取] → [缓存存储]<br> [后续请求] → [缓存命中] → [直接返回]</p><p><strong>useAsyncData 缓存</strong>：</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> { </span><span style="color:#79B8FF;">data</span><span style="color:#E1E4E8;"> } </span><span style="color:#F97583;">=</span><span style="color:#F97583;"> await</span><span style="color:#B392F0;"> useAsyncData</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;cached-data&#39;</span><span style="color:#E1E4E8;">, </span></span>
<span class="line"><span style="color:#E1E4E8;">  () </span><span style="color:#F97583;">=&gt;</span><span style="color:#B392F0;"> $fetch</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;/api/data&#39;</span><span style="color:#E1E4E8;">),</span></span>
<span class="line"><span style="color:#E1E4E8;">  {</span></span>
<span class="line"><span style="color:#E1E4E8;">    cache: </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    maxAge: </span><span style="color:#79B8FF;">3600</span><span style="color:#6A737D;"> // 缓存1小时</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">)</span></span></code></pre></div><h3 id="预加载与懒加载" tabindex="-1">预加载与懒加载 <a class="header-anchor" href="#预加载与懒加载" aria-label="Permalink to &quot;预加载与懒加载&quot;">​</a></h3><p><strong>预加载关键数据</strong>：</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;">// 在父组件预加载子组件数据</span></span>
<span class="line"><span style="color:#B392F0;">onMounted</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">async</span><span style="color:#E1E4E8;"> () </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#F97583;">  await</span><span style="color:#B392F0;"> preloadComponents</span><span style="color:#E1E4E8;">([</span><span style="color:#9ECBFF;">&#39;/pages/child.vue&#39;</span><span style="color:#E1E4E8;">])</span></span>
<span class="line"><span style="color:#E1E4E8;">})</span></span></code></pre></div><p><strong>懒加载非关键数据</strong>：</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#F97583;">const</span><span style="color:#B392F0;"> loadAdditionalData</span><span style="color:#F97583;"> =</span><span style="color:#F97583;"> async</span><span style="color:#E1E4E8;"> () </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#F97583;">  const</span><span style="color:#E1E4E8;"> { </span><span style="color:#79B8FF;">data</span><span style="color:#E1E4E8;"> } </span><span style="color:#F97583;">=</span><span style="color:#F97583;"> await</span><span style="color:#B392F0;"> useAsyncData</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;additional&#39;</span><span style="color:#E1E4E8;">, </span></span>
<span class="line"><span style="color:#E1E4E8;">    () </span><span style="color:#F97583;">=&gt;</span><span style="color:#B392F0;"> $fetch</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;/api/additional&#39;</span><span style="color:#E1E4E8;">),</span></span>
<span class="line"><span style="color:#E1E4E8;">    { server: </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;"> } </span><span style="color:#6A737D;">// 仅在客户端获取</span></span>
<span class="line"><span style="color:#E1E4E8;">  )</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre></div><h2 id="错误处理与加载状态" tabindex="-1">错误处理与加载状态 <a class="header-anchor" href="#错误处理与加载状态" aria-label="Permalink to &quot;错误处理与加载状态&quot;">​</a></h2><h3 id="统一错误处理" tabindex="-1">统一错误处理 <a class="header-anchor" href="#统一错误处理" aria-label="Permalink to &quot;统一错误处理&quot;">​</a></h3><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#F97583;">export</span><span style="color:#F97583;"> default</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#F97583;">  async</span><span style="color:#B392F0;"> asyncData</span><span style="color:#E1E4E8;">({ </span><span style="color:#FFAB70;">error</span><span style="color:#E1E4E8;"> }) {</span></span>
<span class="line"><span style="color:#F97583;">    try</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#F97583;">      const</span><span style="color:#79B8FF;"> data</span><span style="color:#F97583;"> =</span><span style="color:#F97583;"> await</span><span style="color:#B392F0;"> $fetch</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;/api/data&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#F97583;">      return</span><span style="color:#E1E4E8;"> { data }</span></span>
<span class="line"><span style="color:#E1E4E8;">    } </span><span style="color:#F97583;">catch</span><span style="color:#E1E4E8;"> (err) {</span></span>
<span class="line"><span style="color:#B392F0;">      error</span><span style="color:#E1E4E8;">({ </span></span>
<span class="line"><span style="color:#E1E4E8;">        statusCode: </span><span style="color:#79B8FF;">404</span><span style="color:#E1E4E8;">, </span></span>
<span class="line"><span style="color:#E1E4E8;">        message: </span><span style="color:#9ECBFF;">&#39;数据获取失败&#39;</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#E1E4E8;">      })</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre></div><h3 id="加载状态管理" tabindex="-1">加载状态管理 <a class="header-anchor" href="#加载状态管理" aria-label="Permalink to &quot;加载状态管理&quot;">​</a></h3><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#E1E4E8;">&lt;</span><span style="color:#85E89D;">template</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">  &lt;</span><span style="color:#85E89D;">div</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;</span><span style="color:#85E89D;">div</span><span style="color:#B392F0;"> v-if</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;$fetchState.pending&quot;</span><span style="color:#B392F0;"> class</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;loading&quot;</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">      加载中...</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;/</span><span style="color:#85E89D;">div</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;</span><span style="color:#85E89D;">div</span><span style="color:#B392F0;"> v-else-if</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;$fetchState.error&quot;</span><span style="color:#B392F0;"> class</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;error&quot;</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">      加载失败</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;/</span><span style="color:#85E89D;">div</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;</span><span style="color:#85E89D;">div</span><span style="color:#B392F0;"> v-else</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">      &lt;!-- 正常内容 --&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;/</span><span style="color:#85E89D;">div</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;</span><span style="color:#85E89D;">button</span><span style="color:#FDAEB7;font-style:italic;"> @click=&quot;$fetch&quot;</span><span style="color:#FDAEB7;font-style:italic;"> :disabled=&quot;$fetchState.pending&quot;&gt;</span></span>
<span class="line"><span style="color:#B392F0;">      刷新数据</span></span>
<span class="line"><span style="color:#FDAEB7;font-style:italic;">    &lt;/button&gt;</span></span>
<span class="line"><span style="color:#FDAEB7;font-style:italic;">  &lt;/div&gt;</span></span>
<span class="line"><span style="color:#FDAEB7;font-style:italic;">&lt;/template&gt;</span></span></code></pre></div><h2 id="最佳实践指南" tabindex="-1">最佳实践指南 <a class="header-anchor" href="#最佳实践指南" aria-label="Permalink to &quot;最佳实践指南&quot;">​</a></h2><h3 id="选择合适的数据获取方法" tabindex="-1">选择合适的数据获取方法 <a class="header-anchor" href="#选择合适的数据获取方法" aria-label="Permalink to &quot;选择合适的数据获取方法&quot;">​</a></h3><table tabindex="0"><thead><tr><th>场景</th><th>推荐方案</th><th>理由</th></tr></thead><tbody><tr><td>Nuxt 3 页面组件</td><td>useAsyncData/useFetch</td><td>更好的 TypeScript 支持，Composition API</td></tr><tr><td>Nuxt 2 页面组件</td><td>asyncData</td><td>传统稳定，Options API 风格</td></tr><tr><td>非页面组件</td><td>fetch</td><td>支持组件级数据获取</td></tr><tr><td>全局数据</td><td>Vuex + nuxtServerInit</td><td>多组件共享数据</td></tr></tbody></table><h3 id="性能优化建议" tabindex="-1">性能优化建议 <a class="header-anchor" href="#性能优化建议" aria-label="Permalink to &quot;性能优化建议&quot;">​</a></h3><ol><li><p><strong>合理使用缓存</strong></p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;">// 适合缓存的数据</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> { </span><span style="color:#FFAB70;">data</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">categories</span><span style="color:#E1E4E8;"> } </span><span style="color:#F97583;">=</span><span style="color:#F97583;"> await</span><span style="color:#B392F0;"> useAsyncData</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;categories&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  () </span><span style="color:#F97583;">=&gt;</span><span style="color:#B392F0;"> $fetch</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;/api/categories&#39;</span><span style="color:#E1E4E8;">),</span></span>
<span class="line"><span style="color:#E1E4E8;">  { cache: </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">, maxAge: </span><span style="color:#79B8FF;">86400</span><span style="color:#E1E4E8;"> } </span><span style="color:#6A737D;">// 缓存24小时</span></span>
<span class="line"><span style="color:#E1E4E8;">)</span></span></code></pre></div></li><li><p><strong>减少服务端负载</strong></p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;">// 非关键数据在客户端获取</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> { </span><span style="color:#FFAB70;">data</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">analytics</span><span style="color:#E1E4E8;"> } </span><span style="color:#F97583;">=</span><span style="color:#F97583;"> await</span><span style="color:#B392F0;"> useAsyncData</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;analytics&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  () </span><span style="color:#F97583;">=&gt;</span><span style="color:#B392F0;"> $fetch</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;/api/analytics&#39;</span><span style="color:#E1E4E8;">),</span></span>
<span class="line"><span style="color:#E1E4E8;">  { server: </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;"> }</span></span>
<span class="line"><span style="color:#E1E4E8;">)</span></span></code></pre></div></li><li><p><strong>代码分割优化</strong></p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;">// 大型数据集分页加载</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> { </span><span style="color:#FFAB70;">data</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">items</span><span style="color:#E1E4E8;"> } </span><span style="color:#F97583;">=</span><span style="color:#F97583;"> await</span><span style="color:#B392F0;"> useAsyncData</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;items&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  () </span><span style="color:#F97583;">=&gt;</span><span style="color:#B392F0;"> $fetch</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">\`/api/items?page=\${</span><span style="color:#E1E4E8;">page</span><span style="color:#9ECBFF;">.</span><span style="color:#E1E4E8;">value</span><span style="color:#9ECBFF;">}&amp;limit=20\`</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">)</span></span></code></pre></div></li></ol><h3 id="开发体验提升" tabindex="-1">开发体验提升 <a class="header-anchor" href="#开发体验提升" aria-label="Permalink to &quot;开发体验提升&quot;">​</a></h3><p><strong>类型安全</strong>：</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#F97583;">interface</span><span style="color:#B392F0;"> Post</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#FFAB70;">  id</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;"> number</span></span>
<span class="line"><span style="color:#FFAB70;">  title</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;"> string</span></span>
<span class="line"><span style="color:#FFAB70;">  content</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;"> string</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> { </span><span style="color:#FFAB70;">data</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">posts</span><span style="color:#E1E4E8;"> } </span><span style="color:#F97583;">=</span><span style="color:#F97583;"> await</span><span style="color:#B392F0;"> useAsyncData</span><span style="color:#E1E4E8;">&lt;</span><span style="color:#B392F0;">Post</span><span style="color:#E1E4E8;">[]&gt;(</span><span style="color:#9ECBFF;">&#39;posts&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  () </span><span style="color:#F97583;">=&gt;</span><span style="color:#B392F0;"> $fetch</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;/api/posts&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">)</span></span></code></pre></div><p><strong>组合式函数复用</strong>：</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;">// composables/usePosts.js</span></span>
<span class="line"><span style="color:#F97583;">export</span><span style="color:#F97583;"> const</span><span style="color:#B392F0;"> usePosts</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> () </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#F97583;">  return</span><span style="color:#B392F0;"> useAsyncData</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;posts&#39;</span><span style="color:#E1E4E8;">, () </span><span style="color:#F97583;">=&gt;</span><span style="color:#B392F0;"> $fetch</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;/api/posts&#39;</span><span style="color:#E1E4E8;">))</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 在组件中使用</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> { </span><span style="color:#FFAB70;">data</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">posts</span><span style="color:#E1E4E8;"> } </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> usePosts</span><span style="color:#E1E4E8;">()</span></span></code></pre></div>`,83)])])}const F=a(o,[["render",e]]);export{d as __pageData,F as default};

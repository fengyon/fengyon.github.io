import{_ as n,c as a,o as l,b as p}from"./chunks/framework.CMLuPXeo.js";const i=JSON.parse('{"title":"WASM 与 Rust","description":"","frontmatter":{},"headers":[{"level":2,"title":"为什么选择 Rust 开发 WebAssembly？","slug":"为什么选择-rust-开发-webassembly","link":"#为什么选择-rust-开发-webassembly","children":[]},{"level":2,"title":"开发环境搭建","slug":"开发环境搭建","link":"#开发环境搭建","children":[{"level":3,"title":"基础工具链安装","slug":"基础工具链安装","link":"#基础工具链安装","children":[]},{"level":3,"title":"项目初始化","slug":"项目初始化","link":"#项目初始化","children":[]}]},{"level":2,"title":"核心开发库与工具","slug":"核心开发库与工具","link":"#核心开发库与工具","children":[{"level":3,"title":"wasm-bindgen：Rust 与 JavaScript 的桥梁","slug":"wasm-bindgen-rust-与-javascript-的桥梁","link":"#wasm-bindgen-rust-与-javascript-的桥梁","children":[]},{"level":3,"title":"web-sys：浏览器 API 绑定","slug":"web-sys-浏览器-api-绑定","link":"#web-sys-浏览器-api-绑定","children":[]},{"level":3,"title":"wasmedge-bindgen：复杂数据类型处理","slug":"wasmedge-bindgen-复杂数据类型处理","link":"#wasmedge-bindgen-复杂数据类型处理","children":[]}]},{"level":2,"title":"编译与构建","slug":"编译与构建","link":"#编译与构建","children":[{"level":3,"title":"使用 wasm-pack 构建","slug":"使用-wasm-pack-构建","link":"#使用-wasm-pack-构建","children":[]},{"level":3,"title":"优化编译配置","slug":"优化编译配置","link":"#优化编译配置","children":[]}]},{"level":2,"title":"前端集成","slug":"前端集成","link":"#前端集成","children":[{"level":3,"title":"现代 ES6 模块集成","slug":"现代-es6-模块集成","link":"#现代-es6-模块集成","children":[]},{"level":3,"title":"性能对比实践","slug":"性能对比实践","link":"#性能对比实践","children":[]}]},{"level":2,"title":"高级应用模式","slug":"高级应用模式","link":"#高级应用模式","children":[{"level":3,"title":"服务器端 WASM 应用","slug":"服务器端-wasm-应用","link":"#服务器端-wasm-应用","children":[]},{"level":3,"title":"组件化开发 with wasmCloud","slug":"组件化开发-with-wasmcloud","link":"#组件化开发-with-wasmcloud","children":[]}]},{"level":2,"title":"内存管理最佳实践","slug":"内存管理最佳实践","link":"#内存管理最佳实践","children":[{"level":3,"title":"WASM 线性内存模型","slug":"wasm-线性内存模型","link":"#wasm-线性内存模型","children":[]},{"level":3,"title":"高效数据传递策略","slug":"高效数据传递策略","link":"#高效数据传递策略","children":[]}]},{"level":2,"title":"调试与测试","slug":"调试与测试","link":"#调试与测试","children":[{"level":3,"title":"单元测试配置","slug":"单元测试配置","link":"#单元测试配置","children":[]},{"level":3,"title":"调试技巧","slug":"调试技巧","link":"#调试技巧","children":[]}]}],"relativePath":"leading/webassembly/wasm-rust.md","filePath":"leading/webassembly/wasm-rust.md"}'),o={name:"leading/webassembly/wasm-rust.md"};function e(t,s,c,r,E,y){return l(),a("div",null,[...s[0]||(s[0]=[p(`<div style="display:none;" hidden="true" aria-hidden="true">Are you an LLM? You can read better optimized documentation at /leading/webassembly/wasm-rust.md for this page in Markdown format</div><h1 id="wasm-与-rust" tabindex="-1">WASM 与 Rust <a class="header-anchor" href="#wasm-与-rust" aria-label="Permalink to &quot;WASM 与 Rust&quot;">​</a></h1><h2 id="为什么选择-rust-开发-webassembly" tabindex="-1">为什么选择 Rust 开发 WebAssembly？ <a class="header-anchor" href="#为什么选择-rust-开发-webassembly" aria-label="Permalink to &quot;为什么选择 Rust 开发 WebAssembly？&quot;">​</a></h2><p>Rust 语言与 WebAssembly 的结合堪称完美。Rust 作为一门内存安全且无运行时开销的系统编程语言，成为开发 WebAssembly 模块的理想选择。其所有权系统在编译时防止内存错误，这与 WebAssembly 的安全沙箱设计哲学高度一致。</p><p><strong>核心优势对比：</strong></p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span>Rust 优势 → WASM 需求</span></span>
<span class="line"><span>内存安全 → 沙箱安全保证</span></span>
<span class="line"><span>零成本抽象 → 紧凑的二进制体积</span></span>
<span class="line"><span>现代工具链 → 流畅的开发体验</span></span>
<span class="line"><span>无运行时 → 快速启动执行</span></span></code></pre></div><p>与其他语言相比，Rust 生成的 WASM 模块<strong>不含垃圾回收器这样的额外成本</strong>，通过高级优化和 Tree Shaking 可移除无用代码，实现更小的代码尺寸。在性能方面，Rust 提供可预见的性能，没有难以预料的 GC 暂停，也没有 JIT 编译器造成的性能抖动。</p><h2 id="开发环境搭建" tabindex="-1">开发环境搭建 <a class="header-anchor" href="#开发环境搭建" aria-label="Permalink to &quot;开发环境搭建&quot;">​</a></h2><h3 id="基础工具链安装" tabindex="-1">基础工具链安装 <a class="header-anchor" href="#基础工具链安装" aria-label="Permalink to &quot;基础工具链安装&quot;">​</a></h3><p>开始 Rust WASM 开发前，需要安装以下核心工具：</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># 安装 Rust 工具链</span></span>
<span class="line"><span style="color:#B392F0;">curl</span><span style="color:#79B8FF;"> --proto</span><span style="color:#9ECBFF;"> &#39;=https&#39;</span><span style="color:#79B8FF;"> --tlsv1.2</span><span style="color:#79B8FF;"> -sSf</span><span style="color:#9ECBFF;"> https://sh.rustup.rs</span><span style="color:#F97583;"> |</span><span style="color:#B392F0;"> sh</span></span>
<span class="line"><span style="color:#79B8FF;">source</span><span style="color:#E1E4E8;"> $HOME</span><span style="color:#9ECBFF;">/.cargo/env</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 添加 WASM 编译目标</span></span>
<span class="line"><span style="color:#B392F0;">rustup</span><span style="color:#9ECBFF;"> target</span><span style="color:#9ECBFF;"> add</span><span style="color:#9ECBFF;"> wasm32-unknown-unknown</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 安装 wasm-pack（官方推荐工具）</span></span>
<span class="line"><span style="color:#B392F0;">cargo</span><span style="color:#9ECBFF;"> install</span><span style="color:#9ECBFF;"> wasm-pack</span></span></code></pre></div><h3 id="项目初始化" tabindex="-1">项目初始化 <a class="header-anchor" href="#项目初始化" aria-label="Permalink to &quot;项目初始化&quot;">​</a></h3><p>创建新的 Rust 库项目并配置为生成 WebAssembly 模块：</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#B392F0;">cargo</span><span style="color:#9ECBFF;"> new</span><span style="color:#79B8FF;"> --lib</span><span style="color:#9ECBFF;"> rust_wasm_demo</span></span>
<span class="line"><span style="color:#79B8FF;">cd</span><span style="color:#9ECBFF;"> rust_wasm_demo</span></span></code></pre></div><p>修改 <code>Cargo.toml</code> 文件配置：</p><div class="language-toml"><button title="Copy Code" class="copy"></button><span class="lang">toml</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#E1E4E8;">[</span><span style="color:#B392F0;">package</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">name = </span><span style="color:#9ECBFF;">&quot;rust_wasm_demo&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">version = </span><span style="color:#9ECBFF;">&quot;0.1.0&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">edition = </span><span style="color:#9ECBFF;">&quot;2021&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">[</span><span style="color:#B392F0;">lib</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">crate-type = [</span><span style="color:#9ECBFF;">&quot;cdylib&quot;</span><span style="color:#E1E4E8;">]  </span><span style="color:#6A737D;"># 生成动态库供 Wasm 使用</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">[</span><span style="color:#B392F0;">dependencies</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">wasm-bindgen = </span><span style="color:#9ECBFF;">&quot;0.2&quot;</span></span></code></pre></div><h2 id="核心开发库与工具" tabindex="-1">核心开发库与工具 <a class="header-anchor" href="#核心开发库与工具" aria-label="Permalink to &quot;核心开发库与工具&quot;">​</a></h2><h3 id="wasm-bindgen-rust-与-javascript-的桥梁" tabindex="-1">wasm-bindgen：Rust 与 JavaScript 的桥梁 <a class="header-anchor" href="#wasm-bindgen-rust-与-javascript-的桥梁" aria-label="Permalink to &quot;wasm-bindgen：Rust 与 JavaScript 的桥梁&quot;">​</a></h3><p><code>wasm-bindgen</code> 是实现 Rust 和 JavaScript 之间高级交互的核心工具。它通过生成类型安全的绑定代码，桥接两种语言之间的语义差异。</p><h4 id="基础函数导出" tabindex="-1">基础函数导出 <a class="header-anchor" href="#基础函数导出" aria-label="Permalink to &quot;基础函数导出&quot;">​</a></h4><div class="language-rust"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#F97583;">use</span><span style="color:#B392F0;"> wasm_bindgen</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">prelude</span><span style="color:#F97583;">::*</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">#[wasm_bindgen]</span></span>
<span class="line"><span style="color:#F97583;">pub</span><span style="color:#F97583;"> fn</span><span style="color:#B392F0;"> greet</span><span style="color:#E1E4E8;">(name</span><span style="color:#F97583;">:</span><span style="color:#F97583;"> &amp;</span><span style="color:#B392F0;">str</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;"> String</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#B392F0;">    format!</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;Hello, {}!&quot;</span><span style="color:#E1E4E8;">, name)</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">#[wasm_bindgen]</span></span>
<span class="line"><span style="color:#F97583;">pub</span><span style="color:#F97583;"> fn</span><span style="color:#B392F0;"> fibonacci</span><span style="color:#E1E4E8;">(n</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> u32</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;"> u32</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#F97583;">    if</span><span style="color:#E1E4E8;"> n </span><span style="color:#F97583;">&lt;=</span><span style="color:#79B8FF;"> 1</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#F97583;">        return</span><span style="color:#E1E4E8;"> n;</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#F97583;">    let</span><span style="color:#F97583;"> mut</span><span style="color:#E1E4E8;"> a </span><span style="color:#F97583;">=</span><span style="color:#79B8FF;"> 0</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">    let</span><span style="color:#F97583;"> mut</span><span style="color:#E1E4E8;"> b </span><span style="color:#F97583;">=</span><span style="color:#79B8FF;"> 1</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">    for</span><span style="color:#E1E4E8;"> _ </span><span style="color:#F97583;">in</span><span style="color:#79B8FF;"> 2</span><span style="color:#F97583;">..=</span><span style="color:#E1E4E8;">n {</span></span>
<span class="line"><span style="color:#F97583;">        let</span><span style="color:#E1E4E8;"> c </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> a </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> b;</span></span>
<span class="line"><span style="color:#E1E4E8;">        a </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> b;</span></span>
<span class="line"><span style="color:#E1E4E8;">        b </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> c;</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">    b</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre></div><h4 id="复杂数据结构处理" tabindex="-1">复杂数据结构处理 <a class="header-anchor" href="#复杂数据结构处理" aria-label="Permalink to &quot;复杂数据结构处理&quot;">​</a></h4><p>对于需要处理复杂数据类型的场景，可以结合 serde 进行序列化：</p><div class="language-rust"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#F97583;">use</span><span style="color:#B392F0;"> wasm_bindgen</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">prelude</span><span style="color:#F97583;">::*</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">use</span><span style="color:#B392F0;"> serde</span><span style="color:#F97583;">::</span><span style="color:#E1E4E8;">{</span><span style="color:#B392F0;">Serialize</span><span style="color:#E1E4E8;">, </span><span style="color:#B392F0;">Deserialize</span><span style="color:#E1E4E8;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">#[derive(</span><span style="color:#B392F0;">Serialize</span><span style="color:#E1E4E8;">, </span><span style="color:#B392F0;">Deserialize</span><span style="color:#E1E4E8;">)]</span></span>
<span class="line"><span style="color:#F97583;">struct</span><span style="color:#B392F0;"> Point</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    x</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> f32</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    y</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> f32</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">#[derive(</span><span style="color:#B392F0;">Serialize</span><span style="color:#E1E4E8;">, </span><span style="color:#B392F0;">Deserialize</span><span style="color:#E1E4E8;">)]</span></span>
<span class="line"><span style="color:#F97583;">struct</span><span style="color:#B392F0;"> Line</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    points</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> Vec</span><span style="color:#E1E4E8;">&lt;</span><span style="color:#B392F0;">Point</span><span style="color:#E1E4E8;">&gt;,</span></span>
<span class="line"><span style="color:#E1E4E8;">    valid</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> bool</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    length</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> f32</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    desc</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> String</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">#[wasm_bindgen]</span></span>
<span class="line"><span style="color:#F97583;">pub</span><span style="color:#F97583;"> fn</span><span style="color:#B392F0;"> create_line</span><span style="color:#E1E4E8;">(p1</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> String</span><span style="color:#E1E4E8;">, p2</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> String</span><span style="color:#E1E4E8;">, desc</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> String</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;"> Result</span><span style="color:#E1E4E8;">&lt;</span><span style="color:#B392F0;">Vec</span><span style="color:#E1E4E8;">&lt;</span><span style="color:#B392F0;">u8</span><span style="color:#E1E4E8;">&gt;, </span><span style="color:#B392F0;">String</span><span style="color:#E1E4E8;">&gt; {</span></span>
<span class="line"><span style="color:#F97583;">    let</span><span style="color:#E1E4E8;"> point1</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> Point</span><span style="color:#F97583;"> =</span><span style="color:#B392F0;"> serde_json</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">from_str</span><span style="color:#E1E4E8;">(p1</span><span style="color:#F97583;">.</span><span style="color:#B392F0;">as_str</span><span style="color:#E1E4E8;">())</span><span style="color:#F97583;">.</span><span style="color:#B392F0;">unwrap</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#F97583;">    let</span><span style="color:#E1E4E8;"> point2</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> Point</span><span style="color:#F97583;"> =</span><span style="color:#B392F0;"> serde_json</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">from_str</span><span style="color:#E1E4E8;">(p2</span><span style="color:#F97583;">.</span><span style="color:#B392F0;">as_str</span><span style="color:#E1E4E8;">())</span><span style="color:#F97583;">.</span><span style="color:#B392F0;">unwrap</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#F97583;">    let</span><span style="color:#E1E4E8;"> length </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> ((point1</span><span style="color:#F97583;">.</span><span style="color:#E1E4E8;">x </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> point2</span><span style="color:#F97583;">.</span><span style="color:#E1E4E8;">x)</span><span style="color:#F97583;">.</span><span style="color:#B392F0;">powi</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> (point1</span><span style="color:#F97583;">.</span><span style="color:#E1E4E8;">y </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> point2</span><span style="color:#F97583;">.</span><span style="color:#E1E4E8;">y)</span><span style="color:#F97583;">.</span><span style="color:#B392F0;">powi</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">))</span><span style="color:#F97583;">.</span><span style="color:#B392F0;">sqrt</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#F97583;">    let</span><span style="color:#E1E4E8;"> valid </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> length </span><span style="color:#F97583;">!=</span><span style="color:#79B8FF;"> 0.0</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">    let</span><span style="color:#E1E4E8;"> line </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> Line</span><span style="color:#E1E4E8;"> { </span></span>
<span class="line"><span style="color:#E1E4E8;">        points</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> vec!</span><span style="color:#E1E4E8;">[point1, point2], </span></span>
<span class="line"><span style="color:#E1E4E8;">        valid, </span></span>
<span class="line"><span style="color:#E1E4E8;">        length, </span></span>
<span class="line"><span style="color:#E1E4E8;">        desc </span></span>
<span class="line"><span style="color:#E1E4E8;">    };</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#B392F0;">    Ok</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">serde_json</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">to_vec</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">&amp;</span><span style="color:#E1E4E8;">line)</span><span style="color:#F97583;">.</span><span style="color:#B392F0;">unwrap</span><span style="color:#E1E4E8;">())</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre></div><h3 id="web-sys-浏览器-api-绑定" tabindex="-1">web-sys：浏览器 API 绑定 <a class="header-anchor" href="#web-sys-浏览器-api-绑定" aria-label="Permalink to &quot;web-sys：浏览器 API 绑定&quot;">​</a></h3><p><code>web-sys</code> 相当于 Rust 的“浏览器功能说明书”，让 Rust 编译的 WASM 能直接调用浏览器的各种功能。它采用按需引入的策略，避免 WASM 文件不必要的膨胀。</p><h4 id="按需配置特性" tabindex="-1">按需配置特性 <a class="header-anchor" href="#按需配置特性" aria-label="Permalink to &quot;按需配置特性&quot;">​</a></h4><p>在 <code>Cargo.toml</code> 中配置所需功能：</p><div class="language-toml"><button title="Copy Code" class="copy"></button><span class="lang">toml</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#E1E4E8;">[</span><span style="color:#B392F0;">dependencies</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">web-sys = { version = </span><span style="color:#9ECBFF;">&quot;0.3&quot;</span><span style="color:#E1E4E8;">, features = [</span></span>
<span class="line"><span style="color:#9ECBFF;">  &quot;Document&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#9ECBFF;">  &quot;Element&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#9ECBFF;">  &quot;Window&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#9ECBFF;">  &quot;console&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#9ECBFF;">  &quot;HtmlElement&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#9ECBFF;">  &quot;Event&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#9ECBFF;">  &quot;EventListener&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">] }</span></span></code></pre></div><h4 id="dom-操作与事件处理" tabindex="-1">DOM 操作与事件处理 <a class="header-anchor" href="#dom-操作与事件处理" aria-label="Permalink to &quot;DOM 操作与事件处理&quot;">​</a></h4><div class="language-rust"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#F97583;">use</span><span style="color:#B392F0;"> wasm_bindgen</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">prelude</span><span style="color:#F97583;">::*</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">use</span><span style="color:#B392F0;"> web_sys</span><span style="color:#F97583;">::</span><span style="color:#E1E4E8;">{window, document, console, </span><span style="color:#B392F0;">Event</span><span style="color:#E1E4E8;">, </span><span style="color:#B392F0;">Element</span><span style="color:#E1E4E8;">};</span></span>
<span class="line"><span style="color:#F97583;">use</span><span style="color:#B392F0;"> wasm_bindgen</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">JsCast</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">#[wasm_bindgen]</span></span>
<span class="line"><span style="color:#F97583;">pub</span><span style="color:#F97583;"> fn</span><span style="color:#B392F0;"> setup_calculator</span><span style="color:#E1E4E8;">() </span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;"> Result</span><span style="color:#E1E4E8;">&lt;(), </span><span style="color:#B392F0;">JsValue</span><span style="color:#E1E4E8;">&gt; {</span></span>
<span class="line"><span style="color:#F97583;">    let</span><span style="color:#E1E4E8;"> window </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> window</span><span style="color:#E1E4E8;">()</span><span style="color:#F97583;">.</span><span style="color:#B392F0;">unwrap</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#F97583;">    let</span><span style="color:#E1E4E8;"> document </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> document</span><span style="color:#E1E4E8;">()</span><span style="color:#F97583;">.</span><span style="color:#B392F0;">unwrap</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#F97583;">    let</span><span style="color:#E1E4E8;"> body </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> document</span><span style="color:#F97583;">.</span><span style="color:#B392F0;">body</span><span style="color:#E1E4E8;">()</span><span style="color:#F97583;">.</span><span style="color:#B392F0;">unwrap</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#6A737D;">    // 创建输入框</span></span>
<span class="line"><span style="color:#F97583;">    let</span><span style="color:#E1E4E8;"> input1 </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> document</span><span style="color:#F97583;">.</span><span style="color:#B392F0;">create_element</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;input&quot;</span><span style="color:#E1E4E8;">)</span><span style="color:#F97583;">?</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    input1</span><span style="color:#F97583;">.</span><span style="color:#B392F0;">set_attribute</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;type&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;number&quot;</span><span style="color:#E1E4E8;">)</span><span style="color:#F97583;">?</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    input1</span><span style="color:#F97583;">.</span><span style="color:#B392F0;">set_attribute</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;id&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;num1&quot;</span><span style="color:#E1E4E8;">)</span><span style="color:#F97583;">?</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#F97583;">    let</span><span style="color:#E1E4E8;"> input2 </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> document</span><span style="color:#F97583;">.</span><span style="color:#B392F0;">create_element</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;input&quot;</span><span style="color:#E1E4E8;">)</span><span style="color:#F97583;">?</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    input2</span><span style="color:#F97583;">.</span><span style="color:#B392F0;">set_attribute</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;type&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;number&quot;</span><span style="color:#E1E4E8;">)</span><span style="color:#F97583;">?</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    input2</span><span style="color:#F97583;">.</span><span style="color:#B392F0;">set_attribute</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;id&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;num2&quot;</span><span style="color:#E1E4E8;">)</span><span style="color:#F97583;">?</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#6A737D;">    // 创建按钮</span></span>
<span class="line"><span style="color:#F97583;">    let</span><span style="color:#E1E4E8;"> button </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> document</span><span style="color:#F97583;">.</span><span style="color:#B392F0;">create_element</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;button&quot;</span><span style="color:#E1E4E8;">)</span><span style="color:#F97583;">?</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    button</span><span style="color:#F97583;">.</span><span style="color:#B392F0;">set_text_content</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">Some</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;计算斐波那契&quot;</span><span style="color:#E1E4E8;">));</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#6A737D;">    // 添加点击事件</span></span>
<span class="line"><span style="color:#F97583;">    let</span><span style="color:#E1E4E8;"> closure </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> Closure</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">wrap</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">Box</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">new</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">||</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#F97583;">        let</span><span style="color:#E1E4E8;"> result </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> fibonacci</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">25</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#B392F0;">        console</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">log_1</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">&amp;</span><span style="color:#B392F0;">format!</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;斐波那契(25) = {}&quot;</span><span style="color:#E1E4E8;">, result)</span><span style="color:#F97583;">.</span><span style="color:#B392F0;">into</span><span style="color:#E1E4E8;">());</span></span>
<span class="line"><span style="color:#E1E4E8;">    }) </span><span style="color:#F97583;">as</span><span style="color:#B392F0;"> Box</span><span style="color:#E1E4E8;">&lt;</span><span style="color:#F97583;">dyn</span><span style="color:#B392F0;"> FnMut</span><span style="color:#E1E4E8;">()&gt;);</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#E1E4E8;">    button</span><span style="color:#F97583;">.</span><span style="color:#B392F0;">add_event_listener_with_callback</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;click&quot;</span><span style="color:#E1E4E8;">, closure</span><span style="color:#F97583;">.</span><span style="color:#B392F0;">as_ref</span><span style="color:#E1E4E8;">()</span><span style="color:#F97583;">.</span><span style="color:#B392F0;">unchecked_ref</span><span style="color:#E1E4E8;">())</span><span style="color:#F97583;">?</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    closure</span><span style="color:#F97583;">.</span><span style="color:#B392F0;">forget</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#6A737D;">    // 添加到页面</span></span>
<span class="line"><span style="color:#E1E4E8;">    body</span><span style="color:#F97583;">.</span><span style="color:#B392F0;">append_child</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">&amp;</span><span style="color:#E1E4E8;">input1)</span><span style="color:#F97583;">?</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    body</span><span style="color:#F97583;">.</span><span style="color:#B392F0;">append_child</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">&amp;</span><span style="color:#E1E4E8;">input2)</span><span style="color:#F97583;">?</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    body</span><span style="color:#F97583;">.</span><span style="color:#B392F0;">append_child</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">&amp;</span><span style="color:#E1E4E8;">button)</span><span style="color:#F97583;">?</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#B392F0;">    Ok</span><span style="color:#E1E4E8;">(())</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">#[wasm_bindgen]</span></span>
<span class="line"><span style="color:#F97583;">pub</span><span style="color:#F97583;"> fn</span><span style="color:#B392F0;"> log_message</span><span style="color:#E1E4E8;">(message</span><span style="color:#F97583;">:</span><span style="color:#F97583;"> &amp;</span><span style="color:#B392F0;">str</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#B392F0;">    console</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">log_1</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">&amp;</span><span style="color:#B392F0;">JsValue</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">from_str</span><span style="color:#E1E4E8;">(message));</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre></div><h3 id="wasmedge-bindgen-复杂数据类型处理" tabindex="-1">wasmedge-bindgen：复杂数据类型处理 <a class="header-anchor" href="#wasmedge-bindgen-复杂数据类型处理" aria-label="Permalink to &quot;wasmedge-bindgen：复杂数据类型处理&quot;">​</a></h3><p>WasmEdge 运行时提供了 <code>wasmedge-bindgen</code> 来增强复杂数据类型的处理能力：</p><div class="language-rust"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#F97583;">use</span><span style="color:#B392F0;"> wasmedge_bindgen</span><span style="color:#F97583;">::*</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">use</span><span style="color:#B392F0;"> wasmedge_bindgen_macro</span><span style="color:#F97583;">::*</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">#[wasmedge_bindgen]</span></span>
<span class="line"><span style="color:#F97583;">pub</span><span style="color:#F97583;"> fn</span><span style="color:#B392F0;"> obfusticate</span><span style="color:#E1E4E8;">(s</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> String</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;"> Result</span><span style="color:#E1E4E8;">&lt;</span><span style="color:#B392F0;">Vec</span><span style="color:#E1E4E8;">&lt;</span><span style="color:#B392F0;">u8</span><span style="color:#E1E4E8;">&gt;, </span><span style="color:#B392F0;">String</span><span style="color:#E1E4E8;">&gt; {</span></span>
<span class="line"><span style="color:#F97583;">    let</span><span style="color:#E1E4E8;"> r</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> String</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> s</span><span style="color:#F97583;">.</span><span style="color:#B392F0;">chars</span><span style="color:#E1E4E8;">()</span><span style="color:#F97583;">.</span><span style="color:#B392F0;">map</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">c</span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#F97583;">        match</span><span style="color:#E1E4E8;"> c {</span></span>
<span class="line"><span style="color:#9ECBFF;">            &#39;A&#39;</span><span style="color:#F97583;">..=</span><span style="color:#9ECBFF;">&#39;M&#39;</span><span style="color:#F97583;"> |</span><span style="color:#9ECBFF;"> &#39;a&#39;</span><span style="color:#F97583;">..=</span><span style="color:#9ECBFF;">&#39;m&#39;</span><span style="color:#F97583;"> =&gt;</span><span style="color:#E1E4E8;"> ((c </span><span style="color:#F97583;">as</span><span style="color:#B392F0;"> u8</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">+</span><span style="color:#79B8FF;"> 13</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">as</span><span style="color:#B392F0;"> char</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#9ECBFF;">            &#39;N&#39;</span><span style="color:#F97583;">..=</span><span style="color:#9ECBFF;">&#39;Z&#39;</span><span style="color:#F97583;"> |</span><span style="color:#9ECBFF;"> &#39;n&#39;</span><span style="color:#F97583;">..=</span><span style="color:#9ECBFF;">&#39;z&#39;</span><span style="color:#F97583;"> =&gt;</span><span style="color:#E1E4E8;"> ((c </span><span style="color:#F97583;">as</span><span style="color:#B392F0;"> u8</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">-</span><span style="color:#79B8FF;"> 13</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">as</span><span style="color:#B392F0;"> char</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">            _ </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> c</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">    })</span><span style="color:#F97583;">.</span><span style="color:#B392F0;">collect</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#B392F0;">    Ok</span><span style="color:#E1E4E8;">(r</span><span style="color:#F97583;">.</span><span style="color:#B392F0;">as_bytes</span><span style="color:#E1E4E8;">()</span><span style="color:#F97583;">.</span><span style="color:#B392F0;">to_vec</span><span style="color:#E1E4E8;">())</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">#[wasmedge_bindgen]</span></span>
<span class="line"><span style="color:#F97583;">pub</span><span style="color:#F97583;"> fn</span><span style="color:#B392F0;"> sha3_digest</span><span style="color:#E1E4E8;">(v</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> Vec</span><span style="color:#E1E4E8;">&lt;</span><span style="color:#B392F0;">u8</span><span style="color:#E1E4E8;">&gt;) </span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;"> Result</span><span style="color:#E1E4E8;">&lt;</span><span style="color:#B392F0;">Vec</span><span style="color:#E1E4E8;">&lt;</span><span style="color:#B392F0;">u8</span><span style="color:#E1E4E8;">&gt;, </span><span style="color:#B392F0;">String</span><span style="color:#E1E4E8;">&gt; {</span></span>
<span class="line"><span style="color:#F97583;">    use</span><span style="color:#B392F0;"> sha3</span><span style="color:#F97583;">::</span><span style="color:#E1E4E8;">{</span><span style="color:#B392F0;">Digest</span><span style="color:#E1E4E8;">, </span><span style="color:#B392F0;">Sha3_256</span><span style="color:#E1E4E8;">};</span></span>
<span class="line"><span style="color:#B392F0;">    Ok</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">Sha3_256</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">digest</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">&amp;</span><span style="color:#E1E4E8;">v)</span><span style="color:#F97583;">.</span><span style="color:#B392F0;">as_slice</span><span style="color:#E1E4E8;">()</span><span style="color:#F97583;">.</span><span style="color:#B392F0;">to_vec</span><span style="color:#E1E4E8;">())</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre></div><h2 id="编译与构建" tabindex="-1">编译与构建 <a class="header-anchor" href="#编译与构建" aria-label="Permalink to &quot;编译与构建&quot;">​</a></h2><h3 id="使用-wasm-pack-构建" tabindex="-1">使用 wasm-pack 构建 <a class="header-anchor" href="#使用-wasm-pack-构建" aria-label="Permalink to &quot;使用 wasm-pack 构建&quot;">​</a></h3><p><code>wasm-pack</code> 是官方推荐的构建工具，提供一体化的构建体验：</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># 开发构建</span></span>
<span class="line"><span style="color:#B392F0;">wasm-pack</span><span style="color:#9ECBFF;"> build</span><span style="color:#79B8FF;"> --target</span><span style="color:#9ECBFF;"> web</span><span style="color:#79B8FF;"> --dev</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 发布构建</span></span>
<span class="line"><span style="color:#B392F0;">wasm-pack</span><span style="color:#9ECBFF;"> build</span><span style="color:#79B8FF;"> --target</span><span style="color:#9ECBFF;"> web</span><span style="color:#79B8FF;"> --release</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 针对 Node.js 环境</span></span>
<span class="line"><span style="color:#B392F0;">wasm-pack</span><span style="color:#9ECBFF;"> build</span><span style="color:#79B8FF;"> --target</span><span style="color:#9ECBFF;"> nodejs</span></span></code></pre></div><h3 id="优化编译配置" tabindex="-1">优化编译配置 <a class="header-anchor" href="#优化编译配置" aria-label="Permalink to &quot;优化编译配置&quot;">​</a></h3><p>在 <code>Cargo.toml</code> 中添加优化配置：</p><div class="language-toml"><button title="Copy Code" class="copy"></button><span class="lang">toml</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#E1E4E8;">[</span><span style="color:#B392F0;">package</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">metadata</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">wasm-pack</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">profile</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">release</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">wasm-opt = [</span><span style="color:#9ECBFF;">&quot;-Os&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;--enable-mutable-globals&quot;</span><span style="color:#E1E4E8;">]</span></span></code></pre></div><p>手动使用 <code>wasm-opt</code> 进一步优化：</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># 安装 wasm-opt</span></span>
<span class="line"><span style="color:#B392F0;">cargo</span><span style="color:#9ECBFF;"> install</span><span style="color:#9ECBFF;"> wasm-tools</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 优化 WASM 文件</span></span>
<span class="line"><span style="color:#B392F0;">wasm-opt</span><span style="color:#79B8FF;"> -Os</span><span style="color:#9ECBFF;"> pkg/rust_wasm_demo_bg.wasm</span><span style="color:#79B8FF;"> -o</span><span style="color:#9ECBFF;"> pkg/rust_wasm_demo_optimized.wasm</span></span></code></pre></div><h2 id="前端集成" tabindex="-1">前端集成 <a class="header-anchor" href="#前端集成" aria-label="Permalink to &quot;前端集成&quot;">​</a></h2><h3 id="现代-es6-模块集成" tabindex="-1">现代 ES6 模块集成 <a class="header-anchor" href="#现代-es6-模块集成" aria-label="Permalink to &quot;现代 ES6 模块集成&quot;">​</a></h3><div class="language-html"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#E1E4E8;">&lt;!</span><span style="color:#85E89D;">DOCTYPE</span><span style="color:#B392F0;"> html</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">&lt;</span><span style="color:#85E89D;">html</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">&lt;</span><span style="color:#85E89D;">head</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;</span><span style="color:#85E89D;">meta</span><span style="color:#B392F0;"> charset</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;utf-8&quot;</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;</span><span style="color:#85E89D;">title</span><span style="color:#E1E4E8;">&gt;Rust WASM 演示&lt;/</span><span style="color:#85E89D;">title</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">&lt;/</span><span style="color:#85E89D;">head</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">&lt;</span><span style="color:#85E89D;">body</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;</span><span style="color:#85E89D;">script</span><span style="color:#B392F0;"> type</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;module&quot;</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#F97583;">        import</span><span style="color:#E1E4E8;"> init, { greet, fibonacci, setup_calculator } </span><span style="color:#F97583;">from</span><span style="color:#9ECBFF;"> &#39;./pkg/rust_wasm_demo.js&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#F97583;">        async</span><span style="color:#F97583;"> function</span><span style="color:#B392F0;"> run</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#6A737D;">            // 初始化 WASM 模块</span></span>
<span class="line"><span style="color:#F97583;">            await</span><span style="color:#B392F0;"> init</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span></span>
<span class="line"><span style="color:#6A737D;">            // 调用 Rust 函数</span></span>
<span class="line"><span style="color:#F97583;">            const</span><span style="color:#79B8FF;"> greeting</span><span style="color:#F97583;"> =</span><span style="color:#B392F0;"> greet</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;WASM&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">            console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(greeting);</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span></span>
<span class="line"><span style="color:#6A737D;">            // 性能测试</span></span>
<span class="line"><span style="color:#F97583;">            const</span><span style="color:#79B8FF;"> start</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> performance.</span><span style="color:#B392F0;">now</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#F97583;">            const</span><span style="color:#79B8FF;"> fibResult</span><span style="color:#F97583;"> =</span><span style="color:#B392F0;"> fibonacci</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">40</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#F97583;">            const</span><span style="color:#79B8FF;"> duration</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> performance.</span><span style="color:#B392F0;">now</span><span style="color:#E1E4E8;">() </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> start;</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span></span>
<span class="line"><span style="color:#E1E4E8;">            console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">\`斐波那契(40) = \${</span><span style="color:#E1E4E8;">fibResult</span><span style="color:#9ECBFF;">}, 耗时: \${</span><span style="color:#E1E4E8;">duration</span><span style="color:#9ECBFF;">.</span><span style="color:#B392F0;">toFixed</span><span style="color:#9ECBFF;">(</span><span style="color:#79B8FF;">2</span><span style="color:#9ECBFF;">)</span><span style="color:#9ECBFF;">}ms\`</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span></span>
<span class="line"><span style="color:#6A737D;">            // 设置 DOM 交互</span></span>
<span class="line"><span style="color:#F97583;">            await</span><span style="color:#B392F0;"> setup_calculator</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#B392F0;">        run</span><span style="color:#E1E4E8;">().</span><span style="color:#B392F0;">catch</span><span style="color:#E1E4E8;">(console.error);</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;/</span><span style="color:#85E89D;">script</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">&lt;/</span><span style="color:#85E89D;">body</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">&lt;/</span><span style="color:#85E89D;">html</span><span style="color:#E1E4E8;">&gt;</span></span></code></pre></div><h3 id="性能对比实践" tabindex="-1">性能对比实践 <a class="header-anchor" href="#性能对比实践" aria-label="Permalink to &quot;性能对比实践&quot;">​</a></h3><p>根据实际测试数据，Rust WASM 在计算密集型任务中表现卓越：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span>斐波那契数列计算性能对比（第30项）:</span></span>
<span class="line"><span></span></span>
<span class="line"><span>实现方式       平均耗时     相对性能</span></span>
<span class="line"><span>JavaScript递归  128ms        1x</span></span>
<span class="line"><span>JavaScript迭代  0.02ms     6400x  </span></span>
<span class="line"><span>Rust WASM      0.003ms    42666x</span></span></code></pre></div><h2 id="高级应用模式" tabindex="-1">高级应用模式 <a class="header-anchor" href="#高级应用模式" aria-label="Permalink to &quot;高级应用模式&quot;">​</a></h2><h3 id="服务器端-wasm-应用" tabindex="-1">服务器端 WASM 应用 <a class="header-anchor" href="#服务器端-wasm-应用" aria-label="Permalink to &quot;服务器端 WASM 应用&quot;">​</a></h3><p>Rust WASM 不仅限于浏览器，也可在服务器端运行。以下是使用 WasmEdge 创建 HTTP 服务器的示例：</p><div class="language-rust"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#F97583;">use</span><span style="color:#B392F0;"> bytecodec</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">DecodeExt</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">use</span><span style="color:#B392F0;"> httpcodec</span><span style="color:#F97583;">::</span><span style="color:#E1E4E8;">{</span><span style="color:#B392F0;">HttpVersion</span><span style="color:#E1E4E8;">, </span><span style="color:#B392F0;">ReasonPhrase</span><span style="color:#E1E4E8;">, </span><span style="color:#B392F0;">Request</span><span style="color:#E1E4E8;">, </span><span style="color:#B392F0;">RequestDecoder</span><span style="color:#E1E4E8;">, </span><span style="color:#B392F0;">Response</span><span style="color:#E1E4E8;">, </span><span style="color:#B392F0;">StatusCode</span><span style="color:#E1E4E8;">};</span></span>
<span class="line"><span style="color:#F97583;">use</span><span style="color:#B392F0;"> std</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">io</span><span style="color:#F97583;">::</span><span style="color:#E1E4E8;">{</span><span style="color:#B392F0;">Read</span><span style="color:#E1E4E8;">, </span><span style="color:#B392F0;">Write</span><span style="color:#E1E4E8;">};</span></span>
<span class="line"><span style="color:#F97583;">use</span><span style="color:#B392F0;"> wasmedge_wasi_socket</span><span style="color:#F97583;">::</span><span style="color:#E1E4E8;">{</span><span style="color:#B392F0;">TcpListener</span><span style="color:#E1E4E8;">, </span><span style="color:#B392F0;">TcpStream</span><span style="color:#E1E4E8;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">fn</span><span style="color:#B392F0;"> handle_http</span><span style="color:#E1E4E8;">(req</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> Request</span><span style="color:#E1E4E8;">&lt;</span><span style="color:#B392F0;">String</span><span style="color:#E1E4E8;">&gt;) </span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;"> bytecodec</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">Result</span><span style="color:#E1E4E8;">&lt;</span><span style="color:#B392F0;">Response</span><span style="color:#E1E4E8;">&lt;</span><span style="color:#B392F0;">String</span><span style="color:#E1E4E8;">&gt;&gt; {</span></span>
<span class="line"><span style="color:#B392F0;">    Ok</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">Response</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">new</span><span style="color:#E1E4E8;">(</span></span>
<span class="line"><span style="color:#B392F0;">        HttpVersion</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">V1_0</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#B392F0;">        StatusCode</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">new</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">200</span><span style="color:#E1E4E8;">)</span><span style="color:#F97583;">?</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#B392F0;">        ReasonPhrase</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">new</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;&quot;</span><span style="color:#E1E4E8;">)</span><span style="color:#F97583;">?</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#B392F0;">        format!</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;echo: {}&quot;</span><span style="color:#E1E4E8;">, req</span><span style="color:#F97583;">.</span><span style="color:#B392F0;">body</span><span style="color:#E1E4E8;">()),</span></span>
<span class="line"><span style="color:#E1E4E8;">    ))</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">fn</span><span style="color:#B392F0;"> handle_client</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">mut</span><span style="color:#E1E4E8;"> stream</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> TcpStream</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;"> std</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">io</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">Result</span><span style="color:#E1E4E8;">&lt;()&gt; {</span></span>
<span class="line"><span style="color:#F97583;">    let</span><span style="color:#F97583;"> mut</span><span style="color:#E1E4E8;"> buff </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> [</span><span style="color:#79B8FF;">0</span><span style="color:#B392F0;">u8</span><span style="color:#E1E4E8;">; </span><span style="color:#79B8FF;">1024</span><span style="color:#E1E4E8;">];</span></span>
<span class="line"><span style="color:#F97583;">    let</span><span style="color:#F97583;"> mut</span><span style="color:#E1E4E8;"> data </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> Vec</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">new</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#F97583;">    loop</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#F97583;">        let</span><span style="color:#E1E4E8;"> n </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> stream</span><span style="color:#F97583;">.</span><span style="color:#B392F0;">read</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">&amp;mut</span><span style="color:#E1E4E8;"> buff)</span><span style="color:#F97583;">?</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">        data</span><span style="color:#F97583;">.</span><span style="color:#B392F0;">extend_from_slice</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">&amp;</span><span style="color:#E1E4E8;">buff[</span><span style="color:#79B8FF;">0</span><span style="color:#F97583;">..</span><span style="color:#E1E4E8;">n]);</span></span>
<span class="line"><span style="color:#F97583;">        if</span><span style="color:#E1E4E8;"> n </span><span style="color:#F97583;">&lt;</span><span style="color:#79B8FF;"> 1024</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#F97583;">            break</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#F97583;">    let</span><span style="color:#F97583;"> mut</span><span style="color:#E1E4E8;"> decoder </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> RequestDecoder</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">default</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#F97583;">    let</span><span style="color:#E1E4E8;"> req </span><span style="color:#F97583;">=</span><span style="color:#F97583;"> match</span><span style="color:#E1E4E8;"> decoder</span><span style="color:#F97583;">.</span><span style="color:#B392F0;">decode_from_bytes</span><span style="color:#E1E4E8;">(data</span><span style="color:#F97583;">.</span><span style="color:#B392F0;">as_slice</span><span style="color:#E1E4E8;">()) {</span></span>
<span class="line"><span style="color:#B392F0;">        Ok</span><span style="color:#E1E4E8;">(req) </span><span style="color:#F97583;">=&gt;</span><span style="color:#B392F0;"> handle_http</span><span style="color:#E1E4E8;">(req),</span></span>
<span class="line"><span style="color:#B392F0;">        Err</span><span style="color:#E1E4E8;">(e) </span><span style="color:#F97583;">=&gt;</span><span style="color:#B392F0;"> Err</span><span style="color:#E1E4E8;">(e),</span></span>
<span class="line"><span style="color:#E1E4E8;">    };</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#F97583;">    let</span><span style="color:#E1E4E8;"> response </span><span style="color:#F97583;">=</span><span style="color:#F97583;"> match</span><span style="color:#E1E4E8;"> req {</span></span>
<span class="line"><span style="color:#B392F0;">        Ok</span><span style="color:#E1E4E8;">(r) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> r,</span></span>
<span class="line"><span style="color:#B392F0;">        Err</span><span style="color:#E1E4E8;">(e) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#F97583;">            let</span><span style="color:#E1E4E8;"> err </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> format!</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;{:?}&quot;</span><span style="color:#E1E4E8;">, e);</span></span>
<span class="line"><span style="color:#B392F0;">            Response</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">new</span><span style="color:#E1E4E8;">(</span></span>
<span class="line"><span style="color:#B392F0;">                HttpVersion</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">V1_0</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#B392F0;">                StatusCode</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">new</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">500</span><span style="color:#E1E4E8;">)</span><span style="color:#F97583;">.</span><span style="color:#B392F0;">unwrap</span><span style="color:#E1E4E8;">(),</span></span>
<span class="line"><span style="color:#B392F0;">                ReasonPhrase</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">new</span><span style="color:#E1E4E8;">(err</span><span style="color:#F97583;">.</span><span style="color:#B392F0;">as_str</span><span style="color:#E1E4E8;">())</span><span style="color:#F97583;">.</span><span style="color:#B392F0;">unwrap</span><span style="color:#E1E4E8;">(),</span></span>
<span class="line"><span style="color:#E1E4E8;">                err</span><span style="color:#F97583;">.</span><span style="color:#B392F0;">clone</span><span style="color:#E1E4E8;">(),</span></span>
<span class="line"><span style="color:#E1E4E8;">            )</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">    };</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#F97583;">    let</span><span style="color:#E1E4E8;"> write_buf </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> response</span><span style="color:#F97583;">.</span><span style="color:#B392F0;">to_string</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">    stream</span><span style="color:#F97583;">.</span><span style="color:#B392F0;">write</span><span style="color:#E1E4E8;">(write_buf</span><span style="color:#F97583;">.</span><span style="color:#B392F0;">as_bytes</span><span style="color:#E1E4E8;">())</span><span style="color:#F97583;">?</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    stream</span><span style="color:#F97583;">.</span><span style="color:#B392F0;">flush</span><span style="color:#E1E4E8;">()</span><span style="color:#F97583;">?</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#B392F0;">    Ok</span><span style="color:#E1E4E8;">(())</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">#[wasmedge_bindgen]</span></span>
<span class="line"><span style="color:#F97583;">pub</span><span style="color:#F97583;"> fn</span><span style="color:#B392F0;"> start_server</span><span style="color:#E1E4E8;">() </span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;"> std</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">io</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">Result</span><span style="color:#E1E4E8;">&lt;()&gt; {</span></span>
<span class="line"><span style="color:#F97583;">    let</span><span style="color:#E1E4E8;"> port </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> std</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">env</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">var</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;PORT&quot;</span><span style="color:#E1E4E8;">)</span><span style="color:#F97583;">.</span><span style="color:#B392F0;">unwrap_or</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;1234&quot;</span><span style="color:#F97583;">.</span><span style="color:#B392F0;">to_string</span><span style="color:#E1E4E8;">());</span></span>
<span class="line"><span style="color:#B392F0;">    println!</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;服务器启动在端口: {}&quot;</span><span style="color:#E1E4E8;">, port);</span></span>
<span class="line"><span style="color:#F97583;">    let</span><span style="color:#E1E4E8;"> listener </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> TcpListener</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">bind</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">format!</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;0.0.0.0:{}&quot;</span><span style="color:#E1E4E8;">, port))</span><span style="color:#F97583;">?</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#F97583;">    loop</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#F97583;">        match</span><span style="color:#E1E4E8;"> listener</span><span style="color:#F97583;">.</span><span style="color:#B392F0;">accept</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#B392F0;">            Ok</span><span style="color:#E1E4E8;">((stream, _)) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#F97583;">                let</span><span style="color:#E1E4E8;"> _ </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> handle_client</span><span style="color:#E1E4E8;">(stream);</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span>
<span class="line"><span style="color:#B392F0;">            Err</span><span style="color:#E1E4E8;">(e) </span><span style="color:#F97583;">=&gt;</span><span style="color:#B392F0;"> eprintln!</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;连接错误: {}&quot;</span><span style="color:#E1E4E8;">, e),</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre></div><h3 id="组件化开发-with-wasmcloud" tabindex="-1">组件化开发 with wasmCloud <a class="header-anchor" href="#组件化开发-with-wasmcloud" aria-label="Permalink to &quot;组件化开发 with wasmCloud&quot;">​</a></h3><p>wasmCloud 支持基于 WIT 的组件模型，实现更好的可移植性：</p><div class="language-rust"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#B392F0;">wit_bindgen</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">generate!</span><span style="color:#E1E4E8;">({</span></span>
<span class="line"><span style="color:#E1E4E8;">    world</span><span style="color:#F97583;">:</span><span style="color:#9ECBFF;"> &quot;hello&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    exports</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#9ECBFF;">        &quot;wasi:http/incoming-handler&quot;</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> HttpServer</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    },</span></span>
<span class="line"><span style="color:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">use</span><span style="color:#B392F0;"> exports</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">wasi</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">http</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">incoming_handler</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">Guest</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">use</span><span style="color:#B392F0;"> wasi</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">http</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">types</span><span style="color:#F97583;">::*</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">struct</span><span style="color:#B392F0;"> HttpServer</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">impl</span><span style="color:#B392F0;"> Guest</span><span style="color:#F97583;"> for</span><span style="color:#B392F0;"> HttpServer</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#F97583;">    fn</span><span style="color:#B392F0;"> handle</span><span style="color:#E1E4E8;">(request</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> IncomingRequest</span><span style="color:#E1E4E8;">, response_out</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> ResponseOutparam</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#F97583;">        let</span><span style="color:#E1E4E8;"> response </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> OutgoingResponse</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">new</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">Fields</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">new</span><span style="color:#E1E4E8;">());</span></span>
<span class="line"><span style="color:#E1E4E8;">        response</span><span style="color:#F97583;">.</span><span style="color:#B392F0;">set_status_code</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">200</span><span style="color:#E1E4E8;">)</span><span style="color:#F97583;">.</span><span style="color:#B392F0;">unwrap</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#F97583;">        let</span><span style="color:#E1E4E8;"> response_body </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> response</span><span style="color:#F97583;">.</span><span style="color:#B392F0;">body</span><span style="color:#E1E4E8;">()</span><span style="color:#F97583;">.</span><span style="color:#B392F0;">unwrap</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#F97583;">        let</span><span style="color:#E1E4E8;"> name </span><span style="color:#F97583;">=</span><span style="color:#F97583;"> match</span><span style="color:#E1E4E8;"> request</span></span>
<span class="line"><span style="color:#F97583;">            .</span><span style="color:#B392F0;">path_with_query</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"><span style="color:#F97583;">            .</span><span style="color:#B392F0;">unwrap</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"><span style="color:#F97583;">            .</span><span style="color:#B392F0;">split</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;=&quot;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#F97583;">            .</span><span style="color:#B392F0;">collect</span><span style="color:#F97583;">::</span><span style="color:#E1E4E8;">&lt;</span><span style="color:#B392F0;">Vec</span><span style="color:#E1E4E8;">&lt;</span><span style="color:#F97583;">&amp;</span><span style="color:#B392F0;">str</span><span style="color:#E1E4E8;">&gt;&gt;()[</span><span style="color:#F97583;">..</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">        {</span></span>
<span class="line"><span style="color:#E1E4E8;">            [</span><span style="color:#9ECBFF;">&quot;/?name&quot;</span><span style="color:#E1E4E8;">, name] </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> name</span><span style="color:#F97583;">.</span><span style="color:#B392F0;">to_string</span><span style="color:#E1E4E8;">(),</span></span>
<span class="line"><span style="color:#E1E4E8;">            _ </span><span style="color:#F97583;">=&gt;</span><span style="color:#9ECBFF;"> &quot;World&quot;</span><span style="color:#F97583;">.</span><span style="color:#B392F0;">to_string</span><span style="color:#E1E4E8;">(),</span></span>
<span class="line"><span style="color:#E1E4E8;">        };</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#E1E4E8;">        response_body</span></span>
<span class="line"><span style="color:#F97583;">            .</span><span style="color:#B392F0;">write</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"><span style="color:#F97583;">            .</span><span style="color:#B392F0;">unwrap</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"><span style="color:#F97583;">            .</span><span style="color:#B392F0;">blocking_write_and_flush</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">format!</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;Hello, {}!</span><span style="color:#79B8FF;">\\n</span><span style="color:#9ECBFF;">&quot;</span><span style="color:#E1E4E8;">, name)</span><span style="color:#F97583;">.</span><span style="color:#B392F0;">as_bytes</span><span style="color:#E1E4E8;">())</span></span>
<span class="line"><span style="color:#F97583;">            .</span><span style="color:#B392F0;">unwrap</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span></span>
<span class="line"><span style="color:#B392F0;">        OutgoingBody</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">finish</span><span style="color:#E1E4E8;">(response_body, </span><span style="color:#B392F0;">None</span><span style="color:#E1E4E8;">)</span><span style="color:#F97583;">.</span><span style="color:#B392F0;">expect</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;failed to finish response body&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#B392F0;">        ResponseOutparam</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">set</span><span style="color:#E1E4E8;">(response_out, </span><span style="color:#B392F0;">Ok</span><span style="color:#E1E4E8;">(response));</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">export!</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">HttpServer</span><span style="color:#E1E4E8;">);</span></span></code></pre></div><h2 id="内存管理最佳实践" tabindex="-1">内存管理最佳实践 <a class="header-anchor" href="#内存管理最佳实践" aria-label="Permalink to &quot;内存管理最佳实践&quot;">​</a></h2><h3 id="wasm-线性内存模型" tabindex="-1">WASM 线性内存模型 <a class="header-anchor" href="#wasm-线性内存模型" aria-label="Permalink to &quot;WASM 线性内存模型&quot;">​</a></h3><p>WebAssembly 使用线性内存模型，提供一个连续、隔离的字节数组作为运行时内存空间。</p><p><strong>内存布局示意图：</strong></p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span>线性内存地址空间:</span></span>
<span class="line"><span>0x0000 ┌─────────────────┐</span></span>
<span class="line"><span>      │    代码和数据     │</span></span>
<span class="line"><span>0x1000 ├─────────────────┤</span></span>
<span class="line"><span>      │     堆空间       │ → 可动态增长</span></span>
<span class="line"><span>0x2000 ├─────────────────┤</span></span>
<span class="line"><span>      │     栈空间       │</span></span>
<span class="line"><span>      └─────────────────┘</span></span></code></pre></div><h3 id="高效数据传递策略" tabindex="-1">高效数据传递策略 <a class="header-anchor" href="#高效数据传递策略" aria-label="Permalink to &quot;高效数据传递策略&quot;">​</a></h3><div class="language-rust"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#F97583;">use</span><span style="color:#B392F0;"> wasm_bindgen</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">prelude</span><span style="color:#F97583;">::*</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">use</span><span style="color:#B392F0;"> js_sys</span><span style="color:#F97583;">::</span><span style="color:#E1E4E8;">{</span><span style="color:#B392F0;">Uint8Array</span><span style="color:#E1E4E8;">, </span><span style="color:#B392F0;">ArrayBuffer</span><span style="color:#E1E4E8;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">#[wasm_bindgen]</span></span>
<span class="line"><span style="color:#F97583;">pub</span><span style="color:#F97583;"> fn</span><span style="color:#B392F0;"> process_image_data</span><span style="color:#E1E4E8;">(buffer</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> Vec</span><span style="color:#E1E4E8;">&lt;</span><span style="color:#B392F0;">u8</span><span style="color:#E1E4E8;">&gt;) </span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;"> Result</span><span style="color:#E1E4E8;">&lt;</span><span style="color:#B392F0;">Vec</span><span style="color:#E1E4E8;">&lt;</span><span style="color:#B392F0;">u8</span><span style="color:#E1E4E8;">&gt;, </span><span style="color:#B392F0;">JsValue</span><span style="color:#E1E4E8;">&gt; {</span></span>
<span class="line"><span style="color:#6A737D;">    // 零拷贝或最小化拷贝处理</span></span>
<span class="line"><span style="color:#F97583;">    let</span><span style="color:#F97583;"> mut</span><span style="color:#E1E4E8;"> image_data </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> buffer;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#6A737D;">    // 图像处理逻辑（例如灰度化）</span></span>
<span class="line"><span style="color:#F97583;">    for</span><span style="color:#E1E4E8;"> i </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">0</span><span style="color:#F97583;">..</span><span style="color:#E1E4E8;">image_data</span><span style="color:#F97583;">.</span><span style="color:#B392F0;">len</span><span style="color:#E1E4E8;">())</span><span style="color:#F97583;">.</span><span style="color:#B392F0;">step_by</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#F97583;">        if</span><span style="color:#E1E4E8;"> i </span><span style="color:#F97583;">+</span><span style="color:#79B8FF;"> 3</span><span style="color:#F97583;"> &lt;</span><span style="color:#E1E4E8;"> image_data</span><span style="color:#F97583;">.</span><span style="color:#B392F0;">len</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#F97583;">            let</span><span style="color:#E1E4E8;"> r </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> image_data[i] </span><span style="color:#F97583;">as</span><span style="color:#B392F0;"> f32</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">            let</span><span style="color:#E1E4E8;"> g </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> image_data[i </span><span style="color:#F97583;">+</span><span style="color:#79B8FF;"> 1</span><span style="color:#E1E4E8;">] </span><span style="color:#F97583;">as</span><span style="color:#B392F0;"> f32</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">            let</span><span style="color:#E1E4E8;"> b </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> image_data[i </span><span style="color:#F97583;">+</span><span style="color:#79B8FF;"> 2</span><span style="color:#E1E4E8;">] </span><span style="color:#F97583;">as</span><span style="color:#B392F0;"> f32</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span></span>
<span class="line"><span style="color:#6A737D;">            // 灰度计算</span></span>
<span class="line"><span style="color:#F97583;">            let</span><span style="color:#E1E4E8;"> gray </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">0.299</span><span style="color:#F97583;"> *</span><span style="color:#E1E4E8;"> r </span><span style="color:#F97583;">+</span><span style="color:#79B8FF;"> 0.587</span><span style="color:#F97583;"> *</span><span style="color:#E1E4E8;"> g </span><span style="color:#F97583;">+</span><span style="color:#79B8FF;"> 0.114</span><span style="color:#F97583;"> *</span><span style="color:#E1E4E8;"> b) </span><span style="color:#F97583;">as</span><span style="color:#B392F0;"> u8</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span></span>
<span class="line"><span style="color:#E1E4E8;">            image_data[i] </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> gray;     </span><span style="color:#6A737D;">// R</span></span>
<span class="line"><span style="color:#E1E4E8;">            image_data[i </span><span style="color:#F97583;">+</span><span style="color:#79B8FF;"> 1</span><span style="color:#E1E4E8;">] </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> gray; </span><span style="color:#6A737D;">// G</span></span>
<span class="line"><span style="color:#E1E4E8;">            image_data[i </span><span style="color:#F97583;">+</span><span style="color:#79B8FF;"> 2</span><span style="color:#E1E4E8;">] </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> gray; </span><span style="color:#6A737D;">// B</span></span>
<span class="line"><span style="color:#6A737D;">            // Alpha 通道保持不变</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#B392F0;">    Ok</span><span style="color:#E1E4E8;">(image_data)</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 使用预分配缓冲区避免频繁内存分配</span></span>
<span class="line"><span style="color:#E1E4E8;">#[wasm_bindgen]</span></span>
<span class="line"><span style="color:#F97583;">pub</span><span style="color:#F97583;"> struct</span><span style="color:#B392F0;"> ImageProcessor</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    buffer</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> Vec</span><span style="color:#E1E4E8;">&lt;</span><span style="color:#B392F0;">u8</span><span style="color:#E1E4E8;">&gt;,</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">#[wasm_bindgen]</span></span>
<span class="line"><span style="color:#F97583;">impl</span><span style="color:#B392F0;"> ImageProcessor</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    #[wasm_bindgen(constructor)]</span></span>
<span class="line"><span style="color:#F97583;">    pub</span><span style="color:#F97583;"> fn</span><span style="color:#B392F0;"> new</span><span style="color:#E1E4E8;">(initial_capacity</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> usize</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;"> ImageProcessor</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#B392F0;">        ImageProcessor</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">            buffer</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> Vec</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">with_capacity</span><span style="color:#E1E4E8;">(initial_capacity),</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#F97583;">    pub</span><span style="color:#F97583;"> fn</span><span style="color:#B392F0;"> process</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">&amp;mut</span><span style="color:#79B8FF;"> self</span><span style="color:#E1E4E8;">, input_data</span><span style="color:#F97583;">:</span><span style="color:#F97583;"> &amp;</span><span style="color:#E1E4E8;">[</span><span style="color:#B392F0;">u8</span><span style="color:#E1E4E8;">]) </span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;"> Result</span><span style="color:#E1E4E8;">&lt;</span><span style="color:#B392F0;">Vec</span><span style="color:#E1E4E8;">&lt;</span><span style="color:#B392F0;">u8</span><span style="color:#E1E4E8;">&gt;, </span><span style="color:#B392F0;">JsValue</span><span style="color:#E1E4E8;">&gt; {</span></span>
<span class="line"><span style="color:#79B8FF;">        self</span><span style="color:#F97583;">.</span><span style="color:#E1E4E8;">buffer</span><span style="color:#F97583;">.</span><span style="color:#B392F0;">clear</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#79B8FF;">        self</span><span style="color:#F97583;">.</span><span style="color:#E1E4E8;">buffer</span><span style="color:#F97583;">.</span><span style="color:#B392F0;">extend_from_slice</span><span style="color:#E1E4E8;">(input_data);</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#6A737D;">        // 原地处理数据</span></span>
<span class="line"><span style="color:#F97583;">        for</span><span style="color:#E1E4E8;"> i </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">0</span><span style="color:#F97583;">..</span><span style="color:#79B8FF;">self</span><span style="color:#F97583;">.</span><span style="color:#E1E4E8;">buffer</span><span style="color:#F97583;">.</span><span style="color:#B392F0;">len</span><span style="color:#E1E4E8;">())</span><span style="color:#F97583;">.</span><span style="color:#B392F0;">step_by</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#F97583;">            if</span><span style="color:#E1E4E8;"> i </span><span style="color:#F97583;">+</span><span style="color:#79B8FF;"> 3</span><span style="color:#F97583;"> &lt;</span><span style="color:#79B8FF;"> self</span><span style="color:#F97583;">.</span><span style="color:#E1E4E8;">buffer</span><span style="color:#F97583;">.</span><span style="color:#B392F0;">len</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#6A737D;">                // 处理逻辑...</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#B392F0;">        Ok</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">self</span><span style="color:#F97583;">.</span><span style="color:#E1E4E8;">buffer</span><span style="color:#F97583;">.</span><span style="color:#B392F0;">clone</span><span style="color:#E1E4E8;">())</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre></div><h2 id="调试与测试" tabindex="-1">调试与测试 <a class="header-anchor" href="#调试与测试" aria-label="Permalink to &quot;调试与测试&quot;">​</a></h2><h3 id="单元测试配置" tabindex="-1">单元测试配置 <a class="header-anchor" href="#单元测试配置" aria-label="Permalink to &quot;单元测试配置&quot;">​</a></h3><p>在 Rust 项目中配置 WASM 测试：</p><div class="language-rust"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#E1E4E8;">#[cfg(test)]</span></span>
<span class="line"><span style="color:#F97583;">mod</span><span style="color:#B392F0;"> tests</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#F97583;">    use</span><span style="color:#79B8FF;"> super</span><span style="color:#F97583;">::*</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">    use</span><span style="color:#B392F0;"> wasm_bindgen_test</span><span style="color:#F97583;">::*</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    #[wasm_bindgen_test]</span></span>
<span class="line"><span style="color:#F97583;">    fn</span><span style="color:#B392F0;"> test_fibonacci</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#B392F0;">        assert_eq!</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">fibonacci</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">), </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#B392F0;">        assert_eq!</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">fibonacci</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">), </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#B392F0;">        assert_eq!</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">fibonacci</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">10</span><span style="color:#E1E4E8;">), </span><span style="color:#79B8FF;">55</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#B392F0;">        assert_eq!</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">fibonacci</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">20</span><span style="color:#E1E4E8;">), </span><span style="color:#79B8FF;">6765</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#E1E4E8;">    #[wasm_bindgen_test]</span></span>
<span class="line"><span style="color:#F97583;">    fn</span><span style="color:#B392F0;"> test_greet</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#F97583;">        let</span><span style="color:#E1E4E8;"> result </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> greet</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;World&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#B392F0;">        assert_eq!</span><span style="color:#E1E4E8;">(result, </span><span style="color:#9ECBFF;">&quot;Hello, World!&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre></div><p>在 <code>Cargo.toml</code> 中添加测试依赖：</p><div class="language-toml"><button title="Copy Code" class="copy"></button><span class="lang">toml</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#E1E4E8;">[</span><span style="color:#B392F0;">dev-dependencies</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">wasm-bindgen-test = </span><span style="color:#9ECBFF;">&quot;0.3&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">[</span><span style="color:#B392F0;">lib</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">crate-type = [</span><span style="color:#9ECBFF;">&quot;cdylib&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;rlib&quot;</span><span style="color:#E1E4E8;">]</span></span></code></pre></div><h3 id="调试技巧" tabindex="-1">调试技巧 <a class="header-anchor" href="#调试技巧" aria-label="Permalink to &quot;调试技巧&quot;">​</a></h3><p>启用调试信息编译：</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#B392F0;">wasm-pack</span><span style="color:#9ECBFF;"> build</span><span style="color:#79B8FF;"> --target</span><span style="color:#9ECBFF;"> web</span><span style="color:#79B8FF;"> --dev</span></span></code></pre></div><p>在浏览器开发者工具中调试时，确保启用源映射支持，可以设置断点并单步执行 Rust 代码。</p><p>通过这套完整的技术栈，开发者可以充分利用 Rust 的性能和安全特性，结合 WebAssembly 的跨平台能力，构建高性能的 Web 应用和服务器端解决方案。</p>`,74)])])}const u=n(o,[["render",e]]);export{i as __pageData,u as default};

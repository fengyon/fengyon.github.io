import{_ as a,c as n,o as l,b as p}from"./chunks/framework.CMLuPXeo.js";const i=JSON.parse('{"title":"WASM 与其他语言","description":"","frontmatter":{},"headers":[{"level":2,"title":"多语言生态概览","slug":"多语言生态概览","link":"#多语言生态概览","children":[]},{"level":2,"title":"Rust 与 WebAssembly","slug":"rust-与-webassembly","link":"#rust-与-webassembly","children":[{"level":3,"title":"工具链与开发生态","slug":"工具链与开发生态","link":"#工具链与开发生态","children":[]},{"level":3,"title":"wasm-bindgen 实战","slug":"wasm-bindgen-实战","link":"#wasm-bindgen-实战","children":[]},{"level":3,"title":"编译与优化","slug":"编译与优化","link":"#编译与优化","children":[]}]},{"level":2,"title":"Go 与 WebAssembly","slug":"go-与-webassembly","link":"#go-与-webassembly","children":[{"level":3,"title":"语言特性与 WASM 适配","slug":"语言特性与-wasm-适配","link":"#语言特性与-wasm-适配","children":[]},{"level":3,"title":"go:wasmexport 指令","slug":"go-wasmexport-指令","link":"#go-wasmexport-指令","children":[]},{"level":3,"title":"WASI Reactor 模式构建","slug":"wasi-reactor-模式构建","link":"#wasi-reactor-模式构建","children":[]},{"level":3,"title":"在 Wazero 运行时中使用 Go WASM","slug":"在-wazero-运行时中使用-go-wasm","link":"#在-wazero-运行时中使用-go-wasm","children":[]}]},{"level":2,"title":"C/C++ 与 WebAssembly","slug":"c-c-与-webassembly","link":"#c-c-与-webassembly","children":[{"level":3,"title":"Emscripten 工具链","slug":"emscripten-工具链","link":"#emscripten-工具链","children":[]}]},{"level":2,"title":"AssemblyScript","slug":"assemblyscript","link":"#assemblyscript","children":[{"level":3,"title":"TypeScript 到 WebAssembly","slug":"typescript-到-webassembly","link":"#typescript-到-webassembly","children":[]}]},{"level":2,"title":"语言特性对比与选择指南","slug":"语言特性对比与选择指南","link":"#语言特性对比与选择指南","children":[{"level":3,"title":"各语言在 WASM 生态中的表现","slug":"各语言在-wasm-生态中的表现","link":"#各语言在-wasm-生态中的表现","children":[]},{"level":3,"title":"选择考量因素","slug":"选择考量因素","link":"#选择考量因素","children":[]}]},{"level":2,"title":"跨语言互操作模式","slug":"跨语言互操作模式","link":"#跨语言互操作模式","children":[{"level":3,"title":"通用接口设计","slug":"通用接口设计","link":"#通用接口设计","children":[]},{"level":3,"title":"内存共享模式","slug":"内存共享模式","link":"#内存共享模式","children":[]}]},{"level":2,"title":"工具链与运行时集成","slug":"工具链与运行时集成","link":"#工具链与运行时集成","children":[{"level":3,"title":"多语言开发工作流","slug":"多语言开发工作流","link":"#多语言开发工作流","children":[]},{"level":3,"title":"WasmEdge 多语言运行时","slug":"wasmedge-多语言运行时","link":"#wasmedge-多语言运行时","children":[]}]},{"level":2,"title":"性能优化策略","slug":"性能优化策略","link":"#性能优化策略","children":[{"level":3,"title":"语言特定优化技巧","slug":"语言特定优化技巧","link":"#语言特定优化技巧","children":[]},{"level":3,"title":"内存使用最佳实践","slug":"内存使用最佳实践","link":"#内存使用最佳实践","children":[]}]}],"relativePath":"leading/webassembly/other-languages.md","filePath":"leading/webassembly/other-languages.md"}'),o={name:"leading/webassembly/other-languages.md"};function e(t,s,c,r,E,y){return l(),n("div",null,[...s[0]||(s[0]=[p(`<div style="display:none;" hidden="true" aria-hidden="true">Are you an LLM? You can read better optimized documentation at /leading/webassembly/other-languages.md for this page in Markdown format</div><h1 id="wasm-与其他语言" tabindex="-1">WASM 与其他语言 <a class="header-anchor" href="#wasm-与其他语言" aria-label="Permalink to &quot;WASM 与其他语言&quot;">​</a></h1><h2 id="多语言生态概览" tabindex="-1">多语言生态概览 <a class="header-anchor" href="#多语言生态概览" aria-label="Permalink to &quot;多语言生态概览&quot;">​</a></h2><p>WebAssembly 作为一种通用的编译目标，其设计初衷就是支持多种编程语言。这种语言无关性让开发者能够根据项目需求选择最适合的语言，同时享受 WASM 带来的跨平台、高性能和安全优势。</p><p><strong>核心编译流程示意图：</strong></p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span>高级语言源代码 (Rust/C/C++/Go/等)</span></span>
<span class="line"><span>        ↓</span></span>
<span class="line"><span>    [语言特定编译器]</span></span>
<span class="line"><span>        ↓</span></span>
<span class="line"><span>    LLVM 中间表示 (IR)</span></span>
<span class="line"><span>        ↓</span></span>
<span class="line"><span>  [WASM 后端代码生成]</span></span>
<span class="line"><span>        ↓</span></span>
<span class="line"><span>   .wasm 二进制模块</span></span>
<span class="line"><span>        ↓</span></span>
<span class="line"><span>  [跨平台执行环境]</span></span></code></pre></div><h2 id="rust-与-webassembly" tabindex="-1">Rust 与 WebAssembly <a class="header-anchor" href="#rust-与-webassembly" aria-label="Permalink to &quot;Rust 与 WebAssembly&quot;">​</a></h2><h3 id="工具链与开发生态" tabindex="-1">工具链与开发生态 <a class="header-anchor" href="#工具链与开发生态" aria-label="Permalink to &quot;工具链与开发生态&quot;">​</a></h3><p>Rust 语言凭借其内存安全特性和卓越的性能，成为 WebAssembly 开发的首选语言之一。Rust 生成的 WASM 模块不含垃圾回收器等额外开销，通过高级优化可实现极小的代码体积。</p><p><strong>核心优势对比：</strong></p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span>Rust 特性 → WASM 优势</span></span>
<span class="line"><span>内存安全 → 沙箱安全保证</span></span>
<span class="line"><span>零成本抽象 → 紧凑二进制体积</span></span>
<span class="line"><span>现代工具链 → 流畅开发体验</span></span>
<span class="line"><span>无运行时 → 快速启动执行</span></span></code></pre></div><h3 id="wasm-bindgen-实战" tabindex="-1">wasm-bindgen 实战 <a class="header-anchor" href="#wasm-bindgen-实战" aria-label="Permalink to &quot;wasm-bindgen 实战&quot;">​</a></h3><p><code>wasm-bindgen</code> 是 Rust 与 JavaScript 交互的核心工具，提供类型安全的绑定生成：</p><div class="language-rust"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#F97583;">use</span><span style="color:#B392F0;"> wasm_bindgen</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">prelude</span><span style="color:#F97583;">::*</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">use</span><span style="color:#B392F0;"> web_sys</span><span style="color:#F97583;">::</span><span style="color:#E1E4E8;">console;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">#[wasm_bindgen]</span></span>
<span class="line"><span style="color:#F97583;">pub</span><span style="color:#F97583;"> struct</span><span style="color:#B392F0;"> ImageProcessor</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    width</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> u32</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    height</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> u32</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    data</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> Vec</span><span style="color:#E1E4E8;">&lt;</span><span style="color:#B392F0;">u8</span><span style="color:#E1E4E8;">&gt;,</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">#[wasm_bindgen]</span></span>
<span class="line"><span style="color:#F97583;">impl</span><span style="color:#B392F0;"> ImageProcessor</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    #[wasm_bindgen(constructor)]</span></span>
<span class="line"><span style="color:#F97583;">    pub</span><span style="color:#F97583;"> fn</span><span style="color:#B392F0;"> new</span><span style="color:#E1E4E8;">(width</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> u32</span><span style="color:#E1E4E8;">, height</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> u32</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;"> ImageProcessor</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#B392F0;">        ImageProcessor</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">            width,</span></span>
<span class="line"><span style="color:#E1E4E8;">            height,</span></span>
<span class="line"><span style="color:#E1E4E8;">            data</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> vec!</span><span style="color:#E1E4E8;">[</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">; (width </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> height </span><span style="color:#F97583;">*</span><span style="color:#79B8FF;"> 4</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">as</span><span style="color:#B392F0;"> usize</span><span style="color:#E1E4E8;">],</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    #[wasm_bindgen]</span></span>
<span class="line"><span style="color:#F97583;">    pub</span><span style="color:#F97583;"> fn</span><span style="color:#B392F0;"> grayscale</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">&amp;mut</span><span style="color:#79B8FF;"> self</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#F97583;">        for</span><span style="color:#E1E4E8;"> i </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">0</span><span style="color:#F97583;">..</span><span style="color:#79B8FF;">self</span><span style="color:#F97583;">.</span><span style="color:#E1E4E8;">data</span><span style="color:#F97583;">.</span><span style="color:#B392F0;">len</span><span style="color:#E1E4E8;">())</span><span style="color:#F97583;">.</span><span style="color:#B392F0;">step_by</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#F97583;">            let</span><span style="color:#E1E4E8;"> r </span><span style="color:#F97583;">=</span><span style="color:#79B8FF;"> self</span><span style="color:#F97583;">.</span><span style="color:#E1E4E8;">data[i] </span><span style="color:#F97583;">as</span><span style="color:#B392F0;"> f32</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">            let</span><span style="color:#E1E4E8;"> g </span><span style="color:#F97583;">=</span><span style="color:#79B8FF;"> self</span><span style="color:#F97583;">.</span><span style="color:#E1E4E8;">data[i </span><span style="color:#F97583;">+</span><span style="color:#79B8FF;"> 1</span><span style="color:#E1E4E8;">] </span><span style="color:#F97583;">as</span><span style="color:#B392F0;"> f32</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">            let</span><span style="color:#E1E4E8;"> b </span><span style="color:#F97583;">=</span><span style="color:#79B8FF;"> self</span><span style="color:#F97583;">.</span><span style="color:#E1E4E8;">data[i </span><span style="color:#F97583;">+</span><span style="color:#79B8FF;"> 2</span><span style="color:#E1E4E8;">] </span><span style="color:#F97583;">as</span><span style="color:#B392F0;"> f32</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">            let</span><span style="color:#E1E4E8;"> gray </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">0.299</span><span style="color:#F97583;"> *</span><span style="color:#E1E4E8;"> r </span><span style="color:#F97583;">+</span><span style="color:#79B8FF;"> 0.587</span><span style="color:#F97583;"> *</span><span style="color:#E1E4E8;"> g </span><span style="color:#F97583;">+</span><span style="color:#79B8FF;"> 0.114</span><span style="color:#F97583;"> *</span><span style="color:#E1E4E8;"> b) </span><span style="color:#F97583;">as</span><span style="color:#B392F0;"> u8</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#79B8FF;">            self</span><span style="color:#F97583;">.</span><span style="color:#E1E4E8;">data[i] </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> gray;</span></span>
<span class="line"><span style="color:#79B8FF;">            self</span><span style="color:#F97583;">.</span><span style="color:#E1E4E8;">data[i </span><span style="color:#F97583;">+</span><span style="color:#79B8FF;"> 1</span><span style="color:#E1E4E8;">] </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> gray;</span></span>
<span class="line"><span style="color:#79B8FF;">            self</span><span style="color:#F97583;">.</span><span style="color:#E1E4E8;">data[i </span><span style="color:#F97583;">+</span><span style="color:#79B8FF;"> 2</span><span style="color:#E1E4E8;">] </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> gray;</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    #[wasm_bindgen]</span></span>
<span class="line"><span style="color:#F97583;">    pub</span><span style="color:#F97583;"> fn</span><span style="color:#B392F0;"> get_data_ptr</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">&amp;</span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">-&gt;</span><span style="color:#F97583;"> *const</span><span style="color:#B392F0;"> u8</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#79B8FF;">        self</span><span style="color:#F97583;">.</span><span style="color:#E1E4E8;">data</span><span style="color:#F97583;">.</span><span style="color:#B392F0;">as_ptr</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre></div><h3 id="编译与优化" tabindex="-1">编译与优化 <a class="header-anchor" href="#编译与优化" aria-label="Permalink to &quot;编译与优化&quot;">​</a></h3><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># 安装 WASM 目标</span></span>
<span class="line"><span style="color:#B392F0;">rustup</span><span style="color:#9ECBFF;"> target</span><span style="color:#9ECBFF;"> add</span><span style="color:#9ECBFF;"> wasm32-unknown-unknown</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 使用 wasm-pack 构建</span></span>
<span class="line"><span style="color:#B392F0;">wasm-pack</span><span style="color:#9ECBFF;"> build</span><span style="color:#79B8FF;"> --target</span><span style="color:#9ECBFF;"> web</span><span style="color:#79B8FF;"> --release</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 进一步优化体积</span></span>
<span class="line"><span style="color:#B392F0;">wasm-opt</span><span style="color:#79B8FF;"> -Os</span><span style="color:#9ECBFF;"> pkg/</span><span style="color:#79B8FF;">*</span><span style="color:#9ECBFF;">.wasm</span><span style="color:#79B8FF;"> -o</span><span style="color:#9ECBFF;"> pkg/optimized.wasm</span></span></code></pre></div><h2 id="go-与-webassembly" tabindex="-1">Go 与 WebAssembly <a class="header-anchor" href="#go-与-webassembly" aria-label="Permalink to &quot;Go 与 WebAssembly&quot;">​</a></h2><h3 id="语言特性与-wasm-适配" tabindex="-1">语言特性与 WASM 适配 <a class="header-anchor" href="#语言特性与-wasm-适配" aria-label="Permalink to &quot;语言特性与 WASM 适配&quot;">​</a></h3><p>Go 语言通过基于 LLVM 的 TinyGo 编译器更好地适配 WebAssembly 环境。TinyGo 专门针对嵌入式系统和 WASM 优化，解决了传统 Go 编译器生成二进制文件过大的问题。</p><h3 id="go-wasmexport-指令" tabindex="-1">go:wasmexport 指令 <a class="header-anchor" href="#go-wasmexport-指令" aria-label="Permalink to &quot;go:wasmexport 指令&quot;">​</a></h3><p>Go 1.24 引入了 <code>go:wasmexport</code> 指令，显著增强了 Go 与 WASM 主机的交互能力：</p><div class="language-go"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#F97583;">package</span><span style="color:#B392F0;"> main</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//go:wasmexport add</span></span>
<span class="line"><span style="color:#F97583;">func</span><span style="color:#B392F0;"> add</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">a</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">b</span><span style="color:#F97583;"> int32</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">int32</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#F97583;">    return</span><span style="color:#E1E4E8;"> a </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> b</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//go:wasmexport process_string</span></span>
<span class="line"><span style="color:#F97583;">func</span><span style="color:#B392F0;"> processString</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">input</span><span style="color:#F97583;"> string</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">string</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#6A737D;">    // 字符串处理逻辑</span></span>
<span class="line"><span style="color:#F97583;">    return</span><span style="color:#9ECBFF;"> &quot;Processed: &quot;</span><span style="color:#F97583;"> +</span><span style="color:#E1E4E8;"> input</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">//go:wasmexport calculate_stats</span></span>
<span class="line"><span style="color:#F97583;">func</span><span style="color:#B392F0;"> calculateStats</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">data</span><span style="color:#E1E4E8;"> []</span><span style="color:#F97583;">float64</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">map</span><span style="color:#E1E4E8;">[</span><span style="color:#F97583;">string</span><span style="color:#E1E4E8;">]</span><span style="color:#F97583;">float64</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    stats </span><span style="color:#F97583;">:=</span><span style="color:#B392F0;"> make</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">map</span><span style="color:#E1E4E8;">[</span><span style="color:#F97583;">string</span><span style="color:#E1E4E8;">]</span><span style="color:#F97583;">float64</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">    var</span><span style="color:#E1E4E8;"> sum </span><span style="color:#F97583;">float64</span></span>
<span class="line"><span style="color:#F97583;">    for</span><span style="color:#E1E4E8;"> _, v </span><span style="color:#F97583;">:=</span><span style="color:#F97583;"> range</span><span style="color:#E1E4E8;"> data {</span></span>
<span class="line"><span style="color:#E1E4E8;">        sum </span><span style="color:#F97583;">+=</span><span style="color:#E1E4E8;"> v</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">    stats[</span><span style="color:#9ECBFF;">&quot;mean&quot;</span><span style="color:#E1E4E8;">] </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> sum </span><span style="color:#F97583;">/</span><span style="color:#F97583;"> float64</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">len</span><span style="color:#E1E4E8;">(data))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">    // 更多统计计算...</span></span>
<span class="line"><span style="color:#F97583;">    return</span><span style="color:#E1E4E8;"> stats</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre></div><h3 id="wasi-reactor-模式构建" tabindex="-1">WASI Reactor 模式构建 <a class="header-anchor" href="#wasi-reactor-模式构建" aria-label="Permalink to &quot;WASI Reactor 模式构建&quot;">​</a></h3><p>Go 1.24 支持构建 WASI Reactor，创建长期运行的 WebAssembly 模块：</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># 构建 WASI Reactor</span></span>
<span class="line"><span style="color:#E1E4E8;">GOOS</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">wasip1</span><span style="color:#E1E4E8;"> GOARCH</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">wasm</span><span style="color:#B392F0;"> go</span><span style="color:#9ECBFF;"> build</span><span style="color:#79B8FF;"> -buildmode=c-shared</span><span style="color:#79B8FF;"> -o</span><span style="color:#9ECBFF;"> reactor.wasm</span></span></code></pre></div><p><strong>Reactor 与 Command 模式对比：</strong></p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span>Command 模式: 初始化 → 执行主函数 → 退出</span></span>
<span class="line"><span>Reactor 模式: 初始化 → 保持运行状态 → 处理多个请求 → 清理</span></span></code></pre></div><h3 id="在-wazero-运行时中使用-go-wasm" tabindex="-1">在 Wazero 运行时中使用 Go WASM <a class="header-anchor" href="#在-wazero-运行时中使用-go-wasm" aria-label="Permalink to &quot;在 Wazero 运行时中使用 Go WASM&quot;">​</a></h3><div class="language-go"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#F97583;">package</span><span style="color:#B392F0;"> main</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> (</span></span>
<span class="line"><span style="color:#9ECBFF;">    &quot;</span><span style="color:#B392F0;">context</span><span style="color:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="color:#9ECBFF;">    &quot;</span><span style="color:#B392F0;">fmt</span><span style="color:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="color:#9ECBFF;">    &quot;</span><span style="color:#B392F0;">github.com/tetratelabs/wazero</span><span style="color:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="color:#9ECBFF;">    &quot;</span><span style="color:#B392F0;">github.com/tetratelabs/wazero/api</span><span style="color:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">func</span><span style="color:#B392F0;"> main</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#E1E4E8;">    ctx </span><span style="color:#F97583;">:=</span><span style="color:#E1E4E8;"> context.</span><span style="color:#B392F0;">Background</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">    // 创建 Wasm 运行时</span></span>
<span class="line"><span style="color:#E1E4E8;">    r </span><span style="color:#F97583;">:=</span><span style="color:#E1E4E8;"> wazero.</span><span style="color:#B392F0;">NewRuntime</span><span style="color:#E1E4E8;">(ctx)</span></span>
<span class="line"><span style="color:#F97583;">    defer</span><span style="color:#E1E4E8;"> r.</span><span style="color:#B392F0;">Close</span><span style="color:#E1E4E8;">(ctx)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">    // 配置 Reactor 初始化</span></span>
<span class="line"><span style="color:#E1E4E8;">    config </span><span style="color:#F97583;">:=</span><span style="color:#E1E4E8;"> wazero.</span><span style="color:#B392F0;">NewModuleConfig</span><span style="color:#E1E4E8;">().</span><span style="color:#B392F0;">WithStartFunctions</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;_initialize&quot;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">    // 实例化模块</span></span>
<span class="line"><span style="color:#E1E4E8;">    wasmModule, _ </span><span style="color:#F97583;">:=</span><span style="color:#E1E4E8;"> r.</span><span style="color:#B392F0;">InstantiateWithConfig</span><span style="color:#E1E4E8;">(ctx, wasmFile, config)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">    // 调用导出的 Go 函数</span></span>
<span class="line"><span style="color:#E1E4E8;">    fn </span><span style="color:#F97583;">:=</span><span style="color:#E1E4E8;"> wasmModule.</span><span style="color:#B392F0;">ExportedFunction</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;add&quot;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#F97583;">    var</span><span style="color:#E1E4E8;"> a, b </span><span style="color:#F97583;">int32</span><span style="color:#F97583;"> =</span><span style="color:#79B8FF;"> 5</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">3</span></span>
<span class="line"><span style="color:#E1E4E8;">    res, _ </span><span style="color:#F97583;">:=</span><span style="color:#E1E4E8;"> fn.</span><span style="color:#B392F0;">Call</span><span style="color:#E1E4E8;">(ctx, api.</span><span style="color:#B392F0;">EncodeI32</span><span style="color:#E1E4E8;">(a), api.</span><span style="color:#B392F0;">EncodeI32</span><span style="color:#E1E4E8;">(b))</span></span>
<span class="line"><span style="color:#E1E4E8;">    result </span><span style="color:#F97583;">:=</span><span style="color:#E1E4E8;"> api.</span><span style="color:#B392F0;">DecodeI32</span><span style="color:#E1E4E8;">(res[</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">])</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    fmt.</span><span style="color:#B392F0;">Printf</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;add(</span><span style="color:#79B8FF;">%d</span><span style="color:#9ECBFF;">, </span><span style="color:#79B8FF;">%d</span><span style="color:#9ECBFF;">) = </span><span style="color:#79B8FF;">%d\\n</span><span style="color:#9ECBFF;">&quot;</span><span style="color:#E1E4E8;">, a, b, result)</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre></div><h2 id="c-c-与-webassembly" tabindex="-1">C/C++ 与 WebAssembly <a class="header-anchor" href="#c-c-与-webassembly" aria-label="Permalink to &quot;C/C++ 与 WebAssembly&quot;">​</a></h2><h3 id="emscripten-工具链" tabindex="-1">Emscripten 工具链 <a class="header-anchor" href="#emscripten-工具链" aria-label="Permalink to &quot;Emscripten 工具链&quot;">​</a></h3><p>Emscripten 是将 C/C++ 代码编译为 WebAssembly 的完整工具链，提供丰富的系统库支持。</p><h4 id="编译示例" tabindex="-1">编译示例 <a class="header-anchor" href="#编译示例" aria-label="Permalink to &quot;编译示例&quot;">​</a></h4><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># 安装 Emscripten</span></span>
<span class="line"><span style="color:#B392F0;">git</span><span style="color:#9ECBFF;"> clone</span><span style="color:#9ECBFF;"> https://github.com/emscripten-core/emsdk.git</span></span>
<span class="line"><span style="color:#79B8FF;">cd</span><span style="color:#9ECBFF;"> emsdk</span></span>
<span class="line"><span style="color:#B392F0;">./emsdk</span><span style="color:#9ECBFF;"> install</span><span style="color:#9ECBFF;"> latest</span></span>
<span class="line"><span style="color:#B392F0;">./emsdk</span><span style="color:#9ECBFF;"> activate</span><span style="color:#9ECBFF;"> latest</span></span>
<span class="line"><span style="color:#79B8FF;">source</span><span style="color:#9ECBFF;"> ./emsdk_env.sh</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 编译 C 代码为 WASM</span></span>
<span class="line"><span style="color:#B392F0;">emcc</span><span style="color:#79B8FF;"> -O3</span><span style="color:#79B8FF;"> -s</span><span style="color:#9ECBFF;"> WASM=</span><span style="color:#79B8FF;">1</span><span style="color:#79B8FF;"> -s</span><span style="color:#9ECBFF;"> EXPORTED_FUNCTIONS=&#39;[&quot;_main&quot;, &quot;_process_image&quot;]&#39;</span><span style="color:#79B8FF;"> -o</span><span style="color:#9ECBFF;"> output.html</span><span style="color:#9ECBFF;"> input.c</span></span></code></pre></div><h4 id="c-代码示例" tabindex="-1">C 代码示例 <a class="header-anchor" href="#c-代码示例" aria-label="Permalink to &quot;C 代码示例&quot;">​</a></h4><div class="language-c"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#F97583;">#include</span><span style="color:#9ECBFF;"> &lt;emscripten.h&gt;</span></span>
<span class="line"><span style="color:#F97583;">#include</span><span style="color:#9ECBFF;"> &lt;stdint.h&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 导出函数供 JavaScript 调用</span></span>
<span class="line"><span style="color:#E1E4E8;">EMSCRIPTEN_KEEPALIVE</span></span>
<span class="line"><span style="color:#F97583;">uint8_t*</span><span style="color:#B392F0;"> allocate_buffer</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">int</span><span style="color:#FFAB70;"> size</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#F97583;">    return</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">uint8_t*</span><span style="color:#E1E4E8;">)</span><span style="color:#B392F0;">malloc</span><span style="color:#E1E4E8;">(size </span><span style="color:#F97583;">*</span><span style="color:#F97583;"> sizeof</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">uint8_t</span><span style="color:#E1E4E8;">));</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">EMSCRIPTEN_KEEPALIVE</span></span>
<span class="line"><span style="color:#F97583;">void</span><span style="color:#B392F0;"> free_buffer</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">uint8_t*</span><span style="color:#FFAB70;"> ptr</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#B392F0;">    free</span><span style="color:#E1E4E8;">(ptr);</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">EMSCRIPTEN_KEEPALIVE</span></span>
<span class="line"><span style="color:#F97583;">void</span><span style="color:#B392F0;"> image_filter</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">uint8_t*</span><span style="color:#FFAB70;"> input</span><span style="color:#E1E4E8;">, </span><span style="color:#F97583;">uint8_t*</span><span style="color:#FFAB70;"> output</span><span style="color:#E1E4E8;">, </span><span style="color:#F97583;">int</span><span style="color:#FFAB70;"> width</span><span style="color:#E1E4E8;">, </span><span style="color:#F97583;">int</span><span style="color:#FFAB70;"> height</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#6A737D;">    // 图像处理逻辑 - 边缘检测</span></span>
<span class="line"><span style="color:#F97583;">    for</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">int</span><span style="color:#E1E4E8;"> y </span><span style="color:#F97583;">=</span><span style="color:#79B8FF;"> 1</span><span style="color:#E1E4E8;">; y </span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;"> height </span><span style="color:#F97583;">-</span><span style="color:#79B8FF;"> 1</span><span style="color:#E1E4E8;">; y</span><span style="color:#F97583;">++</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#F97583;">        for</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">int</span><span style="color:#E1E4E8;"> x </span><span style="color:#F97583;">=</span><span style="color:#79B8FF;"> 1</span><span style="color:#E1E4E8;">; x </span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;"> width </span><span style="color:#F97583;">-</span><span style="color:#79B8FF;"> 1</span><span style="color:#E1E4E8;">; x</span><span style="color:#F97583;">++</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#F97583;">            int</span><span style="color:#E1E4E8;"> idx </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> (y </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> width </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> x) </span><span style="color:#F97583;">*</span><span style="color:#79B8FF;"> 4</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">            // 简单的 Sobel 边缘检测</span></span>
<span class="line"><span style="color:#F97583;">            int</span><span style="color:#E1E4E8;"> gx </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">1</span><span style="color:#F97583;"> *</span><span style="color:#FFAB70;"> input</span><span style="color:#E1E4E8;">[idx </span><span style="color:#F97583;">-</span><span style="color:#79B8FF;"> 4</span><span style="color:#E1E4E8;">] </span><span style="color:#F97583;">+</span><span style="color:#79B8FF;"> 0</span><span style="color:#F97583;"> +</span><span style="color:#79B8FF;"> 1</span><span style="color:#F97583;"> *</span><span style="color:#FFAB70;"> input</span><span style="color:#E1E4E8;">[idx </span><span style="color:#F97583;">+</span><span style="color:#79B8FF;"> 4</span><span style="color:#E1E4E8;">]) </span><span style="color:#F97583;">+</span></span>
<span class="line"><span style="color:#E1E4E8;">                     (</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">2</span><span style="color:#F97583;"> *</span><span style="color:#FFAB70;"> input</span><span style="color:#E1E4E8;">[idx </span><span style="color:#F97583;">-</span><span style="color:#79B8FF;"> 4</span><span style="color:#F97583;"> +</span><span style="color:#E1E4E8;"> width</span><span style="color:#F97583;">*</span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;">] </span><span style="color:#F97583;">+</span><span style="color:#79B8FF;"> 0</span><span style="color:#F97583;"> +</span><span style="color:#79B8FF;"> 2</span><span style="color:#F97583;"> *</span><span style="color:#FFAB70;"> input</span><span style="color:#E1E4E8;">[idx </span><span style="color:#F97583;">+</span><span style="color:#79B8FF;"> 4</span><span style="color:#F97583;"> +</span><span style="color:#E1E4E8;"> width</span><span style="color:#F97583;">*</span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;">]) </span><span style="color:#F97583;">+</span></span>
<span class="line"><span style="color:#E1E4E8;">                     (</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">1</span><span style="color:#F97583;"> *</span><span style="color:#FFAB70;"> input</span><span style="color:#E1E4E8;">[idx </span><span style="color:#F97583;">-</span><span style="color:#79B8FF;"> 4</span><span style="color:#F97583;"> +</span><span style="color:#E1E4E8;"> width</span><span style="color:#F97583;">*</span><span style="color:#79B8FF;">8</span><span style="color:#E1E4E8;">] </span><span style="color:#F97583;">+</span><span style="color:#79B8FF;"> 0</span><span style="color:#F97583;"> +</span><span style="color:#79B8FF;"> 1</span><span style="color:#F97583;"> *</span><span style="color:#FFAB70;"> input</span><span style="color:#E1E4E8;">[idx </span><span style="color:#F97583;">+</span><span style="color:#79B8FF;"> 4</span><span style="color:#F97583;"> +</span><span style="color:#E1E4E8;"> width</span><span style="color:#F97583;">*</span><span style="color:#79B8FF;">8</span><span style="color:#E1E4E8;">]);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">            int</span><span style="color:#E1E4E8;"> gy </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">1</span><span style="color:#F97583;"> *</span><span style="color:#FFAB70;"> input</span><span style="color:#E1E4E8;">[idx </span><span style="color:#F97583;">-</span><span style="color:#79B8FF;"> 4</span><span style="color:#E1E4E8;">] </span><span style="color:#F97583;">-</span><span style="color:#79B8FF;"> 2</span><span style="color:#F97583;"> *</span><span style="color:#FFAB70;"> input</span><span style="color:#E1E4E8;">[idx </span><span style="color:#F97583;">-</span><span style="color:#79B8FF;"> 4</span><span style="color:#F97583;"> +</span><span style="color:#E1E4E8;"> width</span><span style="color:#F97583;">*</span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;">] </span><span style="color:#F97583;">-</span><span style="color:#79B8FF;"> 1</span><span style="color:#F97583;"> *</span><span style="color:#FFAB70;"> input</span><span style="color:#E1E4E8;">[idx </span><span style="color:#F97583;">-</span><span style="color:#79B8FF;"> 4</span><span style="color:#F97583;"> +</span><span style="color:#E1E4E8;"> width</span><span style="color:#F97583;">*</span><span style="color:#79B8FF;">8</span><span style="color:#E1E4E8;">]) </span><span style="color:#F97583;">+</span></span>
<span class="line"><span style="color:#E1E4E8;">                     (</span><span style="color:#79B8FF;">0</span><span style="color:#F97583;"> +</span><span style="color:#79B8FF;"> 0</span><span style="color:#F97583;"> +</span><span style="color:#79B8FF;"> 0</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">+</span></span>
<span class="line"><span style="color:#E1E4E8;">                     (</span><span style="color:#79B8FF;">1</span><span style="color:#F97583;"> *</span><span style="color:#FFAB70;"> input</span><span style="color:#E1E4E8;">[idx </span><span style="color:#F97583;">+</span><span style="color:#79B8FF;"> 4</span><span style="color:#E1E4E8;">] </span><span style="color:#F97583;">+</span><span style="color:#79B8FF;"> 2</span><span style="color:#F97583;"> *</span><span style="color:#FFAB70;"> input</span><span style="color:#E1E4E8;">[idx </span><span style="color:#F97583;">+</span><span style="color:#79B8FF;"> 4</span><span style="color:#F97583;"> +</span><span style="color:#E1E4E8;"> width</span><span style="color:#F97583;">*</span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;">] </span><span style="color:#F97583;">+</span><span style="color:#79B8FF;"> 1</span><span style="color:#F97583;"> *</span><span style="color:#FFAB70;"> input</span><span style="color:#E1E4E8;">[idx </span><span style="color:#F97583;">+</span><span style="color:#79B8FF;"> 4</span><span style="color:#F97583;"> +</span><span style="color:#E1E4E8;"> width</span><span style="color:#F97583;">*</span><span style="color:#79B8FF;">8</span><span style="color:#E1E4E8;">]);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">            int</span><span style="color:#E1E4E8;"> magnitude </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">int</span><span style="color:#E1E4E8;">)</span><span style="color:#B392F0;">sqrt</span><span style="color:#E1E4E8;">((</span><span style="color:#F97583;">double</span><span style="color:#E1E4E8;">)(gx </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> gx </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> gy </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> gy));</span></span>
<span class="line"><span style="color:#E1E4E8;">            magnitude </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> magnitude </span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> 255</span><span style="color:#F97583;"> ?</span><span style="color:#79B8FF;"> 255</span><span style="color:#F97583;"> :</span><span style="color:#E1E4E8;"> magnitude;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFAB70;">            output</span><span style="color:#E1E4E8;">[idx] </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> magnitude;</span><span style="color:#6A737D;">     // R</span></span>
<span class="line"><span style="color:#FFAB70;">            output</span><span style="color:#E1E4E8;">[idx </span><span style="color:#F97583;">+</span><span style="color:#79B8FF;"> 1</span><span style="color:#E1E4E8;">] </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> magnitude;</span><span style="color:#6A737D;"> // G</span></span>
<span class="line"><span style="color:#FFAB70;">            output</span><span style="color:#E1E4E8;">[idx </span><span style="color:#F97583;">+</span><span style="color:#79B8FF;"> 2</span><span style="color:#E1E4E8;">] </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> magnitude;</span><span style="color:#6A737D;"> // B</span></span>
<span class="line"><span style="color:#FFAB70;">            output</span><span style="color:#E1E4E8;">[idx </span><span style="color:#F97583;">+</span><span style="color:#79B8FF;"> 3</span><span style="color:#E1E4E8;">] </span><span style="color:#F97583;">=</span><span style="color:#79B8FF;"> 255</span><span style="color:#E1E4E8;">;</span><span style="color:#6A737D;">       // A</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre></div><h2 id="assemblyscript" tabindex="-1">AssemblyScript <a class="header-anchor" href="#assemblyscript" aria-label="Permalink to &quot;AssemblyScript&quot;">​</a></h2><h3 id="typescript-到-webassembly" tabindex="-1">TypeScript 到 WebAssembly <a class="header-anchor" href="#typescript-到-webassembly" aria-label="Permalink to &quot;TypeScript 到 WebAssembly&quot;">​</a></h3><p>AssemblyScript 允许 TypeScript 开发者直接编译到 WebAssembly，降低了 WASM 开发的学习曲线。</p><h4 id="开发示例" tabindex="-1">开发示例 <a class="header-anchor" href="#开发示例" aria-label="Permalink to &quot;开发示例&quot;">​</a></h4><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;">// image.ts</span></span>
<span class="line"><span style="color:#F97583;">export</span><span style="color:#F97583;"> function</span><span style="color:#B392F0;"> rotateImage</span><span style="color:#E1E4E8;">(</span></span>
<span class="line"><span style="color:#FFAB70;">  inputPtr</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> i32</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#FFAB70;">  outputPtr</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> i32</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#FFAB70;">  width</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> i32</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#FFAB70;">  height</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> i32</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#FFAB70;">  angle</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> f64</span></span>
<span class="line"><span style="color:#E1E4E8;">)</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;"> void</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#F97583;">  const</span><span style="color:#79B8FF;"> cosTheta</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> Math.</span><span style="color:#B392F0;">cos</span><span style="color:#E1E4E8;">(angle)</span></span>
<span class="line"><span style="color:#F97583;">  const</span><span style="color:#79B8FF;"> sinTheta</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> Math.</span><span style="color:#B392F0;">sin</span><span style="color:#E1E4E8;">(angle)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">  const</span><span style="color:#79B8FF;"> centerX</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> width </span><span style="color:#F97583;">/</span><span style="color:#79B8FF;"> 2.0</span></span>
<span class="line"><span style="color:#F97583;">  const</span><span style="color:#79B8FF;"> centerY</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> height </span><span style="color:#F97583;">/</span><span style="color:#79B8FF;"> 2.0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">  for</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> y </span><span style="color:#F97583;">=</span><span style="color:#79B8FF;"> 0</span><span style="color:#E1E4E8;">; y </span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;"> height; y</span><span style="color:#F97583;">++</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#F97583;">    for</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> x </span><span style="color:#F97583;">=</span><span style="color:#79B8FF;"> 0</span><span style="color:#E1E4E8;">; x </span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;"> width; x</span><span style="color:#F97583;">++</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#6A737D;">      // 计算旋转后的坐标</span></span>
<span class="line"><span style="color:#F97583;">      const</span><span style="color:#79B8FF;"> srcX</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> (x </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> centerX) </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> cosTheta </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> (y </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> centerY) </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> sinTheta </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> centerX</span></span>
<span class="line"><span style="color:#F97583;">      const</span><span style="color:#79B8FF;"> srcY</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> (x </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> centerX) </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> sinTheta </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> (y </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> centerY) </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> cosTheta </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> centerY</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">      if</span><span style="color:#E1E4E8;"> (srcX </span><span style="color:#F97583;">&gt;=</span><span style="color:#79B8FF;"> 0</span><span style="color:#F97583;"> &amp;&amp;</span><span style="color:#E1E4E8;"> srcX </span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;"> width </span><span style="color:#F97583;">&amp;&amp;</span><span style="color:#E1E4E8;"> srcY </span><span style="color:#F97583;">&gt;=</span><span style="color:#79B8FF;"> 0</span><span style="color:#F97583;"> &amp;&amp;</span><span style="color:#E1E4E8;"> srcY </span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;"> height) {</span></span>
<span class="line"><span style="color:#F97583;">        const</span><span style="color:#79B8FF;"> srcIdx</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> (Math.</span><span style="color:#B392F0;">floor</span><span style="color:#E1E4E8;">(srcY) </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> width </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> Math.</span><span style="color:#B392F0;">floor</span><span style="color:#E1E4E8;">(srcX)) </span><span style="color:#F97583;">*</span><span style="color:#79B8FF;"> 4</span></span>
<span class="line"><span style="color:#F97583;">        const</span><span style="color:#79B8FF;"> dstIdx</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> (y </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> width </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> x) </span><span style="color:#F97583;">*</span><span style="color:#79B8FF;"> 4</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">        // 复制像素数据</span></span>
<span class="line"><span style="color:#B392F0;">        store</span><span style="color:#E1E4E8;">&lt;</span><span style="color:#B392F0;">u8</span><span style="color:#E1E4E8;">&gt;(outputPtr </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> dstIdx, </span><span style="color:#B392F0;">load</span><span style="color:#E1E4E8;">&lt;</span><span style="color:#B392F0;">u8</span><span style="color:#E1E4E8;">&gt;(inputPtr </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> srcIdx))</span></span>
<span class="line"><span style="color:#B392F0;">        store</span><span style="color:#E1E4E8;">&lt;</span><span style="color:#B392F0;">u8</span><span style="color:#E1E4E8;">&gt;(outputPtr </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> dstIdx </span><span style="color:#F97583;">+</span><span style="color:#79B8FF;"> 1</span><span style="color:#E1E4E8;">, </span><span style="color:#B392F0;">load</span><span style="color:#E1E4E8;">&lt;</span><span style="color:#B392F0;">u8</span><span style="color:#E1E4E8;">&gt;(inputPtr </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> srcIdx </span><span style="color:#F97583;">+</span><span style="color:#79B8FF;"> 1</span><span style="color:#E1E4E8;">))</span></span>
<span class="line"><span style="color:#B392F0;">        store</span><span style="color:#E1E4E8;">&lt;</span><span style="color:#B392F0;">u8</span><span style="color:#E1E4E8;">&gt;(outputPtr </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> dstIdx </span><span style="color:#F97583;">+</span><span style="color:#79B8FF;"> 2</span><span style="color:#E1E4E8;">, </span><span style="color:#B392F0;">load</span><span style="color:#E1E4E8;">&lt;</span><span style="color:#B392F0;">u8</span><span style="color:#E1E4E8;">&gt;(inputPtr </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> srcIdx </span><span style="color:#F97583;">+</span><span style="color:#79B8FF;"> 2</span><span style="color:#E1E4E8;">))</span></span>
<span class="line"><span style="color:#B392F0;">        store</span><span style="color:#E1E4E8;">&lt;</span><span style="color:#B392F0;">u8</span><span style="color:#E1E4E8;">&gt;(outputPtr </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> dstIdx </span><span style="color:#F97583;">+</span><span style="color:#79B8FF;"> 3</span><span style="color:#E1E4E8;">, </span><span style="color:#B392F0;">load</span><span style="color:#E1E4E8;">&lt;</span><span style="color:#B392F0;">u8</span><span style="color:#E1E4E8;">&gt;(inputPtr </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> srcIdx </span><span style="color:#F97583;">+</span><span style="color:#79B8FF;"> 3</span><span style="color:#E1E4E8;">))</span></span>
<span class="line"><span style="color:#E1E4E8;">      }</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 矩阵运算示例</span></span>
<span class="line"><span style="color:#F97583;">export</span><span style="color:#F97583;"> function</span><span style="color:#B392F0;"> matrixMultiply</span><span style="color:#E1E4E8;">(</span></span>
<span class="line"><span style="color:#FFAB70;">  aPtr</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> i32</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#FFAB70;">  bPtr</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> i32</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#FFAB70;">  resultPtr</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> i32</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#FFAB70;">  rowsA</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> i32</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#FFAB70;">  colsA</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> i32</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#FFAB70;">  colsB</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> i32</span></span>
<span class="line"><span style="color:#E1E4E8;">)</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;"> void</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#F97583;">  for</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> i </span><span style="color:#F97583;">=</span><span style="color:#79B8FF;"> 0</span><span style="color:#E1E4E8;">; i </span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;"> rowsA; i</span><span style="color:#F97583;">++</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#F97583;">    for</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> j </span><span style="color:#F97583;">=</span><span style="color:#79B8FF;"> 0</span><span style="color:#E1E4E8;">; j </span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;"> colsB; j</span><span style="color:#F97583;">++</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#F97583;">      let</span><span style="color:#E1E4E8;"> sum </span><span style="color:#F97583;">=</span><span style="color:#79B8FF;"> 0.0</span></span>
<span class="line"><span style="color:#F97583;">      for</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> k </span><span style="color:#F97583;">=</span><span style="color:#79B8FF;"> 0</span><span style="color:#E1E4E8;">; k </span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;"> colsA; k</span><span style="color:#F97583;">++</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#F97583;">        const</span><span style="color:#79B8FF;"> aVal</span><span style="color:#F97583;"> =</span><span style="color:#B392F0;"> load</span><span style="color:#E1E4E8;">&lt;</span><span style="color:#B392F0;">f64</span><span style="color:#E1E4E8;">&gt;(aPtr </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> (i </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> colsA </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> k) </span><span style="color:#F97583;">*</span><span style="color:#79B8FF;"> 8</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#F97583;">        const</span><span style="color:#79B8FF;"> bVal</span><span style="color:#F97583;"> =</span><span style="color:#B392F0;"> load</span><span style="color:#E1E4E8;">&lt;</span><span style="color:#B392F0;">f64</span><span style="color:#E1E4E8;">&gt;(bPtr </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> (k </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> colsB </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> j) </span><span style="color:#F97583;">*</span><span style="color:#79B8FF;"> 8</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">        sum </span><span style="color:#F97583;">+=</span><span style="color:#E1E4E8;"> aVal </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> bVal</span></span>
<span class="line"><span style="color:#E1E4E8;">      }</span></span>
<span class="line"><span style="color:#B392F0;">      store</span><span style="color:#E1E4E8;">&lt;</span><span style="color:#B392F0;">f64</span><span style="color:#E1E4E8;">&gt;(resultPtr </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> (i </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> colsB </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> j) </span><span style="color:#F97583;">*</span><span style="color:#79B8FF;"> 8</span><span style="color:#E1E4E8;">, sum)</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre></div><h4 id="编译配置" tabindex="-1">编译配置 <a class="header-anchor" href="#编译配置" aria-label="Permalink to &quot;编译配置&quot;">​</a></h4><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;">// asconfig.json</span></span>
<span class="line"><span style="color:#E1E4E8;">{</span></span>
<span class="line"><span style="color:#79B8FF;">  &quot;targets&quot;</span><span style="color:#E1E4E8;">: {</span></span>
<span class="line"><span style="color:#79B8FF;">    &quot;release&quot;</span><span style="color:#E1E4E8;">: {</span></span>
<span class="line"><span style="color:#79B8FF;">      &quot;optimizeLevel&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">3</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#79B8FF;">      &quot;shrinkLevel&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#79B8FF;">      &quot;converge&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#79B8FF;">      &quot;noAssert&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">false</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">  },</span></span>
<span class="line"><span style="color:#79B8FF;">  &quot;options&quot;</span><span style="color:#E1E4E8;">: {</span></span>
<span class="line"><span style="color:#79B8FF;">    &quot;exportMemory&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#79B8FF;">    &quot;exportTable&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">true</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre></div><h2 id="语言特性对比与选择指南" tabindex="-1">语言特性对比与选择指南 <a class="header-anchor" href="#语言特性对比与选择指南" aria-label="Permalink to &quot;语言特性对比与选择指南&quot;">​</a></h2><h3 id="各语言在-wasm-生态中的表现" tabindex="-1">各语言在 WASM 生态中的表现 <a class="header-anchor" href="#各语言在-wasm-生态中的表现" aria-label="Permalink to &quot;各语言在 WASM 生态中的表现&quot;">​</a></h3><table tabindex="0"><thead><tr><th>语言</th><th>编译体积</th><th>运行时性能</th><th>内存管理</th><th>工具链成熟度</th><th>最佳适用场景</th></tr></thead><tbody><tr><td>Rust</td><td>中小</td><td>优秀</td><td>编译时检查</td><td>成熟</td><td>高性能计算、系统编程</td></tr><tr><td>Go</td><td>较大</td><td>良好</td><td>GC</td><td>中等</td><td>网络服务、并发处理</td></tr><tr><td>C/C++</td><td>小</td><td>优秀</td><td>手动管理</td><td>非常成熟</td><td>图像处理、游戏引擎</td></tr><tr><td>AssemblyScript</td><td>小</td><td>良好</td><td>线性内存</td><td>中等</td><td>Web 前端、TypeScript 迁移</td></tr></tbody></table><h3 id="选择考量因素" tabindex="-1">选择考量因素 <a class="header-anchor" href="#选择考量因素" aria-label="Permalink to &quot;选择考量因素&quot;">​</a></h3><p><strong>性能关键型应用：</strong></p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span>C/C++/Rust → 接近原生性能 → 游戏/音视频处理</span></span></code></pre></div><p><strong>开发效率优先：</strong></p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span>Go/AssemblyScript → 现代语言特性 → 快速原型/Web应用</span></span></code></pre></div><p><strong>现有代码迁移：</strong></p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span>保持原语言 → 最小化重写成本 → 企业级应用迁移</span></span></code></pre></div><h2 id="跨语言互操作模式" tabindex="-1">跨语言互操作模式 <a class="header-anchor" href="#跨语言互操作模式" aria-label="Permalink to &quot;跨语言互操作模式&quot;">​</a></h2><h3 id="通用接口设计" tabindex="-1">通用接口设计 <a class="header-anchor" href="#通用接口设计" aria-label="Permalink to &quot;通用接口设计&quot;">​</a></h3><p>通过 WASM 接口类型 (Interface Types) 实现跨语言通信：</p><div class="language-wat"><button title="Copy Code" class="copy"></button><span class="lang">wat</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span>;; 跨语言接口定义</span></span>
<span class="line"><span>(module</span></span>
<span class="line"><span>  (type $Image (record</span></span>
<span class="line"><span>    (field $data (list u8))</span></span>
<span class="line"><span>    (field $width i32)</span></span>
<span class="line"><span>    (field $height i32)</span></span>
<span class="line"><span>  ))</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  (import &quot;env&quot; &quot;process_image&quot; (func $process_image</span></span>
<span class="line"><span>    (param $image (ref $Image))</span></span>
<span class="line"><span>    (result (ref $Image))</span></span>
<span class="line"><span>  ))</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  (export &quot;image_processor&quot; (func $process_image))</span></span>
<span class="line"><span>)</span></span></code></pre></div><h3 id="内存共享模式" tabindex="-1">内存共享模式 <a class="header-anchor" href="#内存共享模式" aria-label="Permalink to &quot;内存共享模式&quot;">​</a></h3><p><strong>跨语言数据交换示意图：</strong></p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span>语言A 分配内存 → WASM 线性内存 → 语言B 读取处理</span></span>
<span class="line"><span>    ↓</span></span>
<span class="line"><span>统一数据格式 (ArrayBuffer/TypedArray)</span></span>
<span class="line"><span>    ↓</span></span>
<span class="line"><span>零拷贝或最小化拷贝传递</span></span></code></pre></div><h2 id="工具链与运行时集成" tabindex="-1">工具链与运行时集成 <a class="header-anchor" href="#工具链与运行时集成" aria-label="Permalink to &quot;工具链与运行时集成&quot;">​</a></h2><h3 id="多语言开发工作流" tabindex="-1">多语言开发工作流 <a class="header-anchor" href="#多语言开发工作流" aria-label="Permalink to &quot;多语言开发工作流&quot;">​</a></h3><p><strong>现代 WASM 开发流程：</strong></p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span>[源代码] → [语言特定编译] → [.wasm 模块]</span></span>
<span class="line"><span>    ↓</span></span>
<span class="line"><span>[WASI 接口绑定] → [运行时执行] → [跨平台部署]</span></span></code></pre></div><h3 id="wasmedge-多语言运行时" tabindex="-1">WasmEdge 多语言运行时 <a class="header-anchor" href="#wasmedge-多语言运行时" aria-label="Permalink to &quot;WasmEdge 多语言运行时&quot;">​</a></h3><p>WasmEdge 支持多种语言的 WASM 模块执行，提供统一的运行时环境：</p><div class="language-rust"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;">// 在 WasmEdge 中运行多语言 WASM 模块</span></span>
<span class="line"><span style="color:#F97583;">use</span><span style="color:#B392F0;"> wasmedge_sdk</span><span style="color:#F97583;">::</span><span style="color:#E1E4E8;">{</span></span>
<span class="line"><span style="color:#B392F0;">    config</span><span style="color:#F97583;">::</span><span style="color:#E1E4E8;">{</span><span style="color:#B392F0;">CommonConfigOptions</span><span style="color:#E1E4E8;">, </span><span style="color:#B392F0;">ConfigBuilder</span><span style="color:#E1E4E8;">},</span></span>
<span class="line"><span style="color:#E1E4E8;">    params,</span></span>
<span class="line"><span style="color:#B392F0;">    Executor</span><span style="color:#E1E4E8;">, </span><span style="color:#B392F0;">ImportObjectBuilder</span><span style="color:#E1E4E8;">, </span><span style="color:#B392F0;">Store</span><span style="color:#E1E4E8;">, </span><span style="color:#B392F0;">WasmVal</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">async</span><span style="color:#F97583;"> fn</span><span style="color:#B392F0;"> run_multilingual_wasm</span><span style="color:#E1E4E8;">() </span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;"> Result</span><span style="color:#E1E4E8;">&lt;(), </span><span style="color:#B392F0;">Box</span><span style="color:#E1E4E8;">&lt;</span><span style="color:#F97583;">dyn</span><span style="color:#E1E4E8;"> std</span><span style="color:#F97583;">::</span><span style="color:#E1E4E8;">error</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">Error</span><span style="color:#E1E4E8;">&gt;&gt; {</span></span>
<span class="line"><span style="color:#6A737D;">    // 配置运行时</span></span>
<span class="line"><span style="color:#F97583;">    let</span><span style="color:#E1E4E8;"> config </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> ConfigBuilder</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">new</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">CommonConfigOptions</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">new</span><span style="color:#E1E4E8;">()</span><span style="color:#F97583;">.</span><span style="color:#B392F0;">bulk_memory_operations</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">))</span></span>
<span class="line"><span style="color:#F97583;">        .</span><span style="color:#B392F0;">build</span><span style="color:#E1E4E8;">()</span><span style="color:#F97583;">?</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">    let</span><span style="color:#F97583;"> mut</span><span style="color:#E1E4E8;"> executor </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> Executor</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">new</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">Some</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">&amp;</span><span style="color:#E1E4E8;">config), </span><span style="color:#B392F0;">None</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#F97583;">    let</span><span style="color:#F97583;"> mut</span><span style="color:#E1E4E8;"> store </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> Store</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">new</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">    // 加载不同语言编译的 WASM 模块</span></span>
<span class="line"><span style="color:#F97583;">    let</span><span style="color:#E1E4E8;"> languages </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> [</span><span style="color:#9ECBFF;">&quot;rust&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;go&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;cpp&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;assemblyscript&quot;</span><span style="color:#E1E4E8;">];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">    for</span><span style="color:#E1E4E8;"> lang </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> languages {</span></span>
<span class="line"><span style="color:#F97583;">        let</span><span style="color:#E1E4E8;"> wasm_file </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> format!</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;./target/{}.wasm&quot;</span><span style="color:#E1E4E8;">, lang);</span></span>
<span class="line"><span style="color:#F97583;">        if</span><span style="color:#B392F0;"> std</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">path</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">Path</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">new</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">&amp;</span><span style="color:#E1E4E8;">wasm_file)</span><span style="color:#F97583;">.</span><span style="color:#B392F0;">exists</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#F97583;">            let</span><span style="color:#E1E4E8;"> module </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> wasmedge_sdk</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">Module</span><span style="color:#F97583;">::</span><span style="color:#B392F0;">from_file</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">Some</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">&amp;</span><span style="color:#E1E4E8;">config), </span><span style="color:#F97583;">&amp;</span><span style="color:#E1E4E8;">wasm_file)</span><span style="color:#F97583;">?</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">            let</span><span style="color:#E1E4E8;"> instance </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> store</span><span style="color:#F97583;">.</span><span style="color:#B392F0;">register_named_module</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">&amp;mut</span><span style="color:#E1E4E8;"> executor, </span><span style="color:#F97583;">&amp;</span><span style="color:#E1E4E8;">lang, </span><span style="color:#F97583;">&amp;</span><span style="color:#E1E4E8;">module)</span><span style="color:#F97583;">?</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">            println!</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;成功加载 {} WASM 模块&quot;</span><span style="color:#E1E4E8;">, lang);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">            // 调用通用接口函数</span></span>
<span class="line"><span style="color:#F97583;">            if</span><span style="color:#F97583;"> let</span><span style="color:#B392F0;"> Ok</span><span style="color:#E1E4E8;">(func) </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> instance</span><span style="color:#F97583;">.</span><span style="color:#B392F0;">func</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;process&quot;</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#F97583;">                let</span><span style="color:#E1E4E8;"> _ </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> func</span><span style="color:#F97583;">.</span><span style="color:#B392F0;">call</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">&amp;mut</span><span style="color:#E1E4E8;"> executor, </span><span style="color:#B392F0;">params!</span><span style="color:#E1E4E8;">())</span><span style="color:#F97583;">?</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">    Ok</span><span style="color:#E1E4E8;">(())</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre></div><h2 id="性能优化策略" tabindex="-1">性能优化策略 <a class="header-anchor" href="#性能优化策略" aria-label="Permalink to &quot;性能优化策略&quot;">​</a></h2><h3 id="语言特定优化技巧" tabindex="-1">语言特定优化技巧 <a class="header-anchor" href="#语言特定优化技巧" aria-label="Permalink to &quot;语言特定优化技巧&quot;">​</a></h3><p><strong>Rust 优化：</strong></p><div class="language-toml"><button title="Copy Code" class="copy"></button><span class="lang">toml</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># Cargo.toml</span></span>
<span class="line"><span style="color:#E1E4E8;">[</span><span style="color:#B392F0;">package</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">metadata</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">wasm-pack</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">profile</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">release</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">wasm-opt = [</span><span style="color:#9ECBFF;">&quot;-Os&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;--enable-mutable-globals&quot;</span><span style="color:#E1E4E8;">]</span></span></code></pre></div><p><strong>Go 优化：</strong></p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># 减小二进制体积</span></span>
<span class="line"><span style="color:#E1E4E8;">GOOS</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">wasip1</span><span style="color:#E1E4E8;"> GOARCH</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">wasm</span><span style="color:#B392F0;"> go</span><span style="color:#9ECBFF;"> build</span><span style="color:#79B8FF;"> -ldflags=</span><span style="color:#9ECBFF;">&quot;-s -w&quot;</span><span style="color:#79B8FF;"> -o</span><span style="color:#9ECBFF;"> minimal.wasm</span></span></code></pre></div><p><strong>C/C++ 优化：</strong></p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># 高级优化</span></span>
<span class="line"><span style="color:#B392F0;">emcc</span><span style="color:#79B8FF;"> -O3</span><span style="color:#79B8FF;"> -s</span><span style="color:#9ECBFF;"> WASM=</span><span style="color:#79B8FF;">1</span><span style="color:#79B8FF;"> -s</span><span style="color:#9ECBFF;"> ALLOW_MEMORY_GROWTH=</span><span style="color:#79B8FF;">1</span><span style="color:#79B8FF;"> -s</span><span style="color:#9ECBFF;"> MAXIMUM_MEMORY=4GB</span><span style="color:#79B8FF;"> -o</span><span style="color:#9ECBFF;"> optimized.html</span><span style="color:#9ECBFF;"> source.c</span></span></code></pre></div><h3 id="内存使用最佳实践" tabindex="-1">内存使用最佳实践 <a class="header-anchor" href="#内存使用最佳实践" aria-label="Permalink to &quot;内存使用最佳实践&quot;">​</a></h3><div class="language-rust"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;">// 跨语言内存管理模式</span></span>
<span class="line"><span style="color:#E1E4E8;">#[wasm_bindgen]</span></span>
<span class="line"><span style="color:#F97583;">pub</span><span style="color:#F97583;"> struct</span><span style="color:#B392F0;"> CrossLanguageBuffer</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    data</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> Vec</span><span style="color:#E1E4E8;">&lt;</span><span style="color:#B392F0;">u8</span><span style="color:#E1E4E8;">&gt;,</span></span>
<span class="line"><span style="color:#E1E4E8;">    language</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> String</span><span style="color:#E1E4E8;">, </span><span style="color:#6A737D;">// 标识源语言</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">#[wasm_bindgen]</span></span>
<span class="line"><span style="color:#F97583;">impl</span><span style="color:#B392F0;"> CrossLanguageBuffer</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    #[wasm_bindgen(constructor)]</span></span>
<span class="line"><span style="color:#F97583;">    pub</span><span style="color:#F97583;"> fn</span><span style="color:#B392F0;"> new</span><span style="color:#E1E4E8;">(size</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> usize</span><span style="color:#E1E4E8;">, lang</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> String</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">-&gt;</span><span style="color:#79B8FF;"> Self</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#79B8FF;">        Self</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">            data</span><span style="color:#F97583;">:</span><span style="color:#B392F0;"> vec!</span><span style="color:#E1E4E8;">[</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">; size],</span></span>
<span class="line"><span style="color:#E1E4E8;">            language</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> lang,</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">    // 为不同语言提供优化的处理接口</span></span>
<span class="line"><span style="color:#E1E4E8;">    #[wasm_bindgen]</span></span>
<span class="line"><span style="color:#F97583;">    pub</span><span style="color:#F97583;"> fn</span><span style="color:#B392F0;"> process_for_language</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">&amp;mut</span><span style="color:#79B8FF;"> self</span><span style="color:#E1E4E8;">, operation</span><span style="color:#F97583;">:</span><span style="color:#F97583;"> &amp;</span><span style="color:#B392F0;">str</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;"> Result</span><span style="color:#E1E4E8;">&lt;(), </span><span style="color:#B392F0;">JsValue</span><span style="color:#E1E4E8;">&gt; {</span></span>
<span class="line"><span style="color:#F97583;">        match</span><span style="color:#79B8FF;"> self</span><span style="color:#F97583;">.</span><span style="color:#E1E4E8;">language</span><span style="color:#F97583;">.</span><span style="color:#B392F0;">as_str</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#9ECBFF;">            &quot;rust&quot;</span><span style="color:#F97583;"> =&gt;</span><span style="color:#79B8FF;"> self</span><span style="color:#F97583;">.</span><span style="color:#B392F0;">rust_optimized_process</span><span style="color:#E1E4E8;">(operation),</span></span>
<span class="line"><span style="color:#9ECBFF;">            &quot;go&quot;</span><span style="color:#F97583;"> =&gt;</span><span style="color:#79B8FF;"> self</span><span style="color:#F97583;">.</span><span style="color:#B392F0;">go_compatible_process</span><span style="color:#E1E4E8;">(operation),</span></span>
<span class="line"><span style="color:#9ECBFF;">            &quot;cpp&quot;</span><span style="color:#F97583;"> =&gt;</span><span style="color:#79B8FF;"> self</span><span style="color:#F97583;">.</span><span style="color:#B392F0;">cpp_style_process</span><span style="color:#E1E4E8;">(operation),</span></span>
<span class="line"><span style="color:#E1E4E8;">            _ </span><span style="color:#F97583;">=&gt;</span><span style="color:#79B8FF;"> self</span><span style="color:#F97583;">.</span><span style="color:#B392F0;">generic_process</span><span style="color:#E1E4E8;">(operation)</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre></div><p>通过这种多语言支持的能力，WebAssembly 真正成为了连接不同编程语言生态的桥梁，让开发者能够根据具体需求选择最适合的工具，同时享受 WASM 带来的跨平台和性能优势。</p>`,78)])])}const d=a(o,[["render",e]]);export{i as __pageData,d as default};

import{_ as n,c as a,o as l,b as p}from"./chunks/framework.CMLuPXeo.js";const d=JSON.parse('{"title":"Kubernetes","description":"","frontmatter":{},"headers":[{"level":2,"title":"概述","slug":"概述","link":"#概述","children":[]},{"level":2,"title":"核心架构","slug":"核心架构","link":"#核心架构","children":[{"level":3,"title":"架构组成","slug":"架构组成","link":"#架构组成","children":[]},{"level":3,"title":"组件详解","slug":"组件详解","link":"#组件详解","children":[]}]},{"level":2,"title":"核心概念","slug":"核心概念","link":"#核心概念","children":[{"level":3,"title":"Pod","slug":"pod","link":"#pod","children":[]},{"level":3,"title":"Controller","slug":"controller","link":"#controller","children":[]},{"level":3,"title":"Service","slug":"service","link":"#service","children":[]}]},{"level":2,"title":"关键特性","slug":"关键特性","link":"#关键特性","children":[{"level":3,"title":"自动修复","slug":"自动修复","link":"#自动修复","children":[]},{"level":3,"title":"服务发现与负载均衡","slug":"服务发现与负载均衡","link":"#服务发现与负载均衡","children":[]},{"level":3,"title":"存储编排","slug":"存储编排","link":"#存储编排","children":[]},{"level":3,"title":"自动部署和回滚","slug":"自动部署和回滚","link":"#自动部署和回滚","children":[]},{"level":3,"title":"密钥与配置管理","slug":"密钥与配置管理","link":"#密钥与配置管理","children":[]}]},{"level":2,"title":"常用 API 示例","slug":"常用-api-示例","link":"#常用-api-示例","children":[{"level":3,"title":"Pod 配置","slug":"pod-配置","link":"#pod-配置","children":[]},{"level":3,"title":"Deployment 配置","slug":"deployment-配置","link":"#deployment-配置","children":[]},{"level":3,"title":"Service 配置","slug":"service-配置","link":"#service-配置","children":[]},{"level":3,"title":"ConfigMap 和 Secret","slug":"configmap-和-secret","link":"#configmap-和-secret","children":[]}]},{"level":2,"title":"实践示例","slug":"实践示例","link":"#实践示例","children":[{"level":3,"title":"应用部署流程","slug":"应用部署流程","link":"#应用部署流程","children":[]},{"level":3,"title":"水平扩缩容","slug":"水平扩缩容","link":"#水平扩缩容","children":[]},{"level":3,"title":"滚动更新","slug":"滚动更新","link":"#滚动更新","children":[]}]},{"level":2,"title":"网络与存储","slug":"网络与存储","link":"#网络与存储","children":[{"level":3,"title":"网络模型","slug":"网络模型","link":"#网络模型","children":[]},{"level":3,"title":"存储卷","slug":"存储卷","link":"#存储卷","children":[]}]},{"level":2,"title":"运维与监控","slug":"运维与监控","link":"#运维与监控","children":[{"level":3,"title":"资源监控","slug":"资源监控","link":"#资源监控","children":[]},{"level":3,"title":"调试命令","slug":"调试命令","link":"#调试命令","children":[]}]}],"relativePath":"full-stack/operation/kubernetes.md","filePath":"full-stack/operation/kubernetes.md"}'),e={name:"full-stack/operation/kubernetes.md"};function o(t,s,c,r,i,E){return l(),a("div",null,[...s[0]||(s[0]=[p(`<div style="display:none;" hidden="true" aria-hidden="true">Are you an LLM? You can read better optimized documentation at /full-stack/operation/kubernetes.md for this page in Markdown format</div><h1 id="kubernetes" tabindex="-1">Kubernetes <a class="header-anchor" href="#kubernetes" aria-label="Permalink to &quot;Kubernetes&quot;">​</a></h1><h2 id="概述" tabindex="-1">概述 <a class="header-anchor" href="#概述" aria-label="Permalink to &quot;概述&quot;">​</a></h2><p>Kubernetes (常简称为 <strong>K8s</strong>) 是一个可移植、可扩展的<strong>开源容器编排平台</strong>，用于管理容器化的工作负载和服务，并促进声明式配置和自动化。它拥有一个庞大且快速增长的生态系统，其服务、支持和工具的使用范围广泛。</p><p>Kubernetes 这个名字源于希腊语，意为“舵手”或“飞行员”。K8s 这个缩写是因为 K 和 s 之间有 8 个字符。Google 在 2014 年开源了 Kubernetes 项目，它建立在 Google 大规模运行生产工作负载十几年经验的基础上，结合了社区中最优秀的想法和实践。</p><h2 id="核心架构" tabindex="-1">核心架构 <a class="header-anchor" href="#核心架构" aria-label="Permalink to &quot;核心架构&quot;">​</a></h2><h3 id="架构组成" tabindex="-1">架构组成 <a class="header-anchor" href="#架构组成" aria-label="Permalink to &quot;架构组成&quot;">​</a></h3><p>Kubernetes 遵循<strong>客户端-服务器架构</strong>，主要由<strong>控制平面 (Control Plane)</strong> 和<strong>工作节点 (Worker Nodes)</strong> 组成。</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span>控制平面 (Master)</span></span>
<span class="line"><span>├── kube-apiserver: API 入口</span></span>
<span class="line"><span>├── etcd: 键值存储</span></span>
<span class="line"><span>├── kube-scheduler: 调度决策</span></span>
<span class="line"><span>└── kube-controller-manager: 控制循环</span></span>
<span class="line"><span></span></span>
<span class="line"><span>工作节点 (Nodes)</span></span>
<span class="line"><span>├── kubelet: 节点代理</span></span>
<span class="line"><span>├── kube-proxy: 网络代理</span></span>
<span class="line"><span>└── 容器运行时: Docker, containerd 等</span></span></code></pre></div><h3 id="组件详解" tabindex="-1">组件详解 <a class="header-anchor" href="#组件详解" aria-label="Permalink to &quot;组件详解&quot;">​</a></h3><p><strong>控制平面组件</strong>：</p><ul><li><strong>kube-apiserver</strong>：公开基础 Kubernetes API，是控制平面的前端</li><li><strong>etcd</strong>：一致且高可用的键值存储，用作 Kubernetes 所有集群数据的后备存储</li><li><strong>kube-scheduler</strong>：监视新创建的 Pod 并选择要运行它们的节点</li><li><strong>kube-controller-manager</strong>：运行控制器进程，处理集群的常规任务</li></ul><p><strong>节点组件</strong>：</p><ul><li><strong>kubelet</strong>：在集群中的每个节点上运行的代理，确保容器在 Pod 中运行</li><li><strong>kube-proxy</strong>：在节点上维护网络规则，实现 Kubernetes 服务概念</li><li><strong>容器运行时</strong>：负责运行容器的软件，如 Docker、containerd</li></ul><h2 id="核心概念" tabindex="-1">核心概念 <a class="header-anchor" href="#核心概念" aria-label="Permalink to &quot;核心概念&quot;">​</a></h2><h3 id="pod" tabindex="-1">Pod <a class="header-anchor" href="#pod" aria-label="Permalink to &quot;Pod&quot;">​</a></h3><p><strong>Pod</strong> 是 Kubernetes 中最小的可部署计算单元，代表集群中运行的一个进程。</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span>Pod 结构：</span></span>
<span class="line"><span>+-------------------+</span></span>
<span class="line"><span>|       Pod         |</span></span>
<span class="line"><span>|  +-------------+  |</span></span>
<span class="line"><span>|  |  Container  |  |</span></span>
<span class="line"><span>|  +-------------+  |</span></span>
<span class="line"><span>|  |  Container  |  |</span></span>
<span class="line"><span>|  +-------------+  |</span></span>
<span class="line"><span>| 共享网络和存储命名空间 |</span></span>
<span class="line"><span>+-------------------+</span></span></code></pre></div><p>Pod 特点：</p><ul><li>可以包含一个或多个紧密相关的容器</li><li>共享网络命名空间 (同一 IP) 和存储卷</li><li>是临时性的、可丢弃的实体</li></ul><h3 id="controller" tabindex="-1">Controller <a class="header-anchor" href="#controller" aria-label="Permalink to &quot;Controller&quot;">​</a></h3><p><strong>控制器</strong>通过跟踪 Kubernetes 资源状态的更改，帮助将资源置于其所需状态。常见的工作负载控制器类型包括：</p><ul><li><strong>Deployment</strong>：管理无状态应用，支持滚动更新和回滚</li><li><strong>ReplicaSet</strong>：确保指定数量的 Pod 副本一直在运行</li><li><strong>StatefulSet</strong>：管理有状态应用，提供有序部署和缩放</li><li><strong>DaemonSet</strong>：确保所有 (或某些) 节点上运行一个 Pod 的副本</li><li><strong>Job</strong> 和 <strong>CronJob</strong>：运行一次性或定时任务</li></ul><h3 id="service" tabindex="-1">Service <a class="header-anchor" href="#service" aria-label="Permalink to &quot;Service&quot;">​</a></h3><p><strong>Service</strong> 是一组抽象的或有逻辑的 Pod 集合，以及用于访问它们的策略。服务提供稳定的 IP 地址和 DNS 名称，实现负载均衡。</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span>服务流量路由：</span></span>
<span class="line"><span>+----------+    +----------+    +-------+</span></span>
<span class="line"><span>| 客户端    | -&gt; | Service  | -&gt; | Pod 1 |</span></span>
<span class="line"><span>+----------+    +----------+    +-------+</span></span>
<span class="line"><span>                         | -&gt; | Pod 2 |</span></span>
<span class="line"><span>                         +-------+</span></span>
<span class="line"><span>                         | -&gt; | Pod 3 |</span></span>
<span class="line"><span>                         +-------+</span></span></code></pre></div><h2 id="关键特性" tabindex="-1">关键特性 <a class="header-anchor" href="#关键特性" aria-label="Permalink to &quot;关键特性&quot;">​</a></h2><h3 id="自动修复" tabindex="-1">自动修复 <a class="header-anchor" href="#自动修复" aria-label="Permalink to &quot;自动修复&quot;">​</a></h3><p>Kubernetes 通过以下机制实现<strong>自我修复</strong>：</p><ul><li>自动重启失败的容器</li><li>替换无响应的容器 (根据健康检查)</li><li>杀死不通过用户定义的健康检查的容器</li><li>在容器就绪前不向客户端通告</li></ul><h3 id="服务发现与负载均衡" tabindex="-1">服务发现与负载均衡 <a class="header-anchor" href="#服务发现与负载均衡" aria-label="Permalink to &quot;服务发现与负载均衡&quot;">​</a></h3><p>Kubernetes 可以使用 DNS 名称或自己的 IP 地址来暴露容器。如果进入容器的流量很大，Kubernetes 可以负载均衡并分配网络流量，从而使部署稳定。</p><h3 id="存储编排" tabindex="-1">存储编排 <a class="header-anchor" href="#存储编排" aria-label="Permalink to &quot;存储编排&quot;">​</a></h3><p>Kubernetes 允许你自动挂载你选择的存储系统，例如本地存储、公共云提供商等。支持多种存储类型：</p><ul><li><strong>临时卷</strong>：为只读输入数据提供临时存储，容器重启后不再可用</li><li><strong>持久卷</strong>：将存储卷作为 Kubernetes 资源提供，容器重启后数据和卷仍然可用</li></ul><h3 id="自动部署和回滚" tabindex="-1">自动部署和回滚 <a class="header-anchor" href="#自动部署和回滚" aria-label="Permalink to &quot;自动部署和回滚&quot;">​</a></h3><p>你可以使用 Kubernetes 描述已部署容器的所需状态，它可以以受控的速率将实际状态更改为期望状态。例如，你可以自动化 Kubernetes 来为你的部署创建新容器，删除现有容器并将它们的所有资源用于新容器。</p><h3 id="密钥与配置管理" tabindex="-1">密钥与配置管理 <a class="header-anchor" href="#密钥与配置管理" aria-label="Permalink to &quot;密钥与配置管理&quot;">​</a></h3><p>Kubernetes 允许你存储和管理敏感信息，例如密码、OAuth 令牌和 SSH 密钥。你可以在不重建容器镜像的情况下部署和更新密钥和应用程序配置，也无需在堆栈配置中暴露密钥。</p><h2 id="常用-api-示例" tabindex="-1">常用 API 示例 <a class="header-anchor" href="#常用-api-示例" aria-label="Permalink to &quot;常用 API 示例&quot;">​</a></h2><h3 id="pod-配置" tabindex="-1">Pod 配置 <a class="header-anchor" href="#pod-配置" aria-label="Permalink to &quot;Pod 配置&quot;">​</a></h3><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Pod</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nginx-pod</span></span>
<span class="line"><span style="color:#85E89D;">  labels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">    app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nginx</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  containers</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nginx-container</span></span>
<span class="line"><span style="color:#85E89D;">    image</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nginx:1.19</span></span>
<span class="line"><span style="color:#85E89D;">    ports</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#85E89D;">containerPort</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">80</span></span>
<span class="line"><span style="color:#85E89D;">    env</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">ENV_VAR</span></span>
<span class="line"><span style="color:#85E89D;">      value</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;production&quot;</span></span>
<span class="line"><span style="color:#85E89D;">    resources</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">      requests</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">        memory</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;64Mi&quot;</span></span>
<span class="line"><span style="color:#85E89D;">        cpu</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;250m&quot;</span></span>
<span class="line"><span style="color:#85E89D;">      limits</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">        memory</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;128Mi&quot;</span></span>
<span class="line"><span style="color:#85E89D;">        cpu</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;500m&quot;</span></span></code></pre></div><h3 id="deployment-配置" tabindex="-1">Deployment 配置 <a class="header-anchor" href="#deployment-配置" aria-label="Permalink to &quot;Deployment 配置&quot;">​</a></h3><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">apps/v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Deployment</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nginx-deployment</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  replicas</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">3</span></span>
<span class="line"><span style="color:#85E89D;">  selector</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">    matchLabels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">      app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nginx</span></span>
<span class="line"><span style="color:#85E89D;">  template</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">    metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">      labels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">        app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nginx</span></span>
<span class="line"><span style="color:#85E89D;">    spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">      containers</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nginx</span></span>
<span class="line"><span style="color:#85E89D;">        image</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nginx:1.19</span></span>
<span class="line"><span style="color:#85E89D;">        ports</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#85E89D;">containerPort</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">80</span></span>
<span class="line"><span style="color:#85E89D;">        livenessProbe</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">          httpGet</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">            path</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">/</span></span>
<span class="line"><span style="color:#85E89D;">            port</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">80</span></span>
<span class="line"><span style="color:#85E89D;">          initialDelaySeconds</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">5</span></span>
<span class="line"><span style="color:#85E89D;">          periodSeconds</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">10</span></span>
<span class="line"><span style="color:#85E89D;">        readinessProbe</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">          httpGet</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">            path</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">/</span></span>
<span class="line"><span style="color:#85E89D;">            port</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">80</span></span>
<span class="line"><span style="color:#85E89D;">          initialDelaySeconds</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">5</span></span>
<span class="line"><span style="color:#85E89D;">          periodSeconds</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">10</span></span></code></pre></div><h3 id="service-配置" tabindex="-1">Service 配置 <a class="header-anchor" href="#service-配置" aria-label="Permalink to &quot;Service 配置&quot;">​</a></h3><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Service</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nginx-service</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  selector</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">    app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nginx</span></span>
<span class="line"><span style="color:#85E89D;">  ports</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#85E89D;">protocol</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">TCP</span></span>
<span class="line"><span style="color:#85E89D;">      port</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">80</span></span>
<span class="line"><span style="color:#85E89D;">      targetPort</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">80</span></span>
<span class="line"><span style="color:#85E89D;">  type</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">LoadBalancer</span></span></code></pre></div><h3 id="configmap-和-secret" tabindex="-1">ConfigMap 和 Secret <a class="header-anchor" href="#configmap-和-secret" aria-label="Permalink to &quot;ConfigMap 和 Secret&quot;">​</a></h3><p><strong>ConfigMap 示例</strong>：</p><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">ConfigMap</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">app-config</span></span>
<span class="line"><span style="color:#85E89D;">data</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  config.properties</span><span style="color:#E1E4E8;">: </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#9ECBFF;">    server.port=8080</span></span>
<span class="line"><span style="color:#9ECBFF;">    logging.level=INFO</span></span></code></pre></div><p><strong>Secret 示例</strong>：</p><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Secret</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">db-secret</span></span>
<span class="line"><span style="color:#85E89D;">type</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Opaque</span></span>
<span class="line"><span style="color:#85E89D;">data</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  username</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">YWRtaW4=</span></span>
<span class="line"><span style="color:#85E89D;">  password</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">cGFzc3dvcmQ=</span></span></code></pre></div><h2 id="实践示例" tabindex="-1">实践示例 <a class="header-anchor" href="#实践示例" aria-label="Permalink to &quot;实践示例&quot;">​</a></h2><h3 id="应用部署流程" tabindex="-1">应用部署流程 <a class="header-anchor" href="#应用部署流程" aria-label="Permalink to &quot;应用部署流程&quot;">​</a></h3><ol><li><strong>创建命名空间</strong></li></ol><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Namespace</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">my-app</span></span></code></pre></div><ol start="2"><li><strong>部署应用</strong></li></ol><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> apply</span><span style="color:#79B8FF;"> -f</span><span style="color:#9ECBFF;"> deployment.yaml</span><span style="color:#79B8FF;"> -n</span><span style="color:#9ECBFF;"> my-app</span></span></code></pre></div><ol start="3"><li><strong>暴露服务</strong></li></ol><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> expose</span><span style="color:#9ECBFF;"> deployment</span><span style="color:#9ECBFF;"> nginx-deployment</span><span style="color:#79B8FF;"> --port=80</span><span style="color:#79B8FF;"> --type=LoadBalancer</span><span style="color:#79B8FF;"> -n</span><span style="color:#9ECBFF;"> my-app</span></span></code></pre></div><ol start="4"><li><strong>检查状态</strong></li></ol><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> get</span><span style="color:#9ECBFF;"> pods</span><span style="color:#79B8FF;"> -n</span><span style="color:#9ECBFF;"> my-app</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> describe</span><span style="color:#9ECBFF;"> deployment</span><span style="color:#9ECBFF;"> nginx-deployment</span><span style="color:#79B8FF;"> -n</span><span style="color:#9ECBFF;"> my-app</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> get</span><span style="color:#9ECBFF;"> services</span><span style="color:#79B8FF;"> -n</span><span style="color:#9ECBFF;"> my-app</span></span></code></pre></div><h3 id="水平扩缩容" tabindex="-1">水平扩缩容 <a class="header-anchor" href="#水平扩缩容" aria-label="Permalink to &quot;水平扩缩容&quot;">​</a></h3><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># 手动扩缩</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> scale</span><span style="color:#9ECBFF;"> deployment</span><span style="color:#9ECBFF;"> nginx-deployment</span><span style="color:#79B8FF;"> --replicas=5</span><span style="color:#79B8FF;"> -n</span><span style="color:#9ECBFF;"> my-app</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 自动扩缩（需要 metrics-server）</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> autoscale</span><span style="color:#9ECBFF;"> deployment</span><span style="color:#9ECBFF;"> nginx-deployment</span><span style="color:#79B8FF;"> --cpu-percent=50</span><span style="color:#79B8FF;"> --min=1</span><span style="color:#79B8FF;"> --max=10</span><span style="color:#79B8FF;"> -n</span><span style="color:#9ECBFF;"> my-app</span></span></code></pre></div><h3 id="滚动更新" tabindex="-1">滚动更新 <a class="header-anchor" href="#滚动更新" aria-label="Permalink to &quot;滚动更新&quot;">​</a></h3><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># 更新镜像版本</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> set</span><span style="color:#9ECBFF;"> image</span><span style="color:#9ECBFF;"> deployment</span><span style="color:#9ECBFF;"> nginx-deployment</span><span style="color:#9ECBFF;"> nginx=nginx:1.20</span><span style="color:#79B8FF;"> -n</span><span style="color:#9ECBFF;"> my-app</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 监视更新状态</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> rollout</span><span style="color:#9ECBFF;"> status</span><span style="color:#9ECBFF;"> deployment</span><span style="color:#9ECBFF;"> nginx-deployment</span><span style="color:#79B8FF;"> -n</span><span style="color:#9ECBFF;"> my-app</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 回滚更新</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> rollout</span><span style="color:#9ECBFF;"> undo</span><span style="color:#9ECBFF;"> deployment</span><span style="color:#9ECBFF;"> nginx-deployment</span><span style="color:#79B8FF;"> -n</span><span style="color:#9ECBFF;"> my-app</span></span></code></pre></div><h2 id="网络与存储" tabindex="-1">网络与存储 <a class="header-anchor" href="#网络与存储" aria-label="Permalink to &quot;网络与存储&quot;">​</a></h2><h3 id="网络模型" tabindex="-1">网络模型 <a class="header-anchor" href="#网络模型" aria-label="Permalink to &quot;网络模型&quot;">​</a></h3><p>Kubernetes 网络遵循基本原则：</p><ul><li>每个 Pod 都有唯一的 IP 地址</li><li>Pod 内所有容器共享网络命名空间</li><li>Pod 可以不经过 NAT 与所有其他 Pod 通信</li></ul><h3 id="存储卷" tabindex="-1">存储卷 <a class="header-anchor" href="#存储卷" aria-label="Permalink to &quot;存储卷&quot;">​</a></h3><p><strong>持久卷声明示例</strong>：</p><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">PersistentVolumeClaim</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">my-pvc</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  accessModes</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#9ECBFF;">ReadWriteOnce</span></span>
<span class="line"><span style="color:#85E89D;">  resources</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">    requests</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">      storage</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">10Gi</span></span></code></pre></div><p><strong>使用存储卷的 Pod</strong>：</p><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Pod</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">app-with-storage</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  containers</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">app</span></span>
<span class="line"><span style="color:#85E89D;">    image</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nginx</span></span>
<span class="line"><span style="color:#85E89D;">    volumeMounts</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">storage</span></span>
<span class="line"><span style="color:#85E89D;">      mountPath</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">/data</span></span>
<span class="line"><span style="color:#85E89D;">  volumes</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">storage</span></span>
<span class="line"><span style="color:#85E89D;">    persistentVolumeClaim</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">      claimName</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">my-pvc</span></span></code></pre></div><h2 id="运维与监控" tabindex="-1">运维与监控 <a class="header-anchor" href="#运维与监控" aria-label="Permalink to &quot;运维与监控&quot;">​</a></h2><h3 id="资源监控" tabindex="-1">资源监控 <a class="header-anchor" href="#资源监控" aria-label="Permalink to &quot;资源监控&quot;">​</a></h3><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># 查看集群资源使用情况</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> top</span><span style="color:#9ECBFF;"> nodes</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> top</span><span style="color:#9ECBFF;"> pods</span><span style="color:#79B8FF;"> -n</span><span style="color:#9ECBFF;"> my-app</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 查看 Pod 详细状态</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> describe</span><span style="color:#9ECBFF;"> pod</span><span style="color:#9ECBFF;"> pod-name</span><span style="color:#79B8FF;"> -n</span><span style="color:#9ECBFF;"> my-app</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 查看容器日志</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> logs</span><span style="color:#9ECBFF;"> pod-name</span><span style="color:#79B8FF;"> -n</span><span style="color:#9ECBFF;"> my-app</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> logs</span><span style="color:#9ECBFF;"> pod-name</span><span style="color:#79B8FF;"> -c</span><span style="color:#9ECBFF;"> container-name</span><span style="color:#79B8FF;"> -n</span><span style="color:#9ECBFF;"> my-app</span></span></code></pre></div><h3 id="调试命令" tabindex="-1">调试命令 <a class="header-anchor" href="#调试命令" aria-label="Permalink to &quot;调试命令&quot;">​</a></h3><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># 进入运行中的容器</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> exec</span><span style="color:#79B8FF;"> -it</span><span style="color:#9ECBFF;"> pod-name</span><span style="color:#79B8FF;"> -c</span><span style="color:#9ECBFF;"> container-name</span><span style="color:#79B8FF;"> --</span><span style="color:#9ECBFF;"> /bin/bash</span><span style="color:#79B8FF;"> -n</span><span style="color:#9ECBFF;"> my-app</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 端口转发用于本地访问</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> port-forward</span><span style="color:#9ECBFF;"> pod-name</span><span style="color:#9ECBFF;"> 8080:80</span><span style="color:#79B8FF;"> -n</span><span style="color:#9ECBFF;"> my-app</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 检查集群事件</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> get</span><span style="color:#9ECBFF;"> events</span><span style="color:#79B8FF;"> -n</span><span style="color:#9ECBFF;"> my-app</span><span style="color:#79B8FF;"> --sort-by=.metadata.creationTimestamp</span></span></code></pre></div>`,79)])])}const F=n(e,[["render",o]]);export{d as __pageData,F as default};

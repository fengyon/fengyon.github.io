import{_ as n,c as a,o as l,b as p}from"./chunks/framework.CMLuPXeo.js";const F=JSON.parse('{"title":"nextjs 状态管理","description":"","frontmatter":{},"headers":[{"level":2,"title":"状态管理概览","slug":"状态管理概览","link":"#状态管理概览","children":[]},{"level":2,"title":"客户端状态管理","slug":"客户端状态管理","link":"#客户端状态管理","children":[{"level":3,"title":"本地组件状态","slug":"本地组件状态","link":"#本地组件状态","children":[]},{"level":3,"title":"Context API","slug":"context-api","link":"#context-api","children":[]}]},{"level":2,"title":"服务端状态管理","slug":"服务端状态管理","link":"#服务端状态管理","children":[{"level":3,"title":"URL 状态","slug":"url-状态","link":"#url-状态","children":[]},{"level":3,"title":"Server Actions","slug":"server-actions","link":"#server-actions","children":[]}]},{"level":2,"title":"数据获取与缓存","slug":"数据获取与缓存","link":"#数据获取与缓存","children":[{"level":3,"title":"SWR","slug":"swr","link":"#swr","children":[]},{"level":3,"title":"TanStack Query","slug":"tanstack-query","link":"#tanstack-query","children":[]}]},{"level":2,"title":"状态管理库","slug":"状态管理库","link":"#状态管理库","children":[{"level":3,"title":"Zustand","slug":"zustand","link":"#zustand","children":[]},{"level":3,"title":"Redux Toolkit","slug":"redux-toolkit","link":"#redux-toolkit","children":[]}]},{"level":2,"title":"表单状态管理","slug":"表单状态管理","link":"#表单状态管理","children":[{"level":3,"title":"React Hook Form","slug":"react-hook-form","link":"#react-hook-form","children":[]}]},{"level":2,"title":"状态持久化","slug":"状态持久化","link":"#状态持久化","children":[{"level":3,"title":"localStorage 集成","slug":"localstorage-集成","link":"#localstorage-集成","children":[]}]},{"level":2,"title":"状态管理选择指南","slug":"状态管理选择指南","link":"#状态管理选择指南","children":[{"level":3,"title":"性能考虑","slug":"性能考虑","link":"#性能考虑","children":[]}]}],"relativePath":"framework/nextjs/status.md","filePath":"framework/nextjs/status.md"}'),o={name:"framework/nextjs/status.md"};function e(t,s,c,r,E,y){return l(),a("div",null,[...s[0]||(s[0]=[p(`<div style="display:none;" hidden="true" aria-hidden="true">Are you an LLM? You can read better optimized documentation at /framework/nextjs/status.md for this page in Markdown format</div><h1 id="nextjs-状态管理" tabindex="-1">nextjs 状态管理 <a class="header-anchor" href="#nextjs-状态管理" aria-label="Permalink to &quot;nextjs 状态管理&quot;">​</a></h1><p>Next.js 应用中的状态管理需要考虑服务端渲染、客户端交互和组件层次结构的特殊性，提供多种方案来满足不同场景的需求。</p><h2 id="状态管理概览" tabindex="-1">状态管理概览 <a class="header-anchor" href="#状态管理概览" aria-label="Permalink to &quot;状态管理概览&quot;">​</a></h2><p>Next.js 应用中的状态可以分为不同层次，每种状态都有适合的管理方案：</p><p>示意图：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span>状态层次：</span></span>
<span class="line"><span>组件内状态 (useState) → 组件间状态 (Props/Context) → 应用级状态 (Zustand/Redux) → 服务端状态 (SWR/TanStack Query)</span></span></code></pre></div><h2 id="客户端状态管理" tabindex="-1">客户端状态管理 <a class="header-anchor" href="#客户端状态管理" aria-label="Permalink to &quot;客户端状态管理&quot;">​</a></h2><h3 id="本地组件状态" tabindex="-1">本地组件状态 <a class="header-anchor" href="#本地组件状态" aria-label="Permalink to &quot;本地组件状态&quot;">​</a></h3><p>使用 React 的 <code>useState</code> 和 <code>useReducer</code> 管理组件内部状态。</p><div class="language-jsx"><button title="Copy Code" class="copy"></button><span class="lang">jsx</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#9ECBFF;">&#39;use client&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { useState } </span><span style="color:#F97583;">from</span><span style="color:#9ECBFF;"> &#39;react&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">function</span><span style="color:#B392F0;"> Counter</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#F97583;">  const</span><span style="color:#E1E4E8;"> [</span><span style="color:#79B8FF;">count</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">setCount</span><span style="color:#E1E4E8;">] </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> useState</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#F97583;">  return</span><span style="color:#E1E4E8;"> (</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;</span><span style="color:#85E89D;">div</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">      &lt;</span><span style="color:#85E89D;">p</span><span style="color:#E1E4E8;">&gt;计数: {count}&lt;/</span><span style="color:#85E89D;">p</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">      &lt;</span><span style="color:#85E89D;">button</span><span style="color:#B392F0;"> onClick</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">{() </span><span style="color:#F97583;">=&gt;</span><span style="color:#B392F0;"> setCount</span><span style="color:#E1E4E8;">(count </span><span style="color:#F97583;">+</span><span style="color:#79B8FF;"> 1</span><span style="color:#E1E4E8;">)}&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">        增加</span></span>
<span class="line"><span style="color:#E1E4E8;">      &lt;/</span><span style="color:#85E89D;">button</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;/</span><span style="color:#85E89D;">div</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">  );</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre></div><p>示意图：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span>组件状态流：</span></span>
<span class="line"><span>[初始状态] → [用户交互] → [状态更新] → [UI重新渲染]</span></span></code></pre></div><h3 id="context-api" tabindex="-1">Context API <a class="header-anchor" href="#context-api" aria-label="Permalink to &quot;Context API&quot;">​</a></h3><p>使用 React Context 在组件树中共享状态，避免 prop drilling。</p><p>示意图：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span>Prop Drilling问题：</span></span>
<span class="line"><span>ComponentA → ComponentB → ComponentC → ComponentD</span></span>
<span class="line"><span>    ↓                      ↓</span></span>
<span class="line"><span>[状态]                 [需要状态]</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Context解决方案：</span></span>
<span class="line"><span>Context.Provider</span></span>
<span class="line"><span>    ├── ComponentA</span></span>
<span class="line"><span>    ├── ComponentB  </span></span>
<span class="line"><span>    └── ComponentC → ComponentD (直接消费Context)</span></span></code></pre></div><div class="language-jsx"><button title="Copy Code" class="copy"></button><span class="lang">jsx</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#9ECBFF;">&#39;use client&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { createContext, useContext, useState } </span><span style="color:#F97583;">from</span><span style="color:#9ECBFF;"> &#39;react&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#79B8FF;"> ThemeContext</span><span style="color:#F97583;"> =</span><span style="color:#B392F0;"> createContext</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">export</span><span style="color:#F97583;"> function</span><span style="color:#B392F0;"> ThemeProvider</span><span style="color:#E1E4E8;">({ </span><span style="color:#FFAB70;">children</span><span style="color:#E1E4E8;"> }) {</span></span>
<span class="line"><span style="color:#F97583;">  const</span><span style="color:#E1E4E8;"> [</span><span style="color:#79B8FF;">theme</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">setTheme</span><span style="color:#E1E4E8;">] </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> useState</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;light&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#F97583;">  return</span><span style="color:#E1E4E8;"> (</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;</span><span style="color:#79B8FF;">ThemeContext.Provider</span><span style="color:#B392F0;"> value</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">{{ theme, setTheme }}&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">      {children}</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;/</span><span style="color:#79B8FF;">ThemeContext.Provider</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">  );</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">export</span><span style="color:#F97583;"> function</span><span style="color:#B392F0;"> useTheme</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#F97583;">  return</span><span style="color:#B392F0;"> useContext</span><span style="color:#E1E4E8;">(ThemeContext);</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre></div><h2 id="服务端状态管理" tabindex="-1">服务端状态管理 <a class="header-anchor" href="#服务端状态管理" aria-label="Permalink to &quot;服务端状态管理&quot;">​</a></h2><h3 id="url-状态" tabindex="-1">URL 状态 <a class="header-anchor" href="#url-状态" aria-label="Permalink to &quot;URL 状态&quot;">​</a></h3><p>使用 URL 参数和查询字符串管理页面状态，支持分享和刷新保持状态。</p><p>示意图：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span>URL作为状态容器：</span></span>
<span class="line"><span>/search?query=nextjs&amp;category=docs&amp;page=1</span></span>
<span class="line"><span>    ↓</span></span>
<span class="line"><span>query: nextjs</span></span>
<span class="line"><span>category: docs  </span></span>
<span class="line"><span>page: 1</span></span></code></pre></div><div class="language-jsx"><button title="Copy Code" class="copy"></button><span class="lang">jsx</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#9ECBFF;">&#39;use client&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { useSearchParams, useRouter } </span><span style="color:#F97583;">from</span><span style="color:#9ECBFF;"> &#39;next/navigation&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">function</span><span style="color:#B392F0;"> SearchFilters</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#F97583;">  const</span><span style="color:#79B8FF;"> searchParams</span><span style="color:#F97583;"> =</span><span style="color:#B392F0;"> useSearchParams</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#F97583;">  const</span><span style="color:#79B8FF;"> router</span><span style="color:#F97583;"> =</span><span style="color:#B392F0;"> useRouter</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#F97583;">  const</span><span style="color:#B392F0;"> updateFilter</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> (</span><span style="color:#FFAB70;">key</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">value</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#F97583;">    const</span><span style="color:#79B8FF;"> params</span><span style="color:#F97583;"> =</span><span style="color:#F97583;"> new</span><span style="color:#B392F0;"> URLSearchParams</span><span style="color:#E1E4E8;">(searchParams);</span></span>
<span class="line"><span style="color:#E1E4E8;">    params.</span><span style="color:#B392F0;">set</span><span style="color:#E1E4E8;">(key, value);</span></span>
<span class="line"><span style="color:#E1E4E8;">    router.</span><span style="color:#B392F0;">push</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">\`?\${</span><span style="color:#E1E4E8;">params</span><span style="color:#9ECBFF;">.</span><span style="color:#B392F0;">toString</span><span style="color:#9ECBFF;">()</span><span style="color:#9ECBFF;">}\`</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">  };</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#F97583;">  return</span><span style="color:#E1E4E8;"> (</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;</span><span style="color:#85E89D;">div</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">      &lt;</span><span style="color:#85E89D;">input</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#B392F0;">        defaultValue</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">{searchParams.</span><span style="color:#B392F0;">get</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;query&#39;</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">||</span><span style="color:#9ECBFF;"> &#39;&#39;</span><span style="color:#E1E4E8;">}</span></span>
<span class="line"><span style="color:#B392F0;">        onChange</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">{(</span><span style="color:#FFAB70;">e</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#B392F0;"> updateFilter</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;query&#39;</span><span style="color:#E1E4E8;">, e.target.value)}</span></span>
<span class="line"><span style="color:#E1E4E8;">      /&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;/</span><span style="color:#85E89D;">div</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">  );</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre></div><h3 id="server-actions" tabindex="-1">Server Actions <a class="header-anchor" href="#server-actions" aria-label="Permalink to &quot;Server Actions&quot;">​</a></h3><p>在服务端处理状态变更，确保数据一致性。</p><div class="language-jsx"><button title="Copy Code" class="copy"></button><span class="lang">jsx</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;">// app/actions.js</span></span>
<span class="line"><span style="color:#9ECBFF;">&#39;use server&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">export</span><span style="color:#F97583;"> async</span><span style="color:#F97583;"> function</span><span style="color:#B392F0;"> createTodo</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">formData</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#F97583;">  const</span><span style="color:#79B8FF;"> title</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> formData.</span><span style="color:#B392F0;">get</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;title&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#6A737D;">  // 服务端状态更新</span></span>
<span class="line"><span style="color:#F97583;">  await</span><span style="color:#E1E4E8;"> db.todos.</span><span style="color:#B392F0;">create</span><span style="color:#E1E4E8;">({ title });</span></span>
<span class="line"><span style="color:#B392F0;">  revalidatePath</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;/todos&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre></div><h2 id="数据获取与缓存" tabindex="-1">数据获取与缓存 <a class="header-anchor" href="#数据获取与缓存" aria-label="Permalink to &quot;数据获取与缓存&quot;">​</a></h2><h3 id="swr" tabindex="-1">SWR <a class="header-anchor" href="#swr" aria-label="Permalink to &quot;SWR&quot;">​</a></h3><p>SWR 提供数据获取、缓存和重新验证功能。</p><p>示意图：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span>SWR工作流：</span></span>
<span class="line"><span>[组件请求数据] → [检查缓存] → [缓存命中?] → 是: 返回缓存</span></span>
<span class="line"><span>        ↓否</span></span>
<span class="line"><span>[发起请求] → [更新缓存] → [返回数据] → [后台重新验证]</span></span></code></pre></div><div class="language-jsx"><button title="Copy Code" class="copy"></button><span class="lang">jsx</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#9ECBFF;">&#39;use client&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> useSWR </span><span style="color:#F97583;">from</span><span style="color:#9ECBFF;"> &#39;swr&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">function</span><span style="color:#B392F0;"> Profile</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#F97583;">  const</span><span style="color:#E1E4E8;"> { </span><span style="color:#79B8FF;">data</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">error</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">isLoading</span><span style="color:#E1E4E8;"> } </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> useSWR</span><span style="color:#E1E4E8;">(</span></span>
<span class="line"><span style="color:#9ECBFF;">    &#39;/api/user&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    (</span><span style="color:#FFAB70;">url</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#B392F0;"> fetch</span><span style="color:#E1E4E8;">(url).</span><span style="color:#B392F0;">then</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">res</span><span style="color:#F97583;"> =&gt;</span><span style="color:#E1E4E8;"> res.</span><span style="color:#B392F0;">json</span><span style="color:#E1E4E8;">())</span></span>
<span class="line"><span style="color:#E1E4E8;">  );</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#F97583;">  if</span><span style="color:#E1E4E8;"> (error) </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> &lt;</span><span style="color:#85E89D;">div</span><span style="color:#E1E4E8;">&gt;加载失败&lt;/</span><span style="color:#85E89D;">div</span><span style="color:#E1E4E8;">&gt;;</span></span>
<span class="line"><span style="color:#F97583;">  if</span><span style="color:#E1E4E8;"> (isLoading) </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> &lt;</span><span style="color:#85E89D;">div</span><span style="color:#E1E4E8;">&gt;加载中...&lt;/</span><span style="color:#85E89D;">div</span><span style="color:#E1E4E8;">&gt;;</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#F97583;">  return</span><span style="color:#E1E4E8;"> &lt;</span><span style="color:#85E89D;">div</span><span style="color:#E1E4E8;">&gt;你好, {data.name}!&lt;/</span><span style="color:#85E89D;">div</span><span style="color:#E1E4E8;">&gt;;</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre></div><h3 id="tanstack-query" tabindex="-1">TanStack Query <a class="header-anchor" href="#tanstack-query" aria-label="Permalink to &quot;TanStack Query&quot;">​</a></h3><p>功能强大的服务端状态管理库，适用于复杂的数据获取场景。</p><div class="language-jsx"><button title="Copy Code" class="copy"></button><span class="lang">jsx</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#9ECBFF;">&#39;use client&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { useQuery, useMutation, useQueryClient } </span><span style="color:#F97583;">from</span><span style="color:#9ECBFF;"> &#39;@tanstack/react-query&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">function</span><span style="color:#B392F0;"> Todos</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#F97583;">  const</span><span style="color:#79B8FF;"> queryClient</span><span style="color:#F97583;"> =</span><span style="color:#B392F0;"> useQueryClient</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#F97583;">  const</span><span style="color:#E1E4E8;"> { </span><span style="color:#FFAB70;">data</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">todos</span><span style="color:#E1E4E8;"> } </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> useQuery</span><span style="color:#E1E4E8;">({</span></span>
<span class="line"><span style="color:#E1E4E8;">    queryKey: [</span><span style="color:#9ECBFF;">&#39;todos&#39;</span><span style="color:#E1E4E8;">],</span></span>
<span class="line"><span style="color:#B392F0;">    queryFn</span><span style="color:#E1E4E8;">: () </span><span style="color:#F97583;">=&gt;</span><span style="color:#B392F0;"> fetch</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;/api/todos&#39;</span><span style="color:#E1E4E8;">).</span><span style="color:#B392F0;">then</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">res</span><span style="color:#F97583;"> =&gt;</span><span style="color:#E1E4E8;"> res.</span><span style="color:#B392F0;">json</span><span style="color:#E1E4E8;">()),</span></span>
<span class="line"><span style="color:#E1E4E8;">  });</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#F97583;">  const</span><span style="color:#79B8FF;"> mutation</span><span style="color:#F97583;"> =</span><span style="color:#B392F0;"> useMutation</span><span style="color:#E1E4E8;">({</span></span>
<span class="line"><span style="color:#B392F0;">    mutationFn</span><span style="color:#E1E4E8;">: (</span><span style="color:#FFAB70;">newTodo</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#B392F0;">      fetch</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;/api/todos&#39;</span><span style="color:#E1E4E8;">, {</span></span>
<span class="line"><span style="color:#E1E4E8;">        method: </span><span style="color:#9ECBFF;">&#39;POST&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">        body: </span><span style="color:#79B8FF;">JSON</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">stringify</span><span style="color:#E1E4E8;">(newTodo),</span></span>
<span class="line"><span style="color:#E1E4E8;">      }),</span></span>
<span class="line"><span style="color:#B392F0;">    onSuccess</span><span style="color:#E1E4E8;">: () </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">      queryClient.</span><span style="color:#B392F0;">invalidateQueries</span><span style="color:#E1E4E8;">({ queryKey: [</span><span style="color:#9ECBFF;">&#39;todos&#39;</span><span style="color:#E1E4E8;">] });</span></span>
<span class="line"><span style="color:#E1E4E8;">    },</span></span>
<span class="line"><span style="color:#E1E4E8;">  });</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#F97583;">  return</span><span style="color:#E1E4E8;"> (</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;</span><span style="color:#85E89D;">div</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">      {todos?.</span><span style="color:#B392F0;">map</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">todo</span><span style="color:#F97583;"> =&gt;</span><span style="color:#E1E4E8;"> (</span></span>
<span class="line"><span style="color:#E1E4E8;">        &lt;</span><span style="color:#85E89D;">div</span><span style="color:#B392F0;"> key</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">{todo.id}&gt;{todo.title}&lt;/</span><span style="color:#85E89D;">div</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">      ))}</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;/</span><span style="color:#85E89D;">div</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">  );</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre></div><h2 id="状态管理库" tabindex="-1">状态管理库 <a class="header-anchor" href="#状态管理库" aria-label="Permalink to &quot;状态管理库&quot;">​</a></h2><h3 id="zustand" tabindex="-1">Zustand <a class="header-anchor" href="#zustand" aria-label="Permalink to &quot;Zustand&quot;">​</a></h3><p>轻量级状态管理库，API 简单直观。</p><div class="language-jsx"><button title="Copy Code" class="copy"></button><span class="lang">jsx</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#9ECBFF;">&#39;use client&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { create } </span><span style="color:#F97583;">from</span><span style="color:#9ECBFF;"> &#39;zustand&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#79B8FF;"> useStore</span><span style="color:#F97583;"> =</span><span style="color:#B392F0;"> create</span><span style="color:#E1E4E8;">((</span><span style="color:#FFAB70;">set</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> ({</span></span>
<span class="line"><span style="color:#E1E4E8;">  bears: </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#B392F0;">  increasePopulation</span><span style="color:#E1E4E8;">: () </span><span style="color:#F97583;">=&gt;</span><span style="color:#B392F0;"> set</span><span style="color:#E1E4E8;">((</span><span style="color:#FFAB70;">state</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> ({ bears: state.bears </span><span style="color:#F97583;">+</span><span style="color:#79B8FF;"> 1</span><span style="color:#E1E4E8;"> })),</span></span>
<span class="line"><span style="color:#B392F0;">  removeAllBears</span><span style="color:#E1E4E8;">: () </span><span style="color:#F97583;">=&gt;</span><span style="color:#B392F0;"> set</span><span style="color:#E1E4E8;">({ bears: </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> }),</span></span>
<span class="line"><span style="color:#E1E4E8;">}));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">function</span><span style="color:#B392F0;"> BearCounter</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#F97583;">  const</span><span style="color:#79B8FF;"> bears</span><span style="color:#F97583;"> =</span><span style="color:#B392F0;"> useStore</span><span style="color:#E1E4E8;">((</span><span style="color:#FFAB70;">state</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> state.bears);</span></span>
<span class="line"><span style="color:#F97583;">  const</span><span style="color:#79B8FF;"> increase</span><span style="color:#F97583;"> =</span><span style="color:#B392F0;"> useStore</span><span style="color:#E1E4E8;">((</span><span style="color:#FFAB70;">state</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> state.increasePopulation);</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#F97583;">  return</span><span style="color:#E1E4E8;"> (</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;</span><span style="color:#85E89D;">div</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">      &lt;</span><span style="color:#85E89D;">h1</span><span style="color:#E1E4E8;">&gt;{bears} 只熊&lt;/</span><span style="color:#85E89D;">h1</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">      &lt;</span><span style="color:#85E89D;">button</span><span style="color:#B392F0;"> onClick</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">{increase}&gt;增加一只熊&lt;/</span><span style="color:#85E89D;">button</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;/</span><span style="color:#85E89D;">div</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">  );</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre></div><h3 id="redux-toolkit" tabindex="-1">Redux Toolkit <a class="header-anchor" href="#redux-toolkit" aria-label="Permalink to &quot;Redux Toolkit&quot;">​</a></h3><p>适用于大型复杂应用的状态管理方案。</p><p>示意图：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span>Redux数据流：</span></span>
<span class="line"><span>[组件] → [Action] → [Reducer] → [Store] → [更新状态] → [组件重新渲染]</span></span></code></pre></div><div class="language-jsx"><button title="Copy Code" class="copy"></button><span class="lang">jsx</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#9ECBFF;">&#39;use client&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { configureStore, createSlice } </span><span style="color:#F97583;">from</span><span style="color:#9ECBFF;"> &#39;@reduxjs/toolkit&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { Provider, useDispatch, useSelector } </span><span style="color:#F97583;">from</span><span style="color:#9ECBFF;"> &#39;react-redux&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#79B8FF;"> counterSlice</span><span style="color:#F97583;"> =</span><span style="color:#B392F0;"> createSlice</span><span style="color:#E1E4E8;">({</span></span>
<span class="line"><span style="color:#E1E4E8;">  name: </span><span style="color:#9ECBFF;">&#39;counter&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  initialState: { value: </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> },</span></span>
<span class="line"><span style="color:#E1E4E8;">  reducers: {</span></span>
<span class="line"><span style="color:#B392F0;">    increment</span><span style="color:#E1E4E8;">: (</span><span style="color:#FFAB70;">state</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">      state.value </span><span style="color:#F97583;">+=</span><span style="color:#79B8FF;"> 1</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    },</span></span>
<span class="line"><span style="color:#E1E4E8;">  },</span></span>
<span class="line"><span style="color:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#79B8FF;"> store</span><span style="color:#F97583;"> =</span><span style="color:#B392F0;"> configureStore</span><span style="color:#E1E4E8;">({</span></span>
<span class="line"><span style="color:#E1E4E8;">  reducer: {</span></span>
<span class="line"><span style="color:#E1E4E8;">    counter: counterSlice.reducer,</span></span>
<span class="line"><span style="color:#E1E4E8;">  },</span></span>
<span class="line"><span style="color:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">function</span><span style="color:#B392F0;"> Counter</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#F97583;">  const</span><span style="color:#79B8FF;"> count</span><span style="color:#F97583;"> =</span><span style="color:#B392F0;"> useSelector</span><span style="color:#E1E4E8;">((</span><span style="color:#FFAB70;">state</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> state.counter.value);</span></span>
<span class="line"><span style="color:#F97583;">  const</span><span style="color:#79B8FF;"> dispatch</span><span style="color:#F97583;"> =</span><span style="color:#B392F0;"> useDispatch</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#F97583;">  return</span><span style="color:#E1E4E8;"> (</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;</span><span style="color:#85E89D;">div</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">      &lt;</span><span style="color:#85E89D;">span</span><span style="color:#E1E4E8;">&gt;{count}&lt;/</span><span style="color:#85E89D;">span</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">      &lt;</span><span style="color:#85E89D;">button</span><span style="color:#B392F0;"> onClick</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">{() </span><span style="color:#F97583;">=&gt;</span><span style="color:#B392F0;"> dispatch</span><span style="color:#E1E4E8;">(counterSlice.actions.</span><span style="color:#B392F0;">increment</span><span style="color:#E1E4E8;">())}&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">        +</span></span>
<span class="line"><span style="color:#E1E4E8;">      &lt;/</span><span style="color:#85E89D;">button</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;/</span><span style="color:#85E89D;">div</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">  );</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre></div><h2 id="表单状态管理" tabindex="-1">表单状态管理 <a class="header-anchor" href="#表单状态管理" aria-label="Permalink to &quot;表单状态管理&quot;">​</a></h2><h3 id="react-hook-form" tabindex="-1">React Hook Form <a class="header-anchor" href="#react-hook-form" aria-label="Permalink to &quot;React Hook Form&quot;">​</a></h3><p>高性能表单状态管理库。</p><div class="language-jsx"><button title="Copy Code" class="copy"></button><span class="lang">jsx</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#9ECBFF;">&#39;use client&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { useForm } </span><span style="color:#F97583;">from</span><span style="color:#9ECBFF;"> &#39;react-hook-form&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">function</span><span style="color:#B392F0;"> ContactForm</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#F97583;">  const</span><span style="color:#E1E4E8;"> { </span><span style="color:#79B8FF;">register</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">handleSubmit</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">formState</span><span style="color:#E1E4E8;">: { </span><span style="color:#79B8FF;">errors</span><span style="color:#E1E4E8;"> } } </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> useForm</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#F97583;">  const</span><span style="color:#B392F0;"> onSubmit</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> (</span><span style="color:#FFAB70;">data</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(data);</span></span>
<span class="line"><span style="color:#E1E4E8;">  };</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#F97583;">  return</span><span style="color:#E1E4E8;"> (</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;</span><span style="color:#85E89D;">form</span><span style="color:#B392F0;"> onSubmit</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">{</span><span style="color:#B392F0;">handleSubmit</span><span style="color:#E1E4E8;">(onSubmit)}&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">      &lt;</span><span style="color:#85E89D;">input</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#E1E4E8;">        {</span><span style="color:#F97583;">...</span><span style="color:#B392F0;">register</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;name&#39;</span><span style="color:#E1E4E8;">, { required: </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;"> })}</span></span>
<span class="line"><span style="color:#B392F0;">        placeholder</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;姓名&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">      /&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">      {errors.name </span><span style="color:#F97583;">&amp;&amp;</span><span style="color:#E1E4E8;"> &lt;</span><span style="color:#85E89D;">span</span><span style="color:#E1E4E8;">&gt;姓名是必填项&lt;/</span><span style="color:#85E89D;">span</span><span style="color:#E1E4E8;">&gt;}</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span></span>
<span class="line"><span style="color:#E1E4E8;">      &lt;</span><span style="color:#85E89D;">input</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#E1E4E8;">        {</span><span style="color:#F97583;">...</span><span style="color:#B392F0;">register</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;email&#39;</span><span style="color:#E1E4E8;">, { </span></span>
<span class="line"><span style="color:#E1E4E8;">          required: </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">          pattern:</span><span style="color:#9ECBFF;"> /</span><span style="color:#F97583;">^</span><span style="color:#79B8FF;">\\S</span><span style="color:#F97583;">+</span><span style="color:#DBEDFF;">@</span><span style="color:#79B8FF;">\\S</span><span style="color:#F97583;">+$</span><span style="color:#9ECBFF;">/</span><span style="color:#F97583;">i</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#E1E4E8;">        })}</span></span>
<span class="line"><span style="color:#B392F0;">        placeholder</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;邮箱&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">      /&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">      {errors.email </span><span style="color:#F97583;">&amp;&amp;</span><span style="color:#E1E4E8;"> &lt;</span><span style="color:#85E89D;">span</span><span style="color:#E1E4E8;">&gt;请输入有效的邮箱地址&lt;/</span><span style="color:#85E89D;">span</span><span style="color:#E1E4E8;">&gt;}</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span></span>
<span class="line"><span style="color:#E1E4E8;">      &lt;</span><span style="color:#85E89D;">button</span><span style="color:#B392F0;"> type</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;submit&quot;</span><span style="color:#E1E4E8;">&gt;提交&lt;/</span><span style="color:#85E89D;">button</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;/</span><span style="color:#85E89D;">form</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">  );</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre></div><h2 id="状态持久化" tabindex="-1">状态持久化 <a class="header-anchor" href="#状态持久化" aria-label="Permalink to &quot;状态持久化&quot;">​</a></h2><h3 id="localstorage-集成" tabindex="-1">localStorage 集成 <a class="header-anchor" href="#localstorage-集成" aria-label="Permalink to &quot;localStorage 集成&quot;">​</a></h3><p>在客户端持久化状态。</p><div class="language-jsx"><button title="Copy Code" class="copy"></button><span class="lang">jsx</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#9ECBFF;">&#39;use client&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { useState, useEffect } </span><span style="color:#F97583;">from</span><span style="color:#9ECBFF;"> &#39;react&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">function</span><span style="color:#B392F0;"> usePersistedState</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">key</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">defaultValue</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#F97583;">  const</span><span style="color:#E1E4E8;"> [</span><span style="color:#79B8FF;">state</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">setState</span><span style="color:#E1E4E8;">] </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> useState</span><span style="color:#E1E4E8;">(() </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#F97583;">    if</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">typeof</span><span style="color:#E1E4E8;"> window </span><span style="color:#F97583;">!==</span><span style="color:#9ECBFF;"> &#39;undefined&#39;</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#F97583;">      const</span><span style="color:#79B8FF;"> stored</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> localStorage.</span><span style="color:#B392F0;">getItem</span><span style="color:#E1E4E8;">(key);</span></span>
<span class="line"><span style="color:#F97583;">      return</span><span style="color:#E1E4E8;"> stored </span><span style="color:#F97583;">?</span><span style="color:#79B8FF;"> JSON</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">parse</span><span style="color:#E1E4E8;">(stored) </span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> defaultValue;</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#F97583;">    return</span><span style="color:#E1E4E8;"> defaultValue;</span></span>
<span class="line"><span style="color:#E1E4E8;">  });</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#B392F0;">  useEffect</span><span style="color:#E1E4E8;">(() </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    localStorage.</span><span style="color:#B392F0;">setItem</span><span style="color:#E1E4E8;">(key, </span><span style="color:#79B8FF;">JSON</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">stringify</span><span style="color:#E1E4E8;">(state));</span></span>
<span class="line"><span style="color:#E1E4E8;">  }, [key, state]);</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#F97583;">  return</span><span style="color:#E1E4E8;"> [state, setState];</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">function</span><span style="color:#B392F0;"> Settings</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#F97583;">  const</span><span style="color:#E1E4E8;"> [</span><span style="color:#79B8FF;">theme</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">setTheme</span><span style="color:#E1E4E8;">] </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> usePersistedState</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;theme&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&#39;light&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#F97583;">  return</span><span style="color:#E1E4E8;"> (</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;</span><span style="color:#85E89D;">select</span><span style="color:#B392F0;"> value</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">{theme} </span><span style="color:#B392F0;">onChange</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">{(</span><span style="color:#FFAB70;">e</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#B392F0;"> setTheme</span><span style="color:#E1E4E8;">(e.target.value)}&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">      &lt;</span><span style="color:#85E89D;">option</span><span style="color:#B392F0;"> value</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;light&quot;</span><span style="color:#E1E4E8;">&gt;浅色&lt;/</span><span style="color:#85E89D;">option</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">      &lt;</span><span style="color:#85E89D;">option</span><span style="color:#B392F0;"> value</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;dark&quot;</span><span style="color:#E1E4E8;">&gt;深色&lt;/</span><span style="color:#85E89D;">option</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;/</span><span style="color:#85E89D;">select</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">  );</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre></div><h2 id="状态管理选择指南" tabindex="-1">状态管理选择指南 <a class="header-anchor" href="#状态管理选择指南" aria-label="Permalink to &quot;状态管理选择指南&quot;">​</a></h2><p>根据应用需求选择合适的状态管理方案：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span>场景                     推荐方案</span></span>
<span class="line"><span>──────────────────────────────────────────────</span></span>
<span class="line"><span>简单组件交互               useState/useReducer</span></span>
<span class="line"><span>主题、用户偏好等全局状态     Context API</span></span>
<span class="line"><span>复杂业务逻辑               Zustand</span></span>
<span class="line"><span>大型企业级应用             Redux Toolkit</span></span>
<span class="line"><span>服务端数据缓存和同步       SWR/TanStack Query</span></span>
<span class="line"><span>表单处理                  React Hook Form</span></span>
<span class="line"><span>URL相关状态               useSearchParams</span></span></code></pre></div><h3 id="性能考虑" tabindex="-1">性能考虑 <a class="header-anchor" href="#性能考虑" aria-label="Permalink to &quot;性能考虑&quot;">​</a></h3><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span>方案             包大小   学习曲线   性能   适用场景</span></span>
<span class="line"><span>──────────────────────────────────────────────────</span></span>
<span class="line"><span>useState         最小     最简单    最佳    组件内状态</span></span>
<span class="line"><span>Context         小       简单      中等    主题、用户偏好</span></span>
<span class="line"><span>Zustand         小       简单      良好    中等复杂度应用</span></span>
<span class="line"><span>Redux Toolkit   中等     中等      良好    大型复杂应用</span></span>
<span class="line"><span>SWR             小       简单      良好    数据获取</span></span>
<span class="line"><span>TanStack Query  中等     中等      良好    复杂数据场景</span></span></code></pre></div><p>Next.js 的状态管理生态提供了丰富的选择，开发者可以根据应用规模、团队熟悉度和性能要求来选择最合适的方案，确保应用的可维护性和用户体验。</p>`,59)])])}const u=n(o,[["render",e]]);export{F as __pageData,u as default};

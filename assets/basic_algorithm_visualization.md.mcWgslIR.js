import{_ as n,c as a,o as l,b as p}from"./chunks/framework.CMLuPXeo.js";const i=JSON.parse('{"title":"可视化工具","description":"","frontmatter":{},"headers":[{"level":2,"title":"工具概述","slug":"工具概述","link":"#工具概述","children":[]},{"level":2,"title":"核心架构设计","slug":"核心架构设计","link":"#核心架构设计","children":[{"level":3,"title":"可视化引擎基础","slug":"可视化引擎基础","link":"#可视化引擎基础","children":[]},{"level":3,"title":"排序算法可视化器","slug":"排序算法可视化器","link":"#排序算法可视化器","children":[]}]},{"level":2,"title":"图形渲染技术","slug":"图形渲染技术","link":"#图形渲染技术","children":[{"level":3,"title":"Canvas 高级渲染","slug":"canvas-高级渲染","link":"#canvas-高级渲染","children":[]},{"level":3,"title":"图算法可视化","slug":"图算法可视化","link":"#图算法可视化","children":[]}]},{"level":2,"title":"交互功能增强","slug":"交互功能增强","link":"#交互功能增强","children":[{"level":3,"title":"用户交互处理器","slug":"用户交互处理器","link":"#用户交互处理器","children":[]},{"level":3,"title":"数据导入导出","slug":"数据导入导出","link":"#数据导入导出","children":[]}]}],"relativePath":"basic/algorithm/visualization.md","filePath":"basic/algorithm/visualization.md"}'),o={name:"basic/algorithm/visualization.md"};function e(t,s,c,E,r,y){return l(),a("div",null,[...s[0]||(s[0]=[p(`<div style="display:none;" hidden="true" aria-hidden="true">Are you an LLM? You can read better optimized documentation at /basic/algorithm/visualization.md for this page in Markdown format</div><h1 id="可视化工具" tabindex="-1">可视化工具 <a class="header-anchor" href="#可视化工具" aria-label="Permalink to &quot;可视化工具&quot;">​</a></h1><h2 id="工具概述" tabindex="-1">工具概述 <a class="header-anchor" href="#工具概述" aria-label="Permalink to &quot;工具概述&quot;">​</a></h2><p>JavaScript 算法可视化工具通过图形化展示算法执行过程，将抽象的计算逻辑转化为直观的视觉表现。这类工具帮助开发者理解算法内在机制、调试复杂逻辑，并为教学和演示提供生动素材。</p><p>核心可视化流程：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span>算法输入 → 执行步骤分解 → 图形元素映射 → 动画渲染</span></span>
<span class="line"><span>                    ↓</span></span>
<span class="line"><span>           交互控制 ← 状态显示</span></span></code></pre></div><h2 id="核心架构设计" tabindex="-1">核心架构设计 <a class="header-anchor" href="#核心架构设计" aria-label="Permalink to &quot;核心架构设计&quot;">​</a></h2><h3 id="可视化引擎基础" tabindex="-1">可视化引擎基础 <a class="header-anchor" href="#可视化引擎基础" aria-label="Permalink to &quot;可视化引擎基础&quot;">​</a></h3><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;">// 可视化引擎基类</span></span>
<span class="line"><span style="color:#F97583;">export</span><span style="color:#F97583;"> class</span><span style="color:#B392F0;"> AlgorithmVisualizer</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#F97583;">    constructor</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">container</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">options</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> {}) {</span></span>
<span class="line"><span style="color:#79B8FF;">        this</span><span style="color:#E1E4E8;">.container </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> container;</span></span>
<span class="line"><span style="color:#79B8FF;">        this</span><span style="color:#E1E4E8;">.options </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">            speed: </span><span style="color:#79B8FF;">1.0</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">            autoPlay: </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">            highlightColor: </span><span style="color:#9ECBFF;">&#39;#ff6b6b&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">            compareColor: </span><span style="color:#9ECBFF;">&#39;#4ecdc4&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">            sortedColor: </span><span style="color:#9ECBFF;">&#39;#45b7d1&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#F97583;">            ...</span><span style="color:#E1E4E8;">options</span></span>
<span class="line"><span style="color:#E1E4E8;">        };</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#79B8FF;">        this</span><span style="color:#E1E4E8;">.states </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> [];</span></span>
<span class="line"><span style="color:#79B8FF;">        this</span><span style="color:#E1E4E8;">.currentStep </span><span style="color:#F97583;">=</span><span style="color:#79B8FF;"> 0</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#79B8FF;">        this</span><span style="color:#E1E4E8;">.isPlaying </span><span style="color:#F97583;">=</span><span style="color:#79B8FF;"> false</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#79B8FF;">        this</span><span style="color:#E1E4E8;">.animationFrameId </span><span style="color:#F97583;">=</span><span style="color:#79B8FF;"> null</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#79B8FF;">        this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">initCanvas</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#79B8FF;">        this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">initControls</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">    // 初始化画布</span></span>
<span class="line"><span style="color:#B392F0;">    initCanvas</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#79B8FF;">        this</span><span style="color:#E1E4E8;">.canvas </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> document.</span><span style="color:#B392F0;">createElement</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;canvas&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#79B8FF;">        this</span><span style="color:#E1E4E8;">.ctx </span><span style="color:#F97583;">=</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.canvas.</span><span style="color:#B392F0;">getContext</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;2d&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#6A737D;">        // 响应式画布</span></span>
<span class="line"><span style="color:#79B8FF;">        this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">resizeCanvas</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">        window.</span><span style="color:#B392F0;">addEventListener</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;resize&#39;</span><span style="color:#E1E4E8;">, () </span><span style="color:#F97583;">=&gt;</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">resizeCanvas</span><span style="color:#E1E4E8;">());</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#79B8FF;">        this</span><span style="color:#E1E4E8;">.container.</span><span style="color:#B392F0;">appendChild</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.canvas);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">    // 调整画布尺寸</span></span>
<span class="line"><span style="color:#B392F0;">    resizeCanvas</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#F97583;">        const</span><span style="color:#79B8FF;"> rect</span><span style="color:#F97583;"> =</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.container.</span><span style="color:#B392F0;">getBoundingClientRect</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#79B8FF;">        this</span><span style="color:#E1E4E8;">.canvas.width </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> rect.width;</span></span>
<span class="line"><span style="color:#79B8FF;">        this</span><span style="color:#E1E4E8;">.canvas.height </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> rect.height;</span></span>
<span class="line"><span style="color:#79B8FF;">        this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">render</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">    // 初始化控制界面</span></span>
<span class="line"><span style="color:#B392F0;">    initControls</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#79B8FF;">        this</span><span style="color:#E1E4E8;">.controls </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> document.</span><span style="color:#B392F0;">createElement</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;div&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#79B8FF;">        this</span><span style="color:#E1E4E8;">.controls.className </span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;"> &#39;visualizer-controls&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#79B8FF;">        this</span><span style="color:#E1E4E8;">.controls.innerHTML </span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;"> \`</span></span>
<span class="line"><span style="color:#9ECBFF;">            &lt;button id=&quot;play-pause&quot;&gt;▶&lt;/button&gt;</span></span>
<span class="line"><span style="color:#9ECBFF;">            &lt;button id=&quot;step-back&quot;&gt;⏮&lt;/button&gt;</span></span>
<span class="line"><span style="color:#9ECBFF;">            &lt;button id=&quot;step-forward&quot;&gt;⏭&lt;/button&gt;</span></span>
<span class="line"><span style="color:#9ECBFF;">            &lt;input type=&quot;range&quot; id=&quot;speed&quot; min=&quot;0.1&quot; max=&quot;5&quot; step=&quot;0.1&quot; value=&quot;\${</span><span style="color:#79B8FF;">this</span><span style="color:#9ECBFF;">.</span><span style="color:#E1E4E8;">options</span><span style="color:#9ECBFF;">.</span><span style="color:#E1E4E8;">speed</span><span style="color:#9ECBFF;">}&quot;&gt;</span></span>
<span class="line"><span style="color:#9ECBFF;">            &lt;span id=&quot;step-counter&quot;&gt;步骤: 0/0&lt;/span&gt;</span></span>
<span class="line"><span style="color:#9ECBFF;">        \`</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#79B8FF;">        this</span><span style="color:#E1E4E8;">.container.</span><span style="color:#B392F0;">appendChild</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.controls);</span></span>
<span class="line"><span style="color:#79B8FF;">        this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">bindControlEvents</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">    // 绑定控制事件</span></span>
<span class="line"><span style="color:#B392F0;">    bindControlEvents</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#E1E4E8;">        document.</span><span style="color:#B392F0;">getElementById</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;play-pause&#39;</span><span style="color:#E1E4E8;">).</span><span style="color:#B392F0;">addEventListener</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;click&#39;</span><span style="color:#E1E4E8;">, () </span><span style="color:#F97583;">=&gt;</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">togglePlay</span><span style="color:#E1E4E8;">());</span></span>
<span class="line"><span style="color:#E1E4E8;">        document.</span><span style="color:#B392F0;">getElementById</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;step-back&#39;</span><span style="color:#E1E4E8;">).</span><span style="color:#B392F0;">addEventListener</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;click&#39;</span><span style="color:#E1E4E8;">, () </span><span style="color:#F97583;">=&gt;</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">stepBack</span><span style="color:#E1E4E8;">());</span></span>
<span class="line"><span style="color:#E1E4E8;">        document.</span><span style="color:#B392F0;">getElementById</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;step-forward&#39;</span><span style="color:#E1E4E8;">).</span><span style="color:#B392F0;">addEventListener</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;click&#39;</span><span style="color:#E1E4E8;">, () </span><span style="color:#F97583;">=&gt;</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">stepForward</span><span style="color:#E1E4E8;">());</span></span>
<span class="line"><span style="color:#E1E4E8;">        document.</span><span style="color:#B392F0;">getElementById</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;speed&#39;</span><span style="color:#E1E4E8;">).</span><span style="color:#B392F0;">addEventListener</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;input&#39;</span><span style="color:#E1E4E8;">, (</span><span style="color:#FFAB70;">e</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#79B8FF;">            this</span><span style="color:#E1E4E8;">.options.speed </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> parseFloat</span><span style="color:#E1E4E8;">(e.target.value);</span></span>
<span class="line"><span style="color:#E1E4E8;">        });</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">    // 记录算法状态</span></span>
<span class="line"><span style="color:#B392F0;">    recordState</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">data</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">highlights</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> [], </span><span style="color:#FFAB70;">metadata</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> {}) {</span></span>
<span class="line"><span style="color:#79B8FF;">        this</span><span style="color:#E1E4E8;">.states.</span><span style="color:#B392F0;">push</span><span style="color:#E1E4E8;">({</span></span>
<span class="line"><span style="color:#E1E4E8;">            data: [</span><span style="color:#F97583;">...</span><span style="color:#E1E4E8;">data],</span></span>
<span class="line"><span style="color:#E1E4E8;">            highlights: [</span><span style="color:#F97583;">...</span><span style="color:#E1E4E8;">highlights],</span></span>
<span class="line"><span style="color:#E1E4E8;">            metadata: { </span><span style="color:#F97583;">...</span><span style="color:#E1E4E8;">metadata, step: </span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.states.</span><span style="color:#79B8FF;">length</span><span style="color:#E1E4E8;"> }</span></span>
<span class="line"><span style="color:#E1E4E8;">        });</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">    // 播放控制</span></span>
<span class="line"><span style="color:#B392F0;">    togglePlay</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#79B8FF;">        this</span><span style="color:#E1E4E8;">.isPlaying </span><span style="color:#F97583;">=</span><span style="color:#F97583;"> !</span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.isPlaying;</span></span>
<span class="line"><span style="color:#F97583;">        const</span><span style="color:#79B8FF;"> button</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> document.</span><span style="color:#B392F0;">getElementById</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;play-pause&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">        button.textContent </span><span style="color:#F97583;">=</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.isPlaying </span><span style="color:#F97583;">?</span><span style="color:#9ECBFF;"> &#39;⏸&#39;</span><span style="color:#F97583;"> :</span><span style="color:#9ECBFF;"> &#39;▶&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#F97583;">        if</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.isPlaying) {</span></span>
<span class="line"><span style="color:#79B8FF;">            this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">play</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">        } </span><span style="color:#F97583;">else</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#79B8FF;">            this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">pause</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">    play</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#F97583;">        const</span><span style="color:#B392F0;"> playStep</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> () </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#F97583;">            if</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.isPlaying </span><span style="color:#F97583;">&amp;&amp;</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.currentStep </span><span style="color:#F97583;">&lt;</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.states.</span><span style="color:#79B8FF;">length</span><span style="color:#F97583;"> -</span><span style="color:#79B8FF;"> 1</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#79B8FF;">                this</span><span style="color:#E1E4E8;">.currentStep</span><span style="color:#F97583;">++</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#79B8FF;">                this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">render</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#79B8FF;">                this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">updateStepCounter</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span></span>
<span class="line"><span style="color:#F97583;">                const</span><span style="color:#79B8FF;"> delay</span><span style="color:#F97583;"> =</span><span style="color:#79B8FF;"> 1000</span><span style="color:#F97583;"> /</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.options.speed;</span></span>
<span class="line"><span style="color:#79B8FF;">                this</span><span style="color:#E1E4E8;">.animationFrameId </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> setTimeout</span><span style="color:#E1E4E8;">(playStep, delay);</span></span>
<span class="line"><span style="color:#E1E4E8;">            } </span><span style="color:#F97583;">else</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#79B8FF;">                this</span><span style="color:#E1E4E8;">.isPlaying </span><span style="color:#F97583;">=</span><span style="color:#79B8FF;"> false</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">                document.</span><span style="color:#B392F0;">getElementById</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;play-pause&#39;</span><span style="color:#E1E4E8;">).textContent </span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;"> &#39;▶&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span>
<span class="line"><span style="color:#E1E4E8;">        };</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#B392F0;">        playStep</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">    pause</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#F97583;">        if</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.animationFrameId) {</span></span>
<span class="line"><span style="color:#B392F0;">            clearTimeout</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.animationFrameId);</span></span>
<span class="line"><span style="color:#79B8FF;">            this</span><span style="color:#E1E4E8;">.animationFrameId </span><span style="color:#F97583;">=</span><span style="color:#79B8FF;"> null</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">    stepForward</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#F97583;">        if</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.currentStep </span><span style="color:#F97583;">&lt;</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.states.</span><span style="color:#79B8FF;">length</span><span style="color:#F97583;"> -</span><span style="color:#79B8FF;"> 1</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#79B8FF;">            this</span><span style="color:#E1E4E8;">.currentStep</span><span style="color:#F97583;">++</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#79B8FF;">            this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">render</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#79B8FF;">            this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">updateStepCounter</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">    stepBack</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#F97583;">        if</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.currentStep </span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> 0</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#79B8FF;">            this</span><span style="color:#E1E4E8;">.currentStep</span><span style="color:#F97583;">--</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#79B8FF;">            this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">render</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#79B8FF;">            this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">updateStepCounter</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">    updateStepCounter</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#F97583;">        const</span><span style="color:#79B8FF;"> counter</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> document.</span><span style="color:#B392F0;">getElementById</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;step-counter&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">        counter.textContent </span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;"> \`步骤: \${</span><span style="color:#79B8FF;">this</span><span style="color:#9ECBFF;">.</span><span style="color:#E1E4E8;">currentStep</span><span style="color:#9ECBFF;">}/\${</span><span style="color:#79B8FF;">this</span><span style="color:#9ECBFF;">.</span><span style="color:#E1E4E8;">states</span><span style="color:#9ECBFF;">.</span><span style="color:#79B8FF;">length</span><span style="color:#F97583;"> -</span><span style="color:#79B8FF;"> 1</span><span style="color:#9ECBFF;">}\`</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">    // 抽象渲染方法 - 由子类实现</span></span>
<span class="line"><span style="color:#B392F0;">    render</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#F97583;">        throw</span><span style="color:#F97583;"> new</span><span style="color:#B392F0;"> Error</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;render method must be implemented by subclass&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre></div><h3 id="排序算法可视化器" tabindex="-1">排序算法可视化器 <a class="header-anchor" href="#排序算法可视化器" aria-label="Permalink to &quot;排序算法可视化器&quot;">​</a></h3><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;">// 排序算法可视化器</span></span>
<span class="line"><span style="color:#F97583;">export</span><span style="color:#F97583;"> class</span><span style="color:#B392F0;"> SortingVisualizer</span><span style="color:#F97583;"> extends</span><span style="color:#B392F0;"> AlgorithmVisualizer</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#F97583;">    constructor</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">container</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">options</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> {}) {</span></span>
<span class="line"><span style="color:#79B8FF;">        super</span><span style="color:#E1E4E8;">(container, options);</span></span>
<span class="line"><span style="color:#79B8FF;">        this</span><span style="color:#E1E4E8;">.data </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> [];</span></span>
<span class="line"><span style="color:#79B8FF;">        this</span><span style="color:#E1E4E8;">.maxValue </span><span style="color:#F97583;">=</span><span style="color:#79B8FF;"> 1</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">    // 初始化数据</span></span>
<span class="line"><span style="color:#B392F0;">    initData</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">size</span><span style="color:#F97583;"> =</span><span style="color:#79B8FF;"> 20</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">dataType</span><span style="color:#F97583;"> =</span><span style="color:#9ECBFF;"> &#39;random&#39;</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#79B8FF;">        this</span><span style="color:#E1E4E8;">.data </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> [];</span></span>
<span class="line"><span style="color:#79B8FF;">        this</span><span style="color:#E1E4E8;">.states </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> [];</span></span>
<span class="line"><span style="color:#79B8FF;">        this</span><span style="color:#E1E4E8;">.currentStep </span><span style="color:#F97583;">=</span><span style="color:#79B8FF;"> 0</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#F97583;">        switch</span><span style="color:#E1E4E8;"> (dataType) {</span></span>
<span class="line"><span style="color:#F97583;">            case</span><span style="color:#9ECBFF;"> &#39;random&#39;</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#79B8FF;">                this</span><span style="color:#E1E4E8;">.data </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> Array.</span><span style="color:#B392F0;">from</span><span style="color:#E1E4E8;">({ length: size }, () </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#E1E4E8;">                    Math.</span><span style="color:#B392F0;">floor</span><span style="color:#E1E4E8;">(Math.</span><span style="color:#B392F0;">random</span><span style="color:#E1E4E8;">() </span><span style="color:#F97583;">*</span><span style="color:#79B8FF;"> 100</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">+</span><span style="color:#79B8FF;"> 1</span></span>
<span class="line"><span style="color:#E1E4E8;">                );</span></span>
<span class="line"><span style="color:#F97583;">                break</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">            case</span><span style="color:#9ECBFF;"> &#39;sorted&#39;</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#79B8FF;">                this</span><span style="color:#E1E4E8;">.data </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> Array.</span><span style="color:#B392F0;">from</span><span style="color:#E1E4E8;">({ length: size }, (</span><span style="color:#FFAB70;">_</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">i</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> i </span><span style="color:#F97583;">+</span><span style="color:#79B8FF;"> 1</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#F97583;">                break</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">            case</span><span style="color:#9ECBFF;"> &#39;reversed&#39;</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#79B8FF;">                this</span><span style="color:#E1E4E8;">.data </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> Array.</span><span style="color:#B392F0;">from</span><span style="color:#E1E4E8;">({ length: size }, (</span><span style="color:#FFAB70;">_</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">i</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> size </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> i);</span></span>
<span class="line"><span style="color:#F97583;">                break</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">            case</span><span style="color:#9ECBFF;"> &#39;nearly-sorted&#39;</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#79B8FF;">                this</span><span style="color:#E1E4E8;">.data </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> Array.</span><span style="color:#B392F0;">from</span><span style="color:#E1E4E8;">({ length: size }, (</span><span style="color:#FFAB70;">_</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">i</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> i </span><span style="color:#F97583;">+</span><span style="color:#79B8FF;"> 1</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#6A737D;">                // 随机交换几对元素</span></span>
<span class="line"><span style="color:#F97583;">                for</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> i </span><span style="color:#F97583;">=</span><span style="color:#79B8FF;"> 0</span><span style="color:#E1E4E8;">; i </span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;"> size </span><span style="color:#F97583;">/</span><span style="color:#79B8FF;"> 10</span><span style="color:#E1E4E8;">; i</span><span style="color:#F97583;">++</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#F97583;">                    const</span><span style="color:#79B8FF;"> a</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> Math.</span><span style="color:#B392F0;">floor</span><span style="color:#E1E4E8;">(Math.</span><span style="color:#B392F0;">random</span><span style="color:#E1E4E8;">() </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> size);</span></span>
<span class="line"><span style="color:#F97583;">                    const</span><span style="color:#79B8FF;"> b</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> Math.</span><span style="color:#B392F0;">floor</span><span style="color:#E1E4E8;">(Math.</span><span style="color:#B392F0;">random</span><span style="color:#E1E4E8;">() </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> size);</span></span>
<span class="line"><span style="color:#E1E4E8;">                    [</span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.data[a], </span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.data[b]] </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> [</span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.data[b], </span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.data[a]];</span></span>
<span class="line"><span style="color:#E1E4E8;">                }</span></span>
<span class="line"><span style="color:#F97583;">                break</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#79B8FF;">        this</span><span style="color:#E1E4E8;">.maxValue </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> Math.</span><span style="color:#B392F0;">max</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">...</span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.data);</span></span>
<span class="line"><span style="color:#79B8FF;">        this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">recordState</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.data, [], { type: </span><span style="color:#9ECBFF;">&#39;initial&#39;</span><span style="color:#E1E4E8;"> });</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">    // 可视化冒泡排序</span></span>
<span class="line"><span style="color:#F97583;">    *</span><span style="color:#B392F0;">bubbleSort</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#F97583;">        const</span><span style="color:#79B8FF;"> arr</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> [</span><span style="color:#F97583;">...</span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.data];</span></span>
<span class="line"><span style="color:#F97583;">        const</span><span style="color:#79B8FF;"> n</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> arr.</span><span style="color:#79B8FF;">length</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#F97583;">        for</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> i </span><span style="color:#F97583;">=</span><span style="color:#79B8FF;"> 0</span><span style="color:#E1E4E8;">; i </span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;"> n </span><span style="color:#F97583;">-</span><span style="color:#79B8FF;"> 1</span><span style="color:#E1E4E8;">; i</span><span style="color:#F97583;">++</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#F97583;">            for</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> j </span><span style="color:#F97583;">=</span><span style="color:#79B8FF;"> 0</span><span style="color:#E1E4E8;">; j </span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;"> n </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> i </span><span style="color:#F97583;">-</span><span style="color:#79B8FF;"> 1</span><span style="color:#E1E4E8;">; j</span><span style="color:#F97583;">++</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#6A737D;">                // 高亮比较的元素</span></span>
<span class="line"><span style="color:#79B8FF;">                this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">recordState</span><span style="color:#E1E4E8;">(arr, [j, j </span><span style="color:#F97583;">+</span><span style="color:#79B8FF;"> 1</span><span style="color:#E1E4E8;">], { </span></span>
<span class="line"><span style="color:#E1E4E8;">                    type: </span><span style="color:#9ECBFF;">&#39;compare&#39;</span><span style="color:#E1E4E8;">, </span></span>
<span class="line"><span style="color:#E1E4E8;">                    indices: [j, j </span><span style="color:#F97583;">+</span><span style="color:#79B8FF;"> 1</span><span style="color:#E1E4E8;">] </span></span>
<span class="line"><span style="color:#E1E4E8;">                });</span></span>
<span class="line"><span style="color:#F97583;">                yield</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span></span>
<span class="line"><span style="color:#F97583;">                if</span><span style="color:#E1E4E8;"> (arr[j] </span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> arr[j </span><span style="color:#F97583;">+</span><span style="color:#79B8FF;"> 1</span><span style="color:#E1E4E8;">]) {</span></span>
<span class="line"><span style="color:#6A737D;">                    // 交换元素</span></span>
<span class="line"><span style="color:#E1E4E8;">                    [arr[j], arr[j </span><span style="color:#F97583;">+</span><span style="color:#79B8FF;"> 1</span><span style="color:#E1E4E8;">]] </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> [arr[j </span><span style="color:#F97583;">+</span><span style="color:#79B8FF;"> 1</span><span style="color:#E1E4E8;">], arr[j]];</span></span>
<span class="line"><span style="color:#79B8FF;">                    this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">recordState</span><span style="color:#E1E4E8;">(arr, [j, j </span><span style="color:#F97583;">+</span><span style="color:#79B8FF;"> 1</span><span style="color:#E1E4E8;">], { </span></span>
<span class="line"><span style="color:#E1E4E8;">                        type: </span><span style="color:#9ECBFF;">&#39;swap&#39;</span><span style="color:#E1E4E8;">, </span></span>
<span class="line"><span style="color:#E1E4E8;">                        indices: [j, j </span><span style="color:#F97583;">+</span><span style="color:#79B8FF;"> 1</span><span style="color:#E1E4E8;">] </span></span>
<span class="line"><span style="color:#E1E4E8;">                    });</span></span>
<span class="line"><span style="color:#F97583;">                    yield</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">                }</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span>
<span class="line"><span style="color:#6A737D;">            // 标记已排序的元素</span></span>
<span class="line"><span style="color:#79B8FF;">            this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">recordState</span><span style="color:#E1E4E8;">(arr, [], { </span></span>
<span class="line"><span style="color:#E1E4E8;">                type: </span><span style="color:#9ECBFF;">&#39;sorted&#39;</span><span style="color:#E1E4E8;">, </span></span>
<span class="line"><span style="color:#E1E4E8;">                indices: [n </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> i </span><span style="color:#F97583;">-</span><span style="color:#79B8FF;"> 1</span><span style="color:#E1E4E8;">, n </span><span style="color:#F97583;">-</span><span style="color:#79B8FF;"> 1</span><span style="color:#E1E4E8;">] </span></span>
<span class="line"><span style="color:#E1E4E8;">            });</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#79B8FF;">        this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">recordState</span><span style="color:#E1E4E8;">(arr, [], { type: </span><span style="color:#9ECBFF;">&#39;complete&#39;</span><span style="color:#E1E4E8;"> });</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">    // 可视化快速排序</span></span>
<span class="line"><span style="color:#F97583;">    *</span><span style="color:#B392F0;">quickSort</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">low</span><span style="color:#F97583;"> =</span><span style="color:#79B8FF;"> 0</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">high</span><span style="color:#F97583;"> =</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.data.</span><span style="color:#79B8FF;">length</span><span style="color:#F97583;"> -</span><span style="color:#79B8FF;"> 1</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">arr</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> [</span><span style="color:#F97583;">...</span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.data]) {</span></span>
<span class="line"><span style="color:#F97583;">        if</span><span style="color:#E1E4E8;"> (low </span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;"> high) {</span></span>
<span class="line"><span style="color:#F97583;">            const</span><span style="color:#79B8FF;"> pivotIndex</span><span style="color:#F97583;"> =</span><span style="color:#F97583;"> yield*</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">partition</span><span style="color:#E1E4E8;">(low, high, arr);</span></span>
<span class="line"><span style="color:#F97583;">            yield*</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">quickSort</span><span style="color:#E1E4E8;">(low, pivotIndex </span><span style="color:#F97583;">-</span><span style="color:#79B8FF;"> 1</span><span style="color:#E1E4E8;">, arr);</span></span>
<span class="line"><span style="color:#F97583;">            yield*</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">quickSort</span><span style="color:#E1E4E8;">(pivotIndex </span><span style="color:#F97583;">+</span><span style="color:#79B8FF;"> 1</span><span style="color:#E1E4E8;">, high, arr);</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#F97583;">        if</span><span style="color:#E1E4E8;"> (low </span><span style="color:#F97583;">===</span><span style="color:#79B8FF;"> 0</span><span style="color:#F97583;"> &amp;&amp;</span><span style="color:#E1E4E8;"> high </span><span style="color:#F97583;">===</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.data.</span><span style="color:#79B8FF;">length</span><span style="color:#F97583;"> -</span><span style="color:#79B8FF;"> 1</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#79B8FF;">            this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">recordState</span><span style="color:#E1E4E8;">(arr, [], { type: </span><span style="color:#9ECBFF;">&#39;complete&#39;</span><span style="color:#E1E4E8;"> });</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">    *</span><span style="color:#B392F0;">partition</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">low</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">high</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">arr</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#F97583;">        const</span><span style="color:#79B8FF;"> pivot</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> arr[high];</span></span>
<span class="line"><span style="color:#F97583;">        let</span><span style="color:#E1E4E8;"> i </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> low </span><span style="color:#F97583;">-</span><span style="color:#79B8FF;"> 1</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#79B8FF;">        this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">recordState</span><span style="color:#E1E4E8;">(arr, [high], { type: </span><span style="color:#9ECBFF;">&#39;pivot&#39;</span><span style="color:#E1E4E8;">, index: high });</span></span>
<span class="line"><span style="color:#F97583;">        yield</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#F97583;">        for</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> j </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> low; j </span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;"> high; j</span><span style="color:#F97583;">++</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#79B8FF;">            this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">recordState</span><span style="color:#E1E4E8;">(arr, [j, high], { type: </span><span style="color:#9ECBFF;">&#39;compare&#39;</span><span style="color:#E1E4E8;">, indices: [j, high] });</span></span>
<span class="line"><span style="color:#F97583;">            yield</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span></span>
<span class="line"><span style="color:#F97583;">            if</span><span style="color:#E1E4E8;"> (arr[j] </span><span style="color:#F97583;">&lt;=</span><span style="color:#E1E4E8;"> pivot) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                i</span><span style="color:#F97583;">++</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">                [arr[i], arr[j]] </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> [arr[j], arr[i]];</span></span>
<span class="line"><span style="color:#79B8FF;">                this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">recordState</span><span style="color:#E1E4E8;">(arr, [i, j], { type: </span><span style="color:#9ECBFF;">&#39;swap&#39;</span><span style="color:#E1E4E8;">, indices: [i, j] });</span></span>
<span class="line"><span style="color:#F97583;">                yield</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#E1E4E8;">        [arr[i </span><span style="color:#F97583;">+</span><span style="color:#79B8FF;"> 1</span><span style="color:#E1E4E8;">], arr[high]] </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> [arr[high], arr[i </span><span style="color:#F97583;">+</span><span style="color:#79B8FF;"> 1</span><span style="color:#E1E4E8;">]];</span></span>
<span class="line"><span style="color:#79B8FF;">        this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">recordState</span><span style="color:#E1E4E8;">(arr, [i </span><span style="color:#F97583;">+</span><span style="color:#79B8FF;"> 1</span><span style="color:#E1E4E8;">, high], { type: </span><span style="color:#9ECBFF;">&#39;swap&#39;</span><span style="color:#E1E4E8;">, indices: [i </span><span style="color:#F97583;">+</span><span style="color:#79B8FF;"> 1</span><span style="color:#E1E4E8;">, high] });</span></span>
<span class="line"><span style="color:#F97583;">        yield</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#F97583;">        return</span><span style="color:#E1E4E8;"> i </span><span style="color:#F97583;">+</span><span style="color:#79B8FF;"> 1</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">    // 渲染排序可视化</span></span>
<span class="line"><span style="color:#B392F0;">    render</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#F97583;">        const</span><span style="color:#79B8FF;"> state</span><span style="color:#F97583;"> =</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.states[</span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.currentStep];</span></span>
<span class="line"><span style="color:#F97583;">        if</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">!</span><span style="color:#E1E4E8;">state) </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#F97583;">        const</span><span style="color:#E1E4E8;"> { </span><span style="color:#79B8FF;">data</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">highlights</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">metadata</span><span style="color:#E1E4E8;"> } </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> state;</span></span>
<span class="line"><span style="color:#F97583;">        const</span><span style="color:#79B8FF;"> ctx</span><span style="color:#F97583;"> =</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.ctx;</span></span>
<span class="line"><span style="color:#F97583;">        const</span><span style="color:#79B8FF;"> width</span><span style="color:#F97583;"> =</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.canvas.width;</span></span>
<span class="line"><span style="color:#F97583;">        const</span><span style="color:#79B8FF;"> height</span><span style="color:#F97583;"> =</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.canvas.height;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#E1E4E8;">        ctx.</span><span style="color:#B392F0;">clearRect</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">, width, height);</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#F97583;">        const</span><span style="color:#79B8FF;"> barWidth</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> width </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;"> data.</span><span style="color:#79B8FF;">length</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">        const</span><span style="color:#79B8FF;"> scale</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> height </span><span style="color:#F97583;">/</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.maxValue;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#6A737D;">        // 绘制数据条</span></span>
<span class="line"><span style="color:#E1E4E8;">        data.</span><span style="color:#B392F0;">forEach</span><span style="color:#E1E4E8;">((</span><span style="color:#FFAB70;">value</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">index</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#F97583;">            const</span><span style="color:#79B8FF;"> barHeight</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> value </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> scale;</span></span>
<span class="line"><span style="color:#F97583;">            const</span><span style="color:#79B8FF;"> x</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> index </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> barWidth;</span></span>
<span class="line"><span style="color:#F97583;">            const</span><span style="color:#79B8FF;"> y</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> height </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> barHeight;</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span></span>
<span class="line"><span style="color:#6A737D;">            // 确定颜色</span></span>
<span class="line"><span style="color:#F97583;">            let</span><span style="color:#E1E4E8;"> color </span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;"> &#39;#3498db&#39;</span><span style="color:#E1E4E8;">; </span><span style="color:#6A737D;">// 默认蓝色</span></span>
<span class="line"><span style="color:#F97583;">            if</span><span style="color:#E1E4E8;"> (metadata.type </span><span style="color:#F97583;">===</span><span style="color:#9ECBFF;"> &#39;complete&#39;</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                color </span><span style="color:#F97583;">=</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.options.sortedColor;</span></span>
<span class="line"><span style="color:#E1E4E8;">            } </span><span style="color:#F97583;">else</span><span style="color:#F97583;"> if</span><span style="color:#E1E4E8;"> (highlights.</span><span style="color:#B392F0;">includes</span><span style="color:#E1E4E8;">(index)) {</span></span>
<span class="line"><span style="color:#F97583;">                if</span><span style="color:#E1E4E8;"> (metadata.type </span><span style="color:#F97583;">===</span><span style="color:#9ECBFF;"> &#39;compare&#39;</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                    color </span><span style="color:#F97583;">=</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.options.compareColor;</span></span>
<span class="line"><span style="color:#E1E4E8;">                } </span><span style="color:#F97583;">else</span><span style="color:#F97583;"> if</span><span style="color:#E1E4E8;"> (metadata.type </span><span style="color:#F97583;">===</span><span style="color:#9ECBFF;"> &#39;swap&#39;</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                    color </span><span style="color:#F97583;">=</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.options.highlightColor;</span></span>
<span class="line"><span style="color:#E1E4E8;">                } </span><span style="color:#F97583;">else</span><span style="color:#F97583;"> if</span><span style="color:#E1E4E8;"> (metadata.type </span><span style="color:#F97583;">===</span><span style="color:#9ECBFF;"> &#39;pivot&#39;</span><span style="color:#F97583;"> &amp;&amp;</span><span style="color:#E1E4E8;"> metadata.index </span><span style="color:#F97583;">===</span><span style="color:#E1E4E8;"> index) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                    color </span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;"> &#39;#9b59b6&#39;</span><span style="color:#E1E4E8;">; </span><span style="color:#6A737D;">// 紫色表示枢轴</span></span>
<span class="line"><span style="color:#E1E4E8;">                }</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span></span>
<span class="line"><span style="color:#6A737D;">            // 绘制条形</span></span>
<span class="line"><span style="color:#E1E4E8;">            ctx.fillStyle </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> color;</span></span>
<span class="line"><span style="color:#E1E4E8;">            ctx.</span><span style="color:#B392F0;">fillRect</span><span style="color:#E1E4E8;">(x, y, barWidth </span><span style="color:#F97583;">-</span><span style="color:#79B8FF;"> 1</span><span style="color:#E1E4E8;">, barHeight);</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span></span>
<span class="line"><span style="color:#6A737D;">            // 绘制数值标签（如果空间足够）</span></span>
<span class="line"><span style="color:#F97583;">            if</span><span style="color:#E1E4E8;"> (barWidth </span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> 20</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                ctx.fillStyle </span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;"> &#39;#2c3e50&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">                ctx.font </span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;"> &#39;12px Arial&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">                ctx.textAlign </span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;"> &#39;center&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">                ctx.</span><span style="color:#B392F0;">fillText</span><span style="color:#E1E4E8;">(value, x </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> barWidth </span><span style="color:#F97583;">/</span><span style="color:#79B8FF;"> 2</span><span style="color:#E1E4E8;">, y </span><span style="color:#F97583;">-</span><span style="color:#79B8FF;"> 5</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span>
<span class="line"><span style="color:#E1E4E8;">        });</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#6A737D;">        // 绘制状态信息</span></span>
<span class="line"><span style="color:#E1E4E8;">        ctx.fillStyle </span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;"> &#39;#2c3e50&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">        ctx.font </span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;"> &#39;14px Arial&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">        ctx.textAlign </span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;"> &#39;left&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">        ctx.</span><span style="color:#B392F0;">fillText</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">\`操作: \${</span><span style="color:#79B8FF;">this</span><span style="color:#9ECBFF;">.</span><span style="color:#B392F0;">getOperationText</span><span style="color:#9ECBFF;">(</span><span style="color:#E1E4E8;">metadata</span><span style="color:#9ECBFF;">)</span><span style="color:#9ECBFF;">}\`</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">10</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">20</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">        ctx.</span><span style="color:#B392F0;">fillText</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">\`比较次数: \${</span><span style="color:#79B8FF;">this</span><span style="color:#9ECBFF;">.</span><span style="color:#B392F0;">getComparisonCount</span><span style="color:#9ECBFF;">()</span><span style="color:#9ECBFF;">}\`</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">10</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">40</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">        ctx.</span><span style="color:#B392F0;">fillText</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">\`交换次数: \${</span><span style="color:#79B8FF;">this</span><span style="color:#9ECBFF;">.</span><span style="color:#B392F0;">getSwapCount</span><span style="color:#9ECBFF;">()</span><span style="color:#9ECBFF;">}\`</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">10</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">60</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">    getOperationText</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">metadata</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#F97583;">        const</span><span style="color:#79B8FF;"> operations</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#9ECBFF;">            &#39;initial&#39;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&#39;初始化&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#9ECBFF;">            &#39;compare&#39;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&#39;比较元素&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#9ECBFF;">            &#39;swap&#39;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&#39;交换元素&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#9ECBFF;">            &#39;pivot&#39;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&#39;选择枢轴&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#9ECBFF;">            &#39;sorted&#39;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&#39;部分排序完成&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#9ECBFF;">            &#39;complete&#39;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&#39;排序完成&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">        };</span></span>
<span class="line"><span style="color:#F97583;">        return</span><span style="color:#E1E4E8;"> operations[metadata.type] </span><span style="color:#F97583;">||</span><span style="color:#E1E4E8;"> metadata.type;</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">    getComparisonCount</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#F97583;">        return</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.states.</span><span style="color:#B392F0;">slice</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.currentStep </span><span style="color:#F97583;">+</span><span style="color:#79B8FF;"> 1</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">            .</span><span style="color:#B392F0;">filter</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">state</span><span style="color:#F97583;"> =&gt;</span><span style="color:#E1E4E8;"> state.metadata.type </span><span style="color:#F97583;">===</span><span style="color:#9ECBFF;"> &#39;compare&#39;</span><span style="color:#E1E4E8;">).</span><span style="color:#79B8FF;">length</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">    getSwapCount</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#F97583;">        return</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.states.</span><span style="color:#B392F0;">slice</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.currentStep </span><span style="color:#F97583;">+</span><span style="color:#79B8FF;"> 1</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">            .</span><span style="color:#B392F0;">filter</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">state</span><span style="color:#F97583;"> =&gt;</span><span style="color:#E1E4E8;"> state.metadata.type </span><span style="color:#F97583;">===</span><span style="color:#9ECBFF;"> &#39;swap&#39;</span><span style="color:#E1E4E8;">).</span><span style="color:#79B8FF;">length</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre></div><h2 id="图形渲染技术" tabindex="-1">图形渲染技术 <a class="header-anchor" href="#图形渲染技术" aria-label="Permalink to &quot;图形渲染技术&quot;">​</a></h2><h3 id="canvas-高级渲染" tabindex="-1">Canvas 高级渲染 <a class="header-anchor" href="#canvas-高级渲染" aria-label="Permalink to &quot;Canvas 高级渲染&quot;">​</a></h3><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;">// 高级 Canvas 渲染器</span></span>
<span class="line"><span style="color:#F97583;">export</span><span style="color:#F97583;"> class</span><span style="color:#B392F0;"> AdvancedRenderer</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#F97583;">    constructor</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">canvas</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#79B8FF;">        this</span><span style="color:#E1E4E8;">.canvas </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> canvas;</span></span>
<span class="line"><span style="color:#79B8FF;">        this</span><span style="color:#E1E4E8;">.ctx </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> canvas.</span><span style="color:#B392F0;">getContext</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;2d&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#79B8FF;">        this</span><span style="color:#E1E4E8;">.animations </span><span style="color:#F97583;">=</span><span style="color:#F97583;"> new</span><span style="color:#B392F0;"> Map</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#79B8FF;">        this</span><span style="color:#E1E4E8;">.animationId </span><span style="color:#F97583;">=</span><span style="color:#79B8FF;"> 0</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">    // 绘制数组条形图</span></span>
<span class="line"><span style="color:#B392F0;">    drawBarChart</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">data</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">options</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> {}) {</span></span>
<span class="line"><span style="color:#F97583;">        const</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#79B8FF;">            x</span><span style="color:#F97583;"> =</span><span style="color:#79B8FF;"> 0</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#79B8FF;">            y</span><span style="color:#F97583;"> =</span><span style="color:#79B8FF;"> 0</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#79B8FF;">            width</span><span style="color:#F97583;"> =</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.canvas.width,</span></span>
<span class="line"><span style="color:#79B8FF;">            height</span><span style="color:#F97583;"> =</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.canvas.height,</span></span>
<span class="line"><span style="color:#79B8FF;">            colors</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> [</span><span style="color:#9ECBFF;">&#39;#3498db&#39;</span><span style="color:#E1E4E8;">],</span></span>
<span class="line"><span style="color:#79B8FF;">            spacing</span><span style="color:#F97583;"> =</span><span style="color:#79B8FF;"> 1</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#79B8FF;">            showValues</span><span style="color:#F97583;"> =</span><span style="color:#79B8FF;"> true</span></span>
<span class="line"><span style="color:#E1E4E8;">        } </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> options;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">        const</span><span style="color:#79B8FF;"> barWidth</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> (width </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> (data.</span><span style="color:#79B8FF;">length</span><span style="color:#F97583;"> -</span><span style="color:#79B8FF;"> 1</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> spacing) </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;"> data.</span><span style="color:#79B8FF;">length</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">        const</span><span style="color:#79B8FF;"> maxValue</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> Math.</span><span style="color:#B392F0;">max</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">...</span><span style="color:#E1E4E8;">data);</span></span>
<span class="line"><span style="color:#F97583;">        const</span><span style="color:#79B8FF;"> scale</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> height </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;"> maxValue;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">        data.</span><span style="color:#B392F0;">forEach</span><span style="color:#E1E4E8;">((</span><span style="color:#FFAB70;">value</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">index</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#F97583;">            const</span><span style="color:#79B8FF;"> barHeight</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> value </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> scale;</span></span>
<span class="line"><span style="color:#F97583;">            const</span><span style="color:#79B8FF;"> barX</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> x </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> index </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> (barWidth </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> spacing);</span></span>
<span class="line"><span style="color:#F97583;">            const</span><span style="color:#79B8FF;"> barY</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> y </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> height </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> barHeight;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">            // 选择颜色</span></span>
<span class="line"><span style="color:#F97583;">            const</span><span style="color:#79B8FF;"> color</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> Array.</span><span style="color:#B392F0;">isArray</span><span style="color:#E1E4E8;">(colors) </span><span style="color:#F97583;">?</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#E1E4E8;">                colors[index </span><span style="color:#F97583;">%</span><span style="color:#E1E4E8;"> colors.</span><span style="color:#79B8FF;">length</span><span style="color:#E1E4E8;">] </span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> colors;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">            // 绘制条形</span></span>
<span class="line"><span style="color:#79B8FF;">            this</span><span style="color:#E1E4E8;">.ctx.fillStyle </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> color;</span></span>
<span class="line"><span style="color:#79B8FF;">            this</span><span style="color:#E1E4E8;">.ctx.</span><span style="color:#B392F0;">fillRect</span><span style="color:#E1E4E8;">(barX, barY, barWidth, barHeight);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">            // 绘制边框</span></span>
<span class="line"><span style="color:#79B8FF;">            this</span><span style="color:#E1E4E8;">.ctx.strokeStyle </span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;"> &#39;#2c3e50&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#79B8FF;">            this</span><span style="color:#E1E4E8;">.ctx.lineWidth </span><span style="color:#F97583;">=</span><span style="color:#79B8FF;"> 1</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#79B8FF;">            this</span><span style="color:#E1E4E8;">.ctx.</span><span style="color:#B392F0;">strokeRect</span><span style="color:#E1E4E8;">(barX, barY, barWidth, barHeight);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">            // 绘制数值</span></span>
<span class="line"><span style="color:#F97583;">            if</span><span style="color:#E1E4E8;"> (showValues </span><span style="color:#F97583;">&amp;&amp;</span><span style="color:#E1E4E8;"> barWidth </span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> 25</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#79B8FF;">                this</span><span style="color:#E1E4E8;">.ctx.fillStyle </span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;"> &#39;#2c3e50&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#79B8FF;">                this</span><span style="color:#E1E4E8;">.ctx.font </span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;"> &#39;10px Arial&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#79B8FF;">                this</span><span style="color:#E1E4E8;">.ctx.textAlign </span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;"> &#39;center&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#79B8FF;">                this</span><span style="color:#E1E4E8;">.ctx.</span><span style="color:#B392F0;">fillText</span><span style="color:#E1E4E8;">(</span></span>
<span class="line"><span style="color:#E1E4E8;">                    value.</span><span style="color:#B392F0;">toString</span><span style="color:#E1E4E8;">(), </span></span>
<span class="line"><span style="color:#E1E4E8;">                    barX </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> barWidth </span><span style="color:#F97583;">/</span><span style="color:#79B8FF;"> 2</span><span style="color:#E1E4E8;">, </span></span>
<span class="line"><span style="color:#E1E4E8;">                    barY </span><span style="color:#F97583;">-</span><span style="color:#79B8FF;"> 5</span></span>
<span class="line"><span style="color:#E1E4E8;">                );</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span>
<span class="line"><span style="color:#E1E4E8;">        });</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">    // 绘制树形结构</span></span>
<span class="line"><span style="color:#B392F0;">    drawTree</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">root</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">options</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> {}) {</span></span>
<span class="line"><span style="color:#F97583;">        const</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#79B8FF;">            x</span><span style="color:#F97583;"> =</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.canvas.width </span><span style="color:#F97583;">/</span><span style="color:#79B8FF;"> 2</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#79B8FF;">            y</span><span style="color:#F97583;"> =</span><span style="color:#79B8FF;"> 50</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#79B8FF;">            nodeRadius</span><span style="color:#F97583;"> =</span><span style="color:#79B8FF;"> 20</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#79B8FF;">            levelHeight</span><span style="color:#F97583;"> =</span><span style="color:#79B8FF;"> 80</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#79B8FF;">            highlightNodes</span><span style="color:#F97583;"> =</span><span style="color:#F97583;"> new</span><span style="color:#B392F0;"> Set</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"><span style="color:#E1E4E8;">        } </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> options;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">        const</span><span style="color:#B392F0;"> drawNode</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> (</span><span style="color:#FFAB70;">node</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">x</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">y</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">level</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#6A737D;">            // 绘制连接线（先绘制线，再绘制节点）</span></span>
<span class="line"><span style="color:#F97583;">            if</span><span style="color:#E1E4E8;"> (node.left) {</span></span>
<span class="line"><span style="color:#F97583;">                const</span><span style="color:#79B8FF;"> childX</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> x </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.canvas.width </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;"> Math.</span><span style="color:#B392F0;">pow</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">, level </span><span style="color:#F97583;">+</span><span style="color:#79B8FF;"> 2</span><span style="color:#E1E4E8;">));</span></span>
<span class="line"><span style="color:#F97583;">                const</span><span style="color:#79B8FF;"> childY</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> y </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> levelHeight;</span></span>
<span class="line"><span style="color:#79B8FF;">                this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">drawLine</span><span style="color:#E1E4E8;">(x, y </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> nodeRadius, childX, childY </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> nodeRadius);</span></span>
<span class="line"><span style="color:#B392F0;">                drawNode</span><span style="color:#E1E4E8;">(node.left, childX, childY, level </span><span style="color:#F97583;">+</span><span style="color:#79B8FF;"> 1</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span>
<span class="line"><span style="color:#F97583;">            if</span><span style="color:#E1E4E8;"> (node.right) {</span></span>
<span class="line"><span style="color:#F97583;">                const</span><span style="color:#79B8FF;"> childX</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> x </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.canvas.width </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;"> Math.</span><span style="color:#B392F0;">pow</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">, level </span><span style="color:#F97583;">+</span><span style="color:#79B8FF;"> 2</span><span style="color:#E1E4E8;">));</span></span>
<span class="line"><span style="color:#F97583;">                const</span><span style="color:#79B8FF;"> childY</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> y </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> levelHeight;</span></span>
<span class="line"><span style="color:#79B8FF;">                this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">drawLine</span><span style="color:#E1E4E8;">(x, y </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> nodeRadius, childX, childY </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> nodeRadius);</span></span>
<span class="line"><span style="color:#B392F0;">                drawNode</span><span style="color:#E1E4E8;">(node.right, childX, childY, level </span><span style="color:#F97583;">+</span><span style="color:#79B8FF;"> 1</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">            // 绘制节点</span></span>
<span class="line"><span style="color:#F97583;">            const</span><span style="color:#79B8FF;"> isHighlighted</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> highlightNodes.</span><span style="color:#B392F0;">has</span><span style="color:#E1E4E8;">(node.value);</span></span>
<span class="line"><span style="color:#79B8FF;">            this</span><span style="color:#E1E4E8;">.ctx.fillStyle </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> isHighlighted </span><span style="color:#F97583;">?</span><span style="color:#9ECBFF;"> &#39;#e74c3c&#39;</span><span style="color:#F97583;"> :</span><span style="color:#9ECBFF;"> &#39;#3498db&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#79B8FF;">            this</span><span style="color:#E1E4E8;">.ctx.</span><span style="color:#B392F0;">beginPath</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#79B8FF;">            this</span><span style="color:#E1E4E8;">.ctx.</span><span style="color:#B392F0;">arc</span><span style="color:#E1E4E8;">(x, y, nodeRadius, </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">2</span><span style="color:#F97583;"> *</span><span style="color:#E1E4E8;"> Math.</span><span style="color:#79B8FF;">PI</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#79B8FF;">            this</span><span style="color:#E1E4E8;">.ctx.</span><span style="color:#B392F0;">fill</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">            // 绘制节点边框</span></span>
<span class="line"><span style="color:#79B8FF;">            this</span><span style="color:#E1E4E8;">.ctx.strokeStyle </span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;"> &#39;#2c3e50&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#79B8FF;">            this</span><span style="color:#E1E4E8;">.ctx.lineWidth </span><span style="color:#F97583;">=</span><span style="color:#79B8FF;"> 2</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#79B8FF;">            this</span><span style="color:#E1E4E8;">.ctx.</span><span style="color:#B392F0;">stroke</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">            // 绘制节点值</span></span>
<span class="line"><span style="color:#79B8FF;">            this</span><span style="color:#E1E4E8;">.ctx.fillStyle </span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;"> &#39;white&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#79B8FF;">            this</span><span style="color:#E1E4E8;">.ctx.font </span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;"> &#39;12px Arial&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#79B8FF;">            this</span><span style="color:#E1E4E8;">.ctx.textAlign </span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;"> &#39;center&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#79B8FF;">            this</span><span style="color:#E1E4E8;">.ctx.textBaseline </span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;"> &#39;middle&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#79B8FF;">            this</span><span style="color:#E1E4E8;">.ctx.</span><span style="color:#B392F0;">fillText</span><span style="color:#E1E4E8;">(node.value.</span><span style="color:#B392F0;">toString</span><span style="color:#E1E4E8;">(), x, y);</span></span>
<span class="line"><span style="color:#E1E4E8;">        };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">        drawNode</span><span style="color:#E1E4E8;">(root, x, y, </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">    // 绘制连接线</span></span>
<span class="line"><span style="color:#B392F0;">    drawLine</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">x1</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">y1</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">x2</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">y2</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">options</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> {}) {</span></span>
<span class="line"><span style="color:#F97583;">        const</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#79B8FF;">            color</span><span style="color:#F97583;"> =</span><span style="color:#9ECBFF;"> &#39;#95a5a6&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#79B8FF;">            width</span><span style="color:#F97583;"> =</span><span style="color:#79B8FF;"> 2</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#79B8FF;">            dash</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> []</span></span>
<span class="line"><span style="color:#E1E4E8;">        } </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> options;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#79B8FF;">        this</span><span style="color:#E1E4E8;">.ctx.strokeStyle </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> color;</span></span>
<span class="line"><span style="color:#79B8FF;">        this</span><span style="color:#E1E4E8;">.ctx.lineWidth </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> width;</span></span>
<span class="line"><span style="color:#79B8FF;">        this</span><span style="color:#E1E4E8;">.ctx.</span><span style="color:#B392F0;">setLineDash</span><span style="color:#E1E4E8;">(dash);</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#79B8FF;">        this</span><span style="color:#E1E4E8;">.ctx.</span><span style="color:#B392F0;">beginPath</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#79B8FF;">        this</span><span style="color:#E1E4E8;">.ctx.</span><span style="color:#B392F0;">moveTo</span><span style="color:#E1E4E8;">(x1, y1);</span></span>
<span class="line"><span style="color:#79B8FF;">        this</span><span style="color:#E1E4E8;">.ctx.</span><span style="color:#B392F0;">lineTo</span><span style="color:#E1E4E8;">(x2, y2);</span></span>
<span class="line"><span style="color:#79B8FF;">        this</span><span style="color:#E1E4E8;">.ctx.</span><span style="color:#B392F0;">stroke</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#79B8FF;">        this</span><span style="color:#E1E4E8;">.ctx.</span><span style="color:#B392F0;">setLineDash</span><span style="color:#E1E4E8;">([]); </span><span style="color:#6A737D;">// 重置虚线</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">    // 平滑动画</span></span>
<span class="line"><span style="color:#B392F0;">    animateValue</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">start</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">end</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">duration</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">updateCallback</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">easing</span><span style="color:#F97583;"> =</span><span style="color:#9ECBFF;"> &#39;easeInOut&#39;</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#F97583;">        const</span><span style="color:#79B8FF;"> startTime</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> performance.</span><span style="color:#B392F0;">now</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#F97583;">        const</span><span style="color:#79B8FF;"> animationId</span><span style="color:#F97583;"> =</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.animationId</span><span style="color:#F97583;">++</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#F97583;">        const</span><span style="color:#79B8FF;"> easingFunctions</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#B392F0;">            linear</span><span style="color:#E1E4E8;">: </span><span style="color:#FFAB70;">t</span><span style="color:#F97583;"> =&gt;</span><span style="color:#E1E4E8;"> t,</span></span>
<span class="line"><span style="color:#B392F0;">            easeIn</span><span style="color:#E1E4E8;">: </span><span style="color:#FFAB70;">t</span><span style="color:#F97583;"> =&gt;</span><span style="color:#E1E4E8;"> t </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> t,</span></span>
<span class="line"><span style="color:#B392F0;">            easeOut</span><span style="color:#E1E4E8;">: </span><span style="color:#FFAB70;">t</span><span style="color:#F97583;"> =&gt;</span><span style="color:#E1E4E8;"> t </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">2</span><span style="color:#F97583;"> -</span><span style="color:#E1E4E8;"> t),</span></span>
<span class="line"><span style="color:#B392F0;">            easeInOut</span><span style="color:#E1E4E8;">: </span><span style="color:#FFAB70;">t</span><span style="color:#F97583;"> =&gt;</span><span style="color:#E1E4E8;"> t </span><span style="color:#F97583;">&lt;</span><span style="color:#79B8FF;"> 0.5</span><span style="color:#F97583;"> ?</span><span style="color:#79B8FF;"> 2</span><span style="color:#F97583;"> *</span><span style="color:#E1E4E8;"> t </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> t </span><span style="color:#F97583;">:</span><span style="color:#F97583;"> -</span><span style="color:#79B8FF;">1</span><span style="color:#F97583;"> +</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">4</span><span style="color:#F97583;"> -</span><span style="color:#79B8FF;"> 2</span><span style="color:#F97583;"> *</span><span style="color:#E1E4E8;"> t) </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> t</span></span>
<span class="line"><span style="color:#E1E4E8;">        };</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#F97583;">        const</span><span style="color:#79B8FF;"> ease</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> easingFunctions[easing] </span><span style="color:#F97583;">||</span><span style="color:#E1E4E8;"> easingFunctions.easeInOut;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#F97583;">        const</span><span style="color:#B392F0;"> animate</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> (</span><span style="color:#FFAB70;">currentTime</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#F97583;">            const</span><span style="color:#79B8FF;"> elapsed</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> currentTime </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> startTime;</span></span>
<span class="line"><span style="color:#F97583;">            const</span><span style="color:#79B8FF;"> progress</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> Math.</span><span style="color:#B392F0;">min</span><span style="color:#E1E4E8;">(elapsed </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;"> duration, </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#F97583;">            const</span><span style="color:#79B8FF;"> easedProgress</span><span style="color:#F97583;"> =</span><span style="color:#B392F0;"> ease</span><span style="color:#E1E4E8;">(progress);</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span></span>
<span class="line"><span style="color:#F97583;">            const</span><span style="color:#79B8FF;"> currentValue</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> start </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> (end </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> start) </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> easedProgress;</span></span>
<span class="line"><span style="color:#B392F0;">            updateCallback</span><span style="color:#E1E4E8;">(currentValue);</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span></span>
<span class="line"><span style="color:#F97583;">            if</span><span style="color:#E1E4E8;"> (progress </span><span style="color:#F97583;">&lt;</span><span style="color:#79B8FF;"> 1</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#79B8FF;">                this</span><span style="color:#E1E4E8;">.animations.</span><span style="color:#B392F0;">set</span><span style="color:#E1E4E8;">(animationId, </span><span style="color:#B392F0;">requestAnimationFrame</span><span style="color:#E1E4E8;">(animate));</span></span>
<span class="line"><span style="color:#E1E4E8;">            } </span><span style="color:#F97583;">else</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#79B8FF;">                this</span><span style="color:#E1E4E8;">.animations.</span><span style="color:#B392F0;">delete</span><span style="color:#E1E4E8;">(animationId);</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span>
<span class="line"><span style="color:#E1E4E8;">        };</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#79B8FF;">        this</span><span style="color:#E1E4E8;">.animations.</span><span style="color:#B392F0;">set</span><span style="color:#E1E4E8;">(animationId, </span><span style="color:#B392F0;">requestAnimationFrame</span><span style="color:#E1E4E8;">(animate));</span></span>
<span class="line"><span style="color:#F97583;">        return</span><span style="color:#E1E4E8;"> animationId;</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">    // 停止所有动画</span></span>
<span class="line"><span style="color:#B392F0;">    stopAllAnimations</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#79B8FF;">        this</span><span style="color:#E1E4E8;">.animations.</span><span style="color:#B392F0;">forEach</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">animationId</span><span style="color:#F97583;"> =&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#B392F0;">            cancelAnimationFrame</span><span style="color:#E1E4E8;">(animationId);</span></span>
<span class="line"><span style="color:#E1E4E8;">        });</span></span>
<span class="line"><span style="color:#79B8FF;">        this</span><span style="color:#E1E4E8;">.animations.</span><span style="color:#B392F0;">clear</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre></div><h3 id="图算法可视化" tabindex="-1">图算法可视化 <a class="header-anchor" href="#图算法可视化" aria-label="Permalink to &quot;图算法可视化&quot;">​</a></h3><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;">// 图算法可视化器</span></span>
<span class="line"><span style="color:#F97583;">export</span><span style="color:#F97583;"> class</span><span style="color:#B392F0;"> GraphVisualizer</span><span style="color:#F97583;"> extends</span><span style="color:#B392F0;"> AlgorithmVisualizer</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#F97583;">    constructor</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">container</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">options</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> {}) {</span></span>
<span class="line"><span style="color:#79B8FF;">        super</span><span style="color:#E1E4E8;">(container, {</span></span>
<span class="line"><span style="color:#E1E4E8;">            nodeRadius: </span><span style="color:#79B8FF;">20</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">            nodeColor: </span><span style="color:#9ECBFF;">&#39;#3498db&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">            edgeColor: </span><span style="color:#9ECBFF;">&#39;#bdc3c7&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">            visitedColor: </span><span style="color:#9ECBFF;">&#39;#e74c3c&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">            pathColor: </span><span style="color:#9ECBFF;">&#39;#2ecc71&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#F97583;">            ...</span><span style="color:#E1E4E8;">options</span></span>
<span class="line"><span style="color:#E1E4E8;">        });</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#79B8FF;">        this</span><span style="color:#E1E4E8;">.graph </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">            nodes: </span><span style="color:#F97583;">new</span><span style="color:#B392F0;"> Map</span><span style="color:#E1E4E8;">(),</span></span>
<span class="line"><span style="color:#E1E4E8;">            edges: </span><span style="color:#F97583;">new</span><span style="color:#B392F0;"> Map</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"><span style="color:#E1E4E8;">        };</span></span>
<span class="line"><span style="color:#79B8FF;">        this</span><span style="color:#E1E4E8;">.layout </span><span style="color:#F97583;">=</span><span style="color:#F97583;"> new</span><span style="color:#B392F0;"> ForceDirectedLayout</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">    // 添加节点</span></span>
<span class="line"><span style="color:#B392F0;">    addNode</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">id</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">data</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> {}) {</span></span>
<span class="line"><span style="color:#79B8FF;">        this</span><span style="color:#E1E4E8;">.graph.nodes.</span><span style="color:#B392F0;">set</span><span style="color:#E1E4E8;">(id, {</span></span>
<span class="line"><span style="color:#E1E4E8;">            id,</span></span>
<span class="line"><span style="color:#E1E4E8;">            x: Math.</span><span style="color:#B392F0;">random</span><span style="color:#E1E4E8;">() </span><span style="color:#F97583;">*</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.canvas.width,</span></span>
<span class="line"><span style="color:#E1E4E8;">            y: Math.</span><span style="color:#B392F0;">random</span><span style="color:#E1E4E8;">() </span><span style="color:#F97583;">*</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.canvas.height,</span></span>
<span class="line"><span style="color:#F97583;">            ...</span><span style="color:#E1E4E8;">data</span></span>
<span class="line"><span style="color:#E1E4E8;">        });</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">    // 添加边</span></span>
<span class="line"><span style="color:#B392F0;">    addEdge</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">from</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">to</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">weight</span><span style="color:#F97583;"> =</span><span style="color:#79B8FF;"> 1</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#F97583;">        const</span><span style="color:#79B8FF;"> edgeId</span><span style="color:#F97583;"> =</span><span style="color:#9ECBFF;"> \`\${</span><span style="color:#E1E4E8;">from</span><span style="color:#9ECBFF;">}-\${</span><span style="color:#E1E4E8;">to</span><span style="color:#9ECBFF;">}\`</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#79B8FF;">        this</span><span style="color:#E1E4E8;">.graph.edges.</span><span style="color:#B392F0;">set</span><span style="color:#E1E4E8;">(edgeId, { from, to, weight });</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">    // 可视化 BFS</span></span>
<span class="line"><span style="color:#F97583;">    *</span><span style="color:#B392F0;">bfs</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">startNode</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#F97583;">        const</span><span style="color:#79B8FF;"> visited</span><span style="color:#F97583;"> =</span><span style="color:#F97583;"> new</span><span style="color:#B392F0;"> Set</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#F97583;">        const</span><span style="color:#79B8FF;"> queue</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> [startNode];</span></span>
<span class="line"><span style="color:#E1E4E8;">        visited.</span><span style="color:#B392F0;">add</span><span style="color:#E1E4E8;">(startNode);</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#79B8FF;">        this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">recordState</span><span style="color:#E1E4E8;">({ current: startNode, visited: </span><span style="color:#F97583;">new</span><span style="color:#B392F0;"> Set</span><span style="color:#E1E4E8;">(visited) });</span></span>
<span class="line"><span style="color:#F97583;">        yield</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#F97583;">        while</span><span style="color:#E1E4E8;"> (queue.</span><span style="color:#79B8FF;">length</span><span style="color:#F97583;"> &gt;</span><span style="color:#79B8FF;"> 0</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#F97583;">            const</span><span style="color:#79B8FF;"> current</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> queue.</span><span style="color:#B392F0;">shift</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span></span>
<span class="line"><span style="color:#6A737D;">            // 获取邻居节点</span></span>
<span class="line"><span style="color:#F97583;">            const</span><span style="color:#79B8FF;"> neighbors</span><span style="color:#F97583;"> =</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">getNeighbors</span><span style="color:#E1E4E8;">(current);</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span></span>
<span class="line"><span style="color:#F97583;">            for</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">const</span><span style="color:#79B8FF;"> neighbor</span><span style="color:#F97583;"> of</span><span style="color:#E1E4E8;"> neighbors) {</span></span>
<span class="line"><span style="color:#F97583;">                if</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">!</span><span style="color:#E1E4E8;">visited.</span><span style="color:#B392F0;">has</span><span style="color:#E1E4E8;">(neighbor)) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                    visited.</span><span style="color:#B392F0;">add</span><span style="color:#E1E4E8;">(neighbor);</span></span>
<span class="line"><span style="color:#E1E4E8;">                    queue.</span><span style="color:#B392F0;">push</span><span style="color:#E1E4E8;">(neighbor);</span></span>
<span class="line"><span style="color:#E1E4E8;">                    </span></span>
<span class="line"><span style="color:#79B8FF;">                    this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">recordState</span><span style="color:#E1E4E8;">({ </span></span>
<span class="line"><span style="color:#E1E4E8;">                        current: neighbor, </span></span>
<span class="line"><span style="color:#E1E4E8;">                        visited: </span><span style="color:#F97583;">new</span><span style="color:#B392F0;"> Set</span><span style="color:#E1E4E8;">(visited),</span></span>
<span class="line"><span style="color:#E1E4E8;">                        processing: current </span></span>
<span class="line"><span style="color:#E1E4E8;">                    });</span></span>
<span class="line"><span style="color:#F97583;">                    yield</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">                }</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#79B8FF;">        this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">recordState</span><span style="color:#E1E4E8;">({ visited: </span><span style="color:#F97583;">new</span><span style="color:#B392F0;"> Set</span><span style="color:#E1E4E8;">(visited), complete: </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;"> });</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">    // 可视化 Dijkstra 算法</span></span>
<span class="line"><span style="color:#F97583;">    *</span><span style="color:#B392F0;">dijkstra</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">startNode</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#F97583;">        const</span><span style="color:#79B8FF;"> distances</span><span style="color:#F97583;"> =</span><span style="color:#F97583;"> new</span><span style="color:#B392F0;"> Map</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#F97583;">        const</span><span style="color:#79B8FF;"> visited</span><span style="color:#F97583;"> =</span><span style="color:#F97583;"> new</span><span style="color:#B392F0;"> Set</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#F97583;">        const</span><span style="color:#79B8FF;"> previous</span><span style="color:#F97583;"> =</span><span style="color:#F97583;"> new</span><span style="color:#B392F0;"> Map</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#6A737D;">        // 初始化距离</span></span>
<span class="line"><span style="color:#F97583;">        for</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">const</span><span style="color:#79B8FF;"> nodeId</span><span style="color:#F97583;"> of</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.graph.nodes.</span><span style="color:#B392F0;">keys</span><span style="color:#E1E4E8;">()) {</span></span>
<span class="line"><span style="color:#E1E4E8;">            distances.</span><span style="color:#B392F0;">set</span><span style="color:#E1E4E8;">(nodeId, nodeId </span><span style="color:#F97583;">===</span><span style="color:#E1E4E8;"> startNode </span><span style="color:#F97583;">?</span><span style="color:#79B8FF;"> 0</span><span style="color:#F97583;"> :</span><span style="color:#79B8FF;"> Infinity</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#F97583;">        while</span><span style="color:#E1E4E8;"> (visited.size </span><span style="color:#F97583;">&lt;</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.graph.nodes.size) {</span></span>
<span class="line"><span style="color:#6A737D;">            // 找到未访问的最小距离节点</span></span>
<span class="line"><span style="color:#F97583;">            let</span><span style="color:#E1E4E8;"> current </span><span style="color:#F97583;">=</span><span style="color:#79B8FF;"> null</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">            let</span><span style="color:#E1E4E8;"> minDistance </span><span style="color:#F97583;">=</span><span style="color:#79B8FF;"> Infinity</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span></span>
<span class="line"><span style="color:#F97583;">            for</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> [</span><span style="color:#79B8FF;">nodeId</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">distance</span><span style="color:#E1E4E8;">] </span><span style="color:#F97583;">of</span><span style="color:#E1E4E8;"> distances) {</span></span>
<span class="line"><span style="color:#F97583;">                if</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">!</span><span style="color:#E1E4E8;">visited.</span><span style="color:#B392F0;">has</span><span style="color:#E1E4E8;">(nodeId) </span><span style="color:#F97583;">&amp;&amp;</span><span style="color:#E1E4E8;"> distance </span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;"> minDistance) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                    minDistance </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> distance;</span></span>
<span class="line"><span style="color:#E1E4E8;">                    current </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> nodeId;</span></span>
<span class="line"><span style="color:#E1E4E8;">                }</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span></span>
<span class="line"><span style="color:#F97583;">            if</span><span style="color:#E1E4E8;"> (current </span><span style="color:#F97583;">===</span><span style="color:#79B8FF;"> null</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">break</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span></span>
<span class="line"><span style="color:#E1E4E8;">            visited.</span><span style="color:#B392F0;">add</span><span style="color:#E1E4E8;">(current);</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span></span>
<span class="line"><span style="color:#79B8FF;">            this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">recordState</span><span style="color:#E1E4E8;">({</span></span>
<span class="line"><span style="color:#E1E4E8;">                current,</span></span>
<span class="line"><span style="color:#E1E4E8;">                visited: </span><span style="color:#F97583;">new</span><span style="color:#B392F0;"> Set</span><span style="color:#E1E4E8;">(visited),</span></span>
<span class="line"><span style="color:#E1E4E8;">                distances: </span><span style="color:#F97583;">new</span><span style="color:#B392F0;"> Map</span><span style="color:#E1E4E8;">(distances),</span></span>
<span class="line"><span style="color:#E1E4E8;">                previous: </span><span style="color:#F97583;">new</span><span style="color:#B392F0;"> Map</span><span style="color:#E1E4E8;">(previous)</span></span>
<span class="line"><span style="color:#E1E4E8;">            });</span></span>
<span class="line"><span style="color:#F97583;">            yield</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span></span>
<span class="line"><span style="color:#6A737D;">            // 更新邻居距离</span></span>
<span class="line"><span style="color:#F97583;">            const</span><span style="color:#79B8FF;"> neighbors</span><span style="color:#F97583;"> =</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">getNeighbors</span><span style="color:#E1E4E8;">(current);</span></span>
<span class="line"><span style="color:#F97583;">            for</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">const</span><span style="color:#79B8FF;"> neighbor</span><span style="color:#F97583;"> of</span><span style="color:#E1E4E8;"> neighbors) {</span></span>
<span class="line"><span style="color:#F97583;">                if</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">!</span><span style="color:#E1E4E8;">visited.</span><span style="color:#B392F0;">has</span><span style="color:#E1E4E8;">(neighbor)) {</span></span>
<span class="line"><span style="color:#F97583;">                    const</span><span style="color:#79B8FF;"> edge</span><span style="color:#F97583;"> =</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.graph.edges.</span><span style="color:#B392F0;">get</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">\`\${</span><span style="color:#E1E4E8;">current</span><span style="color:#9ECBFF;">}-\${</span><span style="color:#E1E4E8;">neighbor</span><span style="color:#9ECBFF;">}\`</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">||</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#79B8FF;">                                this</span><span style="color:#E1E4E8;">.graph.edges.</span><span style="color:#B392F0;">get</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">\`\${</span><span style="color:#E1E4E8;">neighbor</span><span style="color:#9ECBFF;">}-\${</span><span style="color:#E1E4E8;">current</span><span style="color:#9ECBFF;">}\`</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#F97583;">                    const</span><span style="color:#79B8FF;"> newDistance</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> distances.</span><span style="color:#B392F0;">get</span><span style="color:#E1E4E8;">(current) </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> edge.weight;</span></span>
<span class="line"><span style="color:#E1E4E8;">                    </span></span>
<span class="line"><span style="color:#F97583;">                    if</span><span style="color:#E1E4E8;"> (newDistance </span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;"> distances.</span><span style="color:#B392F0;">get</span><span style="color:#E1E4E8;">(neighbor)) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                        distances.</span><span style="color:#B392F0;">set</span><span style="color:#E1E4E8;">(neighbor, newDistance);</span></span>
<span class="line"><span style="color:#E1E4E8;">                        previous.</span><span style="color:#B392F0;">set</span><span style="color:#E1E4E8;">(neighbor, current);</span></span>
<span class="line"><span style="color:#E1E4E8;">                        </span></span>
<span class="line"><span style="color:#79B8FF;">                        this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">recordState</span><span style="color:#E1E4E8;">({</span></span>
<span class="line"><span style="color:#E1E4E8;">                            current: neighbor,</span></span>
<span class="line"><span style="color:#E1E4E8;">                            visited: </span><span style="color:#F97583;">new</span><span style="color:#B392F0;"> Set</span><span style="color:#E1E4E8;">(visited),</span></span>
<span class="line"><span style="color:#E1E4E8;">                            distances: </span><span style="color:#F97583;">new</span><span style="color:#B392F0;"> Map</span><span style="color:#E1E4E8;">(distances),</span></span>
<span class="line"><span style="color:#E1E4E8;">                            previous: </span><span style="color:#F97583;">new</span><span style="color:#B392F0;"> Map</span><span style="color:#E1E4E8;">(previous),</span></span>
<span class="line"><span style="color:#E1E4E8;">                            updated: </span><span style="color:#79B8FF;">true</span></span>
<span class="line"><span style="color:#E1E4E8;">                        });</span></span>
<span class="line"><span style="color:#F97583;">                        yield</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">                    }</span></span>
<span class="line"><span style="color:#E1E4E8;">                }</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#79B8FF;">        this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">recordState</span><span style="color:#E1E4E8;">({ complete: </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">, distances, previous });</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">    getNeighbors</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">nodeId</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#F97583;">        const</span><span style="color:#79B8FF;"> neighbors</span><span style="color:#F97583;"> =</span><span style="color:#F97583;"> new</span><span style="color:#B392F0;"> Set</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#F97583;">        for</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> [</span><span style="color:#79B8FF;">edgeId</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">edge</span><span style="color:#E1E4E8;">] </span><span style="color:#F97583;">of</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.graph.edges) {</span></span>
<span class="line"><span style="color:#F97583;">            if</span><span style="color:#E1E4E8;"> (edge.from </span><span style="color:#F97583;">===</span><span style="color:#E1E4E8;"> nodeId) neighbors.</span><span style="color:#B392F0;">add</span><span style="color:#E1E4E8;">(edge.to);</span></span>
<span class="line"><span style="color:#F97583;">            if</span><span style="color:#E1E4E8;"> (edge.to </span><span style="color:#F97583;">===</span><span style="color:#E1E4E8;"> nodeId) neighbors.</span><span style="color:#B392F0;">add</span><span style="color:#E1E4E8;">(edge.from);</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#F97583;">        return</span><span style="color:#E1E4E8;"> Array.</span><span style="color:#B392F0;">from</span><span style="color:#E1E4E8;">(neighbors);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">    // 渲染图</span></span>
<span class="line"><span style="color:#B392F0;">    render</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#F97583;">        const</span><span style="color:#79B8FF;"> state</span><span style="color:#F97583;"> =</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.states[</span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.currentStep] </span><span style="color:#F97583;">||</span><span style="color:#E1E4E8;"> {};</span></span>
<span class="line"><span style="color:#F97583;">        const</span><span style="color:#79B8FF;"> ctx</span><span style="color:#F97583;"> =</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.ctx;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#E1E4E8;">        ctx.</span><span style="color:#B392F0;">clearRect</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.canvas.width, </span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.canvas.height);</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#6A737D;">        // 绘制边</span></span>
<span class="line"><span style="color:#F97583;">        for</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> [</span><span style="color:#79B8FF;">edgeId</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">edge</span><span style="color:#E1E4E8;">] </span><span style="color:#F97583;">of</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.graph.edges) {</span></span>
<span class="line"><span style="color:#F97583;">            const</span><span style="color:#79B8FF;"> fromNode</span><span style="color:#F97583;"> =</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.graph.nodes.</span><span style="color:#B392F0;">get</span><span style="color:#E1E4E8;">(edge.from);</span></span>
<span class="line"><span style="color:#F97583;">            const</span><span style="color:#79B8FF;"> toNode</span><span style="color:#F97583;"> =</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.graph.nodes.</span><span style="color:#B392F0;">get</span><span style="color:#E1E4E8;">(edge.to);</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span></span>
<span class="line"><span style="color:#F97583;">            if</span><span style="color:#E1E4E8;"> (fromNode </span><span style="color:#F97583;">&amp;&amp;</span><span style="color:#E1E4E8;"> toNode) {</span></span>
<span class="line"><span style="color:#79B8FF;">                this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">drawEdge</span><span style="color:#E1E4E8;">(fromNode, toNode, edge, state);</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#6A737D;">        // 绘制节点</span></span>
<span class="line"><span style="color:#F97583;">        for</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> [</span><span style="color:#79B8FF;">nodeId</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">node</span><span style="color:#E1E4E8;">] </span><span style="color:#F97583;">of</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.graph.nodes) {</span></span>
<span class="line"><span style="color:#79B8FF;">            this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">drawNode</span><span style="color:#E1E4E8;">(node, state);</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">    drawEdge</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">fromNode</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">toNode</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">edge</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">state</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#F97583;">        const</span><span style="color:#79B8FF;"> ctx</span><span style="color:#F97583;"> =</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.ctx;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#6A737D;">        // 确定边颜色</span></span>
<span class="line"><span style="color:#F97583;">        let</span><span style="color:#E1E4E8;"> color </span><span style="color:#F97583;">=</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.options.edgeColor;</span></span>
<span class="line"><span style="color:#F97583;">        if</span><span style="color:#E1E4E8;"> (state.complete) {</span></span>
<span class="line"><span style="color:#E1E4E8;">            color </span><span style="color:#F97583;">=</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.options.pathColor;</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#E1E4E8;">        ctx.strokeStyle </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> color;</span></span>
<span class="line"><span style="color:#E1E4E8;">        ctx.lineWidth </span><span style="color:#F97583;">=</span><span style="color:#79B8FF;"> 2</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">        ctx.</span><span style="color:#B392F0;">beginPath</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">        ctx.</span><span style="color:#B392F0;">moveTo</span><span style="color:#E1E4E8;">(fromNode.x, fromNode.y);</span></span>
<span class="line"><span style="color:#E1E4E8;">        ctx.</span><span style="color:#B392F0;">lineTo</span><span style="color:#E1E4E8;">(toNode.x, toNode.y);</span></span>
<span class="line"><span style="color:#E1E4E8;">        ctx.</span><span style="color:#B392F0;">stroke</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#6A737D;">        // 绘制权重</span></span>
<span class="line"><span style="color:#F97583;">        const</span><span style="color:#79B8FF;"> midX</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> (fromNode.x </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> toNode.x) </span><span style="color:#F97583;">/</span><span style="color:#79B8FF;"> 2</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">        const</span><span style="color:#79B8FF;"> midY</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> (fromNode.y </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> toNode.y) </span><span style="color:#F97583;">/</span><span style="color:#79B8FF;"> 2</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#E1E4E8;">        ctx.fillStyle </span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;"> &#39;white&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">        ctx.strokeStyle </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> color;</span></span>
<span class="line"><span style="color:#E1E4E8;">        ctx.lineWidth </span><span style="color:#F97583;">=</span><span style="color:#79B8FF;"> 1</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">        ctx.</span><span style="color:#B392F0;">beginPath</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">        ctx.</span><span style="color:#B392F0;">arc</span><span style="color:#E1E4E8;">(midX, midY, </span><span style="color:#79B8FF;">12</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">2</span><span style="color:#F97583;"> *</span><span style="color:#E1E4E8;"> Math.</span><span style="color:#79B8FF;">PI</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">        ctx.</span><span style="color:#B392F0;">fill</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">        ctx.</span><span style="color:#B392F0;">stroke</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#E1E4E8;">        ctx.fillStyle </span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;"> &#39;#2c3e50&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">        ctx.font </span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;"> &#39;10px Arial&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">        ctx.textAlign </span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;"> &#39;center&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">        ctx.textBaseline </span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;"> &#39;middle&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">        ctx.</span><span style="color:#B392F0;">fillText</span><span style="color:#E1E4E8;">(edge.weight.</span><span style="color:#B392F0;">toString</span><span style="color:#E1E4E8;">(), midX, midY);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">    drawNode</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">node</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">state</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#F97583;">        const</span><span style="color:#79B8FF;"> ctx</span><span style="color:#F97583;"> =</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.ctx;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#6A737D;">        // 确定节点颜色</span></span>
<span class="line"><span style="color:#F97583;">        let</span><span style="color:#E1E4E8;"> color </span><span style="color:#F97583;">=</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.options.nodeColor;</span></span>
<span class="line"><span style="color:#F97583;">        if</span><span style="color:#E1E4E8;"> (state.visited </span><span style="color:#F97583;">&amp;&amp;</span><span style="color:#E1E4E8;"> state.visited.</span><span style="color:#B392F0;">has</span><span style="color:#E1E4E8;">(node.id)) {</span></span>
<span class="line"><span style="color:#E1E4E8;">            color </span><span style="color:#F97583;">=</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.options.visitedColor;</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#F97583;">        if</span><span style="color:#E1E4E8;"> (state.current </span><span style="color:#F97583;">===</span><span style="color:#E1E4E8;"> node.id) {</span></span>
<span class="line"><span style="color:#E1E4E8;">            color </span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;"> &#39;#f39c12&#39;</span><span style="color:#E1E4E8;">; </span><span style="color:#6A737D;">// 当前节点用橙色</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#F97583;">        if</span><span style="color:#E1E4E8;"> (state.complete) {</span></span>
<span class="line"><span style="color:#E1E4E8;">            color </span><span style="color:#F97583;">=</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.options.pathColor;</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#6A737D;">        // 绘制节点</span></span>
<span class="line"><span style="color:#E1E4E8;">        ctx.fillStyle </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> color;</span></span>
<span class="line"><span style="color:#E1E4E8;">        ctx.</span><span style="color:#B392F0;">beginPath</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">        ctx.</span><span style="color:#B392F0;">arc</span><span style="color:#E1E4E8;">(node.x, node.y, </span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.options.nodeRadius, </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">2</span><span style="color:#F97583;"> *</span><span style="color:#E1E4E8;"> Math.</span><span style="color:#79B8FF;">PI</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">        ctx.</span><span style="color:#B392F0;">fill</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#6A737D;">        // 绘制节点边框</span></span>
<span class="line"><span style="color:#E1E4E8;">        ctx.strokeStyle </span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;"> &#39;#2c3e50&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">        ctx.lineWidth </span><span style="color:#F97583;">=</span><span style="color:#79B8FF;"> 2</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">        ctx.</span><span style="color:#B392F0;">stroke</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#6A737D;">        // 绘制节点标签</span></span>
<span class="line"><span style="color:#E1E4E8;">        ctx.fillStyle </span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;"> &#39;white&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">        ctx.font </span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;"> &#39;12px Arial&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">        ctx.textAlign </span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;"> &#39;center&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">        ctx.textBaseline </span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;"> &#39;middle&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">        ctx.</span><span style="color:#B392F0;">fillText</span><span style="color:#E1E4E8;">(node.id, node.x, node.y);</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#6A737D;">        // 显示距离（如果存在）</span></span>
<span class="line"><span style="color:#F97583;">        if</span><span style="color:#E1E4E8;"> (state.distances </span><span style="color:#F97583;">&amp;&amp;</span><span style="color:#E1E4E8;"> state.distances.</span><span style="color:#B392F0;">has</span><span style="color:#E1E4E8;">(node.id)) {</span></span>
<span class="line"><span style="color:#F97583;">            const</span><span style="color:#79B8FF;"> distance</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> state.distances.</span><span style="color:#B392F0;">get</span><span style="color:#E1E4E8;">(node.id);</span></span>
<span class="line"><span style="color:#F97583;">            if</span><span style="color:#E1E4E8;"> (distance </span><span style="color:#F97583;">!==</span><span style="color:#79B8FF;"> Infinity</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                ctx.fillStyle </span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;"> &#39;#2c3e50&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">                ctx.font </span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;"> &#39;10px Arial&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">                ctx.</span><span style="color:#B392F0;">fillText</span><span style="color:#E1E4E8;">(</span></span>
<span class="line"><span style="color:#E1E4E8;">                    distance.</span><span style="color:#B392F0;">toString</span><span style="color:#E1E4E8;">(), </span></span>
<span class="line"><span style="color:#E1E4E8;">                    node.x, </span></span>
<span class="line"><span style="color:#E1E4E8;">                    node.y </span><span style="color:#F97583;">+</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.options.nodeRadius </span><span style="color:#F97583;">+</span><span style="color:#79B8FF;"> 15</span></span>
<span class="line"><span style="color:#E1E4E8;">                );</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 力导向布局</span></span>
<span class="line"><span style="color:#F97583;">class</span><span style="color:#B392F0;"> ForceDirectedLayout</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#F97583;">    constructor</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#79B8FF;">        this</span><span style="color:#E1E4E8;">.springLength </span><span style="color:#F97583;">=</span><span style="color:#79B8FF;"> 100</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#79B8FF;">        this</span><span style="color:#E1E4E8;">.springStrength </span><span style="color:#F97583;">=</span><span style="color:#79B8FF;"> 0.1</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#79B8FF;">        this</span><span style="color:#E1E4E8;">.repulsionStrength </span><span style="color:#F97583;">=</span><span style="color:#79B8FF;"> 1000</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#B392F0;">    updatePositions</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">nodes</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">edges</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">width</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">height</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#6A737D;">        // 简化的力导向布局实现</span></span>
<span class="line"><span style="color:#6A737D;">        // 实际实现会更复杂，包含斥力和引力的计算</span></span>
<span class="line"><span style="color:#F97583;">        for</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> [</span><span style="color:#79B8FF;">_</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">node</span><span style="color:#E1E4E8;">] </span><span style="color:#F97583;">of</span><span style="color:#E1E4E8;"> nodes) {</span></span>
<span class="line"><span style="color:#6A737D;">            // 添加随机扰动避免重叠</span></span>
<span class="line"><span style="color:#E1E4E8;">            node.x </span><span style="color:#F97583;">+=</span><span style="color:#E1E4E8;"> (Math.</span><span style="color:#B392F0;">random</span><span style="color:#E1E4E8;">() </span><span style="color:#F97583;">-</span><span style="color:#79B8FF;"> 0.5</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">*</span><span style="color:#79B8FF;"> 2</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">            node.y </span><span style="color:#F97583;">+=</span><span style="color:#E1E4E8;"> (Math.</span><span style="color:#B392F0;">random</span><span style="color:#E1E4E8;">() </span><span style="color:#F97583;">-</span><span style="color:#79B8FF;"> 0.5</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">*</span><span style="color:#79B8FF;"> 2</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span></span>
<span class="line"><span style="color:#6A737D;">            // 边界检查</span></span>
<span class="line"><span style="color:#E1E4E8;">            node.x </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> Math.</span><span style="color:#B392F0;">max</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">50</span><span style="color:#E1E4E8;">, Math.</span><span style="color:#B392F0;">min</span><span style="color:#E1E4E8;">(width </span><span style="color:#F97583;">-</span><span style="color:#79B8FF;"> 50</span><span style="color:#E1E4E8;">, node.x));</span></span>
<span class="line"><span style="color:#E1E4E8;">            node.y </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> Math.</span><span style="color:#B392F0;">max</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">50</span><span style="color:#E1E4E8;">, Math.</span><span style="color:#B392F0;">min</span><span style="color:#E1E4E8;">(height </span><span style="color:#F97583;">-</span><span style="color:#79B8FF;"> 50</span><span style="color:#E1E4E8;">, node.y));</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre></div><h2 id="交互功能增强" tabindex="-1">交互功能增强 <a class="header-anchor" href="#交互功能增强" aria-label="Permalink to &quot;交互功能增强&quot;">​</a></h2><h3 id="用户交互处理器" tabindex="-1">用户交互处理器 <a class="header-anchor" href="#用户交互处理器" aria-label="Permalink to &quot;用户交互处理器&quot;">​</a></h3><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;">// 交互处理器</span></span>
<span class="line"><span style="color:#F97583;">export</span><span style="color:#F97583;"> class</span><span style="color:#B392F0;"> InteractionHandler</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#F97583;">    constructor</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">visualizer</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#79B8FF;">        this</span><span style="color:#E1E4E8;">.visualizer </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> visualizer;</span></span>
<span class="line"><span style="color:#79B8FF;">        this</span><span style="color:#E1E4E8;">.isDragging </span><span style="color:#F97583;">=</span><span style="color:#79B8FF;"> false</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#79B8FF;">        this</span><span style="color:#E1E4E8;">.draggedNode </span><span style="color:#F97583;">=</span><span style="color:#79B8FF;"> null</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#79B8FF;">        this</span><span style="color:#E1E4E8;">.dragOffset </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> { x: </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">, y: </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> };</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#79B8FF;">        this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">bindEvents</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">    bindEvents</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#F97583;">        const</span><span style="color:#79B8FF;"> canvas</span><span style="color:#F97583;"> =</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.visualizer.canvas;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#E1E4E8;">        canvas.</span><span style="color:#B392F0;">addEventListener</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;mousedown&#39;</span><span style="color:#E1E4E8;">, (</span><span style="color:#FFAB70;">e</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">onMouseDown</span><span style="color:#E1E4E8;">(e));</span></span>
<span class="line"><span style="color:#E1E4E8;">        canvas.</span><span style="color:#B392F0;">addEventListener</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;mousemove&#39;</span><span style="color:#E1E4E8;">, (</span><span style="color:#FFAB70;">e</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">onMouseMove</span><span style="color:#E1E4E8;">(e));</span></span>
<span class="line"><span style="color:#E1E4E8;">        canvas.</span><span style="color:#B392F0;">addEventListener</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;mouseup&#39;</span><span style="color:#E1E4E8;">, () </span><span style="color:#F97583;">=&gt;</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">onMouseUp</span><span style="color:#E1E4E8;">());</span></span>
<span class="line"><span style="color:#E1E4E8;">        canvas.</span><span style="color:#B392F0;">addEventListener</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;wheel&#39;</span><span style="color:#E1E4E8;">, (</span><span style="color:#FFAB70;">e</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">onWheel</span><span style="color:#E1E4E8;">(e));</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#6A737D;">        // 触摸事件支持</span></span>
<span class="line"><span style="color:#E1E4E8;">        canvas.</span><span style="color:#B392F0;">addEventListener</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;touchstart&#39;</span><span style="color:#E1E4E8;">, (</span><span style="color:#FFAB70;">e</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">onTouchStart</span><span style="color:#E1E4E8;">(e));</span></span>
<span class="line"><span style="color:#E1E4E8;">        canvas.</span><span style="color:#B392F0;">addEventListener</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;touchmove&#39;</span><span style="color:#E1E4E8;">, (</span><span style="color:#FFAB70;">e</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">onTouchMove</span><span style="color:#E1E4E8;">(e));</span></span>
<span class="line"><span style="color:#E1E4E8;">        canvas.</span><span style="color:#B392F0;">addEventListener</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;touchend&#39;</span><span style="color:#E1E4E8;">, () </span><span style="color:#F97583;">=&gt;</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">onTouchEnd</span><span style="color:#E1E4E8;">());</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">    onMouseDown</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">e</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#F97583;">        const</span><span style="color:#79B8FF;"> rect</span><span style="color:#F97583;"> =</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.visualizer.canvas.</span><span style="color:#B392F0;">getBoundingClientRect</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#F97583;">        const</span><span style="color:#79B8FF;"> x</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> e.clientX </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> rect.left;</span></span>
<span class="line"><span style="color:#F97583;">        const</span><span style="color:#79B8FF;"> y</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> e.clientY </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> rect.top;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#6A737D;">        // 检查是否点击了节点</span></span>
<span class="line"><span style="color:#F97583;">        if</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.visualizer.graph) {</span></span>
<span class="line"><span style="color:#79B8FF;">            this</span><span style="color:#E1E4E8;">.draggedNode </span><span style="color:#F97583;">=</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">findNodeAt</span><span style="color:#E1E4E8;">(x, y);</span></span>
<span class="line"><span style="color:#F97583;">            if</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.draggedNode) {</span></span>
<span class="line"><span style="color:#79B8FF;">                this</span><span style="color:#E1E4E8;">.isDragging </span><span style="color:#F97583;">=</span><span style="color:#79B8FF;"> true</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#79B8FF;">                this</span><span style="color:#E1E4E8;">.dragOffset.x </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> x </span><span style="color:#F97583;">-</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.draggedNode.x;</span></span>
<span class="line"><span style="color:#79B8FF;">                this</span><span style="color:#E1E4E8;">.dragOffset.y </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> y </span><span style="color:#F97583;">-</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.draggedNode.y;</span></span>
<span class="line"><span style="color:#E1E4E8;">                e.</span><span style="color:#B392F0;">preventDefault</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">    onMouseMove</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">e</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#F97583;">        if</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.isDragging </span><span style="color:#F97583;">&amp;&amp;</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.draggedNode) {</span></span>
<span class="line"><span style="color:#F97583;">            const</span><span style="color:#79B8FF;"> rect</span><span style="color:#F97583;"> =</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.visualizer.canvas.</span><span style="color:#B392F0;">getBoundingClientRect</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#F97583;">            const</span><span style="color:#79B8FF;"> x</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> e.clientX </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> rect.left;</span></span>
<span class="line"><span style="color:#F97583;">            const</span><span style="color:#79B8FF;"> y</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> e.clientY </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> rect.top;</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span></span>
<span class="line"><span style="color:#79B8FF;">            this</span><span style="color:#E1E4E8;">.draggedNode.x </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> x </span><span style="color:#F97583;">-</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.dragOffset.x;</span></span>
<span class="line"><span style="color:#79B8FF;">            this</span><span style="color:#E1E4E8;">.draggedNode.y </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> y </span><span style="color:#F97583;">-</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.dragOffset.y;</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span></span>
<span class="line"><span style="color:#79B8FF;">            this</span><span style="color:#E1E4E8;">.visualizer.</span><span style="color:#B392F0;">render</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">    onMouseUp</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#79B8FF;">        this</span><span style="color:#E1E4E8;">.isDragging </span><span style="color:#F97583;">=</span><span style="color:#79B8FF;"> false</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#79B8FF;">        this</span><span style="color:#E1E4E8;">.draggedNode </span><span style="color:#F97583;">=</span><span style="color:#79B8FF;"> null</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">    onWheel</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">e</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        e.</span><span style="color:#B392F0;">preventDefault</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#6A737D;">        // 缩放功能</span></span>
<span class="line"><span style="color:#F97583;">        const</span><span style="color:#79B8FF;"> zoomIntensity</span><span style="color:#F97583;"> =</span><span style="color:#79B8FF;"> 0.1</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">        const</span><span style="color:#79B8FF;"> wheel</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> e.deltaY </span><span style="color:#F97583;">&lt;</span><span style="color:#79B8FF;"> 0</span><span style="color:#F97583;"> ?</span><span style="color:#79B8FF;"> 1</span><span style="color:#F97583;"> :</span><span style="color:#F97583;"> -</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">        const</span><span style="color:#79B8FF;"> zoom</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> Math.</span><span style="color:#B392F0;">exp</span><span style="color:#E1E4E8;">(wheel </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> zoomIntensity);</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#6A737D;">        // 更新可视化器的缩放级别</span></span>
<span class="line"><span style="color:#F97583;">        if</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.visualizer.scale) {</span></span>
<span class="line"><span style="color:#79B8FF;">            this</span><span style="color:#E1E4E8;">.visualizer.scale </span><span style="color:#F97583;">*=</span><span style="color:#E1E4E8;"> zoom;</span></span>
<span class="line"><span style="color:#79B8FF;">            this</span><span style="color:#E1E4E8;">.visualizer.</span><span style="color:#B392F0;">render</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">    onTouchStart</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">e</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#F97583;">        if</span><span style="color:#E1E4E8;"> (e.touches.</span><span style="color:#79B8FF;">length</span><span style="color:#F97583;"> ===</span><span style="color:#79B8FF;"> 1</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#F97583;">            const</span><span style="color:#79B8FF;"> touch</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> e.touches[</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">];</span></span>
<span class="line"><span style="color:#F97583;">            const</span><span style="color:#79B8FF;"> rect</span><span style="color:#F97583;"> =</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.visualizer.canvas.</span><span style="color:#B392F0;">getBoundingClientRect</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#F97583;">            const</span><span style="color:#79B8FF;"> x</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> touch.clientX </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> rect.left;</span></span>
<span class="line"><span style="color:#F97583;">            const</span><span style="color:#79B8FF;"> y</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> touch.clientY </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> rect.top;</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span></span>
<span class="line"><span style="color:#79B8FF;">            this</span><span style="color:#E1E4E8;">.draggedNode </span><span style="color:#F97583;">=</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">findNodeAt</span><span style="color:#E1E4E8;">(x, y);</span></span>
<span class="line"><span style="color:#F97583;">            if</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.draggedNode) {</span></span>
<span class="line"><span style="color:#79B8FF;">                this</span><span style="color:#E1E4E8;">.isDragging </span><span style="color:#F97583;">=</span><span style="color:#79B8FF;"> true</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#79B8FF;">                this</span><span style="color:#E1E4E8;">.dragOffset.x </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> x </span><span style="color:#F97583;">-</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.draggedNode.x;</span></span>
<span class="line"><span style="color:#79B8FF;">                this</span><span style="color:#E1E4E8;">.dragOffset.y </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> y </span><span style="color:#F97583;">-</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.draggedNode.y;</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">    onTouchMove</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">e</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#F97583;">        if</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.isDragging </span><span style="color:#F97583;">&amp;&amp;</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.draggedNode </span><span style="color:#F97583;">&amp;&amp;</span><span style="color:#E1E4E8;"> e.touches.</span><span style="color:#79B8FF;">length</span><span style="color:#F97583;"> ===</span><span style="color:#79B8FF;"> 1</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#F97583;">            const</span><span style="color:#79B8FF;"> touch</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> e.touches[</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">];</span></span>
<span class="line"><span style="color:#F97583;">            const</span><span style="color:#79B8FF;"> rect</span><span style="color:#F97583;"> =</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.visualizer.canvas.</span><span style="color:#B392F0;">getBoundingClientRect</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#F97583;">            const</span><span style="color:#79B8FF;"> x</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> touch.clientX </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> rect.left;</span></span>
<span class="line"><span style="color:#F97583;">            const</span><span style="color:#79B8FF;"> y</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> touch.clientY </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> rect.top;</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span></span>
<span class="line"><span style="color:#79B8FF;">            this</span><span style="color:#E1E4E8;">.draggedNode.x </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> x </span><span style="color:#F97583;">-</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.dragOffset.x;</span></span>
<span class="line"><span style="color:#79B8FF;">            this</span><span style="color:#E1E4E8;">.draggedNode.y </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> y </span><span style="color:#F97583;">-</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.dragOffset.y;</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span></span>
<span class="line"><span style="color:#79B8FF;">            this</span><span style="color:#E1E4E8;">.visualizer.</span><span style="color:#B392F0;">render</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">    onTouchEnd</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#79B8FF;">        this</span><span style="color:#E1E4E8;">.isDragging </span><span style="color:#F97583;">=</span><span style="color:#79B8FF;"> false</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#79B8FF;">        this</span><span style="color:#E1E4E8;">.draggedNode </span><span style="color:#F97583;">=</span><span style="color:#79B8FF;"> null</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">    findNodeAt</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">x</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">y</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#F97583;">        if</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">!</span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.visualizer.graph) </span><span style="color:#F97583;">return</span><span style="color:#79B8FF;"> null</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#F97583;">        for</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> [</span><span style="color:#79B8FF;">_</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">node</span><span style="color:#E1E4E8;">] </span><span style="color:#F97583;">of</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.visualizer.graph.nodes) {</span></span>
<span class="line"><span style="color:#F97583;">            const</span><span style="color:#79B8FF;"> distance</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> Math.</span><span style="color:#B392F0;">sqrt</span><span style="color:#E1E4E8;">(</span></span>
<span class="line"><span style="color:#E1E4E8;">                Math.</span><span style="color:#B392F0;">pow</span><span style="color:#E1E4E8;">(node.x </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> x, </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> Math.</span><span style="color:#B392F0;">pow</span><span style="color:#E1E4E8;">(node.y </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> y, </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">            );</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span></span>
<span class="line"><span style="color:#F97583;">            if</span><span style="color:#E1E4E8;"> (distance </span><span style="color:#F97583;">&lt;=</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.visualizer.options.nodeRadius) {</span></span>
<span class="line"><span style="color:#F97583;">                return</span><span style="color:#E1E4E8;"> node;</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#F97583;">        return</span><span style="color:#79B8FF;"> null</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre></div><h3 id="数据导入导出" tabindex="-1">数据导入导出 <a class="header-anchor" href="#数据导入导出" aria-label="Permalink to &quot;数据导入导出&quot;">​</a></h3><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;">// 数据管理器</span></span>
<span class="line"><span style="color:#F97583;">export</span><span style="color:#F97583;"> class</span><span style="color:#B392F0;"> DataManager</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#F97583;">    constructor</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">visualizer</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#79B8FF;">        this</span><span style="color:#E1E4E8;">.visualizer </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> visualizer;</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">    // 导出当前状态为 JSON</span></span>
<span class="line"><span style="color:#B392F0;">    exportState</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#F97583;">        const</span><span style="color:#79B8FF;"> state</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">            algorithm: </span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.visualizer.</span><span style="color:#79B8FF;">constructor</span><span style="color:#E1E4E8;">.name,</span></span>
<span class="line"><span style="color:#E1E4E8;">            data: </span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.visualizer.data </span><span style="color:#F97583;">||</span><span style="color:#E1E4E8;"> [],</span></span>
<span class="line"><span style="color:#E1E4E8;">            states: </span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.visualizer.states,</span></span>
<span class="line"><span style="color:#E1E4E8;">            currentStep: </span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.visualizer.currentStep,</span></span>
<span class="line"><span style="color:#E1E4E8;">            options: </span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.visualizer.options,</span></span>
<span class="line"><span style="color:#E1E4E8;">            timestamp: </span><span style="color:#F97583;">new</span><span style="color:#B392F0;"> Date</span><span style="color:#E1E4E8;">().</span><span style="color:#B392F0;">toISOString</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"><span style="color:#E1E4E8;">        };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">        if</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.visualizer.graph) {</span></span>
<span class="line"><span style="color:#E1E4E8;">            state.graph </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">                nodes: Array.</span><span style="color:#B392F0;">from</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.visualizer.graph.nodes.</span><span style="color:#B392F0;">entries</span><span style="color:#E1E4E8;">()),</span></span>
<span class="line"><span style="color:#E1E4E8;">                edges: Array.</span><span style="color:#B392F0;">from</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.visualizer.graph.edges.</span><span style="color:#B392F0;">entries</span><span style="color:#E1E4E8;">())</span></span>
<span class="line"><span style="color:#E1E4E8;">            };</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">        return</span><span style="color:#79B8FF;"> JSON</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">stringify</span><span style="color:#E1E4E8;">(state, </span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">    // 从 JSON 导入状态</span></span>
<span class="line"><span style="color:#B392F0;">    importState</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">jsonString</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#F97583;">        try</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#F97583;">            const</span><span style="color:#79B8FF;"> state</span><span style="color:#F97583;"> =</span><span style="color:#79B8FF;"> JSON</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">parse</span><span style="color:#E1E4E8;">(jsonString);</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span></span>
<span class="line"><span style="color:#79B8FF;">            this</span><span style="color:#E1E4E8;">.visualizer.data </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> state.data </span><span style="color:#F97583;">||</span><span style="color:#E1E4E8;"> [];</span></span>
<span class="line"><span style="color:#79B8FF;">            this</span><span style="color:#E1E4E8;">.visualizer.states </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> state.states </span><span style="color:#F97583;">||</span><span style="color:#E1E4E8;"> [];</span></span>
<span class="line"><span style="color:#79B8FF;">            this</span><span style="color:#E1E4E8;">.visualizer.currentStep </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> state.currentStep </span><span style="color:#F97583;">||</span><span style="color:#79B8FF;"> 0</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#79B8FF;">            this</span><span style="color:#E1E4E8;">.visualizer.options </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> { </span><span style="color:#F97583;">...</span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.visualizer.options, </span><span style="color:#F97583;">...</span><span style="color:#E1E4E8;">state.options };</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span></span>
<span class="line"><span style="color:#F97583;">            if</span><span style="color:#E1E4E8;"> (state.graph </span><span style="color:#F97583;">&amp;&amp;</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.visualizer.graph) {</span></span>
<span class="line"><span style="color:#79B8FF;">                this</span><span style="color:#E1E4E8;">.visualizer.graph.nodes </span><span style="color:#F97583;">=</span><span style="color:#F97583;"> new</span><span style="color:#B392F0;"> Map</span><span style="color:#E1E4E8;">(state.graph.nodes);</span></span>
<span class="line"><span style="color:#79B8FF;">                this</span><span style="color:#E1E4E8;">.visualizer.graph.edges </span><span style="color:#F97583;">=</span><span style="color:#F97583;"> new</span><span style="color:#B392F0;"> Map</span><span style="color:#E1E4E8;">(state.graph.edges);</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span></span>
<span class="line"><span style="color:#79B8FF;">            this</span><span style="color:#E1E4E8;">.visualizer.</span><span style="color:#B392F0;">render</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#F97583;">            return</span><span style="color:#79B8FF;"> true</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">        } </span><span style="color:#F97583;">catch</span><span style="color:#E1E4E8;"> (error) {</span></span>
<span class="line"><span style="color:#E1E4E8;">            console.</span><span style="color:#B392F0;">error</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;导入状态失败:&#39;</span><span style="color:#E1E4E8;">, error);</span></span>
<span class="line"><span style="color:#F97583;">            return</span><span style="color:#79B8FF;"> false</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">    // 生成测试数据</span></span>
<span class="line"><span style="color:#B392F0;">    generateTestData</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">type</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">size</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#F97583;">        switch</span><span style="color:#E1E4E8;"> (type) {</span></span>
<span class="line"><span style="color:#F97583;">            case</span><span style="color:#9ECBFF;"> &#39;sorting&#39;</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#F97583;">                return</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">generateSortingData</span><span style="color:#E1E4E8;">(size);</span></span>
<span class="line"><span style="color:#F97583;">            case</span><span style="color:#9ECBFF;"> &#39;graph&#39;</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#F97583;">                return</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">generateGraphData</span><span style="color:#E1E4E8;">(size);</span></span>
<span class="line"><span style="color:#F97583;">            case</span><span style="color:#9ECBFF;"> &#39;tree&#39;</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#F97583;">                return</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">generateTreeData</span><span style="color:#E1E4E8;">(size);</span></span>
<span class="line"><span style="color:#F97583;">            default</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#F97583;">                return</span><span style="color:#E1E4E8;"> [];</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">    generateSortingData</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">size</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#F97583;">        return</span><span style="color:#E1E4E8;"> Array.</span><span style="color:#B392F0;">from</span><span style="color:#E1E4E8;">({ length: size }, () </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#E1E4E8;">            Math.</span><span style="color:#B392F0;">floor</span><span style="color:#E1E4E8;">(Math.</span><span style="color:#B392F0;">random</span><span style="color:#E1E4E8;">() </span><span style="color:#F97583;">*</span><span style="color:#79B8FF;"> 100</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">+</span><span style="color:#79B8FF;"> 1</span></span>
<span class="line"><span style="color:#E1E4E8;">        );</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">    generateGraphData</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">nodeCount</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#F97583;">        const</span><span style="color:#79B8FF;"> nodes</span><span style="color:#F97583;"> =</span><span style="color:#F97583;"> new</span><span style="color:#B392F0;"> Map</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#F97583;">        const</span><span style="color:#79B8FF;"> edges</span><span style="color:#F97583;"> =</span><span style="color:#F97583;"> new</span><span style="color:#B392F0;"> Map</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#6A737D;">        // 创建节点</span></span>
<span class="line"><span style="color:#F97583;">        for</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> i </span><span style="color:#F97583;">=</span><span style="color:#79B8FF;"> 0</span><span style="color:#E1E4E8;">; i </span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;"> nodeCount; i</span><span style="color:#F97583;">++</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">            nodes.</span><span style="color:#B392F0;">set</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">\`Node\${</span><span style="color:#E1E4E8;">i</span><span style="color:#9ECBFF;">}\`</span><span style="color:#E1E4E8;">, {</span></span>
<span class="line"><span style="color:#E1E4E8;">                id: </span><span style="color:#9ECBFF;">\`Node\${</span><span style="color:#E1E4E8;">i</span><span style="color:#9ECBFF;">}\`</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">                x: Math.</span><span style="color:#B392F0;">random</span><span style="color:#E1E4E8;">() </span><span style="color:#F97583;">*</span><span style="color:#79B8FF;"> 600</span><span style="color:#F97583;"> +</span><span style="color:#79B8FF;"> 50</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">                y: Math.</span><span style="color:#B392F0;">random</span><span style="color:#E1E4E8;">() </span><span style="color:#F97583;">*</span><span style="color:#79B8FF;"> 400</span><span style="color:#F97583;"> +</span><span style="color:#79B8FF;"> 50</span></span>
<span class="line"><span style="color:#E1E4E8;">            });</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#6A737D;">        // 创建随机边</span></span>
<span class="line"><span style="color:#F97583;">        const</span><span style="color:#79B8FF;"> nodeArray</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> Array.</span><span style="color:#B392F0;">from</span><span style="color:#E1E4E8;">(nodes.</span><span style="color:#B392F0;">keys</span><span style="color:#E1E4E8;">());</span></span>
<span class="line"><span style="color:#F97583;">        for</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> i </span><span style="color:#F97583;">=</span><span style="color:#79B8FF;"> 0</span><span style="color:#E1E4E8;">; i </span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;"> nodeCount </span><span style="color:#F97583;">*</span><span style="color:#79B8FF;"> 1.5</span><span style="color:#E1E4E8;">; i</span><span style="color:#F97583;">++</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#F97583;">            const</span><span style="color:#79B8FF;"> from</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> nodeArray[Math.</span><span style="color:#B392F0;">floor</span><span style="color:#E1E4E8;">(Math.</span><span style="color:#B392F0;">random</span><span style="color:#E1E4E8;">() </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> nodeArray.</span><span style="color:#79B8FF;">length</span><span style="color:#E1E4E8;">)];</span></span>
<span class="line"><span style="color:#F97583;">            const</span><span style="color:#79B8FF;"> to</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> nodeArray[Math.</span><span style="color:#B392F0;">floor</span><span style="color:#E1E4E8;">(Math.</span><span style="color:#B392F0;">random</span><span style="color:#E1E4E8;">() </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> nodeArray.</span><span style="color:#79B8FF;">length</span><span style="color:#E1E4E8;">)];</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span></span>
<span class="line"><span style="color:#F97583;">            if</span><span style="color:#E1E4E8;"> (from </span><span style="color:#F97583;">!==</span><span style="color:#E1E4E8;"> to) {</span></span>
<span class="line"><span style="color:#F97583;">                const</span><span style="color:#79B8FF;"> edgeId</span><span style="color:#F97583;"> =</span><span style="color:#9ECBFF;"> \`\${</span><span style="color:#E1E4E8;">from</span><span style="color:#9ECBFF;">}-\${</span><span style="color:#E1E4E8;">to</span><span style="color:#9ECBFF;">}\`</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">                const</span><span style="color:#79B8FF;"> reverseEdgeId</span><span style="color:#F97583;"> =</span><span style="color:#9ECBFF;"> \`\${</span><span style="color:#E1E4E8;">to</span><span style="color:#9ECBFF;">}-\${</span><span style="color:#E1E4E8;">from</span><span style="color:#9ECBFF;">}\`</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span></span>
<span class="line"><span style="color:#F97583;">                if</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">!</span><span style="color:#E1E4E8;">edges.</span><span style="color:#B392F0;">has</span><span style="color:#E1E4E8;">(edgeId) </span><span style="color:#F97583;">&amp;&amp;</span><span style="color:#F97583;"> !</span><span style="color:#E1E4E8;">edges.</span><span style="color:#B392F0;">has</span><span style="color:#E1E4E8;">(reverseEdgeId)) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                    edges.</span><span style="color:#B392F0;">set</span><span style="color:#E1E4E8;">(edgeId, {</span></span>
<span class="line"><span style="color:#E1E4E8;">                        from,</span></span>
<span class="line"><span style="color:#E1E4E8;">                        to,</span></span>
<span class="line"><span style="color:#E1E4E8;">                        weight: Math.</span><span style="color:#B392F0;">floor</span><span style="color:#E1E4E8;">(Math.</span><span style="color:#B392F0;">random</span><span style="color:#E1E4E8;">() </span><span style="color:#F97583;">*</span><span style="color:#79B8FF;"> 10</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">+</span><span style="color:#79B8FF;"> 1</span></span>
<span class="line"><span style="color:#E1E4E8;">                    });</span></span>
<span class="line"><span style="color:#E1E4E8;">                }</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#F97583;">        return</span><span style="color:#E1E4E8;"> { nodes, edges };</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">    generateTreeData</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">level</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#6A737D;">        // 生成平衡二叉树数据</span></span>
<span class="line"><span style="color:#F97583;">        const</span><span style="color:#B392F0;"> generateSubtree</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> (</span><span style="color:#FFAB70;">value</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">depth</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#F97583;">            if</span><span style="color:#E1E4E8;"> (depth </span><span style="color:#F97583;">&lt;=</span><span style="color:#79B8FF;"> 0</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">return</span><span style="color:#79B8FF;"> null</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span></span>
<span class="line"><span style="color:#F97583;">            return</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">                value,</span></span>
<span class="line"><span style="color:#E1E4E8;">                left: </span><span style="color:#B392F0;">generateSubtree</span><span style="color:#E1E4E8;">(value </span><span style="color:#F97583;">*</span><span style="color:#79B8FF;"> 2</span><span style="color:#E1E4E8;">, depth </span><span style="color:#F97583;">-</span><span style="color:#79B8FF;"> 1</span><span style="color:#E1E4E8;">),</span></span>
<span class="line"><span style="color:#E1E4E8;">                right: </span><span style="color:#B392F0;">generateSubtree</span><span style="color:#E1E4E8;">(value </span><span style="color:#F97583;">*</span><span style="color:#79B8FF;"> 2</span><span style="color:#F97583;"> +</span><span style="color:#79B8FF;"> 1</span><span style="color:#E1E4E8;">, depth </span><span style="color:#F97583;">-</span><span style="color:#79B8FF;"> 1</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">            };</span></span>
<span class="line"><span style="color:#E1E4E8;">        };</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#F97583;">        return</span><span style="color:#B392F0;"> generateSubtree</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">, level);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre></div>`,21)])])}const B=n(o,[["render",e]]);export{i as __pageData,B as default};

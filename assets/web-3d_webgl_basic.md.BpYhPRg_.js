import{_ as a,c as n,o as l,b as p}from"./chunks/framework.CMLuPXeo.js";const d=JSON.parse('{"title":"WebGL 基础","description":"","frontmatter":{},"headers":[{"level":2,"title":"WebGL 概述","slug":"webgl-概述","link":"#webgl-概述","children":[]},{"level":2,"title":"WebGL 上下文","slug":"webgl-上下文","link":"#webgl-上下文","children":[]},{"level":2,"title":"坐标系系统","slug":"坐标系系统","link":"#坐标系系统","children":[]},{"level":2,"title":"绘制基本图元","slug":"绘制基本图元","link":"#绘制基本图元","children":[]},{"level":2,"title":"着色器程序","slug":"着色器程序","link":"#着色器程序","children":[]},{"level":2,"title":"缓冲区对象","slug":"缓冲区对象","link":"#缓冲区对象","children":[]},{"level":2,"title":"纹理","slug":"纹理","link":"#纹理","children":[]},{"level":2,"title":"变换矩阵","slug":"变换矩阵","link":"#变换矩阵","children":[]},{"level":2,"title":"渲染状态","slug":"渲染状态","link":"#渲染状态","children":[]},{"level":2,"title":"渲染循环","slug":"渲染循环","link":"#渲染循环","children":[]},{"level":2,"title":"错误处理","slug":"错误处理","link":"#错误处理","children":[]},{"level":2,"title":"性能优化","slug":"性能优化","link":"#性能优化","children":[]}],"relativePath":"web-3d/webgl/basic.md","filePath":"web-3d/webgl/basic.md"}'),e={name:"web-3d/webgl/basic.md"};function o(c,s,t,r,i,E){return l(),n("div",null,[...s[0]||(s[0]=[p(`<div style="display:none;" hidden="true" aria-hidden="true">Are you an LLM? You can read better optimized documentation at /web-3d/webgl/basic.md for this page in Markdown format</div><h1 id="webgl-基础" tabindex="-1">WebGL 基础 <a class="header-anchor" href="#webgl-基础" aria-label="Permalink to &quot;WebGL 基础&quot;">​</a></h1><p>WebGL (Web Graphics Library) 是一种基于 OpenGL ES 的 JavaScript API，用于在 Web 浏览器中渲染交互式 2D 和 3D 图形。它通过利用 GPU 加速来实现高性能图形渲染，为 Web 开发者提供了底层的图形硬件访问能力。</p><h2 id="webgl-概述" tabindex="-1">WebGL 概述 <a class="header-anchor" href="#webgl-概述" aria-label="Permalink to &quot;WebGL 概述&quot;">​</a></h2><p>WebGL 将 JavaScript 与 OpenGL ES 2.0 的功能相结合，允许在 HTML5 Canvas 元素中直接进行硬件加速的图形渲染。它提供了对图形管线的精细控制，是现代 Web 3D 应用的基石。</p><p>特点：</p><ul><li>基于 OpenGL ES 2.0 标准</li><li>直接访问 GPU 硬件加速</li><li>跨平台、免插件</li><li>与 HTML5 生态系统深度集成</li></ul><p>示意图 (WebGL 在 Web 中的位置)：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span>浏览器 → Canvas元素 → WebGL上下文 → GPU驱动</span></span>
<span class="line"><span>    ↓         ↓           ↓         ↓</span></span>
<span class="line"><span> HTML     绘图表面     渲染API    硬件加速</span></span></code></pre></div><h2 id="webgl-上下文" tabindex="-1">WebGL 上下文 <a class="header-anchor" href="#webgl-上下文" aria-label="Permalink to &quot;WebGL 上下文&quot;">​</a></h2><p>WebGL 上下文是访问 WebGL 功能的入口点，通过 Canvas 元素获取。每个上下文维护独立的渲染状态和资源。</p><p>特点：</p><ul><li>通过 canvas.getContext (‘webgl’) 获取</li><li>管理渲染状态、缓冲区、纹理等资源</li><li>支持 WebGL 1.0 和 WebGL 2.0</li></ul><p>上下文初始化代码：</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#F97583;">const</span><span style="color:#79B8FF;"> canvas</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> document.</span><span style="color:#B392F0;">getElementById</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;canvas&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#79B8FF;"> gl</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> canvas.</span><span style="color:#B392F0;">getContext</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;webgl&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">!</span><span style="color:#E1E4E8;">gl) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    console.</span><span style="color:#B392F0;">error</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;WebGL 不支持&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre></div><p>状态机示意图：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span>WebGL上下文</span></span>
<span class="line"><span>├── 绘制状态 (深度测试、混合等)</span></span>
<span class="line"><span>├── 缓冲区对象 (顶点、索引)</span></span>
<span class="line"><span>├── 纹理单元</span></span>
<span class="line"><span>├── 着色器程序</span></span>
<span class="line"><span>└── 帧缓冲区</span></span></code></pre></div><h2 id="坐标系系统" tabindex="-1">坐标系系统 <a class="header-anchor" href="#坐标系系统" aria-label="Permalink to &quot;坐标系系统&quot;">​</a></h2><p>WebGL 使用右手坐标系，坐标范围在裁剪空间中为 [-1，1]。理解坐标系转换是 WebGL 编程的基础。</p><p>特点：</p><ul><li>标准化设备坐标：X/Y/Z 范围 [-1，1]</li><li>视口变换将 NDC 映射到屏幕像素</li><li>矩阵变换实现坐标系转换</li></ul><p>坐标系示意图：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span>裁剪空间 (NDC)：</span></span>
<span class="line"><span>    Y</span></span>
<span class="line"><span>    |</span></span>
<span class="line"><span>-1  +---+ 1</span></span>
<span class="line"><span>  / |  /|</span></span>
<span class="line"><span> /  | / |</span></span>
<span class="line"><span>+---+---+ X</span></span>
<span class="line"><span>|   |   |</span></span>
<span class="line"><span>|   +---+</span></span>
<span class="line"><span>|  /   /</span></span>
<span class="line"><span>| /   /</span></span>
<span class="line"><span>Z    /</span></span>
<span class="line"><span>-1  1</span></span></code></pre></div><h2 id="绘制基本图元" tabindex="-1">绘制基本图元 <a class="header-anchor" href="#绘制基本图元" aria-label="Permalink to &quot;绘制基本图元&quot;">​</a></h2><p>WebGL 支持多种基本图元类型，包括点、线和三角形。这些图元通过顶点数据定义。</p><p>特点：</p><ul><li>三角形是最常用的图元</li><li>支持三角形带、扇形等优化模式</li><li>点精灵用于粒子效果</li></ul><p>图元类型示意图：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span>点：● ● ● ●</span></span>
<span class="line"><span></span></span>
<span class="line"><span>线：├───┼───┤</span></span>
<span class="line"><span></span></span>
<span class="line"><span>三角形：▲  三角形带：▲▲▲  三角形扇：◑</span></span>
<span class="line"><span>       / \\         / \\ / \\ / \\       / \\</span></span>
<span class="line"><span>      /   \\       /   \\   \\   \\     /   \\</span></span>
<span class="line"><span>     ───────     ───────────────   ───────</span></span></code></pre></div><p>绘制调用代码：</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;">// 绘制三角形</span></span>
<span class="line"><span style="color:#E1E4E8;">gl.</span><span style="color:#B392F0;">drawArrays</span><span style="color:#E1E4E8;">(gl.</span><span style="color:#79B8FF;">TRIANGLES</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">3</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 使用索引绘制</span></span>
<span class="line"><span style="color:#E1E4E8;">gl.</span><span style="color:#B392F0;">drawElements</span><span style="color:#E1E4E8;">(gl.</span><span style="color:#79B8FF;">TRIANGLES</span><span style="color:#E1E4E8;">, count, gl.</span><span style="color:#79B8FF;">UNSIGNED_SHORT</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">);</span></span></code></pre></div><h2 id="着色器程序" tabindex="-1">着色器程序 <a class="header-anchor" href="#着色器程序" aria-label="Permalink to &quot;着色器程序&quot;">​</a></h2><p>着色器是 WebGL 的核心，包括顶点着色器和片段着色器。它们运行在 GPU 上，控制渲染过程。</p><p>特点：</p><ul><li>顶点着色器：处理每个顶点</li><li>片段着色器：处理每个像素</li><li>必须成对编译和链接</li></ul><p>着色器创建流程：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span>创建着色器 → 指定源码 → 编译 → 检查错误</span></span>
<span class="line"><span>    ↓</span></span>
<span class="line"><span>创建程序 → 附加着色器 → 链接 → 使用程序</span></span></code></pre></div><p>简单着色器示例：</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;">// 顶点着色器</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#79B8FF;"> vsSource</span><span style="color:#F97583;"> =</span><span style="color:#9ECBFF;"> \`</span></span>
<span class="line"><span style="color:#9ECBFF;">    attribute vec4 aPosition;</span></span>
<span class="line"><span style="color:#9ECBFF;">    void main() {</span></span>
<span class="line"><span style="color:#9ECBFF;">        gl_Position = aPosition;</span></span>
<span class="line"><span style="color:#9ECBFF;">    }</span></span>
<span class="line"><span style="color:#9ECBFF;">\`</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 片段着色器</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#79B8FF;"> fsSource</span><span style="color:#F97583;"> =</span><span style="color:#9ECBFF;"> \`</span></span>
<span class="line"><span style="color:#9ECBFF;">    void main() {</span></span>
<span class="line"><span style="color:#9ECBFF;">        gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0); // 红色</span></span>
<span class="line"><span style="color:#9ECBFF;">    }</span></span>
<span class="line"><span style="color:#9ECBFF;">\`</span><span style="color:#E1E4E8;">;</span></span></code></pre></div><h2 id="缓冲区对象" tabindex="-1">缓冲区对象 <a class="header-anchor" href="#缓冲区对象" aria-label="Permalink to &quot;缓冲区对象&quot;">​</a></h2><p>缓冲区用于在 CPU 和 GPU 之间传递数据，包括顶点数据、颜色、法线等。WebGL 使用 ArrayBuffer 存储二进制数据。</p><p>特点：</p><ul><li>顶点缓冲区：存储顶点位置、颜色等</li><li>索引缓冲区：存储顶点索引，减少重复数据</li><li>数据一次性上传，多次使用</li></ul><p>缓冲区操作示意图：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span>JavaScript数组 → 类型化数组 → WebGL缓冲区 → GPU内存</span></span>
<span class="line"><span>   [x,y,z,...]     Float32Array     gl.bufferData()</span></span></code></pre></div><p>缓冲区管理代码：</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;">// 创建顶点缓冲区</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#79B8FF;"> positionBuffer</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> gl.</span><span style="color:#B392F0;">createBuffer</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">gl.</span><span style="color:#B392F0;">bindBuffer</span><span style="color:#E1E4E8;">(gl.</span><span style="color:#79B8FF;">ARRAY_BUFFER</span><span style="color:#E1E4E8;">, positionBuffer);</span></span>
<span class="line"><span style="color:#E1E4E8;">gl.</span><span style="color:#B392F0;">bufferData</span><span style="color:#E1E4E8;">(gl.</span><span style="color:#79B8FF;">ARRAY_BUFFER</span><span style="color:#E1E4E8;">, </span><span style="color:#F97583;">new</span><span style="color:#B392F0;"> Float32Array</span><span style="color:#E1E4E8;">(positions), gl.</span><span style="color:#79B8FF;">STATIC_DRAW</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 设置顶点属性</span></span>
<span class="line"><span style="color:#E1E4E8;">gl.</span><span style="color:#B392F0;">vertexAttribPointer</span><span style="color:#E1E4E8;">(positionAttributeLocation, </span><span style="color:#79B8FF;">3</span><span style="color:#E1E4E8;">, gl.</span><span style="color:#79B8FF;">FLOAT</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">gl.</span><span style="color:#B392F0;">enableVertexAttribArray</span><span style="color:#E1E4E8;">(positionAttributeLocation);</span></span></code></pre></div><h2 id="纹理" tabindex="-1">纹理 <a class="header-anchor" href="#纹理" aria-label="Permalink to &quot;纹理&quot;">​</a></h2><p>纹理用于为 3D 模型添加表面细节，支持 2D 纹理、立方体贴图等类型。纹理数据可以来自图像、视频或 Canvas。</p><p>特点：</p><ul><li>支持多种像素格式 (RGB、RGBA 等)</li><li>可配置的滤波和环绕模式</li><li>MIPMAP 用于多级细节</li></ul><p>纹理加载流程：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span>图像加载 → 创建纹理 → 设置参数 → 上传数据 → 生成MIPMAP</span></span>
<span class="line"><span>   ↓          ↓          ↓          ↓          ↓</span></span>
<span class="line"><span>&lt;img&gt;    gl.createTexture() gl.texParameteri() gl.texImage2D() gl.generateMipmap()</span></span></code></pre></div><p>纹理坐标示意图：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span>纹理坐标 (0-1)：</span></span>
<span class="line"><span>(0,0) --- (1,0)</span></span>
<span class="line"><span>  |         |</span></span>
<span class="line"><span>  |  图像   |</span></span>
<span class="line"><span>  |         |</span></span>
<span class="line"><span>(0,1) --- (1,1)</span></span></code></pre></div><h2 id="变换矩阵" tabindex="-1">变换矩阵 <a class="header-anchor" href="#变换矩阵" aria-label="Permalink to &quot;变换矩阵&quot;">​</a></h2><p>矩阵用于坐标变换，包括模型、视图和投影变换。WebGL 不提供内置矩阵函数，需要开发者自己实现或使用库。</p><p>特点：</p><ul><li>4x4 齐次坐标矩阵</li><li>矩阵乘法实现变换组合</li><li>常用库：glMatrix、Three.js 矩阵类</li></ul><p>变换流程示意图：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span>局部坐标 → 模型矩阵 → 世界坐标 → 视图矩阵 → 视图坐标 → 投影矩阵 → 裁剪坐标</span></span>
<span class="line"><span>   ↓          ↓          ↓          ↓          ↓          ↓          ↓</span></span>
<span class="line"><span>原始位置    移动旋转    场景位置    相机视角    相对相机    透视/正交   标准化坐标</span></span></code></pre></div><p>矩阵设置代码：</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;">// 使用 glMatrix 库</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#79B8FF;"> modelViewMatrix</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> mat4.</span><span style="color:#B392F0;">create</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#79B8FF;"> projectionMatrix</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> mat4.</span><span style="color:#B392F0;">create</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">mat4.</span><span style="color:#B392F0;">perspective</span><span style="color:#E1E4E8;">(projectionMatrix, </span><span style="color:#79B8FF;">45</span><span style="color:#F97583;"> *</span><span style="color:#E1E4E8;"> Math.</span><span style="color:#79B8FF;">PI</span><span style="color:#F97583;"> /</span><span style="color:#79B8FF;"> 180</span><span style="color:#E1E4E8;">, canvas.width </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;"> canvas.height, </span><span style="color:#79B8FF;">0.1</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">100.0</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">mat4.</span><span style="color:#B392F0;">translate</span><span style="color:#E1E4E8;">(modelViewMatrix, modelViewMatrix, [</span><span style="color:#79B8FF;">0.0</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">0.0</span><span style="color:#E1E4E8;">, </span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">6.0</span><span style="color:#E1E4E8;">]);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 传递给着色器</span></span>
<span class="line"><span style="color:#E1E4E8;">gl.</span><span style="color:#B392F0;">uniformMatrix4fv</span><span style="color:#E1E4E8;">(matrixLocation, </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;">, modelViewMatrix);</span></span></code></pre></div><h2 id="渲染状态" tabindex="-1">渲染状态 <a class="header-anchor" href="#渲染状态" aria-label="Permalink to &quot;渲染状态&quot;">​</a></h2><p>WebGL 使用状态机模型管理渲染设置，包括深度测试、混合、面剔除等。正确设置状态对渲染结果至关重要。</p><p>特点：</p><ul><li>状态一旦设置，持续有效直到改变</li><li>状态改变可能影响性能</li><li>需要合理管理状态组合</li></ul><p>常用状态设置：</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;">// 启用深度测试</span></span>
<span class="line"><span style="color:#E1E4E8;">gl.</span><span style="color:#B392F0;">enable</span><span style="color:#E1E4E8;">(gl.</span><span style="color:#79B8FF;">DEPTH_TEST</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">gl.</span><span style="color:#B392F0;">depthFunc</span><span style="color:#E1E4E8;">(gl.</span><span style="color:#79B8FF;">LEQUAL</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 启用混合（透明度）</span></span>
<span class="line"><span style="color:#E1E4E8;">gl.</span><span style="color:#B392F0;">enable</span><span style="color:#E1E4E8;">(gl.</span><span style="color:#79B8FF;">BLEND</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">gl.</span><span style="color:#B392F0;">blendFunc</span><span style="color:#E1E4E8;">(gl.</span><span style="color:#79B8FF;">SRC_ALPHA</span><span style="color:#E1E4E8;">, gl.</span><span style="color:#79B8FF;">ONE_MINUS_SRC_ALPHA</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 启用面剔除</span></span>
<span class="line"><span style="color:#E1E4E8;">gl.</span><span style="color:#B392F0;">enable</span><span style="color:#E1E4E8;">(gl.</span><span style="color:#79B8FF;">CULL_FACE</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">gl.</span><span style="color:#B392F0;">cullFace</span><span style="color:#E1E4E8;">(gl.</span><span style="color:#79B8FF;">BACK</span><span style="color:#E1E4E8;">);</span></span></code></pre></div><p>状态机示意图：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span>WebGL状态机</span></span>
<span class="line"><span>├── 深度测试: 启用/禁用</span></span>
<span class="line"><span>├── 混合: 启用/禁用 + 混合函数</span></span>
<span class="line"><span>├── 面剔除: 启用/禁用 + 剔除面</span></span>
<span class="line"><span>├── 模板测试: 启用/禁用 + 模板操作</span></span>
<span class="line"><span>└── 剪裁: 启用/禁用 + 剪裁平面</span></span></code></pre></div><h2 id="渲染循环" tabindex="-1">渲染循环 <a class="header-anchor" href="#渲染循环" aria-label="Permalink to &quot;渲染循环&quot;">​</a></h2><p>WebGL 应用通常使用渲染循环实现动画和交互。requestAnimationFrame 提供与显示器刷新率同步的循环机制。</p><p>特点：</p><ul><li>与浏览器重绘同步</li><li>标签页不可见时自动暂停</li><li>提供高精度时间戳</li></ul><p>渲染循环结构：</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#F97583;">function</span><span style="color:#B392F0;"> render</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">timestamp</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#6A737D;">    // 更新场景</span></span>
<span class="line"><span style="color:#B392F0;">    updateScene</span><span style="color:#E1E4E8;">(timestamp);</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#6A737D;">    // 清除画布</span></span>
<span class="line"><span style="color:#E1E4E8;">    gl.</span><span style="color:#B392F0;">clear</span><span style="color:#E1E4E8;">(gl.</span><span style="color:#79B8FF;">COLOR_BUFFER_BIT</span><span style="color:#F97583;"> |</span><span style="color:#E1E4E8;"> gl.</span><span style="color:#79B8FF;">DEPTH_BUFFER_BIT</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#6A737D;">    // 渲染对象</span></span>
<span class="line"><span style="color:#B392F0;">    renderObjects</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#6A737D;">    // 继续循环</span></span>
<span class="line"><span style="color:#B392F0;">    requestAnimationFrame</span><span style="color:#E1E4E8;">(render);</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 启动循环</span></span>
<span class="line"><span style="color:#B392F0;">requestAnimationFrame</span><span style="color:#E1E4E8;">(render);</span></span></code></pre></div><p>渲染流水线示意图：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span>清除 → 设置状态 → 绑定资源 → 绘制 → 交换缓冲区</span></span>
<span class="line"><span> ↓        ↓         ↓        ↓        ↓</span></span>
<span class="line"><span>gl.clear() 状态设置 纹理/缓冲区 gl.drawArrays() 隐式完成</span></span></code></pre></div><h2 id="错误处理" tabindex="-1">错误处理 <a class="header-anchor" href="#错误处理" aria-label="Permalink to &quot;错误处理&quot;">​</a></h2><p>WebGL 提供多种错误检查和调试机制，帮助开发者识别和解决问题。</p><p>特点：</p><ul><li>gl.getError() 获取错误代码</li><li>上下文丢失事件处理</li><li>着色器编译错误信息</li></ul><p>错误处理代码：</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;">// 检查 WebGL 错误</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#79B8FF;"> error</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> gl.</span><span style="color:#B392F0;">getError</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (error </span><span style="color:#F97583;">!==</span><span style="color:#E1E4E8;"> gl.</span><span style="color:#79B8FF;">NO_ERROR</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    console.</span><span style="color:#B392F0;">error</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;WebGL 错误:&#39;</span><span style="color:#E1E4E8;">, error);</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 检查着色器编译状态</span></span>
<span class="line"><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">!</span><span style="color:#E1E4E8;">gl.</span><span style="color:#B392F0;">getShaderParameter</span><span style="color:#E1E4E8;">(shader, gl.</span><span style="color:#79B8FF;">COMPILE_STATUS</span><span style="color:#E1E4E8;">)) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    console.</span><span style="color:#B392F0;">error</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;着色器编译错误:&#39;</span><span style="color:#E1E4E8;">, gl.</span><span style="color:#B392F0;">getShaderInfoLog</span><span style="color:#E1E4E8;">(shader));</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 处理上下文丢失</span></span>
<span class="line"><span style="color:#E1E4E8;">canvas.</span><span style="color:#B392F0;">addEventListener</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;webglcontextlost&#39;</span><span style="color:#E1E4E8;">, (</span><span style="color:#FFAB70;">event</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    event.</span><span style="color:#B392F0;">preventDefault</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#6A737D;">    // 保存状态，准备恢复</span></span>
<span class="line"><span style="color:#E1E4E8;">});</span></span></code></pre></div><h2 id="性能优化" tabindex="-1">性能优化 <a class="header-anchor" href="#性能优化" aria-label="Permalink to &quot;性能优化&quot;">​</a></h2><p>WebGL 性能优化涉及减少绘制调用、合理使用缓冲区和纹理、优化着色器等多个方面。</p><p>优化策略示意图：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span>性能问题 → 分析瓶颈 → 应用优化 → 测试效果</span></span>
<span class="line"><span>    ↓          ↓          ↓         ↓</span></span>
<span class="line"><span>帧率低      CPU/GPU     批处理    验证改进</span></span>
<span class="line"><span>          负载不均    减少状态改变</span></span></code></pre></div><p>常见优化技巧：</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;">// 1. 批处理绘制调用</span></span>
<span class="line"><span style="color:#6A737D;">// 2. 使用索引绘制减少顶点数据</span></span>
<span class="line"><span style="color:#6A737D;">// 3. 纹理图集减少纹理切换</span></span>
<span class="line"><span style="color:#6A737D;">// 4. 合理的 MIPMAP 级别</span></span>
<span class="line"><span style="color:#6A737D;">// 5. 避免在渲染循环中分配内存</span></span></code></pre></div>`,91)])])}const F=a(e,[["render",o]]);export{d as __pageData,F as default};

import{_ as n,c as a,o as l,b as p}from"./chunks/framework.CMLuPXeo.js";const F=JSON.parse('{"title":"Electron 安全","description":"","frontmatter":{},"headers":[{"level":2,"title":"安全架构基础","slug":"安全架构基础","link":"#安全架构基础","children":[]},{"level":2,"title":"上下文隔离","slug":"上下文隔离","link":"#上下文隔离","children":[{"level":3,"title":"上下文隔离的工作原理","slug":"上下文隔离的工作原理","link":"#上下文隔离的工作原理","children":[]},{"level":3,"title":"配置上下文隔离","slug":"配置上下文隔离","link":"#配置上下文隔离","children":[]}]},{"level":2,"title":"沙盒机制","slug":"沙盒机制","link":"#沙盒机制","children":[{"level":3,"title":"沙盒的工作原理","slug":"沙盒的工作原理","link":"#沙盒的工作原理","children":[]},{"level":3,"title":"沙盒配置","slug":"沙盒配置","link":"#沙盒配置","children":[]}]},{"level":2,"title":"进程间通信安全","slug":"进程间通信安全","link":"#进程间通信安全","children":[{"level":3,"title":"安全的 IPC 模式","slug":"安全的-ipc-模式","link":"#安全的-ipc-模式","children":[]},{"level":3,"title":"输入验证和清理","slug":"输入验证和清理","link":"#输入验证和清理","children":[]}]},{"level":2,"title":"内容安全策略","slug":"内容安全策略","link":"#内容安全策略","children":[{"level":3,"title":"CSP 配置","slug":"csp-配置","link":"#csp-配置","children":[]},{"level":3,"title":"CSP 指令说明","slug":"csp-指令说明","link":"#csp-指令说明","children":[]}]},{"level":2,"title":"Node.js 集成安全","slug":"node-js-集成安全","link":"#node-js-集成安全","children":[{"level":3,"title":"安全的 Node.js 配置","slug":"安全的-node-js-配置","link":"#安全的-node-js-配置","children":[]},{"level":3,"title":"预加载脚本安全实践","slug":"预加载脚本安全实践","link":"#预加载脚本安全实践","children":[]}]},{"level":2,"title":"安全配置汇总","slug":"安全配置汇总","link":"#安全配置汇总","children":[]},{"level":2,"title":"常见漏洞防护","slug":"常见漏洞防护","link":"#常见漏洞防护","children":[{"level":3,"title":"XSS 防护","slug":"xss-防护","link":"#xss-防护","children":[]},{"level":3,"title":"安全依赖管理","slug":"安全依赖管理","link":"#安全依赖管理","children":[]}]},{"level":2,"title":"生产环境加固","slug":"生产环境加固","link":"#生产环境加固","children":[{"level":3,"title":"应用程序打包加固","slug":"应用程序打包加固","link":"#应用程序打包加固","children":[]},{"level":3,"title":"运行时安全监控","slug":"运行时安全监控","link":"#运行时安全监控","children":[]}]}],"relativePath":"special/electron/security.md","filePath":"special/electron/security.md"}'),o={name:"special/electron/security.md"};function e(t,s,c,r,E,i){return l(),a("div",null,[...s[0]||(s[0]=[p(`<div style="display:none;" hidden="true" aria-hidden="true">Are you an LLM? You can read better optimized documentation at /special/electron/security.md for this page in Markdown format</div><h1 id="electron-安全" tabindex="-1">Electron 安全 <a class="header-anchor" href="#electron-安全" aria-label="Permalink to &quot;Electron 安全&quot;">​</a></h1><p>Electron 安全是构建跨平台桌面应用程序的核心考量。由于 Electron 融合了 Node.js 的后端能力与 Chromium 的前端渲染能力，这种独特的架构在为开发者提供强大功能的同时，也引入了特有的安全挑战。理解并实施全面的安全防护策略，对于保护应用程序和用户数据至关重要。</p><h2 id="安全架构基础" tabindex="-1">安全架构基础 <a class="header-anchor" href="#安全架构基础" aria-label="Permalink to &quot;安全架构基础&quot;">​</a></h2><p>Electron 的安全架构建立在进程隔离和权限控制的基础之上。应用程序分为主进程和渲染进程，每个进程具有不同的权限级别和能力范围。</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span>Electron 安全架构层次：</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    应用程序层面</span></span>
<span class="line"><span>    |</span></span>
<span class="line"><span>    +-- 主进程 (完全系统权限)</span></span>
<span class="line"><span>    |     |</span></span>
<span class="line"><span>    |     +-- Node.js 完整访问权限</span></span>
<span class="line"><span>    |     +-- 文件系统操作</span></span>
<span class="line"><span>    |     +-- 系统 API 调用</span></span>
<span class="line"><span>    |</span></span>
<span class="line"><span>    +-- 渲染进程 (受限环境)</span></span>
<span class="line"><span>          |</span></span>
<span class="line"><span>          +-- Web 内容渲染</span></span>
<span class="line"><span>          +-- 通过预加载脚本有限访问 Node.js</span></span>
<span class="line"><span>          +-- 沙盒环境执行</span></span></code></pre></div><p>主进程作为应用程序的入口点，拥有完整的 Node.js 环境访问权限，可以执行系统级操作。渲染进程负责显示用户界面，默认情况下应该运行在受限环境中，通过精心控制的通道与主进程通信。</p><h2 id="上下文隔离" tabindex="-1">上下文隔离 <a class="header-anchor" href="#上下文隔离" aria-label="Permalink to &quot;上下文隔离&quot;">​</a></h2><p>上下文隔离是 Electron 中一项关键的安全特性，它确保预加载脚本和 Electron 内部逻辑运行在独立于网页内容的上下文环境中。</p><h3 id="上下文隔离的工作原理" tabindex="-1">上下文隔离的工作原理 <a class="header-anchor" href="#上下文隔离的工作原理" aria-label="Permalink to &quot;上下文隔离的工作原理&quot;">​</a></h3><p>启用上下文隔离后，预加载脚本中的 <code>window</code> 对象与网页中的 <code>window</code> 对象完全隔离。这意味着网页内容无法直接访问预加载脚本中暴露的高权限 API。</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span>隔离前（危险）：</span></span>
<span class="line"><span>渲染进程网页 → 直接访问 → 预加载脚本的 Node.js API</span></span>
<span class="line"><span></span></span>
<span class="line"><span>隔离后（安全）：</span></span>
<span class="line"><span>渲染进程网页 → 上下文隔离边界 → 预加载脚本的 Node.js API</span></span>
<span class="line"><span>                     |</span></span>
<span class="line"><span>                     +-- 通过 contextBridge 安全通信</span></span></code></pre></div><h3 id="配置上下文隔离" tabindex="-1">配置上下文隔离 <a class="header-anchor" href="#配置上下文隔离" aria-label="Permalink to &quot;配置上下文隔离&quot;">​</a></h3><p>在主进程创建 BrowserWindow 时启用上下文隔离：</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;">// main.js</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> { </span><span style="color:#79B8FF;">app</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">BrowserWindow</span><span style="color:#E1E4E8;"> } </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;electron&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">function</span><span style="color:#B392F0;"> createWindow</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#F97583;">  const</span><span style="color:#79B8FF;"> win</span><span style="color:#F97583;"> =</span><span style="color:#F97583;"> new</span><span style="color:#B392F0;"> BrowserWindow</span><span style="color:#E1E4E8;">({</span></span>
<span class="line"><span style="color:#E1E4E8;">    width: </span><span style="color:#79B8FF;">800</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    height: </span><span style="color:#79B8FF;">600</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    webPreferences: {</span></span>
<span class="line"><span style="color:#E1E4E8;">      contextIsolation: </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">, </span><span style="color:#6A737D;">// 启用上下文隔离</span></span>
<span class="line"><span style="color:#E1E4E8;">      preload: path.</span><span style="color:#B392F0;">join</span><span style="color:#E1E4E8;">(__dirname, </span><span style="color:#9ECBFF;">&#39;preload.js&#39;</span><span style="color:#E1E4E8;">),</span></span>
<span class="line"><span style="color:#E1E4E8;">    },</span></span>
<span class="line"><span style="color:#E1E4E8;">  })</span></span>
<span class="line"><span style="color:#E1E4E8;">  win.</span><span style="color:#B392F0;">loadFile</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;index.html&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre></div><p>在预加载脚本中使用 contextBridge 安全地暴露 API：</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;">// preload.js</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> { </span><span style="color:#79B8FF;">contextBridge</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">ipcRenderer</span><span style="color:#E1E4E8;"> } </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;electron&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">contextBridge.</span><span style="color:#B392F0;">exposeInMainWorld</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;electronAPI&#39;</span><span style="color:#E1E4E8;">, {</span></span>
<span class="line"><span style="color:#B392F0;">  readFile</span><span style="color:#E1E4E8;">: (</span><span style="color:#FFAB70;">filePath</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> ipcRenderer.</span><span style="color:#B392F0;">invoke</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;file:read&#39;</span><span style="color:#E1E4E8;">, filePath),</span></span>
<span class="line"><span style="color:#B392F0;">  showDialog</span><span style="color:#E1E4E8;">: (</span><span style="color:#FFAB70;">options</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> ipcRenderer.</span><span style="color:#B392F0;">invoke</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;show-dialog&#39;</span><span style="color:#E1E4E8;">, options),</span></span>
<span class="line"><span style="color:#E1E4E8;">})</span></span></code></pre></div><p>从 Electron 12 开始，上下文隔离默认启用，这是官方强烈推荐的安全配置。</p><h2 id="沙盒机制" tabindex="-1">沙盒机制 <a class="header-anchor" href="#沙盒机制" aria-label="Permalink to &quot;沙盒机制&quot;">​</a></h2><p>沙盒是 Chromium 的关键安全特性，它使用操作系统功能来严格限制渲染器进程可以访问的资源。</p><h3 id="沙盒的工作原理" tabindex="-1">沙盒的工作原理 <a class="header-anchor" href="#沙盒的工作原理" aria-label="Permalink to &quot;沙盒的工作原理&quot;">​</a></h3><p>沙盒化的进程只能自由使用 CPU 周期和内存。为了执行需要额外权限的操作，沙盒化的进程通过专用通信渠道将任务委托给更高权限的进程。</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span>沙盒化渲染进程：</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    渲染进程 (沙盒内)</span></span>
<span class="line"><span>    |</span></span>
<span class="line"><span>    +-- 只能访问 CPU 和内存</span></span>
<span class="line"><span>    +-- 无法直接访问：</span></span>
<span class="line"><span>          |</span></span>
<span class="line"><span>          +-- 文件系统</span></span>
<span class="line"><span>          +-- 网络</span></span>
<span class="line"><span>          +-- 系统设备</span></span>
<span class="line"><span>    |</span></span>
<span class="line"><span>    +-- 通过 IPC 将特权操作委托给主进程</span></span></code></pre></div><h3 id="沙盒配置" tabindex="-1">沙盒配置 <a class="header-anchor" href="#沙盒配置" aria-label="Permalink to &quot;沙盒配置&quot;">​</a></h3><p>从 Electron 20 开始，渲染进程默认启用了沙盒，无需进一步配置。但你也可以显式配置沙盒设置：</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;">// main.js</span></span>
<span class="line"><span style="color:#E1E4E8;">app.</span><span style="color:#B392F0;">whenReady</span><span style="color:#E1E4E8;">().</span><span style="color:#B392F0;">then</span><span style="color:#E1E4E8;">(() </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#F97583;">  const</span><span style="color:#79B8FF;"> win</span><span style="color:#F97583;"> =</span><span style="color:#F97583;"> new</span><span style="color:#B392F0;"> BrowserWindow</span><span style="color:#E1E4E8;">({</span></span>
<span class="line"><span style="color:#E1E4E8;">    webPreferences: {</span></span>
<span class="line"><span style="color:#E1E4E8;">      sandbox: </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">, </span><span style="color:#6A737D;">// 显式启用沙盒</span></span>
<span class="line"><span style="color:#E1E4E8;">    },</span></span>
<span class="line"><span style="color:#E1E4E8;">  })</span></span>
<span class="line"><span style="color:#E1E4E8;">  win.</span><span style="color:#B392F0;">loadURL</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;https://google.com&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">})</span></span></code></pre></div><p>需要注意的是，沙盒与 Node.js 集成是互斥的。启用渲染进程的 Node.js 集成 (通过设置 <code>nodeIntegration: true</code>) 会禁用该进程的沙盒。</p><h2 id="进程间通信安全" tabindex="-1">进程间通信安全 <a class="header-anchor" href="#进程间通信安全" aria-label="Permalink to &quot;进程间通信安全&quot;">​</a></h2><p>进程间通信是 Electron 应用中连接主进程和渲染进程的桥梁，确保 IPC 通信的安全至关重要。</p><h3 id="安全的-ipc-模式" tabindex="-1">安全的 IPC 模式 <a class="header-anchor" href="#安全的-ipc-模式" aria-label="Permalink to &quot;安全的 IPC 模式&quot;">​</a></h3><p>所有从渲染进程发起的特权操作都应该通过 IPC 请求主进程执行：</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;">// main.js - IPC 处理器</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> { </span><span style="color:#79B8FF;">ipcMain</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">dialog</span><span style="color:#E1E4E8;"> } </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;electron&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#79B8FF;"> fs</span><span style="color:#F97583;"> =</span><span style="color:#B392F0;"> require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;fs&#39;</span><span style="color:#E1E4E8;">).promises</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 安全地处理文件读取请求</span></span>
<span class="line"><span style="color:#E1E4E8;">ipcMain.</span><span style="color:#B392F0;">handle</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;file:read&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#F97583;">async</span><span style="color:#E1E4E8;"> (</span><span style="color:#FFAB70;">event</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">filePath</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#6A737D;">  // 验证文件路径合法性</span></span>
<span class="line"><span style="color:#F97583;">  if</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">!</span><span style="color:#B392F0;">isValidPath</span><span style="color:#E1E4E8;">(filePath)) {</span></span>
<span class="line"><span style="color:#F97583;">    throw</span><span style="color:#F97583;"> new</span><span style="color:#B392F0;"> Error</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;无效的文件路径&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">  try</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#F97583;">    const</span><span style="color:#79B8FF;"> content</span><span style="color:#F97583;"> =</span><span style="color:#F97583;"> await</span><span style="color:#E1E4E8;"> fs.</span><span style="color:#B392F0;">readFile</span><span style="color:#E1E4E8;">(filePath, </span><span style="color:#9ECBFF;">&#39;utf-8&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#F97583;">    return</span><span style="color:#E1E4E8;"> content</span></span>
<span class="line"><span style="color:#E1E4E8;">  } </span><span style="color:#F97583;">catch</span><span style="color:#E1E4E8;"> (error) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    console.</span><span style="color:#B392F0;">error</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;文件读取失败:&#39;</span><span style="color:#E1E4E8;">, error)</span></span>
<span class="line"><span style="color:#F97583;">    throw</span><span style="color:#E1E4E8;"> error</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 显示对话框的 IPC 处理器</span></span>
<span class="line"><span style="color:#E1E4E8;">ipcMain.</span><span style="color:#B392F0;">handle</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;show-dialog&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#F97583;">async</span><span style="color:#E1E4E8;"> (</span><span style="color:#FFAB70;">event</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">options</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#F97583;">  return</span><span style="color:#E1E4E8;"> dialog.</span><span style="color:#B392F0;">showMessageBox</span><span style="color:#E1E4E8;">(options)</span></span>
<span class="line"><span style="color:#E1E4E8;">})</span></span></code></pre></div><h3 id="输入验证和清理" tabindex="-1">输入验证和清理 <a class="header-anchor" href="#输入验证和清理" aria-label="Permalink to &quot;输入验证和清理&quot;">​</a></h3><p>对所有从渲染进程接收的输入进行严格验证：</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;">// 输入验证工具函数</span></span>
<span class="line"><span style="color:#F97583;">function</span><span style="color:#B392F0;"> isValidPath</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">filePath</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#6A737D;">  // 防止路径遍历攻击</span></span>
<span class="line"><span style="color:#F97583;">  if</span><span style="color:#E1E4E8;"> (filePath.</span><span style="color:#B392F0;">includes</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;..&#39;</span><span style="color:#E1E4E8;">)) </span><span style="color:#F97583;">return</span><span style="color:#79B8FF;"> false</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">  // 限制文件路径到特定目录</span></span>
<span class="line"><span style="color:#F97583;">  const</span><span style="color:#79B8FF;"> allowedBase</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> process.</span><span style="color:#B392F0;">cwd</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"><span style="color:#F97583;">  const</span><span style="color:#79B8FF;"> resolvedPath</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> path.</span><span style="color:#B392F0;">resolve</span><span style="color:#E1E4E8;">(filePath)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">  return</span><span style="color:#E1E4E8;"> resolvedPath.</span><span style="color:#B392F0;">startsWith</span><span style="color:#E1E4E8;">(allowedBase)</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">function</span><span style="color:#B392F0;"> sanitizeInput</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">input</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#6A737D;">  // 移除潜在的恶意字符</span></span>
<span class="line"><span style="color:#F97583;">  return</span><span style="color:#E1E4E8;"> input.</span><span style="color:#B392F0;">replace</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">/</span><span style="color:#79B8FF;">[&lt;&gt;&#39;&quot;;()]</span><span style="color:#9ECBFF;">/</span><span style="color:#F97583;">g</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&#39;&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre></div><h2 id="内容安全策略" tabindex="-1">内容安全策略 <a class="header-anchor" href="#内容安全策略" aria-label="Permalink to &quot;内容安全策略&quot;">​</a></h2><p>内容安全策略是防御跨站脚本攻击的关键技术，通过白名单机制控制应用程序可以加载和执行的资源。</p><h3 id="csp-配置" tabindex="-1">CSP 配置 <a class="header-anchor" href="#csp-配置" aria-label="Permalink to &quot;CSP 配置&quot;">​</a></h3><p>在 HTML 文件中通过 meta 标签设置 CSP：</p><div class="language-html"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#E1E4E8;">&lt;!</span><span style="color:#85E89D;">DOCTYPE</span><span style="color:#B392F0;"> html</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">&lt;</span><span style="color:#85E89D;">html</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">  &lt;</span><span style="color:#85E89D;">head</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;</span><span style="color:#85E89D;">meta</span></span>
<span class="line"><span style="color:#B392F0;">      http-equiv</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;Content-Security-Policy&quot;</span></span>
<span class="line"><span style="color:#B392F0;">      content</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;default-src &#39;self&#39;; </span></span>
<span class="line"><span style="color:#9ECBFF;">                   script-src &#39;self&#39; &#39;unsafe-inline&#39;; </span></span>
<span class="line"><span style="color:#9ECBFF;">                   style-src &#39;self&#39; &#39;unsafe-inline&#39;; </span></span>
<span class="line"><span style="color:#9ECBFF;">                   img-src &#39;self&#39; data: https:;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    /&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;</span><span style="color:#85E89D;">title</span><span style="color:#E1E4E8;">&gt;安全的 Electron 应用&lt;/</span><span style="color:#85E89D;">title</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">  &lt;/</span><span style="color:#85E89D;">head</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">  &lt;</span><span style="color:#85E89D;">body</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;</span><span style="color:#85E89D;">div</span><span style="color:#B392F0;"> id</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;app&quot;</span><span style="color:#E1E4E8;">&gt;&lt;/</span><span style="color:#85E89D;">div</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;</span><span style="color:#85E89D;">script</span><span style="color:#B392F0;"> src</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;./renderer.js&quot;</span><span style="color:#E1E4E8;">&gt;&lt;/</span><span style="color:#85E89D;">script</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">  &lt;/</span><span style="color:#85E89D;">body</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">&lt;/</span><span style="color:#85E89D;">html</span><span style="color:#E1E4E8;">&gt;</span></span></code></pre></div><h3 id="csp-指令说明" tabindex="-1">CSP 指令说明 <a class="header-anchor" href="#csp-指令说明" aria-label="Permalink to &quot;CSP 指令说明&quot;">​</a></h3><ul><li><strong>default-src ‘self’</strong>：默认只允许加载同源资源</li><li><strong>script-src ‘self’</strong>：只允许执行同源脚本</li><li><strong>style-src ‘self’ ‘unsafe-inline’</strong>：允许同源样式和内联样式</li><li><strong>img-src ‘self’ data：https：</strong>：允许同源图片、data URL 和 HTTPS 图片</li></ul><h2 id="node-js-集成安全" tabindex="-1">Node.js 集成安全 <a class="header-anchor" href="#node-js-集成安全" aria-label="Permalink to &quot;Node.js 集成安全&quot;">​</a></h2><p>Node.js 集成为渲染进程提供了强大的系统访问能力，但同时也带来了显著的安全风险。</p><h3 id="安全的-node-js-配置" tabindex="-1">安全的 Node.js 配置 <a class="header-anchor" href="#安全的-node-js-配置" aria-label="Permalink to &quot;安全的 Node.js 配置&quot;">​</a></h3><p>最安全的做法是在渲染进程中完全禁用 Node.js 集成：</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;">// main.js</span></span>
<span class="line"><span style="color:#F97583;">function</span><span style="color:#B392F0;"> createWindow</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#F97583;">  const</span><span style="color:#79B8FF;"> win</span><span style="color:#F97583;"> =</span><span style="color:#F97583;"> new</span><span style="color:#B392F0;"> BrowserWindow</span><span style="color:#E1E4E8;">({</span></span>
<span class="line"><span style="color:#E1E4E8;">    width: </span><span style="color:#79B8FF;">800</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    height: </span><span style="color:#79B8FF;">600</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    webPreferences: {</span></span>
<span class="line"><span style="color:#E1E4E8;">      nodeIntegration: </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;">, </span><span style="color:#6A737D;">// 禁用 Node.js 集成</span></span>
<span class="line"><span style="color:#E1E4E8;">      contextIsolation: </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">, </span><span style="color:#6A737D;">// 启用上下文隔离</span></span>
<span class="line"><span style="color:#E1E4E8;">      sandbox: </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">, </span><span style="color:#6A737D;">// 启用沙盒</span></span>
<span class="line"><span style="color:#E1E4E8;">      preload: path.</span><span style="color:#B392F0;">join</span><span style="color:#E1E4E8;">(__dirname, </span><span style="color:#9ECBFF;">&#39;preload.js&#39;</span><span style="color:#E1E4E8;">),</span></span>
<span class="line"><span style="color:#E1E4E8;">    },</span></span>
<span class="line"><span style="color:#E1E4E8;">  })</span></span>
<span class="line"><span style="color:#E1E4E8;">  win.</span><span style="color:#B392F0;">loadFile</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;index.html&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre></div><h3 id="预加载脚本安全实践" tabindex="-1">预加载脚本安全实践 <a class="header-anchor" href="#预加载脚本安全实践" aria-label="Permalink to &quot;预加载脚本安全实践&quot;">​</a></h3><p>预加载脚本在特权上下文中运行，需要特别小心：</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;">// preload.js - 安全的预加载脚本示例</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> { </span><span style="color:#79B8FF;">contextBridge</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">ipcRenderer</span><span style="color:#E1E4E8;"> } </span><span style="color:#F97583;">=</span><span style="color:#B392F0;"> require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;electron&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 输入验证函数</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#B392F0;"> validateInput</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> (</span><span style="color:#FFAB70;">input</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#F97583;">  if</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">typeof</span><span style="color:#E1E4E8;"> input </span><span style="color:#F97583;">!==</span><span style="color:#9ECBFF;"> &#39;string&#39;</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">return</span><span style="color:#79B8FF;"> false</span></span>
<span class="line"><span style="color:#6A737D;">  // 实施具体的验证逻辑</span></span>
<span class="line"><span style="color:#F97583;">  return</span><span style="color:#79B8FF;"> true</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 安全地暴露 API</span></span>
<span class="line"><span style="color:#E1E4E8;">contextBridge.</span><span style="color:#B392F0;">exposeInMainWorld</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;electronAPI&#39;</span><span style="color:#E1E4E8;">, {</span></span>
<span class="line"><span style="color:#6A737D;">  // 只暴露必要的功能</span></span>
<span class="line"><span style="color:#B392F0;">  readFile</span><span style="color:#E1E4E8;">: (</span><span style="color:#FFAB70;">filePath</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#F97583;">    if</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">!</span><span style="color:#B392F0;">validateInput</span><span style="color:#E1E4E8;">(filePath)) {</span></span>
<span class="line"><span style="color:#F97583;">      return</span><span style="color:#79B8FF;"> Promise</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">reject</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">new</span><span style="color:#B392F0;"> Error</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;无效输入&#39;</span><span style="color:#E1E4E8;">))</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#F97583;">    return</span><span style="color:#E1E4E8;"> ipcRenderer.</span><span style="color:#B392F0;">invoke</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;file:read&#39;</span><span style="color:#E1E4E8;">, filePath)</span></span>
<span class="line"><span style="color:#E1E4E8;">  },</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">  // 记录所有操作</span></span>
<span class="line"><span style="color:#B392F0;">  logOperation</span><span style="color:#E1E4E8;">: (</span><span style="color:#FFAB70;">operation</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#F97583;">    if</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">!</span><span style="color:#B392F0;">validateInput</span><span style="color:#E1E4E8;">(operation)) </span><span style="color:#F97583;">return</span></span>
<span class="line"><span style="color:#E1E4E8;">    ipcRenderer.</span><span style="color:#B392F0;">invoke</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;log-operation&#39;</span><span style="color:#E1E4E8;">, operation)</span></span>
<span class="line"><span style="color:#E1E4E8;">  },</span></span>
<span class="line"><span style="color:#E1E4E8;">})</span></span></code></pre></div><h2 id="安全配置汇总" tabindex="-1">安全配置汇总 <a class="header-anchor" href="#安全配置汇总" aria-label="Permalink to &quot;安全配置汇总&quot;">​</a></h2><p>以下是 Electron 应用的安全配置最佳实践汇总：</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;">// 安全的主进程配置</span></span>
<span class="line"><span style="color:#F97583;">function</span><span style="color:#B392F0;"> createSecureWindow</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#F97583;">  const</span><span style="color:#79B8FF;"> win</span><span style="color:#F97583;"> =</span><span style="color:#F97583;"> new</span><span style="color:#B392F0;"> BrowserWindow</span><span style="color:#E1E4E8;">({</span></span>
<span class="line"><span style="color:#E1E4E8;">    width: </span><span style="color:#79B8FF;">800</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    height: </span><span style="color:#79B8FF;">600</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    webPreferences: {</span></span>
<span class="line"><span style="color:#6A737D;">      // 核心安全设置</span></span>
<span class="line"><span style="color:#E1E4E8;">      nodeIntegration: </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">      contextIsolation: </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">      sandbox: </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">      webSecurity: </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">      allowRunningInsecureContent: </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">      // 预加载脚本</span></span>
<span class="line"><span style="color:#E1E4E8;">      preload: path.</span><span style="color:#B392F0;">join</span><span style="color:#E1E4E8;">(__dirname, </span><span style="color:#9ECBFF;">&#39;preload.js&#39;</span><span style="color:#E1E4E8;">),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">      // 实验性功能</span></span>
<span class="line"><span style="color:#E1E4E8;">      experimentalFeatures: </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">      // 其他安全设置</span></span>
<span class="line"><span style="color:#E1E4E8;">      webgl: </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">      plugins: </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    },</span></span>
<span class="line"><span style="color:#E1E4E8;">  })</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">  // 加载本地文件或可信的 HTTPS 源</span></span>
<span class="line"><span style="color:#E1E4E8;">  win.</span><span style="color:#B392F0;">loadFile</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;index.html&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">  // 开发时打开开发者工具，生产环境关闭</span></span>
<span class="line"><span style="color:#F97583;">  if</span><span style="color:#E1E4E8;"> (process.env.</span><span style="color:#79B8FF;">NODE_ENV</span><span style="color:#F97583;"> ===</span><span style="color:#9ECBFF;"> &#39;development&#39;</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    win.webContents.</span><span style="color:#B392F0;">openDevTools</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre></div><h2 id="常见漏洞防护" tabindex="-1">常见漏洞防护 <a class="header-anchor" href="#常见漏洞防护" aria-label="Permalink to &quot;常见漏洞防护&quot;">​</a></h2><h3 id="xss-防护" tabindex="-1">XSS 防护 <a class="header-anchor" href="#xss-防护" aria-label="Permalink to &quot;XSS 防护&quot;">​</a></h3><p>跨站脚本攻击是 Electron 应用中最常见的安全威胁：</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;">// 渲染进程中的 XSS 防护</span></span>
<span class="line"><span style="color:#F97583;">function</span><span style="color:#B392F0;"> safeHTML</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">unsafeText</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#F97583;">  const</span><span style="color:#79B8FF;"> div</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> document.</span><span style="color:#B392F0;">createElement</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;div&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">  div.textContent </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> unsafeText</span></span>
<span class="line"><span style="color:#F97583;">  return</span><span style="color:#E1E4E8;"> div.innerHTML</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 安全地显示用户内容</span></span>
<span class="line"><span style="color:#F97583;">function</span><span style="color:#B392F0;"> displayUserContent</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">userContent</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#F97583;">  const</span><span style="color:#79B8FF;"> element</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> document.</span><span style="color:#B392F0;">getElementById</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;content&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#6A737D;">  // 错误做法：直接设置 innerHTML</span></span>
<span class="line"><span style="color:#6A737D;">  // element.innerHTML = userContent</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">  // 正确做法：使用 textContent 或 sanitize</span></span>
<span class="line"><span style="color:#E1E4E8;">  element.textContent </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> userContent</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre></div><h3 id="安全依赖管理" tabindex="-1">安全依赖管理 <a class="header-anchor" href="#安全依赖管理" aria-label="Permalink to &quot;安全依赖管理&quot;">​</a></h3><p>定期更新 Electron 和依赖包以修复已知漏洞：</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;">// package.json 中的安全实践</span></span>
<span class="line"><span style="color:#E1E4E8;">{</span></span>
<span class="line"><span style="color:#9ECBFF;">  &quot;name&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;secure-electron-app&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#9ECBFF;">  &quot;version&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;1.0.0&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#9ECBFF;">  &quot;dependencies&quot;</span><span style="color:#E1E4E8;">: {</span></span>
<span class="line"><span style="color:#9ECBFF;">    &quot;electron&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;^37.2.5&quot;</span><span style="color:#6A737D;"> // 使用已知安全的版本</span></span>
<span class="line"><span style="color:#E1E4E8;">  },</span></span>
<span class="line"><span style="color:#9ECBFF;">  &quot;scripts&quot;</span><span style="color:#E1E4E8;">: {</span></span>
<span class="line"><span style="color:#9ECBFF;">    &quot;audit&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;npm audit&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#6A737D;">// 定期运行安全审计</span></span>
<span class="line"><span style="color:#9ECBFF;">    &quot;update&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;npm update --save-dev&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre></div><p>根据安全公告，确保使用不受已知漏洞影响的 Electron 版本非常重要。</p><h2 id="生产环境加固" tabindex="-1">生产环境加固 <a class="header-anchor" href="#生产环境加固" aria-label="Permalink to &quot;生产环境加固&quot;">​</a></h2><h3 id="应用程序打包加固" tabindex="-1">应用程序打包加固 <a class="header-anchor" href="#应用程序打包加固" aria-label="Permalink to &quot;应用程序打包加固&quot;">​</a></h3><p>使用 ASAR 打包和完整性检查：</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;">// 启用 ASAR 完整性验证</span></span>
<span class="line"><span style="color:#E1E4E8;">app.</span><span style="color:#B392F0;">enableSandbox</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"><span style="color:#E1E4E8;">app.</span><span style="color:#B392F0;">configureHostResolver</span><span style="color:#E1E4E8;">({ enableBuiltInResolver: </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;"> })</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// 防止篡改检测</span></span>
<span class="line"><span style="color:#F97583;">function</span><span style="color:#B392F0;"> verifyApplicationIntegrity</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#6A737D;">  // 实现应用程序完整性检查逻辑</span></span>
<span class="line"><span style="color:#F97583;">  const</span><span style="color:#79B8FF;"> expectedHashes</span><span style="color:#F97583;"> =</span><span style="color:#B392F0;"> loadExpectedHashes</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"><span style="color:#F97583;">  const</span><span style="color:#79B8FF;"> currentHashes</span><span style="color:#F97583;"> =</span><span style="color:#B392F0;"> calculateFileHashes</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">  return</span><span style="color:#B392F0;"> compareHashes</span><span style="color:#E1E4E8;">(expectedHashes, currentHashes)</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre></div><h3 id="运行时安全监控" tabindex="-1">运行时安全监控 <a class="header-anchor" href="#运行时安全监控" aria-label="Permalink to &quot;运行时安全监控&quot;">​</a></h3><p>实施安全监控和异常检测：</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;">// 安全事件监控</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#79B8FF;"> securityEvents</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#B392F0;">  logSecurityEvent</span><span style="color:#E1E4E8;">: (</span><span style="color:#FFAB70;">eventType</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">details</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">\`安全事件: \${</span><span style="color:#E1E4E8;">eventType</span><span style="color:#9ECBFF;">}\`</span><span style="color:#E1E4E8;">, details)</span></span>
<span class="line"><span style="color:#6A737D;">    // 发送到安全监控服务</span></span>
<span class="line"><span style="color:#E1E4E8;">    ipcRenderer.</span><span style="color:#B392F0;">invoke</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;log-security-event&#39;</span><span style="color:#E1E4E8;">, {</span></span>
<span class="line"><span style="color:#E1E4E8;">      type: eventType,</span></span>
<span class="line"><span style="color:#E1E4E8;">      details: details,</span></span>
<span class="line"><span style="color:#E1E4E8;">      timestamp: Date.</span><span style="color:#B392F0;">now</span><span style="color:#E1E4E8;">(),</span></span>
<span class="line"><span style="color:#E1E4E8;">    })</span></span>
<span class="line"><span style="color:#E1E4E8;">  },</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">  detectAnomalies</span><span style="color:#E1E4E8;">: () </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#6A737D;">    // 检测异常行为模式</span></span>
<span class="line"><span style="color:#F97583;">    const</span><span style="color:#79B8FF;"> suspiciousPatterns</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> [</span><span style="color:#9ECBFF;">&#39;多次认证失败&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&#39;异常文件访问&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&#39;可疑网络连接&#39;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#6A737D;">    // 实现检测逻辑</span></span>
<span class="line"><span style="color:#E1E4E8;">  },</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre></div><p>Electron 安全是一个持续的过程，需要结合严格的安全策略、适当的技术控制和持续的监控维护。通过实施这些安全措施，你可以显著降低 Electron 应用程序的安全风险，保护用户数据和系统资源免受威胁。</p>`,69)])])}const d=n(o,[["render",e]]);export{F as __pageData,d as default};

import{_ as n,c as a,o as l,b as p}from"./chunks/framework.CMLuPXeo.js";const i=JSON.parse('{"title":"æ„å»º","description":"","frontmatter":{},"headers":[{"level":2,"title":"Node.js å‘½ä»¤è¡Œæ„å»ºæ¦‚è¿°","slug":"node-js-å‘½ä»¤è¡Œæ„å»ºæ¦‚è¿°","link":"#node-js-å‘½ä»¤è¡Œæ„å»ºæ¦‚è¿°","children":[]},{"level":2,"title":"é¡¹ç›®ç»“æ„ä¸åˆå§‹åŒ–","slug":"é¡¹ç›®ç»“æ„ä¸åˆå§‹åŒ–","link":"#é¡¹ç›®ç»“æ„ä¸åˆå§‹åŒ–","children":[{"level":3,"title":"æ ‡å‡†åŒ–é¡¹ç›®å¸ƒå±€","slug":"æ ‡å‡†åŒ–é¡¹ç›®å¸ƒå±€","link":"#æ ‡å‡†åŒ–é¡¹ç›®å¸ƒå±€","children":[]},{"level":3,"title":"package.json é…ç½®","slug":"package-json-é…ç½®","link":"#package-json-é…ç½®","children":[]}]},{"level":2,"title":"æ¨¡å—ç³»ç»Ÿä¸è½¬è¯‘","slug":"æ¨¡å—ç³»ç»Ÿä¸è½¬è¯‘","link":"#æ¨¡å—ç³»ç»Ÿä¸è½¬è¯‘","children":[{"level":3,"title":"ESM æ¨¡å—é…ç½®","slug":"esm-æ¨¡å—é…ç½®","link":"#esm-æ¨¡å—é…ç½®","children":[]},{"level":3,"title":"TypeScript é›†æˆ","slug":"typescript-é›†æˆ","link":"#typescript-é›†æˆ","children":[]}]},{"level":2,"title":"æ‰“åŒ…ä¸ä¼˜åŒ–","slug":"æ‰“åŒ…ä¸ä¼˜åŒ–","link":"#æ‰“åŒ…ä¸ä¼˜åŒ–","children":[{"level":3,"title":"Rollup æ‰“åŒ…é…ç½®","slug":"rollup-æ‰“åŒ…é…ç½®","link":"#rollup-æ‰“åŒ…é…ç½®","children":[]},{"level":3,"title":"ä»£ç åˆ†å‰²ä¸æ‡’åŠ è½½","slug":"ä»£ç åˆ†å‰²ä¸æ‡’åŠ è½½","link":"#ä»£ç åˆ†å‰²ä¸æ‡’åŠ è½½","children":[]}]},{"level":2,"title":"ä¾èµ–ç®¡ç†ä¸ä¼˜åŒ–","slug":"ä¾èµ–ç®¡ç†ä¸ä¼˜åŒ–","link":"#ä¾èµ–ç®¡ç†ä¸ä¼˜åŒ–","children":[{"level":3,"title":"ä¾èµ–åˆ†æå·¥å…·","slug":"ä¾èµ–åˆ†æå·¥å…·","link":"#ä¾èµ–åˆ†æå·¥å…·","children":[]},{"level":3,"title":"ç‰ˆæœ¬ç®¡ç†ä¸å…¼å®¹æ€§","slug":"ç‰ˆæœ¬ç®¡ç†ä¸å…¼å®¹æ€§","link":"#ç‰ˆæœ¬ç®¡ç†ä¸å…¼å®¹æ€§","children":[]}]},{"level":2,"title":"æ„å»ºæµæ°´çº¿ä¸è‡ªåŠ¨åŒ–","slug":"æ„å»ºæµæ°´çº¿ä¸è‡ªåŠ¨åŒ–","link":"#æ„å»ºæµæ°´çº¿ä¸è‡ªåŠ¨åŒ–","children":[{"level":3,"title":"å¤šç¯å¢ƒæ„å»ºé…ç½®","slug":"å¤šç¯å¢ƒæ„å»ºé…ç½®","link":"#å¤šç¯å¢ƒæ„å»ºé…ç½®","children":[]},{"level":3,"title":"æŒç»­é›†æˆé…ç½®","slug":"æŒç»­é›†æˆé…ç½®","link":"#æŒç»­é›†æˆé…ç½®","children":[]}]},{"level":2,"title":"é«˜çº§æ„å»ºç‰¹æ€§","slug":"é«˜çº§æ„å»ºç‰¹æ€§","link":"#é«˜çº§æ„å»ºç‰¹æ€§","children":[{"level":3,"title":"æ¡ä»¶ç¼–è¯‘ä¸ç‰¹æ€§å¼€å…³","slug":"æ¡ä»¶ç¼–è¯‘ä¸ç‰¹æ€§å¼€å…³","link":"#æ¡ä»¶ç¼–è¯‘ä¸ç‰¹æ€§å¼€å…³","children":[]},{"level":3,"title":"æ€§èƒ½åˆ†æä¸ä¼˜åŒ–","slug":"æ€§èƒ½åˆ†æä¸ä¼˜åŒ–","link":"#æ€§èƒ½åˆ†æä¸ä¼˜åŒ–","children":[]}]}],"relativePath":"special/cli/build.md","filePath":"special/cli/build.md"}'),o={name:"special/cli/build.md"};function e(c,s,E,t,r,y){return l(),a("div",null,[...s[0]||(s[0]=[p(`<div style="display:none;" hidden="true" aria-hidden="true">Are you an LLM? You can read better optimized documentation at /special/cli/build.md for this page in Markdown format</div><h1 id="æ„å»º" tabindex="-1">æ„å»º <a class="header-anchor" href="#æ„å»º" aria-label="Permalink to &quot;æ„å»º&quot;">â€‹</a></h1><h2 id="node-js-å‘½ä»¤è¡Œæ„å»ºæ¦‚è¿°" tabindex="-1">Node.js å‘½ä»¤è¡Œæ„å»ºæ¦‚è¿° <a class="header-anchor" href="#node-js-å‘½ä»¤è¡Œæ„å»ºæ¦‚è¿°" aria-label="Permalink to &quot;Node.js å‘½ä»¤è¡Œæ„å»ºæ¦‚è¿°&quot;">â€‹</a></h2><p>åœ¨ Node.js å‘½ä»¤è¡Œå·¥å…·å¼€å‘ä¸­ï¼Œæ„å»ºè¿‡ç¨‹æ˜¯å°†æºä»£ç è½¬æ¢ä¸ºå¯åˆ†å‘ã€å¯æ‰§è¡Œç¨‹åºçš„å…³é”®ç¯èŠ‚ã€‚ç°ä»£å‘½ä»¤è¡Œå·¥å…·çš„æ„å»ºæ¶‰åŠä»£ç è½¬è¯‘ã€æ‰“åŒ…ã€ä¼˜åŒ–ã€ä¾èµ–ç®¡ç†å’Œåˆ†å‘ç­–ç•¥ç­‰å¤šä¸ªæ–¹é¢ï¼Œç›´æ¥å½±å“å·¥å…·çš„æ€§èƒ½ã€å…¼å®¹æ€§å’Œç”¨æˆ·ä½“éªŒã€‚</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span>æ„å»ºæµç¨‹ç¤ºæ„å›¾ï¼š</span></span>
<span class="line"><span>æºä»£ç  â†’ è½¬è¯‘å¤„ç† â†’ æ‰“åŒ…ä¼˜åŒ– â†’ å¯æ‰§è¡Œæ–‡ä»¶ â†’ åˆ†å‘åŒ…</span></span>
<span class="line"><span>   â†“          â†“          â†“          â†“          â†“</span></span>
<span class="line"><span> .mjs/.js   Babel/TS    Webpack   äºŒè¿›åˆ¶æ–‡ä»¶   npmåŒ…</span></span>
<span class="line"><span>  æ–‡ä»¶       è½¬è¯‘        æ‰“åŒ…       ç”Ÿæˆ       å‘å¸ƒ</span></span></code></pre></div><h2 id="é¡¹ç›®ç»“æ„ä¸åˆå§‹åŒ–" tabindex="-1">é¡¹ç›®ç»“æ„ä¸åˆå§‹åŒ– <a class="header-anchor" href="#é¡¹ç›®ç»“æ„ä¸åˆå§‹åŒ–" aria-label="Permalink to &quot;é¡¹ç›®ç»“æ„ä¸åˆå§‹åŒ–&quot;">â€‹</a></h2><h3 id="æ ‡å‡†åŒ–é¡¹ç›®å¸ƒå±€" tabindex="-1">æ ‡å‡†åŒ–é¡¹ç›®å¸ƒå±€ <a class="header-anchor" href="#æ ‡å‡†åŒ–é¡¹ç›®å¸ƒå±€" aria-label="Permalink to &quot;æ ‡å‡†åŒ–é¡¹ç›®å¸ƒå±€&quot;">â€‹</a></h3><p>ç°ä»£ Node.js å‘½ä»¤è¡Œå·¥å…·éµå¾ªç‰¹å®šçš„ç›®å½•ç»“æ„ï¼Œç¡®ä¿ä»£ç ç»„ç»‡æ¸…æ™°ä¸”æ˜“äºç»´æŠ¤ã€‚</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;">// å…¸å‹é¡¹ç›®ç»“æ„</span></span>
<span class="line"><span style="color:#E1E4E8;">my</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">cli</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">tool</span><span style="color:#F97583;">/</span></span>
<span class="line"><span style="color:#E1E4E8;">â”œâ”€â”€ src</span><span style="color:#F97583;">/</span><span style="color:#6A737D;">                    // æºä»£ç ç›®å½•</span></span>
<span class="line"><span style="color:#E1E4E8;">â”‚   â”œâ”€â”€ commands</span><span style="color:#F97583;">/</span><span style="color:#6A737D;">          // å‘½ä»¤å®ç°</span></span>
<span class="line"><span style="color:#E1E4E8;">â”‚   â”œâ”€â”€ utils</span><span style="color:#F97583;">/</span><span style="color:#6A737D;">             // å·¥å…·å‡½æ•°</span></span>
<span class="line"><span style="color:#E1E4E8;">â”‚   â”œâ”€â”€ cli.mjs           </span><span style="color:#6A737D;">// ä¸»å…¥å£æ–‡ä»¶</span></span>
<span class="line"><span style="color:#E1E4E8;">â”‚   â””â”€â”€ config.mjs        </span><span style="color:#6A737D;">// é…ç½®ç®¡ç†</span></span>
<span class="line"><span style="color:#E1E4E8;">â”œâ”€â”€ bin</span><span style="color:#F97583;">/</span><span style="color:#6A737D;">                   // å¯æ‰§è¡Œæ–‡ä»¶ç›®å½•</span></span>
<span class="line"><span style="color:#E1E4E8;">â”œâ”€â”€ dist</span><span style="color:#F97583;">/</span><span style="color:#6A737D;">                  // æ„å»ºè¾“å‡ºç›®å½•</span></span>
<span class="line"><span style="color:#E1E4E8;">â”œâ”€â”€ test</span><span style="color:#F97583;">/</span><span style="color:#6A737D;">                  // æµ‹è¯•æ–‡ä»¶</span></span>
<span class="line"><span style="color:#E1E4E8;">â”œâ”€â”€ docs</span><span style="color:#F97583;">/</span><span style="color:#6A737D;">                  // æ–‡æ¡£</span></span>
<span class="line"><span style="color:#E1E4E8;">â”œâ”€â”€ package.json          </span><span style="color:#6A737D;">// é¡¹ç›®é…ç½®</span></span>
<span class="line"><span style="color:#E1E4E8;">â”œâ”€â”€ rollup.config.mjs     </span><span style="color:#6A737D;">// æ‰“åŒ…é…ç½®</span></span>
<span class="line"><span style="color:#E1E4E8;">â””â”€â”€ tsconfig.json         </span><span style="color:#6A737D;">// TypeScripté…ç½®</span></span></code></pre></div><h3 id="package-json-é…ç½®" tabindex="-1">package.json é…ç½® <a class="header-anchor" href="#package-json-é…ç½®" aria-label="Permalink to &quot;package.json é…ç½®&quot;">â€‹</a></h3><p>package.json æ˜¯ Node.js é¡¹ç›®çš„æ ¸å¿ƒé…ç½®æ–‡ä»¶ï¼Œå®šä¹‰äº†é¡¹ç›®çš„å…ƒæ•°æ®ã€ä¾èµ–å’Œè„šæœ¬ã€‚</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;">// package.json å…³é”®é…ç½®ç¤ºä¾‹</span></span>
<span class="line"><span style="color:#E1E4E8;">{</span></span>
<span class="line"><span style="color:#9ECBFF;">  &quot;name&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;my-cli-tool&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#9ECBFF;">  &quot;version&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;1.0.0&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#9ECBFF;">  &quot;description&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;ä¸€ä¸ªç°ä»£åŒ–çš„å‘½ä»¤è¡Œå·¥å…·&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#9ECBFF;">  &quot;type&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;module&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#9ECBFF;">  &quot;bin&quot;</span><span style="color:#E1E4E8;">: {</span></span>
<span class="line"><span style="color:#9ECBFF;">    &quot;my-cli&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;./bin/cli.mjs&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">  },</span></span>
<span class="line"><span style="color:#9ECBFF;">  &quot;main&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;./dist/cli.mjs&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#9ECBFF;">  &quot;exports&quot;</span><span style="color:#E1E4E8;">: {</span></span>
<span class="line"><span style="color:#9ECBFF;">    &quot;.&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;./dist/cli.mjs&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#9ECBFF;">    &quot;./package.json&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;./package.json&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">  },</span></span>
<span class="line"><span style="color:#9ECBFF;">  &quot;files&quot;</span><span style="color:#E1E4E8;">: [</span></span>
<span class="line"><span style="color:#9ECBFF;">    &quot;bin&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#9ECBFF;">    &quot;dist&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#9ECBFF;">    &quot;README.md&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">  ],</span></span>
<span class="line"><span style="color:#9ECBFF;">  &quot;scripts&quot;</span><span style="color:#E1E4E8;">: {</span></span>
<span class="line"><span style="color:#9ECBFF;">    &quot;build&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;rollup -c&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#9ECBFF;">    &quot;dev&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;rollup -c -w&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#9ECBFF;">    &quot;test&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;node --test test/&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#9ECBFF;">    &quot;lint&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;eslint src/&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#9ECBFF;">    &quot;prepublishOnly&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;npm run build &amp;&amp; npm test&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">  },</span></span>
<span class="line"><span style="color:#9ECBFF;">  &quot;engines&quot;</span><span style="color:#E1E4E8;">: {</span></span>
<span class="line"><span style="color:#9ECBFF;">    &quot;node&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;&gt;=18.0.0&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre></div><h2 id="æ¨¡å—ç³»ç»Ÿä¸è½¬è¯‘" tabindex="-1">æ¨¡å—ç³»ç»Ÿä¸è½¬è¯‘ <a class="header-anchor" href="#æ¨¡å—ç³»ç»Ÿä¸è½¬è¯‘" aria-label="Permalink to &quot;æ¨¡å—ç³»ç»Ÿä¸è½¬è¯‘&quot;">â€‹</a></h2><h3 id="esm-æ¨¡å—é…ç½®" tabindex="-1">ESM æ¨¡å—é…ç½® <a class="header-anchor" href="#esm-æ¨¡å—é…ç½®" aria-label="Permalink to &quot;ESM æ¨¡å—é…ç½®&quot;">â€‹</a></h3><p>ESM (ECMAScript Modules) æ˜¯ç°ä»£ JavaScript çš„æ¨¡å—æ ‡å‡†ï¼Œæä¾›äº†æ›´å¥½çš„é™æ€åˆ†æå’Œ tree-shaking èƒ½åŠ›ã€‚</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;">// src/cli.mjs - ä¸»å…¥å£æ–‡ä»¶</span></span>
<span class="line"><span style="color:#E1E4E8;">#</span><span style="color:#F97583;">!/</span><span style="color:#E1E4E8;">usr</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">bin</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">env node</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { Command } </span><span style="color:#F97583;">from</span><span style="color:#9ECBFF;"> &#39;commander&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { createRequire } </span><span style="color:#F97583;">from</span><span style="color:#9ECBFF;"> &#39;node:module&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { fileURLToPath } </span><span style="color:#F97583;">from</span><span style="color:#9ECBFF;"> &#39;node:url&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { dirname, join } </span><span style="color:#F97583;">from</span><span style="color:#9ECBFF;"> &#39;node:path&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// å…¼å®¹æ€§å¤„ç†</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#79B8FF;"> require</span><span style="color:#F97583;"> =</span><span style="color:#B392F0;"> createRequire</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">import</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">meta</span><span style="color:#E1E4E8;">.url);</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#79B8FF;"> __dirname</span><span style="color:#F97583;"> =</span><span style="color:#B392F0;"> dirname</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">fileURLToPath</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">import</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">meta</span><span style="color:#E1E4E8;">.url));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// å¯¼å…¥æœ¬åœ°æ¨¡å—</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { version } </span><span style="color:#F97583;">from</span><span style="color:#9ECBFF;"> &#39;../package.json&#39;</span><span style="color:#F97583;"> assert</span><span style="color:#E1E4E8;"> { type: </span><span style="color:#9ECBFF;">&#39;json&#39;</span><span style="color:#E1E4E8;"> };</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { setupCommands } </span><span style="color:#F97583;">from</span><span style="color:#9ECBFF;"> &#39;./commands/index.mjs&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { config } </span><span style="color:#F97583;">from</span><span style="color:#9ECBFF;"> &#39;./config.mjs&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">class</span><span style="color:#B392F0;"> CLITool</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#F97583;">  constructor</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#79B8FF;">    this</span><span style="color:#E1E4E8;">.program </span><span style="color:#F97583;">=</span><span style="color:#F97583;"> new</span><span style="color:#B392F0;"> Command</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#79B8FF;">    this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">setupProgram</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#B392F0;">  setupProgram</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#79B8FF;">    this</span><span style="color:#E1E4E8;">.program</span></span>
<span class="line"><span style="color:#E1E4E8;">      .</span><span style="color:#B392F0;">name</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;my-cli&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">      .</span><span style="color:#B392F0;">description</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;ä¸€ä¸ªç°ä»£åŒ–çš„å‘½ä»¤è¡Œå·¥å…·&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">      .</span><span style="color:#B392F0;">version</span><span style="color:#E1E4E8;">(version);</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#B392F0;">    setupCommands</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.program);</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#F97583;">  async</span><span style="color:#B392F0;"> run</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#F97583;">    await</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.program.</span><span style="color:#B392F0;">parseAsync</span><span style="color:#E1E4E8;">(process.argv);</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// å¯åŠ¨åº”ç”¨</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#79B8FF;"> cli</span><span style="color:#F97583;"> =</span><span style="color:#F97583;"> new</span><span style="color:#B392F0;"> CLITool</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">cli.</span><span style="color:#B392F0;">run</span><span style="color:#E1E4E8;">().</span><span style="color:#B392F0;">catch</span><span style="color:#E1E4E8;">(console.error);</span></span></code></pre></div><h3 id="typescript-é›†æˆ" tabindex="-1">TypeScript é›†æˆ <a class="header-anchor" href="#typescript-é›†æˆ" aria-label="Permalink to &quot;TypeScript é›†æˆ&quot;">â€‹</a></h3><p>TypeScript æä¾›ç±»å‹å®‰å…¨å’Œæ›´å¥½çš„å¼€å‘ä½“éªŒï¼Œéœ€è¦é€šè¿‡æ„å»ºè¿‡ç¨‹è½¬æ¢ä¸º JavaScriptã€‚</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;">// tsconfig.json</span></span>
<span class="line"><span style="color:#E1E4E8;">{</span></span>
<span class="line"><span style="color:#9ECBFF;">  &quot;compilerOptions&quot;</span><span style="color:#E1E4E8;">: {</span></span>
<span class="line"><span style="color:#9ECBFF;">    &quot;target&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;ES2022&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#9ECBFF;">    &quot;module&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;ESNext&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#9ECBFF;">    &quot;moduleResolution&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;node&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#9ECBFF;">    &quot;allowSyntheticDefaultImports&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#9ECBFF;">    &quot;esModuleInterop&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#9ECBFF;">    &quot;strict&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#9ECBFF;">    &quot;outDir&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;./dist&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#9ECBFF;">    &quot;rootDir&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;./src&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#9ECBFF;">    &quot;declaration&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#9ECBFF;">    &quot;declarationMap&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#9ECBFF;">    &quot;sourceMap&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">true</span></span>
<span class="line"><span style="color:#E1E4E8;">  },</span></span>
<span class="line"><span style="color:#9ECBFF;">  &quot;include&quot;</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;src/**/*&quot;</span><span style="color:#E1E4E8;">],</span></span>
<span class="line"><span style="color:#9ECBFF;">  &quot;exclude&quot;</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;node_modules&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;dist&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;test&quot;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// src/types.mjs - ç±»å‹å®šä¹‰</span></span>
<span class="line"><span style="color:#6A737D;">/**</span></span>
<span class="line"><span style="color:#6A737D;"> * </span><span style="color:#F97583;">@typedef</span><span style="color:#B392F0;"> {Object}</span><span style="color:#B392F0;"> BuildConfig</span></span>
<span class="line"><span style="color:#6A737D;"> * </span><span style="color:#F97583;">@property</span><span style="color:#B392F0;"> {string}</span><span style="color:#E1E4E8;"> entry</span></span>
<span class="line"><span style="color:#6A737D;"> * </span><span style="color:#F97583;">@property</span><span style="color:#B392F0;"> {string}</span><span style="color:#E1E4E8;"> output</span></span>
<span class="line"><span style="color:#6A737D;"> * </span><span style="color:#F97583;">@property</span><span style="color:#B392F0;"> {boolean}</span><span style="color:#E1E4E8;"> minify</span></span>
<span class="line"><span style="color:#6A737D;"> * </span><span style="color:#F97583;">@property</span><span style="color:#B392F0;"> {string}</span><span style="color:#E1E4E8;"> platform</span></span>
<span class="line"><span style="color:#6A737D;"> */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">/**</span></span>
<span class="line"><span style="color:#6A737D;"> * </span><span style="color:#F97583;">@typedef</span><span style="color:#B392F0;"> {Object}</span><span style="color:#B392F0;"> CommandOptions</span></span>
<span class="line"><span style="color:#6A737D;"> * </span><span style="color:#F97583;">@property</span><span style="color:#B392F0;"> {boolean}</span><span style="color:#E1E4E8;"> verbose</span></span>
<span class="line"><span style="color:#6A737D;"> * </span><span style="color:#F97583;">@property</span><span style="color:#B392F0;"> {string}</span><span style="color:#E1E4E8;"> config</span></span>
<span class="line"><span style="color:#6A737D;"> */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// TypeScript ç¼–è¯‘è„šæœ¬</span></span>
<span class="line"><span style="color:#6A737D;">// build-ts.mjs</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { execSync } </span><span style="color:#F97583;">from</span><span style="color:#9ECBFF;"> &#39;node:child_process&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { readFileSync, writeFileSync } </span><span style="color:#F97583;">from</span><span style="color:#9ECBFF;"> &#39;node:fs&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">function</span><span style="color:#B392F0;"> compileTypeScript</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#F97583;">  try</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;ğŸ”¨ ç¼–è¯‘ TypeScript...&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#B392F0;">    execSync</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;tsc&#39;</span><span style="color:#E1E4E8;">, { stdio: </span><span style="color:#9ECBFF;">&#39;inherit&#39;</span><span style="color:#E1E4E8;"> });</span></span>
<span class="line"><span style="color:#E1E4E8;">    console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;âœ… TypeScript ç¼–è¯‘å®Œæˆ&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">  } </span><span style="color:#F97583;">catch</span><span style="color:#E1E4E8;"> (error) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    console.</span><span style="color:#B392F0;">error</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;âŒ TypeScript ç¼–è¯‘å¤±è´¥:&#39;</span><span style="color:#E1E4E8;">, error.message);</span></span>
<span class="line"><span style="color:#E1E4E8;">    process.</span><span style="color:#B392F0;">exit</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// ç”Ÿæˆç±»å‹å£°æ˜æ–‡ä»¶</span></span>
<span class="line"><span style="color:#F97583;">function</span><span style="color:#B392F0;"> generateDeclarations</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#F97583;">  const</span><span style="color:#79B8FF;"> pkg</span><span style="color:#F97583;"> =</span><span style="color:#79B8FF;"> JSON</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">parse</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">readFileSync</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;package.json&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&#39;utf8&#39;</span><span style="color:#E1E4E8;">));</span></span>
<span class="line"><span style="color:#E1E4E8;">  pkg.types </span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;"> &#39;./dist/cli.d.ts&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#B392F0;">  writeFileSync</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;package.json&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">JSON</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">stringify</span><span style="color:#E1E4E8;">(pkg, </span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">));</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">compileTypeScript</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#B392F0;">generateDeclarations</span><span style="color:#E1E4E8;">();</span></span></code></pre></div><h2 id="æ‰“åŒ…ä¸ä¼˜åŒ–" tabindex="-1">æ‰“åŒ…ä¸ä¼˜åŒ– <a class="header-anchor" href="#æ‰“åŒ…ä¸ä¼˜åŒ–" aria-label="Permalink to &quot;æ‰“åŒ…ä¸ä¼˜åŒ–&quot;">â€‹</a></h2><h3 id="rollup-æ‰“åŒ…é…ç½®" tabindex="-1">Rollup æ‰“åŒ…é…ç½® <a class="header-anchor" href="#rollup-æ‰“åŒ…é…ç½®" aria-label="Permalink to &quot;Rollup æ‰“åŒ…é…ç½®&quot;">â€‹</a></h3><p>Rollup æ˜¯ä¸“ä¸ºåº“å’Œå‘½ä»¤è¡Œå·¥å…·è®¾è®¡çš„æ‰“åŒ…å™¨ï¼Œæä¾›ä¼˜ç§€çš„ tree-shaking åŠŸèƒ½ã€‚</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;">// rollup.config.mjs</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { defineConfig } </span><span style="color:#F97583;">from</span><span style="color:#9ECBFF;"> &#39;rollup&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { nodeResolve } </span><span style="color:#F97583;">from</span><span style="color:#9ECBFF;"> &#39;@rollup/plugin-node-resolve&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> commonjs </span><span style="color:#F97583;">from</span><span style="color:#9ECBFF;"> &#39;@rollup/plugin-commonjs&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> json </span><span style="color:#F97583;">from</span><span style="color:#9ECBFF;"> &#39;@rollup/plugin-json&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { babel } </span><span style="color:#F97583;">from</span><span style="color:#9ECBFF;"> &#39;@rollup/plugin-babel&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { terser } </span><span style="color:#F97583;">from</span><span style="color:#9ECBFF;"> &#39;rollup-plugin-terser&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">export</span><span style="color:#F97583;"> default</span><span style="color:#B392F0;"> defineConfig</span><span style="color:#E1E4E8;">({</span></span>
<span class="line"><span style="color:#E1E4E8;">  input: </span><span style="color:#9ECBFF;">&#39;src/cli.mjs&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  output: [</span></span>
<span class="line"><span style="color:#E1E4E8;">    {</span></span>
<span class="line"><span style="color:#E1E4E8;">      file: </span><span style="color:#9ECBFF;">&#39;dist/cli.mjs&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">      format: </span><span style="color:#9ECBFF;">&#39;esm&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">      banner: </span><span style="color:#9ECBFF;">&#39;#!/usr/bin/env node&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">      sourcemap: </span><span style="color:#79B8FF;">true</span></span>
<span class="line"><span style="color:#E1E4E8;">    },</span></span>
<span class="line"><span style="color:#E1E4E8;">    {</span></span>
<span class="line"><span style="color:#E1E4E8;">      file: </span><span style="color:#9ECBFF;">&#39;dist/cli.cjs&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">      format: </span><span style="color:#9ECBFF;">&#39;cjs&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">      banner: </span><span style="color:#9ECBFF;">&#39;#!/usr/bin/env node&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">      sourcemap: </span><span style="color:#79B8FF;">true</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">  ],</span></span>
<span class="line"><span style="color:#E1E4E8;">  plugins: [</span></span>
<span class="line"><span style="color:#B392F0;">    nodeResolve</span><span style="color:#E1E4E8;">({</span></span>
<span class="line"><span style="color:#E1E4E8;">      preferBuiltins: </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">      exportConditions: [</span><span style="color:#9ECBFF;">&#39;node&#39;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">    }),</span></span>
<span class="line"><span style="color:#B392F0;">    commonjs</span><span style="color:#E1E4E8;">(),</span></span>
<span class="line"><span style="color:#B392F0;">    json</span><span style="color:#E1E4E8;">(),</span></span>
<span class="line"><span style="color:#B392F0;">    babel</span><span style="color:#E1E4E8;">({</span></span>
<span class="line"><span style="color:#E1E4E8;">      babelHelpers: </span><span style="color:#9ECBFF;">&#39;bundled&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">      exclude: </span><span style="color:#9ECBFF;">&#39;node_modules/**&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">      presets: [</span></span>
<span class="line"><span style="color:#E1E4E8;">        [</span><span style="color:#9ECBFF;">&#39;@babel/preset-env&#39;</span><span style="color:#E1E4E8;">, {</span></span>
<span class="line"><span style="color:#E1E4E8;">          targets: { node: </span><span style="color:#9ECBFF;">&#39;18.0.0&#39;</span><span style="color:#E1E4E8;"> },</span></span>
<span class="line"><span style="color:#E1E4E8;">          modules: </span><span style="color:#79B8FF;">false</span></span>
<span class="line"><span style="color:#E1E4E8;">        }]</span></span>
<span class="line"><span style="color:#E1E4E8;">      ]</span></span>
<span class="line"><span style="color:#E1E4E8;">    }),</span></span>
<span class="line"><span style="color:#B392F0;">    terser</span><span style="color:#E1E4E8;">({</span></span>
<span class="line"><span style="color:#E1E4E8;">      compress: {</span></span>
<span class="line"><span style="color:#E1E4E8;">        drop_console: </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">        drop_debugger: </span><span style="color:#79B8FF;">true</span></span>
<span class="line"><span style="color:#E1E4E8;">      }</span></span>
<span class="line"><span style="color:#E1E4E8;">    })</span></span>
<span class="line"><span style="color:#E1E4E8;">  ],</span></span>
<span class="line"><span style="color:#E1E4E8;">  external: [</span></span>
<span class="line"><span style="color:#9ECBFF;">    &#39;commander&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#9ECBFF;">    &#39;chalk&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#9ECBFF;">    &#39;fs&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#9ECBFF;">    &#39;path&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#9ECBFF;">    &#39;child_process&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">  ]</span></span>
<span class="line"><span style="color:#E1E4E8;">});</span></span></code></pre></div><h3 id="ä»£ç åˆ†å‰²ä¸æ‡’åŠ è½½" tabindex="-1">ä»£ç åˆ†å‰²ä¸æ‡’åŠ è½½ <a class="header-anchor" href="#ä»£ç åˆ†å‰²ä¸æ‡’åŠ è½½" aria-label="Permalink to &quot;ä»£ç åˆ†å‰²ä¸æ‡’åŠ è½½&quot;">â€‹</a></h3><p>å¯¹äºå¤§å‹å‘½ä»¤è¡Œå·¥å…·ï¼Œä»£ç åˆ†å‰²å¯ä»¥æ˜¾è‘—æ”¹å–„å¯åŠ¨æ€§èƒ½ã€‚</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;">// src/utils/lazy-loader.mjs</span></span>
<span class="line"><span style="color:#F97583;">class</span><span style="color:#B392F0;"> LazyLoader</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#F97583;">  constructor</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#79B8FF;">    this</span><span style="color:#E1E4E8;">.modules </span><span style="color:#F97583;">=</span><span style="color:#F97583;"> new</span><span style="color:#B392F0;"> Map</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#79B8FF;">    this</span><span style="color:#E1E4E8;">.loading </span><span style="color:#F97583;">=</span><span style="color:#F97583;"> new</span><span style="color:#B392F0;"> Map</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#F97583;">  async</span><span style="color:#B392F0;"> load</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">modulePath</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">moduleName</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#F97583;">    if</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.modules.</span><span style="color:#B392F0;">has</span><span style="color:#E1E4E8;">(moduleName)) {</span></span>
<span class="line"><span style="color:#F97583;">      return</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.modules.</span><span style="color:#B392F0;">get</span><span style="color:#E1E4E8;">(moduleName);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#F97583;">    if</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.loading.</span><span style="color:#B392F0;">has</span><span style="color:#E1E4E8;">(moduleName)) {</span></span>
<span class="line"><span style="color:#F97583;">      return</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.loading.</span><span style="color:#B392F0;">get</span><span style="color:#E1E4E8;">(moduleName);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#F97583;">    const</span><span style="color:#79B8FF;"> loadPromise</span><span style="color:#F97583;"> =</span><span style="color:#B392F0;"> import</span><span style="color:#E1E4E8;">(modulePath)</span></span>
<span class="line"><span style="color:#E1E4E8;">      .</span><span style="color:#B392F0;">then</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">module</span><span style="color:#F97583;"> =&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#79B8FF;">        this</span><span style="color:#E1E4E8;">.modules.</span><span style="color:#B392F0;">set</span><span style="color:#E1E4E8;">(moduleName, </span><span style="color:#79B8FF;">module</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#79B8FF;">        this</span><span style="color:#E1E4E8;">.loading.</span><span style="color:#B392F0;">delete</span><span style="color:#E1E4E8;">(moduleName);</span></span>
<span class="line"><span style="color:#F97583;">        return</span><span style="color:#79B8FF;"> module</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">      })</span></span>
<span class="line"><span style="color:#E1E4E8;">      .</span><span style="color:#B392F0;">catch</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">error</span><span style="color:#F97583;"> =&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#79B8FF;">        this</span><span style="color:#E1E4E8;">.loading.</span><span style="color:#B392F0;">delete</span><span style="color:#E1E4E8;">(moduleName);</span></span>
<span class="line"><span style="color:#F97583;">        throw</span><span style="color:#E1E4E8;"> error;</span></span>
<span class="line"><span style="color:#E1E4E8;">      });</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#79B8FF;">    this</span><span style="color:#E1E4E8;">.loading.</span><span style="color:#B392F0;">set</span><span style="color:#E1E4E8;">(moduleName, loadPromise);</span></span>
<span class="line"><span style="color:#F97583;">    return</span><span style="color:#E1E4E8;"> loadPromise;</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#B392F0;">  preload</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">modulePath</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">moduleName</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#F97583;">    if</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">!</span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.modules.</span><span style="color:#B392F0;">has</span><span style="color:#E1E4E8;">(moduleName) </span><span style="color:#F97583;">&amp;&amp;</span><span style="color:#F97583;"> !</span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.loading.</span><span style="color:#B392F0;">has</span><span style="color:#E1E4E8;">(moduleName)) {</span></span>
<span class="line"><span style="color:#79B8FF;">      this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">load</span><span style="color:#E1E4E8;">(modulePath, moduleName);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// å…¨å±€æ‡’åŠ è½½å™¨å®ä¾‹</span></span>
<span class="line"><span style="color:#F97583;">export</span><span style="color:#F97583;"> const</span><span style="color:#79B8FF;"> lazyLoader</span><span style="color:#F97583;"> =</span><span style="color:#F97583;"> new</span><span style="color:#B392F0;"> LazyLoader</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// ä½¿ç”¨æ‡’åŠ è½½çš„å‘½ä»¤</span></span>
<span class="line"><span style="color:#F97583;">export</span><span style="color:#F97583;"> async</span><span style="color:#F97583;"> function</span><span style="color:#B392F0;"> executeHeavyCommand</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#6A737D;">  // æŒ‰éœ€åŠ è½½é‡å‹ä¾èµ–</span></span>
<span class="line"><span style="color:#F97583;">  const</span><span style="color:#E1E4E8;"> { </span><span style="color:#79B8FF;">HeavyProcessor</span><span style="color:#E1E4E8;"> } </span><span style="color:#F97583;">=</span><span style="color:#F97583;"> await</span><span style="color:#E1E4E8;"> lazyLoader.</span><span style="color:#B392F0;">load</span><span style="color:#E1E4E8;">(</span></span>
<span class="line"><span style="color:#9ECBFF;">    &#39;../processors/heavy.mjs&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#9ECBFF;">    &#39;heavy-processor&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">  );</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#F97583;">  const</span><span style="color:#79B8FF;"> processor</span><span style="color:#F97583;"> =</span><span style="color:#F97583;"> new</span><span style="color:#B392F0;"> HeavyProcessor</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#F97583;">  return</span><span style="color:#E1E4E8;"> processor.</span><span style="color:#B392F0;">process</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre></div><h2 id="ä¾èµ–ç®¡ç†ä¸ä¼˜åŒ–" tabindex="-1">ä¾èµ–ç®¡ç†ä¸ä¼˜åŒ– <a class="header-anchor" href="#ä¾èµ–ç®¡ç†ä¸ä¼˜åŒ–" aria-label="Permalink to &quot;ä¾èµ–ç®¡ç†ä¸ä¼˜åŒ–&quot;">â€‹</a></h2><h3 id="ä¾èµ–åˆ†æå·¥å…·" tabindex="-1">ä¾èµ–åˆ†æå·¥å…· <a class="header-anchor" href="#ä¾èµ–åˆ†æå·¥å…·" aria-label="Permalink to &quot;ä¾èµ–åˆ†æå·¥å…·&quot;">â€‹</a></h3><p>åˆ†æå’Œç®¡ç†ä¾èµ–å…³ç³»ï¼Œé¿å…ä¸å¿…è¦çš„åŒ…ä½“ç§¯è†¨èƒ€ã€‚</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;">// dep-analyzer.mjs</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { readFileSync } </span><span style="color:#F97583;">from</span><span style="color:#9ECBFF;"> &#39;node:fs&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { execSync } </span><span style="color:#F97583;">from</span><span style="color:#9ECBFF;"> &#39;node:child_process&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { createRequire } </span><span style="color:#F97583;">from</span><span style="color:#9ECBFF;"> &#39;node:module&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#79B8FF;"> require</span><span style="color:#F97583;"> =</span><span style="color:#B392F0;"> createRequire</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">import</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">meta</span><span style="color:#E1E4E8;">.url);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">class</span><span style="color:#B392F0;"> DepAnalyzer</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#F97583;">  constructor</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#79B8FF;">    this</span><span style="color:#E1E4E8;">.packageJson </span><span style="color:#F97583;">=</span><span style="color:#79B8FF;"> JSON</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">parse</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">readFileSync</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;package.json&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&#39;utf8&#39;</span><span style="color:#E1E4E8;">));</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#B392F0;">  analyzeDependencies</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#F97583;">    const</span><span style="color:#E1E4E8;"> { </span><span style="color:#79B8FF;">dependencies</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> {}, </span><span style="color:#79B8FF;">devDependencies</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> {} } </span><span style="color:#F97583;">=</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.packageJson;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#E1E4E8;">    console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;ğŸ“¦ ä¾èµ–åˆ†ææŠ¥å‘Š:&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;ç”Ÿäº§ä¾èµ–:&#39;</span><span style="color:#E1E4E8;">, Object.</span><span style="color:#B392F0;">keys</span><span style="color:#E1E4E8;">(dependencies).</span><span style="color:#79B8FF;">length</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;å¼€å‘ä¾èµ–:&#39;</span><span style="color:#E1E4E8;">, Object.</span><span style="color:#B392F0;">keys</span><span style="color:#E1E4E8;">(devDependencies).</span><span style="color:#79B8FF;">length</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#79B8FF;">    this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">checkBundleSize</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#79B8FF;">    this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">findUnusedDeps</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#B392F0;">  checkBundleSize</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#F97583;">    try</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#F97583;">      const</span><span style="color:#79B8FF;"> result</span><span style="color:#F97583;"> =</span><span style="color:#B392F0;"> execSync</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;npx bundle-phobia-cli&#39;</span><span style="color:#E1E4E8;">, { encoding: </span><span style="color:#9ECBFF;">&#39;utf8&#39;</span><span style="color:#E1E4E8;"> });</span></span>
<span class="line"><span style="color:#E1E4E8;">      console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;ğŸ“Š åŒ…å¤§å°åˆ†æ:&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">      console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(result);</span></span>
<span class="line"><span style="color:#E1E4E8;">    } </span><span style="color:#F97583;">catch</span><span style="color:#E1E4E8;"> (error) {</span></span>
<span class="line"><span style="color:#E1E4E8;">      console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;âš ï¸  Bundle Phobia åˆ†æå¤±è´¥&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#B392F0;">  findUnusedDeps</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#F97583;">    try</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#F97583;">      const</span><span style="color:#79B8FF;"> result</span><span style="color:#F97583;"> =</span><span style="color:#B392F0;"> execSync</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;npx depcheck&#39;</span><span style="color:#E1E4E8;">, { encoding: </span><span style="color:#9ECBFF;">&#39;utf8&#39;</span><span style="color:#E1E4E8;"> });</span></span>
<span class="line"><span style="color:#F97583;">      const</span><span style="color:#79B8FF;"> lines</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> result.</span><span style="color:#B392F0;">split</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;</span><span style="color:#79B8FF;">\\n</span><span style="color:#9ECBFF;">&#39;</span><span style="color:#E1E4E8;">).</span><span style="color:#B392F0;">filter</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">line</span><span style="color:#F97583;"> =&gt;</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#E1E4E8;">        line.</span><span style="color:#B392F0;">includes</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;Unused dependencies&#39;</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">||</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#E1E4E8;">        line.</span><span style="color:#B392F0;">includes</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;Unused devDependencies&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">      );</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span></span>
<span class="line"><span style="color:#F97583;">      if</span><span style="color:#E1E4E8;"> (lines.</span><span style="color:#79B8FF;">length</span><span style="color:#F97583;"> &gt;</span><span style="color:#79B8FF;"> 0</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;ğŸ” æœªä½¿ç”¨çš„ä¾èµ–:&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">        lines.</span><span style="color:#B392F0;">forEach</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">line</span><span style="color:#F97583;"> =&gt;</span><span style="color:#E1E4E8;"> console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;  &#39;</span><span style="color:#E1E4E8;">, line));</span></span>
<span class="line"><span style="color:#E1E4E8;">      }</span></span>
<span class="line"><span style="color:#E1E4E8;">    } </span><span style="color:#F97583;">catch</span><span style="color:#E1E4E8;"> (error) {</span></span>
<span class="line"><span style="color:#E1E4E8;">      console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;âš ï¸  Depcheck åˆ†æå¤±è´¥&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#F97583;">  async</span><span style="color:#B392F0;"> optimizeDependencies</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#6A737D;">    // ç§»é™¤æœªä½¿ç”¨çš„ä¾èµ–</span></span>
<span class="line"><span style="color:#F97583;">    const</span><span style="color:#79B8FF;"> unused</span><span style="color:#F97583;"> =</span><span style="color:#F97583;"> await</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">findUnusedDeps</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#F97583;">    if</span><span style="color:#E1E4E8;"> (unused.</span><span style="color:#79B8FF;">length</span><span style="color:#F97583;"> &gt;</span><span style="color:#79B8FF;"> 0</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">      console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;ä¼˜åŒ–ä¾èµ–å…³ç³»...&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#6A737D;">      // å®é™…é¡¹ç›®ä¸­åº”è¯¥æç¤ºç”¨æˆ·æ‰‹åŠ¨ç§»é™¤</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// ä½¿ç”¨ç¤ºä¾‹</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#79B8FF;"> analyzer</span><span style="color:#F97583;"> =</span><span style="color:#F97583;"> new</span><span style="color:#B392F0;"> DepAnalyzer</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">analyzer.</span><span style="color:#B392F0;">analyzeDependencies</span><span style="color:#E1E4E8;">();</span></span></code></pre></div><h3 id="ç‰ˆæœ¬ç®¡ç†ä¸å…¼å®¹æ€§" tabindex="-1">ç‰ˆæœ¬ç®¡ç†ä¸å…¼å®¹æ€§ <a class="header-anchor" href="#ç‰ˆæœ¬ç®¡ç†ä¸å…¼å®¹æ€§" aria-label="Permalink to &quot;ç‰ˆæœ¬ç®¡ç†ä¸å…¼å®¹æ€§&quot;">â€‹</a></h3><p>ç¡®ä¿æ„å»ºäº§ç‰©åœ¨ä¸åŒ Node.js ç‰ˆæœ¬é—´çš„å…¼å®¹æ€§ã€‚</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;">// version-compat.mjs</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { readFileSync, writeFileSync } </span><span style="color:#F97583;">from</span><span style="color:#9ECBFF;"> &#39;node:fs&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { execSync } </span><span style="color:#F97583;">from</span><span style="color:#9ECBFF;"> &#39;node:child_process&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">class</span><span style="color:#B392F0;"> VersionManager</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#F97583;">  constructor</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#79B8FF;">    this</span><span style="color:#E1E4E8;">.packageJson </span><span style="color:#F97583;">=</span><span style="color:#79B8FF;"> JSON</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">parse</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">readFileSync</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;package.json&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&#39;utf8&#39;</span><span style="color:#E1E4E8;">));</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#B392F0;">  updateVersion</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">type</span><span style="color:#F97583;"> =</span><span style="color:#9ECBFF;"> &#39;patch&#39;</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#F97583;">    const</span><span style="color:#79B8FF;"> currentVersion</span><span style="color:#F97583;"> =</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.packageJson.version;</span></span>
<span class="line"><span style="color:#F97583;">    const</span><span style="color:#E1E4E8;"> [</span><span style="color:#79B8FF;">major</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">minor</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">patch</span><span style="color:#E1E4E8;">] </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> currentVersion.</span><span style="color:#B392F0;">split</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;.&#39;</span><span style="color:#E1E4E8;">).</span><span style="color:#B392F0;">map</span><span style="color:#E1E4E8;">(Number);</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#F97583;">    let</span><span style="color:#E1E4E8;"> newVersion;</span></span>
<span class="line"><span style="color:#F97583;">    switch</span><span style="color:#E1E4E8;"> (type) {</span></span>
<span class="line"><span style="color:#F97583;">      case</span><span style="color:#9ECBFF;"> &#39;major&#39;</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        newVersion </span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;"> \`\${</span><span style="color:#E1E4E8;">major</span><span style="color:#F97583;"> +</span><span style="color:#79B8FF;"> 1</span><span style="color:#9ECBFF;">}.0.0\`</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">        break</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">      case</span><span style="color:#9ECBFF;"> &#39;minor&#39;</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        newVersion </span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;"> \`\${</span><span style="color:#E1E4E8;">major</span><span style="color:#9ECBFF;">}.\${</span><span style="color:#E1E4E8;">minor</span><span style="color:#F97583;"> +</span><span style="color:#79B8FF;"> 1</span><span style="color:#9ECBFF;">}.0\`</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">        break</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">      case</span><span style="color:#9ECBFF;"> &#39;patch&#39;</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        newVersion </span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;"> \`\${</span><span style="color:#E1E4E8;">major</span><span style="color:#9ECBFF;">}.\${</span><span style="color:#E1E4E8;">minor</span><span style="color:#9ECBFF;">}.\${</span><span style="color:#E1E4E8;">patch</span><span style="color:#F97583;"> +</span><span style="color:#79B8FF;"> 1</span><span style="color:#9ECBFF;">}\`</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">        break</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">      default</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#F97583;">        throw</span><span style="color:#F97583;"> new</span><span style="color:#B392F0;"> Error</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">\`æ— æ•ˆçš„ç‰ˆæœ¬ç±»å‹: \${</span><span style="color:#E1E4E8;">type</span><span style="color:#9ECBFF;">}\`</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#79B8FF;">    this</span><span style="color:#E1E4E8;">.packageJson.version </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> newVersion;</span></span>
<span class="line"><span style="color:#B392F0;">    writeFileSync</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;package.json&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">JSON</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">stringify</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.packageJson, </span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">));</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#E1E4E8;">    console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">\`ğŸ†™ ç‰ˆæœ¬æ›´æ–°: \${</span><span style="color:#E1E4E8;">currentVersion</span><span style="color:#9ECBFF;">} â†’ \${</span><span style="color:#E1E4E8;">newVersion</span><span style="color:#9ECBFF;">}\`</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#F97583;">    return</span><span style="color:#E1E4E8;"> newVersion;</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#B392F0;">  checkNodeVersion</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#F97583;">    const</span><span style="color:#79B8FF;"> required</span><span style="color:#F97583;"> =</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.packageJson.engines?.node;</span></span>
<span class="line"><span style="color:#F97583;">    const</span><span style="color:#79B8FF;"> current</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> process.version;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#F97583;">    if</span><span style="color:#E1E4E8;"> (required) {</span></span>
<span class="line"><span style="color:#F97583;">      const</span><span style="color:#E1E4E8;"> [</span><span style="color:#79B8FF;">requiredMajor</span><span style="color:#E1E4E8;">] </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> required.</span><span style="color:#B392F0;">replace</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;&gt;=&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&#39;&#39;</span><span style="color:#E1E4E8;">).</span><span style="color:#B392F0;">split</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;.&#39;</span><span style="color:#E1E4E8;">).</span><span style="color:#B392F0;">map</span><span style="color:#E1E4E8;">(Number);</span></span>
<span class="line"><span style="color:#F97583;">      const</span><span style="color:#E1E4E8;"> [</span><span style="color:#79B8FF;">currentMajor</span><span style="color:#E1E4E8;">] </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> current.</span><span style="color:#B392F0;">replace</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;v&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&#39;&#39;</span><span style="color:#E1E4E8;">).</span><span style="color:#B392F0;">split</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;.&#39;</span><span style="color:#E1E4E8;">).</span><span style="color:#B392F0;">map</span><span style="color:#E1E4E8;">(Number);</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span></span>
<span class="line"><span style="color:#F97583;">      if</span><span style="color:#E1E4E8;"> (currentMajor </span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;"> requiredMajor) {</span></span>
<span class="line"><span style="color:#F97583;">        throw</span><span style="color:#F97583;"> new</span><span style="color:#B392F0;"> Error</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">\`éœ€è¦ Node.js \${</span><span style="color:#E1E4E8;">required</span><span style="color:#9ECBFF;">}, å½“å‰ç‰ˆæœ¬ \${</span><span style="color:#E1E4E8;">current</span><span style="color:#9ECBFF;">}\`</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">      }</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#E1E4E8;">    console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">\`âœ… Node.js ç‰ˆæœ¬æ£€æŸ¥é€šè¿‡: \${</span><span style="color:#E1E4E8;">current</span><span style="color:#9ECBFF;">}\`</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#B392F0;">  generateChangelog</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#F97583;">    try</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#B392F0;">      execSync</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;npx conventional-changelog -p angular -i CHANGELOG.md -s&#39;</span><span style="color:#E1E4E8;">, {</span></span>
<span class="line"><span style="color:#E1E4E8;">        stdio: </span><span style="color:#9ECBFF;">&#39;inherit&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">      });</span></span>
<span class="line"><span style="color:#E1E4E8;">      console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;ğŸ“ æ›´æ–°æ—¥å¿—å·²ç”Ÿæˆ&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    } </span><span style="color:#F97583;">catch</span><span style="color:#E1E4E8;"> (error) {</span></span>
<span class="line"><span style="color:#E1E4E8;">      console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;âš ï¸  æ›´æ–°æ—¥å¿—ç”Ÿæˆå¤±è´¥&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// ä½¿ç”¨ç¤ºä¾‹</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#79B8FF;"> versionManager</span><span style="color:#F97583;"> =</span><span style="color:#F97583;"> new</span><span style="color:#B392F0;"> VersionManager</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">versionManager.</span><span style="color:#B392F0;">checkNodeVersion</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#6A737D;">// versionManager.updateVersion(&#39;patch&#39;);</span></span>
<span class="line"><span style="color:#6A737D;">// versionManager.generateChangelog();</span></span></code></pre></div><h2 id="æ„å»ºæµæ°´çº¿ä¸è‡ªåŠ¨åŒ–" tabindex="-1">æ„å»ºæµæ°´çº¿ä¸è‡ªåŠ¨åŒ– <a class="header-anchor" href="#æ„å»ºæµæ°´çº¿ä¸è‡ªåŠ¨åŒ–" aria-label="Permalink to &quot;æ„å»ºæµæ°´çº¿ä¸è‡ªåŠ¨åŒ–&quot;">â€‹</a></h2><h3 id="å¤šç¯å¢ƒæ„å»ºé…ç½®" tabindex="-1">å¤šç¯å¢ƒæ„å»ºé…ç½® <a class="header-anchor" href="#å¤šç¯å¢ƒæ„å»ºé…ç½®" aria-label="Permalink to &quot;å¤šç¯å¢ƒæ„å»ºé…ç½®&quot;">â€‹</a></h3><p>é’ˆå¯¹ä¸åŒç¯å¢ƒ (å¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§) è¿›è¡Œä¼˜åŒ–æ„å»ºã€‚</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;">// build-pipeline.mjs</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { execSync } </span><span style="color:#F97583;">from</span><span style="color:#9ECBFF;"> &#39;node:child_process&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { existsSync, mkdirSync } </span><span style="color:#F97583;">from</span><span style="color:#9ECBFF;"> &#39;node:fs&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">class</span><span style="color:#B392F0;"> BuildPipeline</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#F97583;">  constructor</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">environment</span><span style="color:#F97583;"> =</span><span style="color:#9ECBFF;"> &#39;production&#39;</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#79B8FF;">    this</span><span style="color:#E1E4E8;">.environment </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> environment;</span></span>
<span class="line"><span style="color:#79B8FF;">    this</span><span style="color:#E1E4E8;">.buildDir </span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;"> &#39;dist&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#F97583;">  async</span><span style="color:#B392F0;"> run</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#E1E4E8;">    console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">\`ğŸš€ å¼€å§‹æ„å»º (ç¯å¢ƒ: \${</span><span style="color:#79B8FF;">this</span><span style="color:#9ECBFF;">.</span><span style="color:#E1E4E8;">environment</span><span style="color:#9ECBFF;">})\`</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#F97583;">    try</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#F97583;">      await</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">clean</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#F97583;">      await</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">lint</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#F97583;">      await</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">test</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#F97583;">      await</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">build</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#F97583;">      await</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">optimize</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#F97583;">      await</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">verify</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span></span>
<span class="line"><span style="color:#E1E4E8;">      console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;âœ… æ„å»ºå®Œæˆ&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    } </span><span style="color:#F97583;">catch</span><span style="color:#E1E4E8;"> (error) {</span></span>
<span class="line"><span style="color:#E1E4E8;">      console.</span><span style="color:#B392F0;">error</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;âŒ æ„å»ºå¤±è´¥:&#39;</span><span style="color:#E1E4E8;">, error.message);</span></span>
<span class="line"><span style="color:#E1E4E8;">      process.</span><span style="color:#B392F0;">exit</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#F97583;">  async</span><span style="color:#B392F0;"> clean</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#E1E4E8;">    console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;ğŸ§¹ æ¸…ç†æ„å»ºç›®å½•...&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#F97583;">    if</span><span style="color:#E1E4E8;"> (</span><span style="color:#B392F0;">existsSync</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.buildDir)) {</span></span>
<span class="line"><span style="color:#B392F0;">      execSync</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">\`rm -rf \${</span><span style="color:#79B8FF;">this</span><span style="color:#9ECBFF;">.</span><span style="color:#E1E4E8;">buildDir</span><span style="color:#9ECBFF;">}\`</span><span style="color:#E1E4E8;">, { stdio: </span><span style="color:#9ECBFF;">&#39;inherit&#39;</span><span style="color:#E1E4E8;"> });</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#B392F0;">    mkdirSync</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.buildDir, { recursive: </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;"> });</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#F97583;">  async</span><span style="color:#B392F0;"> lint</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#E1E4E8;">    console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;ğŸ” ä»£ç æ£€æŸ¥...&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#B392F0;">    execSync</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;npm run lint&#39;</span><span style="color:#E1E4E8;">, { stdio: </span><span style="color:#9ECBFF;">&#39;inherit&#39;</span><span style="color:#E1E4E8;"> });</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#F97583;">  async</span><span style="color:#B392F0;"> test</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#E1E4E8;">    console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;ğŸ§ª è¿è¡Œæµ‹è¯•...&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#B392F0;">    execSync</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;npm test&#39;</span><span style="color:#E1E4E8;">, { stdio: </span><span style="color:#9ECBFF;">&#39;inherit&#39;</span><span style="color:#E1E4E8;"> });</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#F97583;">  async</span><span style="color:#B392F0;"> build</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#E1E4E8;">    console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;ğŸ”¨ æ„å»ºé¡¹ç›®...&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#F97583;">    const</span><span style="color:#79B8FF;"> commands</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">      production: </span><span style="color:#9ECBFF;">&#39;npm run build:prod&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">      development: </span><span style="color:#9ECBFF;">&#39;npm run build:dev&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">      staging: </span><span style="color:#9ECBFF;">&#39;npm run build:staging&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">    };</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#F97583;">    const</span><span style="color:#79B8FF;"> command</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> commands[</span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.environment] </span><span style="color:#F97583;">||</span><span style="color:#E1E4E8;"> commands.production;</span></span>
<span class="line"><span style="color:#B392F0;">    execSync</span><span style="color:#E1E4E8;">(command, { stdio: </span><span style="color:#9ECBFF;">&#39;inherit&#39;</span><span style="color:#E1E4E8;"> });</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#F97583;">  async</span><span style="color:#B392F0;"> optimize</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#F97583;">    if</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.environment </span><span style="color:#F97583;">===</span><span style="color:#9ECBFF;"> &#39;production&#39;</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">      console.log </span><span style="color:#9ECBFF;">&#39;âš¡ ä¼˜åŒ–æ„å»ºäº§ç‰©...&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#B392F0;">      execSync</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;npm run optimize&#39;</span><span style="color:#E1E4E8;">, { stdio: </span><span style="color:#9ECBFF;">&#39;inherit&#39;</span><span style="color:#E1E4E8;"> });</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#F97583;">  async</span><span style="color:#B392F0;"> verify</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#E1E4E8;">    console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;ğŸ” éªŒè¯æ„å»ºç»“æœ...&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#6A737D;">    // æ£€æŸ¥å¿…è¦çš„æ–‡ä»¶</span></span>
<span class="line"><span style="color:#F97583;">    const</span><span style="color:#79B8FF;"> requiredFiles</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> [</span></span>
<span class="line"><span style="color:#9ECBFF;">      &#39;dist/cli.mjs&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#9ECBFF;">      &#39;dist/cli.cjs&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#9ECBFF;">      &#39;bin/cli.mjs&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">    ];</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#F97583;">    for</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">const</span><span style="color:#79B8FF;"> file</span><span style="color:#F97583;"> of</span><span style="color:#E1E4E8;"> requiredFiles) {</span></span>
<span class="line"><span style="color:#F97583;">      if</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">!</span><span style="color:#B392F0;">existsSync</span><span style="color:#E1E4E8;">(file)) {</span></span>
<span class="line"><span style="color:#F97583;">        throw</span><span style="color:#F97583;"> new</span><span style="color:#B392F0;"> Error</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">\`æ„å»ºäº§ç‰©ç¼ºå¤±: \${</span><span style="color:#E1E4E8;">file</span><span style="color:#9ECBFF;">}\`</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">      }</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#6A737D;">    // éªŒè¯å¯æ‰§è¡Œæ–‡ä»¶</span></span>
<span class="line"><span style="color:#F97583;">    try</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#B392F0;">      execSync</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;node dist/cli.mjs --version&#39;</span><span style="color:#E1E4E8;">, { stdio: </span><span style="color:#9ECBFF;">&#39;pipe&#39;</span><span style="color:#E1E4E8;"> });</span></span>
<span class="line"><span style="color:#E1E4E8;">    } </span><span style="color:#F97583;">catch</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#F97583;">      throw</span><span style="color:#F97583;"> new</span><span style="color:#B392F0;"> Error</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;æ„å»ºäº§ç‰©æ— æ³•æ­£å¸¸æ‰§è¡Œ&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#E1E4E8;">    console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;âœ… æ„å»ºéªŒè¯é€šè¿‡&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// ä½¿ç”¨ç¤ºä¾‹</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#79B8FF;"> pipeline</span><span style="color:#F97583;"> =</span><span style="color:#F97583;"> new</span><span style="color:#B392F0;"> BuildPipeline</span><span style="color:#E1E4E8;">(process.env.</span><span style="color:#79B8FF;">NODE_ENV</span><span style="color:#F97583;"> ||</span><span style="color:#9ECBFF;"> &#39;production&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#F97583;">await</span><span style="color:#E1E4E8;"> pipeline.</span><span style="color:#B392F0;">run</span><span style="color:#E1E4E8;">();</span></span></code></pre></div><h3 id="æŒç»­é›†æˆé…ç½®" tabindex="-1">æŒç»­é›†æˆé…ç½® <a class="header-anchor" href="#æŒç»­é›†æˆé…ç½®" aria-label="Permalink to &quot;æŒç»­é›†æˆé…ç½®&quot;">â€‹</a></h3><p>åœ¨ CI/CD ç¯å¢ƒä¸­è‡ªåŠ¨åŒ–æ„å»ºå’Œæµ‹è¯•æµç¨‹ã€‚</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;">// github-actions.mjs</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { writeFileSync } </span><span style="color:#F97583;">from</span><span style="color:#9ECBFF;"> &#39;node:fs&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">class</span><span style="color:#B392F0;"> CIConfigGenerator</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#B392F0;">  generateGitHubActions</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#F97583;">    const</span><span style="color:#79B8FF;"> workflow</span><span style="color:#F97583;"> =</span><span style="color:#9ECBFF;"> \`</span></span>
<span class="line"><span style="color:#9ECBFF;">name: Node.js CI</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9ECBFF;">on:</span></span>
<span class="line"><span style="color:#9ECBFF;">  push:</span></span>
<span class="line"><span style="color:#9ECBFF;">    branches: [ main, develop ]</span></span>
<span class="line"><span style="color:#9ECBFF;">  pull_request:</span></span>
<span class="line"><span style="color:#9ECBFF;">    branches: [ main ]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9ECBFF;">jobs:</span></span>
<span class="line"><span style="color:#9ECBFF;">  build:</span></span>
<span class="line"><span style="color:#9ECBFF;">    runs-on: </span><span style="color:#79B8FF;">\\$</span><span style="color:#9ECBFF;">{{ matrix.os }}</span></span>
<span class="line"><span style="color:#9ECBFF;">    </span></span>
<span class="line"><span style="color:#9ECBFF;">    strategy:</span></span>
<span class="line"><span style="color:#9ECBFF;">      matrix:</span></span>
<span class="line"><span style="color:#9ECBFF;">        os: [ubuntu-latest, windows-latest, macos-latest]</span></span>
<span class="line"><span style="color:#9ECBFF;">        node-version: [18.x, 20.x]</span></span>
<span class="line"><span style="color:#9ECBFF;">    </span></span>
<span class="line"><span style="color:#9ECBFF;">    steps:</span></span>
<span class="line"><span style="color:#9ECBFF;">    - uses: actions/checkout@v3</span></span>
<span class="line"><span style="color:#9ECBFF;">    </span></span>
<span class="line"><span style="color:#9ECBFF;">    - name: Use Node.js </span><span style="color:#79B8FF;">\\$</span><span style="color:#9ECBFF;">{{ matrix.node-version }}</span></span>
<span class="line"><span style="color:#9ECBFF;">      uses: actions/setup-node@v3</span></span>
<span class="line"><span style="color:#9ECBFF;">      with:</span></span>
<span class="line"><span style="color:#9ECBFF;">        node-version: </span><span style="color:#79B8FF;">\\$</span><span style="color:#9ECBFF;">{{ matrix.node-version }}</span></span>
<span class="line"><span style="color:#9ECBFF;">        cache: &#39;npm&#39;</span></span>
<span class="line"><span style="color:#9ECBFF;">    </span></span>
<span class="line"><span style="color:#9ECBFF;">    - name: Install dependencies</span></span>
<span class="line"><span style="color:#9ECBFF;">      run: npm ci</span></span>
<span class="line"><span style="color:#9ECBFF;">      </span></span>
<span class="line"><span style="color:#9ECBFF;">    - name: Lint code</span></span>
<span class="line"><span style="color:#9ECBFF;">      run: npm run lint</span></span>
<span class="line"><span style="color:#9ECBFF;">      </span></span>
<span class="line"><span style="color:#9ECBFF;">    - name: Run tests</span></span>
<span class="line"><span style="color:#9ECBFF;">      run: npm test</span></span>
<span class="line"><span style="color:#9ECBFF;">      </span></span>
<span class="line"><span style="color:#9ECBFF;">    - name: Build project</span></span>
<span class="line"><span style="color:#9ECBFF;">      run: npm run build</span></span>
<span class="line"><span style="color:#9ECBFF;">      </span></span>
<span class="line"><span style="color:#9ECBFF;">    - name: Verify build</span></span>
<span class="line"><span style="color:#9ECBFF;">      run: npm run verify</span></span>
<span class="line"><span style="color:#9ECBFF;">      </span></span>
<span class="line"><span style="color:#9ECBFF;">    - name: Upload artifacts</span></span>
<span class="line"><span style="color:#9ECBFF;">      uses: actions/upload-artifact@v3</span></span>
<span class="line"><span style="color:#9ECBFF;">      with:</span></span>
<span class="line"><span style="color:#9ECBFF;">        name: build-</span><span style="color:#79B8FF;">\\$</span><span style="color:#9ECBFF;">{{ matrix.os }}-node-</span><span style="color:#79B8FF;">\\$</span><span style="color:#9ECBFF;">{{ matrix.node-version }}</span></span>
<span class="line"><span style="color:#9ECBFF;">        path: |</span></span>
<span class="line"><span style="color:#9ECBFF;">          dist/</span></span>
<span class="line"><span style="color:#9ECBFF;">          bin/</span></span>
<span class="line"><span style="color:#9ECBFF;">        retention-days: 7</span></span>
<span class="line"><span style="color:#9ECBFF;">\`</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">    writeFileSync</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;.github/workflows/ci.yml&#39;</span><span style="color:#E1E4E8;">, workflow.</span><span style="color:#B392F0;">trim</span><span style="color:#E1E4E8;">());</span></span>
<span class="line"><span style="color:#E1E4E8;">    console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;âœ… GitHub Actions é…ç½®å·²ç”Ÿæˆ&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#B392F0;">  generateDockerfile</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#F97583;">    const</span><span style="color:#79B8FF;"> dockerfile</span><span style="color:#F97583;"> =</span><span style="color:#9ECBFF;"> \`</span></span>
<span class="line"><span style="color:#9ECBFF;">FROM node:18-alpine</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9ECBFF;">WORKDIR /app</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9ECBFF;"># å¤åˆ¶åŒ…æ–‡ä»¶</span></span>
<span class="line"><span style="color:#9ECBFF;">COPY package*.json ./</span></span>
<span class="line"><span style="color:#9ECBFF;">RUN npm ci --only=production</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9ECBFF;"># å¤åˆ¶æ„å»ºäº§ç‰©</span></span>
<span class="line"><span style="color:#9ECBFF;">COPY dist/ ./dist/</span></span>
<span class="line"><span style="color:#9ECBFF;">COPY bin/ ./bin/</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9ECBFF;"># è®¾ç½®å¯æ‰§è¡Œæƒé™</span></span>
<span class="line"><span style="color:#9ECBFF;">RUN chmod +x ./bin/cli.mjs</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9ECBFF;"># åˆ›å»ºç¬¦å·é“¾æ¥</span></span>
<span class="line"><span style="color:#9ECBFF;">RUN ln -s /app/bin/cli.mjs /usr/local/bin/my-cli</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9ECBFF;">ENTRYPOINT [&quot;node&quot;, &quot;/app/bin/cli.mjs&quot;]</span></span>
<span class="line"><span style="color:#9ECBFF;">\`</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">    writeFileSync</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;Dockerfile&#39;</span><span style="color:#E1E4E8;">, dockerfile.</span><span style="color:#B392F0;">trim</span><span style="color:#E1E4E8;">());</span></span>
<span class="line"><span style="color:#E1E4E8;">    console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;âœ… Dockerfile å·²ç”Ÿæˆ&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// ç”Ÿæˆ CI é…ç½®æ–‡ä»¶</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#79B8FF;"> ciGenerator</span><span style="color:#F97583;"> =</span><span style="color:#F97583;"> new</span><span style="color:#B392F0;"> CIConfigGenerator</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">ciGenerator.</span><span style="color:#B392F0;">generateGitHubActions</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">ciGenerator.</span><span style="color:#B392F0;">generateDockerfile</span><span style="color:#E1E4E8;">();</span></span></code></pre></div><h2 id="é«˜çº§æ„å»ºç‰¹æ€§" tabindex="-1">é«˜çº§æ„å»ºç‰¹æ€§ <a class="header-anchor" href="#é«˜çº§æ„å»ºç‰¹æ€§" aria-label="Permalink to &quot;é«˜çº§æ„å»ºç‰¹æ€§&quot;">â€‹</a></h2><h3 id="æ¡ä»¶ç¼–è¯‘ä¸ç‰¹æ€§å¼€å…³" tabindex="-1">æ¡ä»¶ç¼–è¯‘ä¸ç‰¹æ€§å¼€å…³ <a class="header-anchor" href="#æ¡ä»¶ç¼–è¯‘ä¸ç‰¹æ€§å¼€å…³" aria-label="Permalink to &quot;æ¡ä»¶ç¼–è¯‘ä¸ç‰¹æ€§å¼€å…³&quot;">â€‹</a></h3><p>æ ¹æ®æ„å»ºç›®æ ‡å¯ç”¨æˆ–ç¦ç”¨ç‰¹å®šåŠŸèƒ½ã€‚</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;">// feature-flags.mjs</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { readFileSync, writeFileSync } </span><span style="color:#F97583;">from</span><span style="color:#9ECBFF;"> &#39;node:fs&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">class</span><span style="color:#B392F0;"> FeatureManager</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#F97583;">  constructor</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#79B8FF;">    this</span><span style="color:#E1E4E8;">.flags </span><span style="color:#F97583;">=</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">loadFlags</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#B392F0;">  loadFlags</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#F97583;">    try</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#F97583;">      const</span><span style="color:#79B8FF;"> config</span><span style="color:#F97583;"> =</span><span style="color:#B392F0;"> readFileSync</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;feature-flags.json&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&#39;utf8&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#F97583;">      return</span><span style="color:#79B8FF;"> JSON</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">parse</span><span style="color:#E1E4E8;">(config);</span></span>
<span class="line"><span style="color:#E1E4E8;">    } </span><span style="color:#F97583;">catch</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#F97583;">      return</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">        experimental: </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">        analytics: </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">        updateChecker: </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">        plugins: </span><span style="color:#79B8FF;">false</span></span>
<span class="line"><span style="color:#E1E4E8;">      };</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#B392F0;">  generateBuildConfig</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">environment</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#F97583;">    const</span><span style="color:#79B8FF;"> config</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">      environment,</span></span>
<span class="line"><span style="color:#E1E4E8;">      features: { </span><span style="color:#F97583;">...</span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.flags },</span></span>
<span class="line"><span style="color:#E1E4E8;">      buildTime: </span><span style="color:#F97583;">new</span><span style="color:#B392F0;"> Date</span><span style="color:#E1E4E8;">().</span><span style="color:#B392F0;">toISOString</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"><span style="color:#E1E4E8;">    };</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#6A737D;">    // ç¯å¢ƒç‰¹å®šçš„ç‰¹æ€§å¼€å…³</span></span>
<span class="line"><span style="color:#F97583;">    if</span><span style="color:#E1E4E8;"> (environment </span><span style="color:#F97583;">===</span><span style="color:#9ECBFF;"> &#39;development&#39;</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">      config.features.experimental </span><span style="color:#F97583;">=</span><span style="color:#79B8FF;"> true</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">      config.features.plugins </span><span style="color:#F97583;">=</span><span style="color:#79B8FF;"> true</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#F97583;">    if</span><span style="color:#E1E4E8;"> (environment </span><span style="color:#F97583;">===</span><span style="color:#9ECBFF;"> &#39;production&#39;</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">      config.features.experimental </span><span style="color:#F97583;">=</span><span style="color:#79B8FF;"> false</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">      config.features.analytics </span><span style="color:#F97583;">=</span><span style="color:#79B8FF;"> true</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#F97583;">    const</span><span style="color:#79B8FF;"> configContent</span><span style="color:#F97583;"> =</span><span style="color:#9ECBFF;"> \`export const buildConfig = \${</span><span style="color:#79B8FF;">JSON</span><span style="color:#9ECBFF;">.</span><span style="color:#B392F0;">stringify</span><span style="color:#9ECBFF;">(</span><span style="color:#E1E4E8;">config</span><span style="color:#9ECBFF;">, </span><span style="color:#79B8FF;">null</span><span style="color:#9ECBFF;">, </span><span style="color:#79B8FF;">2</span><span style="color:#9ECBFF;">)</span><span style="color:#9ECBFF;">};\`</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#B392F0;">    writeFileSync</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;src/generated/build-config.mjs&#39;</span><span style="color:#E1E4E8;">, configContent);</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#E1E4E8;">    console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;âœ… æ„å»ºé…ç½®å·²ç”Ÿæˆ:&#39;</span><span style="color:#E1E4E8;">, config);</span></span>
<span class="line"><span style="color:#F97583;">    return</span><span style="color:#E1E4E8;"> config;</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#B392F0;">  validateFlags</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#F97583;">    const</span><span style="color:#79B8FF;"> issues</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> [];</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#F97583;">    if</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.flags.experimental </span><span style="color:#F97583;">&amp;&amp;</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.flags.analytics) {</span></span>
<span class="line"><span style="color:#E1E4E8;">      issues.</span><span style="color:#B392F0;">push</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;å®éªŒæ€§åŠŸèƒ½ä¸åˆ†æåŠŸèƒ½å¯èƒ½å­˜åœ¨å†²çª&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#F97583;">    if</span><span style="color:#E1E4E8;"> (issues.</span><span style="color:#79B8FF;">length</span><span style="color:#F97583;"> &gt;</span><span style="color:#79B8FF;"> 0</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">      console.</span><span style="color:#B392F0;">warn</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;âš ï¸  ç‰¹æ€§é…ç½®è­¦å‘Š:&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">      issues.</span><span style="color:#B392F0;">forEach</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">issue</span><span style="color:#F97583;"> =&gt;</span><span style="color:#E1E4E8;"> console.</span><span style="color:#B392F0;">warn</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;  -&#39;</span><span style="color:#E1E4E8;">, issue));</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#F97583;">    return</span><span style="color:#E1E4E8;"> issues.</span><span style="color:#79B8FF;">length</span><span style="color:#F97583;"> ===</span><span style="color:#79B8FF;"> 0</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// ä½¿ç”¨ç‰¹æ€§é…ç½®</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { buildConfig } </span><span style="color:#F97583;">from</span><span style="color:#9ECBFF;"> &#39;../generated/build-config.mjs&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">export</span><span style="color:#F97583;"> function</span><span style="color:#B392F0;"> initializeApp</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#F97583;">  if</span><span style="color:#E1E4E8;"> (buildConfig.features.analytics) {</span></span>
<span class="line"><span style="color:#B392F0;">    initializeAnalytics</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#F97583;">  if</span><span style="color:#E1E4E8;"> (buildConfig.features.experimental) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    console.</span><span style="color:#B392F0;">warn</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;âš ï¸  å®éªŒæ€§åŠŸèƒ½å·²å¯ç”¨&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// æ„å»ºæ—¶ç”Ÿæˆé…ç½®</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#79B8FF;"> featureManager</span><span style="color:#F97583;"> =</span><span style="color:#F97583;"> new</span><span style="color:#B392F0;"> FeatureManager</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">featureManager.</span><span style="color:#B392F0;">generateBuildConfig</span><span style="color:#E1E4E8;">(process.env.</span><span style="color:#79B8FF;">NODE_ENV</span><span style="color:#F97583;"> ||</span><span style="color:#9ECBFF;"> &#39;production&#39;</span><span style="color:#E1E4E8;">);</span></span></code></pre></div><h3 id="æ€§èƒ½åˆ†æä¸ä¼˜åŒ–" tabindex="-1">æ€§èƒ½åˆ†æä¸ä¼˜åŒ– <a class="header-anchor" href="#æ€§èƒ½åˆ†æä¸ä¼˜åŒ–" aria-label="Permalink to &quot;æ€§èƒ½åˆ†æä¸ä¼˜åŒ–&quot;">â€‹</a></h3><p>åœ¨æ„å»ºè¿‡ç¨‹ä¸­åˆ†æå’Œä¼˜åŒ–æ€§èƒ½ç“¶é¢ˆã€‚</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;">// performance-build.mjs</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { performance, PerformanceObserver } </span><span style="color:#F97583;">from</span><span style="color:#9ECBFF;"> &#39;node:perf_hooks&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { execSync } </span><span style="color:#F97583;">from</span><span style="color:#9ECBFF;"> &#39;node:child_process&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">class</span><span style="color:#B392F0;"> PerformanceTracker</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#F97583;">  constructor</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#79B8FF;">    this</span><span style="color:#E1E4E8;">.metrics </span><span style="color:#F97583;">=</span><span style="color:#F97583;"> new</span><span style="color:#B392F0;"> Map</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#79B8FF;">    this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">setupObserver</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#B392F0;">  setupObserver</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#F97583;">    const</span><span style="color:#79B8FF;"> observer</span><span style="color:#F97583;"> =</span><span style="color:#F97583;"> new</span><span style="color:#B392F0;"> PerformanceObserver</span><span style="color:#E1E4E8;">((</span><span style="color:#FFAB70;">list</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">      list.</span><span style="color:#B392F0;">getEntries</span><span style="color:#E1E4E8;">().</span><span style="color:#B392F0;">forEach</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">entry</span><span style="color:#F97583;"> =&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#79B8FF;">        this</span><span style="color:#E1E4E8;">.metrics.</span><span style="color:#B392F0;">set</span><span style="color:#E1E4E8;">(entry.name, entry);</span></span>
<span class="line"><span style="color:#E1E4E8;">      });</span></span>
<span class="line"><span style="color:#E1E4E8;">    });</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#E1E4E8;">    observer.</span><span style="color:#B392F0;">observe</span><span style="color:#E1E4E8;">({ entryTypes: [</span><span style="color:#9ECBFF;">&#39;measure&#39;</span><span style="color:#E1E4E8;">] });</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#B392F0;">  startPhase</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">phase</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    performance.</span><span style="color:#B392F0;">mark</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">\`start-\${</span><span style="color:#E1E4E8;">phase</span><span style="color:#9ECBFF;">}\`</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#B392F0;">  endPhase</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">phase</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    performance.</span><span style="color:#B392F0;">mark</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">\`end-\${</span><span style="color:#E1E4E8;">phase</span><span style="color:#9ECBFF;">}\`</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    performance.</span><span style="color:#B392F0;">measure</span><span style="color:#E1E4E8;">(phase, </span><span style="color:#9ECBFF;">\`start-\${</span><span style="color:#E1E4E8;">phase</span><span style="color:#9ECBFF;">}\`</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">\`end-\${</span><span style="color:#E1E4E8;">phase</span><span style="color:#9ECBFF;">}\`</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#F97583;">  async</span><span style="color:#B392F0;"> trackBuild</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#E1E4E8;">    console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;ğŸ“Š å¼€å§‹æ€§èƒ½è·Ÿè¸ª...&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#79B8FF;">    this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">startPhase</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;total-build&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#6A737D;">    // è·Ÿè¸ªå„ä¸ªæ„å»ºé˜¶æ®µ</span></span>
<span class="line"><span style="color:#F97583;">    const</span><span style="color:#79B8FF;"> phases</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> [</span></span>
<span class="line"><span style="color:#9ECBFF;">      &#39;dependency-install&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#9ECBFF;">      &#39;compilation&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#9ECBFF;">      &#39;bundling&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#9ECBFF;">      &#39;optimization&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#9ECBFF;">      &#39;testing&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">    ];</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#F97583;">    for</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">const</span><span style="color:#79B8FF;"> phase</span><span style="color:#F97583;"> of</span><span style="color:#E1E4E8;"> phases) {</span></span>
<span class="line"><span style="color:#79B8FF;">      this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">startPhase</span><span style="color:#E1E4E8;">(phase);</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span></span>
<span class="line"><span style="color:#6A737D;">      // æ¨¡æ‹Ÿæ„å»ºé˜¶æ®µ</span></span>
<span class="line"><span style="color:#F97583;">      await</span><span style="color:#F97583;"> new</span><span style="color:#79B8FF;"> Promise</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">resolve</span><span style="color:#F97583;"> =&gt;</span><span style="color:#B392F0;"> setTimeout</span><span style="color:#E1E4E8;">(resolve, Math.</span><span style="color:#B392F0;">random</span><span style="color:#E1E4E8;">() </span><span style="color:#F97583;">*</span><span style="color:#79B8FF;"> 1000</span><span style="color:#E1E4E8;">));</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span></span>
<span class="line"><span style="color:#79B8FF;">      this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">endPhase</span><span style="color:#E1E4E8;">(phase);</span></span>
<span class="line"><span style="color:#E1E4E8;">      console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">\`  \${</span><span style="color:#E1E4E8;">phase</span><span style="color:#9ECBFF;">}: \${</span><span style="color:#79B8FF;">this</span><span style="color:#9ECBFF;">.</span><span style="color:#E1E4E8;">metrics</span><span style="color:#9ECBFF;">.</span><span style="color:#B392F0;">get</span><span style="color:#9ECBFF;">(</span><span style="color:#E1E4E8;">phase</span><span style="color:#9ECBFF;">)?.</span><span style="color:#E1E4E8;">duration</span><span style="color:#9ECBFF;">.</span><span style="color:#B392F0;">toFixed</span><span style="color:#9ECBFF;">(</span><span style="color:#79B8FF;">2</span><span style="color:#9ECBFF;">)</span><span style="color:#9ECBFF;">}ms\`</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#79B8FF;">    this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">endPhase</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;total-build&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#79B8FF;">    this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">generateReport</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#B392F0;">  generateReport</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#F97583;">    const</span><span style="color:#79B8FF;"> totalTime</span><span style="color:#F97583;"> =</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.metrics.</span><span style="color:#B392F0;">get</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;total-build&#39;</span><span style="color:#E1E4E8;">)?.duration </span><span style="color:#F97583;">||</span><span style="color:#79B8FF;"> 0</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#E1E4E8;">    console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;</span><span style="color:#79B8FF;">\\n</span><span style="color:#9ECBFF;">ğŸ“ˆ æ„å»ºæ€§èƒ½æŠ¥å‘Š:&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">\`æ€»æ„å»ºæ—¶é—´: \${</span><span style="color:#E1E4E8;">totalTime</span><span style="color:#9ECBFF;">.</span><span style="color:#B392F0;">toFixed</span><span style="color:#9ECBFF;">(</span><span style="color:#79B8FF;">2</span><span style="color:#9ECBFF;">)</span><span style="color:#9ECBFF;">}ms\`</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#6A737D;">    // è®¡ç®—å„é˜¶æ®µå æ¯”</span></span>
<span class="line"><span style="color:#F97583;">    for</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> [</span><span style="color:#79B8FF;">name</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">metric</span><span style="color:#E1E4E8;">] </span><span style="color:#F97583;">of</span><span style="color:#79B8FF;"> this</span><span style="color:#E1E4E8;">.metrics) {</span></span>
<span class="line"><span style="color:#F97583;">      if</span><span style="color:#E1E4E8;"> (name </span><span style="color:#F97583;">!==</span><span style="color:#9ECBFF;"> &#39;total-build&#39;</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#F97583;">        const</span><span style="color:#79B8FF;"> percentage</span><span style="color:#F97583;"> =</span><span style="color:#E1E4E8;"> ((metric.duration </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;"> totalTime) </span><span style="color:#F97583;">*</span><span style="color:#79B8FF;"> 100</span><span style="color:#E1E4E8;">).</span><span style="color:#B392F0;">toFixed</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">        console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">\`  \${</span><span style="color:#E1E4E8;">name</span><span style="color:#9ECBFF;">}: \${</span><span style="color:#E1E4E8;">metric</span><span style="color:#9ECBFF;">.</span><span style="color:#E1E4E8;">duration</span><span style="color:#9ECBFF;">.</span><span style="color:#B392F0;">toFixed</span><span style="color:#9ECBFF;">(</span><span style="color:#79B8FF;">2</span><span style="color:#9ECBFF;">)</span><span style="color:#9ECBFF;">}ms (\${</span><span style="color:#E1E4E8;">percentage</span><span style="color:#9ECBFF;">}%)\`</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">      }</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#6A737D;">    // æ€§èƒ½å»ºè®®</span></span>
<span class="line"><span style="color:#F97583;">    if</span><span style="color:#E1E4E8;"> (totalTime </span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;"> 10000</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">      console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;</span><span style="color:#79B8FF;">\\n</span><span style="color:#9ECBFF;">ğŸ’¡ æ€§èƒ½ä¼˜åŒ–å»ºè®®:&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">      console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;  - è€ƒè™‘ä½¿ç”¨å¢é‡æ„å»º&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">      console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;  - ä¼˜åŒ–ä¾èµ–å®‰è£…æ—¶é—´&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">      console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;  - å¹¶è¡ŒåŒ–æ„å»ºä»»åŠ¡&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#B392F0;">  analyzeBundle</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#F97583;">    try</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">      console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;</span><span style="color:#79B8FF;">\\n</span><span style="color:#9ECBFF;">ğŸ“¦ åŒ…å¤§å°åˆ†æ...&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#F97583;">      const</span><span style="color:#79B8FF;"> result</span><span style="color:#F97583;"> =</span><span style="color:#B392F0;"> execSync</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;npx webpack-bundle-analyzer dist/stats.json&#39;</span><span style="color:#E1E4E8;">, {</span></span>
<span class="line"><span style="color:#E1E4E8;">        encoding: </span><span style="color:#9ECBFF;">&#39;utf8&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">      });</span></span>
<span class="line"><span style="color:#E1E4E8;">      console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(result);</span></span>
<span class="line"><span style="color:#E1E4E8;">    } </span><span style="color:#F97583;">catch</span><span style="color:#E1E4E8;"> (error) {</span></span>
<span class="line"><span style="color:#E1E4E8;">      console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;âš ï¸  åŒ…åˆ†æå·¥å…·æœªå®‰è£…æˆ–é…ç½®&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// ä½¿ç”¨ç¤ºä¾‹</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#79B8FF;"> tracker</span><span style="color:#F97583;"> =</span><span style="color:#F97583;"> new</span><span style="color:#B392F0;"> PerformanceTracker</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#F97583;">await</span><span style="color:#E1E4E8;"> tracker.</span><span style="color:#B392F0;">trackBuild</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">tracker.</span><span style="color:#B392F0;">analyzeBundle</span><span style="color:#E1E4E8;">();</span></span></code></pre></div><p>é€šè¿‡å®æ–½è¿™äº›æ„å»ºæŠ€æœ¯å’Œæœ€ä½³å®è·µï¼ŒNode.js å‘½ä»¤è¡Œå·¥å…·å¯ä»¥è·å¾—ä¼˜åŒ–çš„æ€§èƒ½ã€æ›´å¥½çš„å…¼å®¹æ€§å’Œæ›´æµç•…çš„å¼€å‘ä½“éªŒã€‚æ„å»ºè¿‡ç¨‹ä¸å†æ˜¯ç®€å•çš„ä»£ç è½¬æ¢ï¼Œè€Œæ˜¯ç¡®ä¿å·¥å…·è´¨é‡å’Œç”¨æˆ·ä½“éªŒçš„å…³é”®ç¯èŠ‚ã€‚</p>`,48)])])}const B=n(o,[["render",e]]);export{i as __pageData,B as default};

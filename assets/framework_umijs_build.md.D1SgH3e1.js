import{_ as a,c as n,o as l,b as p}from"./chunks/framework.CMLuPXeo.js";const u=JSON.parse('{"title":"umijs 构建与部署","description":"","frontmatter":{},"headers":[{"level":2,"title":"构建配置","slug":"构建配置","link":"#构建配置","children":[{"level":3,"title":"默认构建行为","slug":"默认构建行为","link":"#默认构建行为","children":[]},{"level":3,"title":"基础配置选项","slug":"基础配置选项","link":"#基础配置选项","children":[]}]},{"level":2,"title":"部署配置","slug":"部署配置","link":"#部署配置","children":[{"level":3,"title":"基础路径配置","slug":"基础路径配置","link":"#基础路径配置","children":[]},{"level":3,"title":"路由历史模式","slug":"路由历史模式","link":"#路由历史模式","children":[]},{"level":3,"title":"按需加载","slug":"按需加载","link":"#按需加载","children":[]}]},{"level":2,"title":"高级部署方案","slug":"高级部署方案","link":"#高级部署方案","children":[{"level":3,"title":"静态化输出","slug":"静态化输出","link":"#静态化输出","children":[]},{"level":3,"title":"环境特定配置","slug":"环境特定配置","link":"#环境特定配置","children":[]}]},{"level":2,"title":"服务端配置","slug":"服务端配置","link":"#服务端配置","children":[{"level":3,"title":"Nginx 配置示例","slug":"nginx-配置示例","link":"#nginx-配置示例","children":[]},{"level":3,"title":"部署流程","slug":"部署流程","link":"#部署流程","children":[]}]},{"level":2,"title":"部署最佳实践","slug":"部署最佳实践","link":"#部署最佳实践","children":[{"level":3,"title":"性能优化","slug":"性能优化","link":"#性能优化","children":[]},{"level":3,"title":"环境一致性","slug":"环境一致性","link":"#环境一致性","children":[]},{"level":3,"title":"错误排查","slug":"错误排查","link":"#错误排查","children":[]}]}],"relativePath":"framework/umijs/build.md","filePath":"framework/umijs/build.md"}'),e={name:"framework/umijs/build.md"};function o(t,s,i,c,r,d){return l(),n("div",null,[...s[0]||(s[0]=[p(`<div style="display:none;" hidden="true" aria-hidden="true">Are you an LLM? You can read better optimized documentation at /framework/umijs/build.md for this page in Markdown format</div><h1 id="umijs-构建与部署" tabindex="-1">umijs 构建与部署 <a class="header-anchor" href="#umijs-构建与部署" aria-label="Permalink to &quot;umijs 构建与部署&quot;">​</a></h1><h2 id="构建配置" tabindex="-1">构建配置 <a class="header-anchor" href="#构建配置" aria-label="Permalink to &quot;构建配置&quot;">​</a></h2><h3 id="默认构建行为" tabindex="-1">默认构建行为 <a class="header-anchor" href="#默认构建行为" aria-label="Permalink to &quot;默认构建行为&quot;">​</a></h3><p>UmiJS 默认采用对新手友好的构建方案，执行 <code>umi build</code> 后会在项目根目录下生成 <code>dist</code> 目录，其中包含三个核心文件：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span>dist/</span></span>
<span class="line"><span>├── index.html</span></span>
<span class="line"><span>├── umi.js</span></span>
<span class="line"><span>└── umi.css</span></span></code></pre></div><h3 id="基础配置选项" tabindex="-1">基础配置选项 <a class="header-anchor" href="#基础配置选项" aria-label="Permalink to &quot;基础配置选项&quot;">​</a></h3><p><strong>不输出 HTML 文件</strong> 当 HTML 文件由后端输出时，可配置不生成 HTML 文件：</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#E1E4E8;">HTML</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">none</span><span style="color:#B392F0;"> umi</span><span style="color:#9ECBFF;"> build</span></span></code></pre></div><p><strong>静态资源路径配置</strong> 当静态资源存放在非根目录或 CDN 时，需要配置 publicPath：</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#F97583;">export</span><span style="color:#F97583;"> default</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  publicPath: </span><span style="color:#9ECBFF;">&quot;http://yourcdn/path/to/static/&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">};</span></span></code></pre></div><p><strong>运行时 publicPath</strong> 如需在 HTML 中动态管理 publicPath，可启用 runtimePublicPath：</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#F97583;">export</span><span style="color:#F97583;"> default</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  runtimePublicPath: </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">};</span></span></code></pre></div><p>在 HTML 中输出：</p><div class="language-html"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#E1E4E8;">&lt;</span><span style="color:#85E89D;">script</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">  window.publicPath </span><span style="color:#F97583;">=</span><span style="color:#F97583;"> &lt;%=</span><span style="color:#79B8FF;"> YOUR</span><span style="color:#79B8FF;"> PUBLIC_PATH</span><span style="color:#F97583;"> %&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">&lt;/</span><span style="color:#85E89D;">script</span><span style="color:#E1E4E8;">&gt;</span></span></code></pre></div><h2 id="部署配置" tabindex="-1">部署配置 <a class="header-anchor" href="#部署配置" aria-label="Permalink to &quot;部署配置&quot;">​</a></h2><h3 id="基础路径配置" tabindex="-1">基础路径配置 <a class="header-anchor" href="#基础路径配置" aria-label="Permalink to &quot;基础路径配置&quot;">​</a></h3><p>部署到非根目录时，必须配置 base 选项以确保资源正确加载：</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#F97583;">export</span><span style="color:#F97583;"> default</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  base: </span><span style="color:#9ECBFF;">&#39;/path/to/your/app/root&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">};</span></span></code></pre></div><p>示意图：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span>本地开发：http://localhost:8000/</span></span>
<span class="line"><span>部署路径：https://domain.com/path/to/your/app/root/</span></span></code></pre></div><h3 id="路由历史模式" tabindex="-1">路由历史模式 <a class="header-anchor" href="#路由历史模式" aria-label="Permalink to &quot;路由历史模式&quot;">​</a></h3><p><strong>Hash 历史模式</strong> 使用 hash 类型的历史路由可避免服务端配置问题：</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#F97583;">export</span><span style="color:#F97583;"> default</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  history: { type: </span><span style="color:#9ECBFF;">&#39;hash&#39;</span><span style="color:#E1E4E8;"> },</span></span>
<span class="line"><span style="color:#E1E4E8;">};</span></span></code></pre></div><p><strong>Browser 历史模式</strong> 默认使用 browser history，需服务端配合支持。</p><h3 id="按需加载" tabindex="-1">按需加载 <a class="header-anchor" href="#按需加载" aria-label="Permalink to &quot;按需加载&quot;">​</a></h3><p>通过配置 dynamicImport 实现路由级按需加载：</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#F97583;">export</span><span style="color:#F97583;"> default</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  dynamicImport: {},</span></span>
<span class="line"><span style="color:#E1E4E8;">};</span></span></code></pre></div><h2 id="高级部署方案" tabindex="-1">高级部署方案 <a class="header-anchor" href="#高级部署方案" aria-label="Permalink to &quot;高级部署方案&quot;">​</a></h2><h3 id="静态化输出" tabindex="-1">静态化输出 <a class="header-anchor" href="#静态化输出" aria-label="Permalink to &quot;静态化输出&quot;">​</a></h3><p>对于静态托管服务，可配置 exportStatic 为每个路由生成独立的 HTML 文件：</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#F97583;">export</span><span style="color:#F97583;"> default</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  exportStatic: {},</span></span>
<span class="line"><span style="color:#E1E4E8;">};</span></span></code></pre></div><p>构建结果：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span>./dist/</span></span>
<span class="line"><span>├── index.html</span></span>
<span class="line"><span>├── list/</span></span>
<span class="line"><span>│   └── index.html</span></span>
<span class="line"><span>└── static/</span></span>
<span class="line"><span>    ├── pages__index.5c0f5f51.async.js</span></span>
<span class="line"><span>    ├── pages__list.f940b099.async.js</span></span>
<span class="line"><span>    ├── umi.2eaebd79.js</span></span>
<span class="line"><span>    └── umi.f4cb51da.css</span></span></code></pre></div><p><strong>HTML 后缀支持</strong> 某些容器环境需要 <code>.html</code> 后缀时：</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#F97583;">export</span><span style="color:#F97583;"> default</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  exportStatic: {</span></span>
<span class="line"><span style="color:#E1E4E8;">    htmlSuffix: </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  },</span></span>
<span class="line"><span style="color:#E1E4E8;">};</span></span></code></pre></div><p>生成结构：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span>dist/</span></span>
<span class="line"><span>├── index.html</span></span>
<span class="line"><span>└── list.html  # 替代 list/index.html</span></span></code></pre></div><h3 id="环境特定配置" tabindex="-1">环境特定配置 <a class="header-anchor" href="#环境特定配置" aria-label="Permalink to &quot;环境特定配置&quot;">​</a></h3><p><strong>多环境配置</strong> 通过环境变量区分不同环境的配置：</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;">// package.json</span></span>
<span class="line"><span style="color:#9ECBFF;">&quot;scripts&quot;</span><span style="color:#E1E4E8;">: {</span></span>
<span class="line"><span style="color:#9ECBFF;">  &quot;build:dev&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;cross-env UMI_ENV=dev umi build&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#9ECBFF;">  &quot;build:prod&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;cross-env UMI_ENV=prod umi build&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre></div><p><strong>配置文件支持</strong> 可创建环境特定的配置文件：</p><ul><li><code>.umirc.js</code> - 基础配置</li><li><code>.umirc.prod.js</code> - 生产环境配置</li></ul><h2 id="服务端配置" tabindex="-1">服务端配置 <a class="header-anchor" href="#服务端配置" aria-label="Permalink to &quot;服务端配置&quot;">​</a></h2><h3 id="nginx-配置示例" tabindex="-1">Nginx 配置示例 <a class="header-anchor" href="#nginx-配置示例" aria-label="Permalink to &quot;Nginx 配置示例&quot;">​</a></h3><p>使用 Nginx 作为反向代理服务器的配置示例：</p><div class="language-nginx"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#F97583;">server</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#F97583;">    listen </span><span style="color:#79B8FF;">80</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">    server_name </span><span style="color:#E1E4E8;">your_domain.com;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#F97583;">    root </span><span style="color:#E1E4E8;">/path/to/your/project/dist;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#F97583;">    location</span><span style="color:#B392F0;"> / </span><span style="color:#E1E4E8;">{</span></span>
<span class="line"><span style="color:#F97583;">        try_files </span><span style="color:#E1E4E8;">$uri $uri/ /index.html;</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre></div><h3 id="部署流程" tabindex="-1">部署流程 <a class="header-anchor" href="#部署流程" aria-label="Permalink to &quot;部署流程&quot;">​</a></h3><p><strong>标准部署步骤</strong>：</p><ol><li>准备服务器环境 (Node.js、Nginx)</li><li>获取项目代码：<code>git clone &lt;项目仓库地址&gt;</code></li><li>安装依赖：<code>npm install</code></li><li>构建项目：<code>npm run build</code></li><li>配置 Nginx 并重启服务</li><li>验证部署结果</li></ol><h2 id="部署最佳实践" tabindex="-1">部署最佳实践 <a class="header-anchor" href="#部署最佳实践" aria-label="Permalink to &quot;部署最佳实践&quot;">​</a></h2><h3 id="性能优化" tabindex="-1">性能优化 <a class="header-anchor" href="#性能优化" aria-label="Permalink to &quot;性能优化&quot;">​</a></h3><p><strong>CDN 加速</strong> 配合 CDN 使用可大幅提升静态资源加载速度：</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#F97583;">export</span><span style="color:#F97583;"> default</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  publicPath: </span><span style="color:#9ECBFF;">&#39;https://cdn.example.com/your-project/&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">};</span></span></code></pre></div><p><strong>资源压缩</strong> 确保开启构建时的压缩优化，减少资源体积。</p><h3 id="环境一致性" tabindex="-1">环境一致性 <a class="header-anchor" href="#环境一致性" aria-label="Permalink to &quot;环境一致性&quot;">​</a></h3><p><strong>容器化部署</strong> 建议使用 Docker 确保环境一致性，通过流程管理工具如 PM2 管理进程。</p><p><strong>持续集成</strong> 集成到 CI/CD 流程，实现自动化测试、构建和部署：</p><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># GitLab CI 示例</span></span>
<span class="line"><span style="color:#85E89D;">stages</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#9ECBFF;">build</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#9ECBFF;">deploy</span></span>
<span class="line"></span>
<span class="line"><span style="color:#85E89D;">build</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">  stage</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">build</span></span>
<span class="line"><span style="color:#85E89D;">  script</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#9ECBFF;">npm install</span></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#9ECBFF;">npm run build</span></span>
<span class="line"><span style="color:#85E89D;">  artifacts</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#85E89D;">    paths</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#9ECBFF;">dist/</span></span></code></pre></div><h3 id="错误排查" tabindex="-1">错误排查 <a class="header-anchor" href="#错误排查" aria-label="Permalink to &quot;错误排查&quot;">​</a></h3><p><strong>常见部署问题</strong></p><ul><li>路由空白：检查 base 配置和服务端重定向规则</li><li>资源 404：验证 publicPath 配置</li><li>接口代理失败：检查服务端反向代理配置</li></ul><p>通过合理的构建配置和部署策略，可以确保 UmiJS 应用在各种环境下稳定运行。</p>`,63)])])}const h=a(e,[["render",o]]);export{u as __pageData,h as default};

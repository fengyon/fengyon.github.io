---
url: /engineering/performance/monitoring.md
---
# 性能监控

## 为什么需要性能监控 {#why-performance-monitoring}

Web 性能直接影响用户体验、业务转化率和搜索引擎排名。缓慢的加载会导致用户流失，研究表明页面加载时间每增加 1 秒，转化率可能下降 7%。性能监控帮助识别瓶颈，例如：

```
用户请求 --> [DNS 查询] --> [TCP 连接] --> [请求发送] --> [响应接收] --> [解析 HTML] --> [加载资源 (CSS/JS)] --> [渲染完成]
```

如果任一环节延迟，整体体验受损。通过监控，团队可以量化问题并优先修复高影响区域。

## 关键性能指标 {#key-performance-metrics}

性能监控依赖核心指标，分为加载性能、交互性和视觉稳定性三类：

* **首次内容绘制 (FCP)**：测量页面首次显示任何内容的时间，反映初始加载感知。\
  示意图：\
  `[空白页] --(FCP)--> [文本/图像出现]`

* **最大内容绘制 (LCP)**：记录视口内最大元素 (如图片或文本块) 的渲染时间，代表主要内容就绪。\
  示意图：\
  `[加载中...] --(LCP)--> [主图/标题完全显示]`

* **首次输入延迟 (FID)**：衡量用户首次交互 (如点击按钮) 到浏览器响应的延迟，关键于交互性。\
  示意图：\
  `[用户点击] --(延迟)--> [页面响应]`

* **累积布局偏移 (CLS)**：量化页面布局意外变化的频率，通过元素位移计算。\
  示意图：\
  `[稳定布局] --(广告加载)--> [内容突然下移]`

这些指标基于真实用户数据 (RUM) 和实验室测试，提供全面视图。

## 常用性能监控工具 {#common-performance-monitoring-tools}

### Google Lighthouse

Lighthouse 是开源自动化工具，集成到 Chrome DevTools 或命令行，用于审计性能、可访问性和 SEO。\
**常用功能**：

* 生成性能报告，评分 0-100，并突出显示 FCP、LCP 等指标。
* 提供具体建议，如压缩图片或移除未使用 CSS。
* 支持模拟移动设备，测试 3G/4G 网络条件。\
  特点：免费、易用，适合开发阶段，但缺乏实时监控。

### WebPageTest

WebPageTest 提供深度测试能力，允许从全球多个位置运行测试。\
**常用功能**：

* 多位置测试：从不同地理节点 (如北美、亚洲) 测量加载时间。
* 视频捕获：生成加载过程视频，可视化渲染步骤。
* 自定义脚本：模拟用户交互，如登录或表单提交。\
  特点：高度可配置，支持高级指标如 Speed Index，但需手动触发测试。

### New Relic

New Relic 是应用性能管理 (APM) 平台，提供实时监控和分析。\
**常用功能**：

* 端到端跟踪：从浏览器到后端服务器，识别延迟根源。
* 错误监控：捕获 JavaScript 错误并与性能数据关联。
* 自定义仪表板：可视化关键指标，设置警报阈值。\
  特点：面向企业，支持大规模应用，但成本较高。

### Datadog

Datadog 是云监控服务，整合基础设施、应用和日志数据。\
**常用功能**：

* RUM (真实用户监控)：收集真实用户会话数据，分析 FID、CLS 等。
* 合成监控：通过脚本模拟用户流，检测可用性问题。
* 趋势分析：比较历史数据，识别性能退化。\
  特点：集成性强，适合 DevOps 团队，但配置复杂。

## 如何实施性能监控 {#how-to-implement-performance-monitoring}

实施性能监控需结合工具和策略，覆盖开发到生产环境：

1. **定义目标**：基于业务需求设定阈值，例如 LCP < 2.5 秒。\
   示意图：\
   `[目标设定] --> [工具选择] --> [数据收集] --> [分析优化]`

2. **集成监控**：在代码中嵌入 SDK，如使用 `web-vitals` 库捕获核心指标：

   ```javascript
   import { getLCP } from 'web-vitals'
   getLCP(console.log)
   ```

   同时配置工具如 New Relic 的浏览器代理。

3. **自动化测试**：在 CI/CD 管道中加入 Lighthouse 或 WebPageTest，防止回归。

4. **实时警报**：设置监控规则，当指标超出范围时通知团队，确保快速响应。

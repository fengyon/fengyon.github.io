---
url: /special/security/pentest.md
---
# 渗透测试基础

## 渗透测试定义与价值 {#penetration-testing-definition}

渗透测试是通过**模拟真实攻击**来评估系统安全性的系统化过程。与恶意攻击不同，渗透测试是在授权范围内进行的合法安全评估，旨在发现和修复漏洞，提升整体安全防护能力。

渗透测试价值示意图：

```
业务需求 -> 授权测试 -> 漏洞发现 -> 风险评估 -> 修复建议 -> 安全提升
    ↓           ↓           ↓           ↓           ↓
 合规要求   ->  范围界定   ->  技术漏洞   ->  影响分析   ->  具体方案   ->  防护加固
 安全验证   ->  规则明确   ->  管理缺陷   ->  概率评估   ->  优先级排序   ->  持续改进
```

## 渗透测试类型 {#penetration-testing-types}

### 测试范围分类

**基于知识的测试方法**：

```
黑盒测试: 零知识测试，模拟外部攻击者
    ↓-- 优势 --> 真实模拟外部威胁
灰盒测试: 部分知识测试，模拟内部威胁  
    ↓-- 优势 --> 效率与深度的平衡
白盒测试: 完全知识测试，代码级审查
    ↓-- 优势 --> 全面深度检测
```

### 测试目标分类

**不同层面的安全评估**：

```
网络渗透测试: 网络设备、协议、服务漏洞
    ↓-- 关注点 --> 网络边界安全
Web应用测试: OWASP Top 10漏洞、业务逻辑缺陷
    ↓-- 关注点 --> 应用层安全
移动应用测试: 客户端安全、API接口、数据存储
    ↓-- 关注点 --> 移动端安全
社会工程学: 人员安全意识、物理安全
    ↓-- 关注点 --> 人为因素安全
```

## 渗透测试流程 {#penetration-testing-process}

### PTES 标准阶段

**渗透测试执行标准**：

```
前期交互 -> 情报收集 -> 威胁建模 -> 漏洞分析 -> 渗透攻击 -> 后渗透 -> 报告生成
    ↓           ↓           ↓           ↓           ↓           ↓           ↓
 目标确认   ->  信息搜集   ->  攻击规划   ->  漏洞识别   ->  漏洞利用   ->  权限维持   ->  结果交付
 范围界定   ->  侦查探测   ->  优先级排序   ->  验证测试   ->  获取访问   ->  内网横向   ->  修复建议
```

### 关键阶段详解

**情报收集阶段**：

```
被动信息收集: 
  公开来源: whois查询、DNS记录、搜索引擎
  社交网络: 员工信息、技术栈识别
  
主动信息收集:
  网络扫描: 端口扫描、服务识别、操作系统指纹
  漏洞探测: 版本比对、配置检查、弱点扫描
```

**威胁建模阶段**：

```
资产识别 -> 威胁识别 -> 漏洞映射 -> 风险量化
    ↓           ↓           ↓           ↓
 关键系统   ->  攻击向量   ->  弱点关联   ->  影响评估
 数据流图   ->  攻击树     ->  利用路径   ->  优先级排序
```

## 信息收集技术 {#information-gathering-techniques}

### 网络侦查方法

**端口扫描技术**：

```
TCP Connect扫描: 完整三次握手，准确性高但易被检测
    ↓-- 命令 --> nc -zv target port
SYN半开扫描: 只发送SYN包，隐蔽性较好  
    ↓-- 命令 --> nmap -sS target
UDP扫描: 发送UDP包检测响应，速度较慢
    ↓-- 命令 --> nmap -sU target
```

**服务识别技术**：

```
横幅抓取: 连接服务获取版本信息
    ↓-- 示例 --> Telnet到端口读取欢迎信息
主动探测: 发送特定协议查询
    ↓-- 示例 --> HTTP OPTIONS请求识别Web服务器
指纹识别: 分析协议实现差异
    ↓-- 工具 --> nmap -sV 版本检测
```

### Web 应用信息收集

**应用层侦查**：

```
目录枚举: 发现隐藏文件和目录
    ↓-- 工具 --> dirb、gobuster
子域名发现: 扩展攻击面
    ↓-- 方法 --> 字典爆破、证书透明度日志
技术栈识别: 确定使用的框架和组件
    ↓-- 工具 --> wappalyzer、whatweb
```

## 漏洞分析与利用 {#vulnerability-analysis-exploitation}

### 漏洞分类体系

**常见漏洞类型**：

```
输入验证类: SQL注入、XSS、命令注入
    ↓-- 测试点 --> 用户输入处理
配置错误类: 默认凭证、不安全的权限
    ↓-- 测试点 --> 系统配置检查
业务逻辑类: 权限绕过、流程缺陷  
    ↓-- 测试点 --> 业务功能测试
```

### 漏洞利用框架

**Metasploit 架构**：

```
漏洞模块 -> 载荷模块 -> 编码模块 -> 执行控制
    ↓           ↓           ↓           ↓
 利用代码   ->  后门程序   ->  免杀处理   ->  会话管理
 攻击向量   ->  功能实现   ->  规避检测   ->  交互操作
```

**利用流程示例**：

```
选择漏洞模块 -> 配置参数 -> 选择载荷 -> 执行攻击 -> 建立会话
    ↓           ↓           ↓           ↓           ↓
 搜索漏洞   ->  目标IP   ->  reverse_shell ->  运行利用   ->  控制目标
 设置选项   ->  端口号   ->  meterpreter ->  获取权限   ->  后渗透阶段
```

## 后渗透技术 {#post-exploitation-techniques}

### 权限提升方法

**横向移动技术**：

```
凭证获取: 内存提取、配置文件查找
    ↓-- 工具 --> mimikatz、LaZagne
网络侦查: 内网主机发现、服务枚举
    ↓-- 命令 --> arp-scan、nbtscan
权限维持: 后门安装、计划任务
    ↓-- 技术 --> 持久化机制
```

### 数据收集与渗出

**敏感信息定位**：

```
文件系统: 配置文件、日志文件、备份文件
    ↓-- 路径 --> /etc/passwd、注册表、数据库文件
内存数据: 进程内存、网络连接信息
    ↓-- 工具 --> procdump、netstat
网络嗅探: 捕获网络流量、分析通信协议
    ↓-- 工具 --> Wireshark、tcpdump
```

## 渗透测试方法论 {#penetration-testing-methodology}

### 结构化测试方法

**OSSTMM 测试框架**：

```
范围界定 -> 信息收集 -> 网络调查 -> 系统调查 -> 应用调查 -> 报告编制
    ↓           ↓           ↓           ↓           ↓           ↓
 通道分析   ->  资产发现   ->  协议测试   ->  配置审计   ->  逻辑测试   ->  度量指标
 攻击面   ->  拓扑映射   ->  服务测试   ->  权限测试   ->  数据流测试   ->  风险评分
```

### OWASP 测试指南

**Web 应用测试模型**：

```
信息收集 -> 配置管理 -> 身份认证 -> 会话管理 -> 授权测试 -> 业务逻辑
    ↓           ↓           ↓           ↓           ↓           ↓
 应用识别   ->  部署配置   ->  密码策略   ->  会话固定   ->  权限绕过   ->  流程缺陷
 架构分析   ->  环境安全   ->  多因素认证   ->  超时设置   ->  水平越权   ->  输入验证
```

## 工具与技术栈 {#tools-technical-stack}

### 标准工具集

**渗透测试工具分类**：

```
信息收集: 
  nmap、masscan、theHarvester、Shodan
  
漏洞扫描:
  Nessus、OpenVAS、Nexpose、Nuclei
  
渗透利用:
  Metasploit、Burp Suite、sqlmap、Hydra
  
后渗透工具:
  Empire、Cobalt Strike、Mimikatz、BloodHound
```

### 自动化测试框架

**集成测试平台**：

```
Kali Linux: 渗透测试专用发行版
    ↓-- 包含 --> 600+安全工具
Parrot OS: 安全专家操作系统  
    ↓-- 特点 --> 匿名性、开发环境
BlackArch: Arch Linux安全发行版
    ↓-- 包含 --> 2000+安全工具
```

## 合规与授权 {#compliance-authorization}

### 法律框架要求

**测试授权要素**：

```
授权范围: 明确的IP范围、系统列表、测试时间
    ↓-- 必须包含 --> 开始/结束时间、特定系统
测试方法: 允许的技术手段、禁止的操作
    ↓-- 示例 --> 允许漏洞扫描，禁止DDoS攻击
应急计划: 意外情况处理、联系人信息
    ↓-- 要求 --> 紧急停止程序、恢复方案
```

### 风险管理

**测试风险控制**：

```
系统影响: 性能下降、服务中断、数据损坏
    ↓-- 缓解措施 --> 备份、非高峰测试
业务影响: 业务中断、数据泄露风险
    ↓-- 缓解措施 --> 分段测试、监控告警
法律风险: 超范围测试、第三方影响
    ↓-- 缓解措施 --> 严格授权、法律审查
```

## 报告与交付 {#reporting-delivery}

### 报告结构标准

**专业渗透测试报告**：

```
执行摘要 -> 测试范围 -> 方法论 -> 发现汇总 -> 详细发现 -> 修复建议 -> 附录
    ↓           ↓           ↓           ↓           ↓           ↓           ↓
 高层概述   ->  测试边界   ->  测试方法   ->  漏洞统计   ->  技术细节   ->  解决方案   ->  证据材料
 业务影响   ->  时间范围   ->  工具使用   ->  风险评级   ->  复现步骤   ->  优先级   ->  日志记录
```

### 漏洞评级体系

**风险量化模型**：

```
技术影响: 机密性、完整性、可用性影响程度
    ↓-- 评分 --> 0-10分量化
利用难度: 攻击复杂度、所需权限、用户交互
    ↓-- 评分 --> 0-10分量化  
环境因素: 资产价值、安全控制、业务需求
    ↓-- 调整 --> 最终风险等级
```
